(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function ue(r){const e=new Set;function t(o){e.add(o)}function n(o){e.delete(o)}const i={get(o,a){return a==="__subscribe"?t:a==="__unsubscribe"?n:typeof o[a]=="object"&&o[a]!==null&&!(o[a]instanceof HTMLElement)?new Proxy(o[a],i):o[a]},set(o,a,f){o[a]=f;for(const d of e)d.__update();return!0}};return new Proxy(r,i)}function Ee(r){return $e(new Ae(r))}function $e(r){function e(n,i){return typeof n[i]!="object"||n[i]!==null?n[i]:new Proxy(n[i],{set:(o,a,f)=>(t.__handleEffect(t.__isReactive(f),()=>{o[a]=t.__handleFunction(f)}),!0),get:(o,a)=>e(o,a)})}const t=new Proxy(r,{get:(n,i)=>{if(i in n)return n[i];if(i in n.__element)return e(n.__element,i)},set:(n,i,s)=>(i in n?n[i]=s:i=="style"?n.$set_style(s):i in n.__element&&n.$property(i,s),!0)});return t}class Ae{constructor(e){if(typeof e=="string")this.__element=document.createElement(e);else if(e instanceof HTMLElement)this.__element=e;else throw new Error("Invalid element name");this.__events=[],this.__children=[],this.__states=new Set,this.__unmounted_events=[],this.__mounted_events=[],this.__parent=null}__update(){for(const e of this.__events)e()}$click(){return this.__element.click(),this}$find(e){var t=[];this.__element.matches(e)&&t.push($e(this));for(const n of this.__children)t=t.concat(n.$find(e));return t}$update(){for(const e of this.__events)e();for(const e of this.__children)e.$update()}__parseInput(e){if(e&&e.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"){for(const t of e.elements)t&&t.__subscribe&&(this.__states.add(t),t.__subscribe(this));return e.expression}return e}__observeParent(){setTimeout(()=>{for(const t of this.__mounted_events)t()},0),new MutationObserver(t=>{for(const n of t){if(n.type==="childList"&&n.removedNodes.length){for(const i of n.removedNodes)if(i===this.__element){this.__unsubscribe();for(const s of this.__unmounted_events)s()}}if(n.type==="childList"&&n.addedNodes.length){for(const i of n.addedNodes)if(i===this.__element){this.__subscribe();for(const s of this.__mounted_events)s()}}}}).observe(this.__element.parentElement,{childList:!0})}__subscribe(){if(this.__states)for(const e of this.__states)e.__subscribe(this)}__unsubscribe(){for(const e of this.__children)e.__unsubscribe();if(this.__states)for(const e of this.__states)e.__unsubscribe(this)}__handleFunction(e){return typeof e=="function"?e():e}__handleEffect(e,t){e?(t(),this.__events.push(t)):t()}__isReactive(...e){for(const t of e)if(typeof t=="function")return!0;return!1}$if(e){return e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{const t=this.__handleFunction(e);this.$style("display",t?"":"none")}),this}$class(e,t=!0){e=this.__parseInput(e),t=this.__parseInput(t);var n=null;return this.__handleEffect(this.__isReactive(e,t),()=>{const i=this.__handleFunction(e);if(i)if(typeof i=="object")for(const s in i)i[s]?this.__element.classList.add(s):this.__element.classList.remove(s);else this.__handleFunction(t)?(this.__isReactive(e)&&(n&&this.__element.classList.remove(...n.split(" ").filter(s=>s.length>0)),n=i),this.__element.classList.add(...i.split(" ").filter(s=>s.length>0))):(this.__element.classList.remove(...i.split(" ").filter(s=>s.length>0)),n=null)}),this}get parentElement(){return this.__parent}$parent(e){return this.__parent=e,e.__element!==void 0?(e.__element.appendChild(this.__element),e.__children.push(this)):e.appendChild(this.__element),this.__observeParent(),this}$parentBefore(e){return this.__parent=e,e.__element!==void 0?e.__element.firstChild?e.__element.insertBefore(this.__element,e.__element.firstChild):e.__element.appendChild(this.__element):e.firstChild?e.insertBefore(this.__element,e.firstChild):e.appendChild(this.__element),this.__observeParent(),this}$on(e,t){return this.__element.addEventListener(e,t),this}__clean_input(e){return e&&e.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?e.expression:e}$onUpdate(e){return this.__events.push(e),this}$onMounted(e){this.__mounted_events.push(e)}$onUnmounted(e){this.__unmounted_events.push(e)}$property(e,t){return e=this.__parseInput(e),t=this.__parseInput(t),this.__handleEffect(this.__isReactive(e,t),()=>{this.__element[this.__handleFunction(e)]=this.__handleFunction(t)}),this}$style(e,t=null){return t?(this.__style(e,t),this):(e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{var n=this.__handleFunction(e);if(typeof n=="object")for(const i in n)this.__element.style[i]=n[i];else{const i=n.split(";").filter(s=>s.length>0);this.__element.style={};for(const s of i){const[o,a]=s.split(":");this.__element.style.setProperty(o,this.__handleFunction(a))}}}),this)}__style(e,t){return e=this.__parseInput(e),t=this.__parseInput(t),this.__handleEffect(this.__isReactive(e,t),()=>{this.__element.style[this.__handleFunction(e)]=this.__handleFunction(t)}),this}$get_computed_style(e){return window.getComputedStyle(this.__element).getPropertyValue(e)}$html(e){return e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{this.__element.innerHTML=this.__handleFunction(e)}),this}$child(e){e=this.__parseInput(e);var t;this.__isReactive(e)?t=Ee("span").$parent(this):t=this;var n=null;return this.__handleEffect(this.__isReactive(e),()=>{var i=this.__handleFunction(e);n&&n();const s=a=>a==null?()=>{}:a.__element!==void 0?(a.$parent(t),()=>a.$remove()):(a instanceof HTMLElement||(a=document.createTextNode(a)),t.__element.appendChild(a),()=>a.remove());if(Array.isArray(i)){var o=[];for(const a of i)o.push(s(a));n=()=>{for(const a of o)a()}}else n=s(i)}),this}$remove(){return this.__parent=null,this.__element.remove(),this}$model([e,t]){return this.$property("value",e),this.$on("input",n=>t(n.target.value)),this}}function Te(r){return r&&r.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?r.expression:r}const p=(r,e,...t)=>{var n,i=!1;if(typeof r=="function"){var s={};if(e)for(const[f,d]of Object.entries(e))s[f]=Te(d);if(n=r(s,...t),n===void 0)return t;i=!0}else n=Ee(r);const o={ref:f=>{f.__ref_object=n},style:f=>{n.$style(f)},class:f=>{n.$class(f)},parent:f=>{n.$parent(f)},if:f=>{n.$if(f)},model:([f,d])=>{n.$model([f,d])}},a={on:(f,d)=>{n.$on(f,d)}};if(e)for(const[f,d]of Object.entries(e)){const l=f.split(":");l.length==2?a[l[0]]&&a[l[0]](l[1],d):o[f]?o[f](d):i||n.$property(f,d)}if(t&&!i)for(const f of t)n.$child(f);return n};function z(r=null){var e=r;return new Proxy({},{get:(n,i)=>{if(e!=null)return e[i]},set:(n,i,s)=>(i==="__ref_object"&&(e=s),s!=null&&(e[i]=s),!0)})}function we(r){return[(r>>0&255)/255,(r>>8&255)/255,(r>>16&255)/255,1]}function ye(r){return r[0]+(r[1]<<8)+(r[2]<<16)-1}const Le=[[0,0,1,0,0,1,0,0,1,0,0,1],[0,0,-1,0,0,-1,0,0,-1,0,0,-1],[0,1,0,0,1,0,0,1,0,0,1,0],[0,-1,0,0,-1,0,0,-1,0,0,-1,0],[1,0,0,1,0,0,1,0,0,1,0,0],[-1,0,0,-1,0,0,-1,0,0,-1,0,0]],Se=[[-1,-1,1,1,-1,1,1,1,1,-1,1,1],[-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1],[-1,1,-1,-1,1,1,1,1,1,1,1,-1],[-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1],[1,-1,-1,1,1,-1,1,1,1,1,-1,1],[-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]],Be=[[0,1,2,0,2,3],[4,5,6,4,6,7],[8,9,10,8,10,11],[12,13,14,12,14,15],[16,17,18,16,18,19],[20,21,22,20,22,23]],Pe=[[0,1,1,2,2,3,3,0],[4,5,5,6,6,7,7,4],[8,9,9,10,10,11,11,8],[12,13,13,14,14,15,15,12],[16,17,17,18,18,19,19,16],[20,21,21,22,22,23,23,20]],Y=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],Ie=[1,1,1];function Q(r,e){return r[0]+1==e[0]&&r[1]==e[1]&&r[2]==e[2]}function j(r,e){return r[0]-1==e[0]&&r[1]==e[1]&&r[2]==e[2]}function ee(r,e){return r[1]+1==e[1]&&r[0]==e[0]&&r[2]==e[2]}function te(r,e){return r[1]-1==e[1]&&r[0]==e[0]&&r[2]==e[2]}function ne(r,e){return r[2]+1==e[2]&&r[0]==e[0]&&r[1]==e[1]}function ie(r,e){return r[2]-1==e[2]&&r[0]==e[0]&&r[1]==e[1]}const he=[[0,1,0,1,0,1],[0,1,0,1,1,0],[0,1,1,0,0,1],[0,1,1,0,1,0],[1,0,0,1,0,1],[1,0,0,1,1,0],[1,0,1,0,0,1],[1,0,1,0,1,0]];class Me{constructor(){this.voxels=[[0,0,0]],this.color=[],this.init_colors(this.voxels)}init_colors(e){for(var t=[],n=0;n<e.length;n++){var i=[];t.push(i);for(var s=0;s<6;s++)i.push([...Ie])}this.color.push(...t)}build_geometry(){for(var e=[],t=[],n=[],i=[],s=[],o=[],a=0,f=1,d=0;d<this.voxels.length;d++){for(var l=0,u=0,m=f-1,b=[],_=0;_<6;_++){if(this.faces[d][_]==0){u+=4;continue}n.push(...Se[_].map((R,F)=>R+this.voxels[d][F%3]*2-this.center[F%3])),s.push(...Le[_]),o.push(...Pe[_].map(R=>R+a-u)),i.push(...Be[_].map(R=>R+a-u)),l+=4;for(var c=we(f),y=0;y<4;y++)b.push(...c);f++}a+=l,t.push({start:m,end:f-1}),e.push(...b)}this.id=f,this.distance=a,this.geometry_vertexes=n,this.geometry_indexes=i,this.geometry_normals=s,this.geometry_edge_index=o,this.pick_map=e,this.pick_meta=t}init(){this.build_boundary(),this.build_center(),this.build_faces(),this.build_geometry()}add(...e){this.voxels.push(...e),this.init_colors(e),this.build_boundary(),this.build_center(),this.rebuild_faces(e),this.build_geometry()}subdivide(){var e=[],t=[],n=[];for(const f in this.voxels){const d=this.voxels[f],l=this.faces[f],u=[d[0]*2,d[1]*2,d[2]*2];for(var i=0;i<8;i++){var s=[];n.push(s);for(var o=0;o<6;o++)s.push([...this.color[f][o]])}e.push([u[0],u[1],u[2]],[u[0]+1,u[1],u[2]],[u[0],u[1]+1,u[2]],[u[0]+1,u[1]+1,u[2]],[u[0],u[1],u[2]+1],[u[0]+1,u[1],u[2]+1],[u[0],u[1]+1,u[2]+1],[u[0]+1,u[1]+1,u[2]+1]);for(var o in he){var a=Array(6).fill(0);for(var i in he[o])he[o][i]==1&&l[i]==1&&(a[i]=1);t.push(a)}}this.voxels=e,this.faces=t,this.color=n,this.build_boundary(),this.build_center(),this.build_geometry()}remove(...e){for(const n of e){if(this.voxels.length==1){e.splice(e.indexOf(n),1);continue}for(var t=0;t<this.voxels.length;t++)if(this.voxels[t][0]==n[0]&&this.voxels[t][1]==n[1]&&this.voxels[t][2]==n[2]){this.voxels.splice(t,1),this.faces.splice(t,1),this.color.splice(t,1);break}}this.build_boundary(),this.build_center(),this.rebuild_remove_faces(e),this.build_geometry()}get_plane_color(e,t,n=null){var i=[];for(const l in this.pick_meta){const u=this.faces[l];for(var s=0,o=0;o<u.length;o++){if(u[o]==0){s+=1;continue}if(e.includes(l)){if(n!=null)var a=this.color[l][o];else var a=this.color[l][o].map(b=>Math.abs(1-b*.3));if(s==t){if(n!=null)var f=this.color[l][o].map((m,b)=>m*(1-n[3])+n[b]*n[3]);else var f=this.color[l][o].map(b=>Math.abs(1-b*.5));for(var d=0;d<4;d++)i.push(...f,1)}else for(var d=0;d<4;d++)i.push(...a,1)}else for(var d=0;d<4;d++)i.push(...this.color[l][o],1);s+=1}}return i}get_plane(e,t){var n=[];for(const o in this.voxels){const a=this.voxels[o];var i=!0;for(const f in t)if(t[f]!=0&&e[f]!=a[f]){i=!1;break}if(i){var s=this.voxels[o].map((f,d)=>f+t[d]);this.voxels.some(f=>f[0]==s[0]&&f[1]==s[1]&&f[2]==s[2])||n.push(o)}}return n}get_contiguous(e,t,n){var i=[];const s=this.voxels,o=new Set;function a(f){for(const m of e){const b=s[m];var d=!0;for(const _ in n)if(n[_]!=0){if(f[_]!=b[_]){d=!1;break}}else if(Math.abs(f[_]-b[_])>1){d=!1;break}if(d){var l=s[m].map((_,c)=>_+n[c]),u=`${l[0]},${l[1]},${l[2]}`;o.has(u)||(o.add(u),i.push(m),a(s[m]))}}}return a(t),i}get_vertical_line(e,t,n){var i=[];for(const f in this.voxels){const d=this.voxels[f];var s=!0,o=-1;for(const l in t)if(t[l]!=0&&(o=l,e[l]!=d[l])){s=!1;break}if(o==0){for(const l in t)if(t[l]==0&&e[l]!=d[l]&&l==2){s=!1;break}}else if(o==2){for(const l in t)if(t[l]==0&&e[l]!=d[l]&&l==0){s=!1;break}}else if(o==1){for(const l in t)if(t[l]==0&&e[l]!=d[l]&&l==0){s=!1;break}}else s=!1;if(s){var a=this.voxels[f].map((l,u)=>l+t[u]);this.voxels.some(l=>l[0]==a[0]&&l[1]==a[1]&&l[2]==a[2])||i.push(f)}}return i}get_horizontal_line(e,t,n){var i=[];for(const f in this.voxels){const d=this.voxels[f];var s=!0,o=-1;for(const l in t)if(t[l]!=0){if(o=l,e[l]!=d[l]){s=!1;break}}else if(e[l]!=d[l]&&l==1){s=!1;break}if(o==1){for(const l in t)if(t[l]==0&&e[l]!=d[l]&&l==2){s=!1;break}}if(s){var a=this.voxels[f].map((l,u)=>l+t[u]);this.voxels.some(l=>l[0]==a[0]&&l[1]==a[1]&&l[2]==a[2])||i.push(f)}}return i}highlight_plane(e,t,n,i,s=null){var o=ye(e),m=[],a=0;for(const _ in this.pick_meta){const c=this.faces[_],y=this.pick_meta[_];if(o>=y.start&&o<y.end)for(var f=0,d=0;d<c.length;d++){if(c[d]==0){f+=1;continue}if(o==a){var l;switch(n){case"Plane":l=this.get_plane(this.voxels[_],Y[f]);break;case"Horizontal line":l=this.get_horizontal_line(this.voxels[_],Y[f]);break;case"Vertical line":l=this.get_vertical_line(this.voxels[_],Y[f]);break}i&&(l=this.get_contiguous(l,this.voxels[_],Y[f]));var u=[];for(const R of l)u.push(this.color[R][f]);return t({voxel:l.map(R=>this.voxels[R]),direction:Y[f],color:u,mouse_color:this.color[_][d],index:_}),this.get_plane_color(l,f,s)}f+=1,a+=1}else for(var d=0;d<c.length;d++)c[d]!=0&&(a+=1)}var m=[];for(const _ in this.pick_meta){const c=this.faces[_];for(var d=0;d<c.length;d++)if(c[d]!=0)for(var b=0;b<4;b++)m.push(...this.color[_][d],1)}return m}get_highlight(e,t,n=null){var i=ye(e),s=[],o=0;for(const m in this.pick_meta){const b=this.faces[m],_=this.pick_meta[m];if(i>=_.start&&i<_.end)for(var a=0,f=0;f<b.length;f++){if(b[f]==0){a+=1;continue}if(n!=null)var d=this.color[m][f];else var d=this.color[m][f].map(y=>Math.abs(1-y*.3));if(i==o){if(n!=null)var l=this.color[m][f].map((c,y)=>c*(1-n[3])+n[y]*n[3]);else var l=this.color[m][f].map(y=>Math.abs(1-y*.5));t({voxel:[this.voxels[m]],direction:Y[a],color:[this.color[m][f]],mouse_color:this.color[m][f],index:m});for(var u=0;u<4;u++)s.push(...l,1)}else for(var u=0;u<4;u++)s.push(...d,1);a+=1,o+=1}else for(var f=0;f<b.length;f++)if(b[f]!=0){for(var u=0;u<4;u++)s.push(...this.color[m][f],1);o+=1}}return s}rebuild_faces(e){const t=new Array(e.length).fill(0).map(s=>[1,1,1,1,1,1]);for(var n=0;n<e.length;n++)for(var i=0;i<this.faces.length;i++)Q(e[n],this.voxels[i])&&(t[n][4]=0,this.faces[i][5]=0),j(e[n],this.voxels[i])&&(t[n][5]=0,this.faces[i][4]=0),ee(e[n],this.voxels[i])&&(t[n][2]=0,this.faces[i][3]=0),te(e[n],this.voxels[i])&&(t[n][3]=0,this.faces[i][2]=0),ne(e[n],this.voxels[i])&&(t[n][0]=0,this.faces[i][1]=0),ie(e[n],this.voxels[i])&&(t[n][1]=0,this.faces[i][0]=0);for(var n=0;n<e.length;n++)for(var i=n+1;i<e.length;i++)Q(e[n],e[i])&&(t[n][4]=0,t[i][5]=0),j(e[n],e[i])&&(t[n][5]=0,t[i][4]=0),ee(e[n],e[i])&&(t[n][2]=0,t[i][3]=0),te(e[n],e[i])&&(t[n][3]=0,t[i][2]=0),ne(e[n],e[i])&&(t[n][0]=0,t[i][1]=0),ie(e[n],e[i])&&(t[n][1]=0,t[i][0]=0);this.faces.push(...t)}rebuild_remove_faces(e){for(var t=0;t<e.length;t++)for(var n=0;n<this.voxels.length;n++)Q(e[t],this.voxels[n])&&(this.faces[n][5]=1),j(e[t],this.voxels[n])&&(this.faces[n][4]=1),ee(e[t],this.voxels[n])&&(this.faces[n][3]=1),te(e[t],this.voxels[n])&&(this.faces[n][2]=1),ne(e[t],this.voxels[n])&&(this.faces[n][1]=1),ie(e[t],this.voxels[n])&&(this.faces[n][0]=1)}build_faces(){const e=this.voxels,t=new Array(e.length).fill(0).map(s=>[1,1,1,1,1,1]);for(var n=0;n<e.length;n++)for(var i=n+1;i<e.length;i++)Q(e[n],e[i])&&(t[n][4]=0,t[i][5]=0),j(e[n],e[i])&&(t[n][5]=0,t[i][4]=0),ee(e[n],e[i])&&(t[n][2]=0,t[i][3]=0),te(e[n],e[i])&&(t[n][3]=0,t[i][2]=0),ne(e[n],e[i])&&(t[n][0]=0,t[i][1]=0),ie(e[n],e[i])&&(t[n][1]=0,t[i][0]=0);this.faces=t}build_center(){const e=this.boundary;this.center=e[0].map((t,n)=>t+e[1][n])}build_boundary(){const e=this.voxels;for(var t=e[0],n=e[0],i=1;i<e.length;i++)t=t.map((s,o)=>Math.min(s,e[i][o])),n=n.map((s,o)=>Math.max(s,e[i][o]));this.boundary=[t,n]}}class Ne{constructor(e,t,n){this.gl=e,this.program=t,this.canvas=n,this.attribute_matrix_4_mat_float=G((i,s)=>{var o=e.getUniformLocation(this.program,i);e.uniformMatrix4fv(o,!1,s)}),this.uniform_float=G((i,s)=>{var o=e.getUniformLocation(this.program,i);e.uniform1f(o,s)}),this.uniform_4_float=G((i,s)=>{var o=e.getUniformLocation(this.program,i);e.uniform4f(o,s[0],s[1],s[2],s[3])}),this.uniform_3_float=G((i,s)=>{var o=e.getUniformLocation(this.program,i);e.uniform3f(o,s[0],s[1],s[2])}),this.attribute_matrix_3_float=G((i,s)=>{var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array(s),e.STATIC_DRAW);var a=e.getAttribLocation(this.program,i);e.vertexAttribPointer(a,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a)}),this.attribute_matrix_4_float=G((i,s)=>{var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array(s),e.STATIC_DRAW);var a=e.getAttribLocation(this.program,i);e.vertexAttribPointer(a,4,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a)})}set face(e){this.faces=e}buffer(e){const t=this.gl,n=this.canvas,i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i);var s=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,s),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,s);const o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,o,0),e(),t.bindFramebuffer(t.FRAMEBUFFER,null),o}getPixel(e,t){const n=this.gl,i=new Uint8Array(4);return n.readPixels(e,t,1,1,n.RGBA,n.UNSIGNED_BYTE,i),i}drawSolid(e){const t=this.gl;if(!e){if(this.faces==null)throw"No faces defined";e=this.faces}var n=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),t.STATIC_DRAW),t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),t.drawElements(t.TRIANGLES,e.length,t.UNSIGNED_SHORT,0)}drawLines(e){const t=this.gl;if(!e){if(this.faces==null)throw"No faces defined";e=this.faces}var n=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),t.STATIC_DRAW),t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),t.drawElements(t.LINES,e.length,t.UNSIGNED_SHORT,0)}}function G(r){return new Proxy({},{set:function(e,t,n){return r(t,n),!0}})}function De(r,e,t){const n=r.getContext("webgl2",{antialias:!0}),i=n.createProgram(),s=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(s,t),n.compileShader(s),n.attachShader(i,s);const o=n.createShader(n.VERTEX_SHADER);return n.shaderSource(o,e),n.compileShader(o),n.attachShader(i,o),n.linkProgram(i),n.useProgram(i),[n,new Ne(n,i,r)]}var xe=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function Ce(){var r=new xe(16);return xe!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Ue(r,e){if(r===e){var t=e[1],n=e[2],i=e[3],s=e[6],o=e[7],a=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=s,r[11]=e[14],r[12]=i,r[13]=o,r[14]=a}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function Oe(r,e){var t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],f=e[6],d=e[7],l=e[8],u=e[9],m=e[10],b=e[11],_=e[12],c=e[13],y=e[14],R=e[15],F=t*a-n*o,w=t*f-i*o,N=t*d-s*o,D=n*f-i*a,M=n*d-s*a,O=i*d-s*f,v=l*c-u*_,g=l*y-m*_,A=l*R-b*_,B=u*y-m*c,P=u*R-b*c,C=m*R-b*y,E=F*C-w*P+N*B+D*A-M*g+O*v;return E?(E=1/E,r[0]=(a*C-f*P+d*B)*E,r[1]=(i*P-n*C-s*B)*E,r[2]=(c*O-y*M+R*D)*E,r[3]=(m*M-u*O-b*D)*E,r[4]=(f*A-o*C-d*g)*E,r[5]=(t*C-i*A+s*g)*E,r[6]=(y*N-_*O-R*w)*E,r[7]=(l*O-m*N+b*w)*E,r[8]=(o*P-a*A+d*v)*E,r[9]=(n*A-t*P-s*v)*E,r[10]=(_*M-c*N+R*F)*E,r[11]=(u*N-l*M-b*F)*E,r[12]=(a*g-o*B-f*v)*E,r[13]=(t*B-n*g+i*v)*E,r[14]=(c*w-_*D-y*F)*E,r[15]=(l*D-u*w+m*F)*E,r):null}function Xe(r,e,t,n){function i(h,L,k,T){var H=Math.tan(h*.5*Math.PI/180);return[.5/H,0,0,0,0,.5*L/H,0,0,0,0,-(T+k)/(T-k),-1,0,0,-2*T*k/(T-k),0]}var s=i(40,r.width/r.height,1,1e3),o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const f=Ce();Oe(f,a),Ue(f,f),t.viewport(0,0,r.width,r.height),e.attribute_matrix_4_mat_float.uNormalMatrix=f,a[14]=a[14]-6;var d=0,l=!1,u,m,b=0,_=0,c=null,y=function(h){return h.button==1?c="pan":c="rotate",l=!0,u=h.pageX,m=h.pageY,h.preventDefault(),!1},R=function(h){l=!1};const F={x:0,y:0};var w=function(h){const L=r.__element.getBoundingClientRect();if(F.x=(h.clientX-L.left)*t.canvas.width/t.canvas.clientWidth,F.y=t.canvas.height-(h.clientY-L.top)*t.canvas.height/t.canvas.clientHeight-1,!l)return!1;b=(h.pageX-u)*2*Math.PI/r.width,_=(h.pageY-m)*2*Math.PI/r.height,c=="rotate"?(g+=b,A+=_):c=="pan"&&N(b,_),u=h.pageX,m=h.pageY,h.preventDefault()};function N(h,L){a[12]-=h*a[14]/2,a[13]+=L*a[14]/2}r.$on("mousedown",y),r.$on("mouseup",R),r.$on("mouseout",R),r.$on("mousemove",w);var D=function(h){h.preventDefault();var L=h.wheelDelta?h.wheelDelta/40:h.detail?-h.detail:0,k=1.3;return L&&M(L<0?1*k:1/k),h.preventDefault()&&!1};function M(h){a[14]*=h}r.$on("wheel",D);function O(h,L){var k=Math.cos(L),T=Math.sin(L),H=h[1],ce=h[5],_e=h[9];h[1]=h[1]*k-h[2]*T,h[5]=h[5]*k-h[6]*T,h[9]=h[9]*k-h[10]*T,h[2]=h[2]*k+H*T,h[6]=h[6]*k+ce*T,h[10]=h[10]*k+_e*T}function v(h,L){var k=Math.cos(L),T=Math.sin(L),H=h[0],ce=h[4],_e=h[8];h[0]=k*h[0]+T*h[2],h[4]=k*h[4]+T*h[6],h[8]=k*h[8]+T*h[10],h[2]=k*h[2]-T*H,h[6]=k*h[6]-T*ce,h[10]=k*h[10]-T*_e}var g=.8,A=.8;function B(){l||(b*=d,_*=d,g+=b,A+=_),o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,A=Math.max(-Math.PI/2,Math.min(Math.PI/2,A)),v(o,g),O(o,A),e.attribute_matrix_4_mat_float.projection_matrix=s,e.attribute_matrix_4_mat_float.view_matrix=a,e.attribute_matrix_4_mat_float.model_matrix=o}function P(){a[12]=0,a[13]=0}function C(){g=.8,A=.8}function E(){a[14]=-6}return{update:B,mouse:F,zoom:M,resetPan:P,resetRotation:C,resetZoom:E}}function He(r){var e=0;function t(n){n*=.001;const i=n-e;e=n;const s=1/i;r(s.toFixed(1)),requestAnimationFrame(t)}t()}function W(r,e,t){var n=[];const i=ue({name:t});for(const s of r){const o=p("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(i.name==s.name?" button-selected":""),elements:[typeof i<"u"?i:void 0,typeof name<"u"?name:void 0,typeof s<"u"?s:void 0,typeof name<"u"?name:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>s.name,elements:[typeof s<"u"?s:void 0,typeof name<"u"?name:void 0]});o.$on("click",()=>{i.name=s.name,e(s.name)}),n.push(o)}return n}function V(r,e){const t=ue({value:!0});var n=p("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(t.value?" button-selected":""),elements:[typeof t<"u"?t:void 0,typeof value<"u"?value:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]});return n.$on("click",()=>{t.value=!t.value,e(t.value)}),n}function S(r,e){var t=p("button",{class:"button"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]});return t.$on("click",()=>{e()}),t}function ge({callback:r,start:e,color:t}){r||(r=d=>{});const n=ue({absolute_value:0,relative_value:0});var i=z(),s=p("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--accent-color:${t()};`,elements:[typeof t<"u"?t:void 0]}},p("div",{class:"trackbar-background"}),p("div",{class:"trackbar-foreground"}),p("div",{class:"trackbar-thumb",ref:i,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${n.absolute_value}px`,elements:[typeof n<"u"?n:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));s.$onMounted(()=>{var d=s.__element.getBoundingClientRect();n.relative_value=e(),n.absolute_value=d.width*e()/255,r(n.relative_value)}),s.$onUpdate(()=>{var d=s.__element.getBoundingClientRect();n.relative_value=e(),n.absolute_value=d.width*e()/255});var o=!1,a;function f(d){var l=d-a,u=s.__element.getBoundingClientRect();l<0&&(l=0),l>u.width&&(l=u.width),n.absolute_value=l,n.relative_value=n.absolute_value/u.width*255,r(n.relative_value)}return document.addEventListener("mousemove",d=>{o&&f(d.clientX)}),i.$on("mousedown",d=>{d.stopPropagation(),o=!0,a=d.clientX-n.absolute_value}),s.$on("mousedown",d=>{var l=s.__element.getBoundingClientRect();a=l.left,f(d.clientX),o=!0}),document.addEventListener("mouseup",d=>{o=!1}),s}function pe({callback:r,start:e,colorFrom:t,colorTo:n}){r||(r=l=>{});const i=ue({absolute_value:0,relative_value:0});var s=z(),o=p("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--color-from:${t()};--color-to:${n()};`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0]}},p("div",{class:"trackbar-data"}),p("div",{class:"trackbar-thumb",ref:s,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${i.absolute_value}px`,elements:[typeof i<"u"?i:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));o.$onMounted(()=>{var l=o.__element.getBoundingClientRect();i.relative_value=e(),i.absolute_value=l.width*e()/255,r(i.relative_value)}),o.$onUpdate(()=>{var l=o.__element.getBoundingClientRect();i.relative_value=e(),i.absolute_value=l.width*e()/255});var a=!1,f;function d(l){var u=l-f,m=o.__element.getBoundingClientRect();u<0&&(u=0),u>m.width&&(u=m.width),i.absolute_value=u,i.relative_value=i.absolute_value/m.width*255,r(i.relative_value)}return document.addEventListener("mousemove",l=>{a&&d(l.clientX)}),s.$on("mousedown",l=>{l.stopPropagation(),a=!0,f=l.clientX-i.absolute_value}),o.$on("mousedown",l=>{var u=o.__element.getBoundingClientRect();f=u.left,d(l.clientX),a=!0}),document.addEventListener("mouseup",l=>{a=!1}),o}function Re(r,e){var t=JSON.stringify(e),n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),s=document.createElement("a");s.download=r,s.href=i,s.textContent="Download",s.click(),s.remove()}async function ke(r,e){var t=document.createElement("input");t.type="file",t.accept="."+r,t.onchange=n=>{var i=n.target.files[0],s=new FileReader;s.onload=function(o){var a=o.target.result;e(JSON.parse(a))},s.readAsText(i)},t.click(),t.remove()}function Ye({set:r,get:e}){var t=0,n=0,i=0,s=255,o=255,a=255,f=255,d=255;const l=z();var u=[];function m(){l.$html(""),ke("col",v=>{for(var g=0;g<v.length;g++)_(v[g][0],v[g][1],v[g][2],v[g][3])})}function b(){Re("color_list.col",u)}function _(v,g,A,B){u.push([v,g,A,B]);var P=p("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${v},${g},${A},${B/255})`,elements:[typeof v<"u"?v:void 0,typeof g<"u"?g:void 0,typeof A<"u"?A:void 0,typeof B<"u"?B:void 0]}}),C=!1;P.$on("mousedown",E=>(C=!0,E.button==1&&E.preventDefault(),!1)),P.$on("contextmenu",E=>(E.preventDefault(),!1)),document.addEventListener("mouseup",E=>{setTimeout(()=>{C=!1},100)}),P.$on("mouseup",E=>{!C||(E.button==0?(t=v,n=g,i=A,s=B,y(),c&&c.$update()):E.button==2?(o=v,a=g,f=A,d=B,y("background"),c&&c.$update()):P.$remove())}),P.$parent(l)}var c=p("div",null,p("div",{style:"display:flex;flex-direction:row"},p("div",{style:"width:100%;padding:10px"},p(pe,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`0,${n},${i}`,elements:[typeof n<"u"?n:void 0,typeof i<"u"?i:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`255,${n},${i}`,elements:[typeof n<"u"?n:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:v=>F(v),elements:[typeof x<"u"?x:void 0,typeof F<"u"?F:void 0,typeof x<"u"?x:void 0]}}),p(pe,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>n,elements:[typeof n<"u"?n:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${t},0,${i}`,elements:[typeof t<"u"?t:void 0,typeof i<"u"?i:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${t},255,${i}`,elements:[typeof t<"u"?t:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:v=>w(v),elements:[typeof x<"u"?x:void 0,typeof w<"u"?w:void 0,typeof x<"u"?x:void 0]}}),p(pe,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${t},${n},0`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${t},${n},255`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:v=>N(v),elements:[typeof x<"u"?x:void 0,typeof N<"u"?N:void 0,typeof x<"u"?x:void 0]}}))),p("div",{class:"row"},p("div",{class:"color-area"},p("div",{class:"color-container"},p("div",{class:"background color-item"},p("div",{class:"backdrop"}),p("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${o},${a},${f},${d/255})`,elements:[typeof o<"u"?o:void 0,typeof a<"u"?a:void 0,typeof f<"u"?f:void 0,typeof d<"u"?d:void 0]}})),p("div",{class:"foreground color-item"},p("div",{class:"backdrop"}),p("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${t},${n},${i},${s/255})`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0,typeof i<"u"?i:void 0,typeof s<"u"?s:void 0]}}))),p("div",{class:"hover-icon-container",style:"margin-left:5px","on:click":O},p("i",{class:"fa-solid fa-arrows-rotate hover-icon"}))),p("div",{class:"alpha-area",style:"margin-top:-10px"},p(ge,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>s,elements:[typeof s<"u"?s:void 0]},color:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${t},${n},${i};`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:v=>D(v),elements:[typeof x<"u"?x:void 0,typeof D<"u"?D:void 0,typeof x<"u"?x:void 0]}}),p(ge,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>d,elements:[typeof d<"u"?d:void 0]},color:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${o},${a},${f};`,elements:[typeof o<"u"?o:void 0,typeof a<"u"?a:void 0,typeof f<"u"?f:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:v=>M(v),elements:[typeof x<"u"?x:void 0,typeof M<"u"?M:void 0,typeof x<"u"?x:void 0]}}))),p("div",{class:"color-history-container"},p("div",{style:"display:inline-block",ref:l}),p("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${t},${n},${i},${s/255})`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0,typeof i<"u"?i:void 0,typeof s<"u"?s:void 0]},"on:click":()=>_(t,n,i,s)},p("i",{class:"fa fa-plus"})),p("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${o},${a},${f},${d/255})`,elements:[typeof o<"u"?o:void 0,typeof a<"u"?a:void 0,typeof f<"u"?f:void 0,typeof d<"u"?d:void 0]},"on:click":()=>_(o,a,f,d)},p("i",{class:"fa fa-plus"}))),p("button",{class:"button","on:click":()=>b()},"Save colors"),p("button",{class:"button","on:click":()=>m()},"Load colors"));function y(v="foreground"){e(v,{r:t,g:n,b:i,a:s},{r:o,g:a,b:f,a:d})}r(R());function R(){return(v,g)=>{v!=null&&(t=v.r,n=v.g,i=v.b,s=v.a),g!=null&&(o=g.r,a=g.g,f=g.b,d=g.a),c&&c.$update()}}function F(v){t=v,c&&c.$update(),y()}function w(v){n=v,c&&c.$update(),y()}function N(v){i=v,c&&c.$update(),y()}function D(v){s=v,c&&c.$update(),y()}function M(v){d=v,c&&c.$update(),y("background")}function O(){var v=o;o=t,t=v,v=a,a=n,n=v,v=f,f=i,i=v,v=d,d=s,s=v,c&&c.$update(),y()}return y(),c}var re=null,se=null,oe=null,fe=null,ae=null,U=I;const be=[{name:"Point"},{name:"Plane"},{name:"Horizontal line"},{name:"Vertical line"}],ve=[{name:"Sculpt"},{name:"Paint"}];var J="Point",Z="Sculpt",K=!0,le=!0,I=[1,0,0],q=[1,1,1];function me(r,e,t){I=[e.r/255,e.g/255,e.b/255,e.a/255],q=[t.r/255,t.g/255,t.b/255,t.a/255],r=="foreground"?U=I:U=q}var de=null;function Ge(r,e){var t=null;r!=null&&(t={r:r[0]*255,g:r[1]*255,b:r[2]*255,a:255});var n=null;e!=null&&(n={r:e[0]*255,g:e[1]*255,b:e[2]*255,a:255}),de(t,n)}const X=z(),Fe=z(),We=p("div",{class:"main"},p("div",{class:"info"},p("p",null,p("h3",null,"Mode"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>W(ve,r=>{Z=r,U=I},"Sculpt"),elements:[typeof W<"u"?W:void 0,typeof ve<"u"?ve:void 0,typeof x<"u"?x:void 0,typeof Z<"u"?Z:void 0,typeof x<"u"?x:void 0,typeof U<"u"?U:void 0,typeof I<"u"?I:void 0]}),p("p",null,p("h3",null,"Color"),p(Ye,{get:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:(r,e,t)=>me(r,e,t),elements:[typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0,typeof me<"u"?me:void 0,typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0]},set:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:r=>de=r,elements:[typeof fn<"u"?fn:void 0,typeof de<"u"?de:void 0,typeof fn<"u"?fn:void 0]}}))),p("canvas",{ref:X}),p("div",{class:"info"},p("p",null,"FPS: ",p("span",{ref:Fe})),p("p",null,p("h3",null,"Tool"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>W(be,r=>J=r,"Point"),elements:[typeof W<"u"?W:void 0,typeof be<"u"?be:void 0,typeof x<"u"?x:void 0,typeof J<"u"?J:void 0,typeof x<"u"?x:void 0]}),p("p",null,p("h3",null,"Tool options"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>V("Contiguous",r=>K=r),elements:[typeof V<"u"?V:void 0,typeof x<"u"?x:void 0,typeof K<"u"?K:void 0,typeof x<"u"?x:void 0]}),p("p",null,p("h3",null,"View"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>V("Wireframe",r=>le=r),elements:[typeof V<"u"?V:void 0,typeof x<"u"?x:void 0,typeof le<"u"?le:void 0,typeof x<"u"?x:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>S("Reset pan",()=>fe()),elements:[typeof S<"u"?S:void 0,typeof fe<"u"?fe:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>S("Reset rotation",()=>ae()),elements:[typeof S<"u"?S:void 0,typeof ae<"u"?ae:void 0]}),p("p",null,p("h3",null,"Actions"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>S("Subdivide",()=>re()),elements:[typeof S<"u"?S:void 0,typeof re<"u"?re:void 0]}),p("p",null,p("h3",null,"Persistence"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>S("Save project",()=>se()),elements:[typeof S<"u"?S:void 0,typeof se<"u"?se:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>S("Load project",()=>oe()),elements:[typeof S<"u"?S:void 0,typeof oe<"u"?oe:void 0]})));X.width=800;X.height=800;We.$parent(document.body);var $=new Me;$.init();async function Ve(){var r=await fetch("./shader.vert").then(b=>b.text()),e=await fetch("./shader.frag").then(b=>b.text()),[t,n]=De(X.__element,r,e);n.antialias=!1,n.uniform_4_float.color_overlay=[0,0,0,1],se=()=>{Re("voxel_model.vox",{voxels:$.voxels,color:$.color})},oe=async()=>{ke("vox",({voxels:b,color:_})=>{$.voxels=b,$.color=_,$.init();var[c,w]=$.boundary,y=c[0]-w[0],R=c[1]-w[1],F=c[2]-w[2],w=Math.abs(Math.max(y,R,F));u(),d(),l(),f(Math.max(w,1)),n.attribute_matrix_3_float.normal=$.geometry_normals,n.attribute_matrix_3_float.position=$.geometry_vertexes})};var i=null,s=null;X.$on("mousedown",b=>{s=[b.offsetX,b.offsetY],b.button==1&&b.preventDefault()}),X.$on("contextmenu",b=>(b.preventDefault(),!1)),X.$on("mouseup",b=>{if(!(!s||Math.abs(b.offsetX-s[0])>3||Math.abs(b.offsetY-s[1])>3)&&!!i)if(Z=="Sculpt")b.button==0?($.add(...i.voxel.map(y=>y.map((R,F)=>R+i.direction[F]))),n.attribute_matrix_3_float.normal=$.geometry_normals,n.attribute_matrix_3_float.position=$.geometry_vertexes):b.button==2&&($.remove(...i.voxel),n.attribute_matrix_3_float.normal=$.geometry_normals,n.attribute_matrix_3_float.position=$.geometry_vertexes);else{if(b.button==0){U=I;for(var _=0;_<i.color.length;_++)for(var c=0;c<3;c++)i.color[_][c]=i.color[_][c]*(1-I[3])+I[c]*I[3]}else if(b.button==2){U=q;for(var _=0;_<i.color.length;_++)for(var c=0;c<3;c++)i.color[_][c]=i.color[_][c]*(1-q[3])+q[c]*q[3]}b.button==1&&(I=[...i.mouse_color,1],U=I,Ge(I))}});const{update:o,mouse:a,zoom:f,resetPan:d,resetRotation:l,resetZoom:u}=Xe(X,n,t);fe=d,ae=l,re=()=>{$.subdivide(),n.attribute_matrix_3_float.normal=$.geometry_normals,n.attribute_matrix_3_float.position=$.geometry_vertexes,f(2)};function m(){t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.enable(t.CULL_FACE),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}He(b=>{Fe.$html({key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>b,elements:[typeof b<"u"?b:void 0]}),o(),n.attribute_matrix_3_float.normal=$.geometry_normals,n.attribute_matrix_3_float.position=$.geometry_vertexes;var _=null;n.buffer(()=>{t.clearColor(0,0,0,0),n.uniform_float.disable_lighting=1,m(),n.attribute_matrix_4_float.color=$.pick_map,n.drawSolid($.geometry_indexes),_=n.getPixel(a.x,a.y)}),n.uniform_float.disable_lighting=0,t.clearColor(.5,.5,.5,.9),t.enable(t.POLYGON_OFFSET_FILL),t.polygonOffset(1,1),m(),i=null,J=="Point"?Z=="Sculpt"?n.attribute_matrix_4_float.color=$.get_highlight(_,c=>i=c):n.attribute_matrix_4_float.color=$.get_highlight(_,c=>i=c,U):Z=="Sculpt"?n.attribute_matrix_4_float.color=$.highlight_plane(_,c=>i=c,J,K):n.attribute_matrix_4_float.color=$.highlight_plane(_,c=>i=c,J,K,U),n.drawSolid($.geometry_indexes),t.disable(t.POLYGON_OFFSET_FILL),le&&(n.uniform_float.enable_color_overlay=1,n.drawLines($.geometry_edge_index),n.uniform_float.enable_color_overlay=0)})}Ve();
