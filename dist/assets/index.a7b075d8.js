(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function oe(i){const e=new Set;function t(o){e.add(o)}function n(o){e.delete(o)}const r={get(o,a){return a==="__subscribe"?t:a==="__unsubscribe"?n:typeof o[a]=="object"&&o[a]!==null&&!(o[a]instanceof HTMLElement)?new Proxy(o[a],r):o[a]},set(o,a,u){o[a]=u;for(const l of e)l.__update();return!0}};return new Proxy(i,r)}function ae(i){return fe(new _e(i))}function fe(i){function e(n,r){return typeof n[r]!="object"||n[r]!==null?n[r]:new Proxy(n[r],{set:(o,a,u)=>(t.__handleEffect(t.__isReactive(u),()=>{o[a]=t.__handleFunction(u)}),!0),get:(o,a)=>e(o,a)})}const t=new Proxy(i,{get:(n,r)=>{if(r in n)return n[r];if(r in n.__element)return e(n.__element,r)},set:(n,r,s)=>(r in n?n[r]=s:r=="style"?n.$set_style(s):r in n.__element&&n.$property(r,s),!0)});return t}class _e{constructor(e){if(typeof e=="string")this.__element=document.createElement(e);else if(e instanceof HTMLElement)this.__element=e;else throw new Error("Invalid element name");this.__events=[],this.__children=[],this.__states=new Set,this.__unmounted_events=[],this.__mounted_events=[],this.__parent=null}__update(){for(const e of this.__events)e()}$click(){return this.__element.click(),this}$find(e){var t=[];this.__element.matches(e)&&t.push(fe(this));for(const n of this.__children)t=t.concat(n.$find(e));return t}$update(){for(const e of this.__events)e();for(const e of this.__children)e.$update()}__parseInput(e){if(e&&e.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"){for(const t of e.elements)t&&t.__subscribe&&(this.__states.add(t),t.__subscribe(this));return e.expression}return e}__observeParent(){setTimeout(()=>{for(const t of this.__mounted_events)t()},0),new MutationObserver(t=>{for(const n of t){if(n.type==="childList"&&n.removedNodes.length){for(const r of n.removedNodes)if(r===this.__element){this.__unsubscribe();for(const s of this.__unmounted_events)s()}}if(n.type==="childList"&&n.addedNodes.length){for(const r of n.addedNodes)if(r===this.__element){this.__subscribe();for(const s of this.__mounted_events)s()}}}}).observe(this.__element.parentElement,{childList:!0})}__subscribe(){if(this.__states)for(const e of this.__states)e.__subscribe(this)}__unsubscribe(){for(const e of this.__children)e.__unsubscribe();if(this.__states)for(const e of this.__states)e.__unsubscribe(this)}__handleFunction(e){return typeof e=="function"?e():e}__handleEffect(e,t){e?(t(),this.__events.push(t)):t()}__isReactive(...e){for(const t of e)if(typeof t=="function")return!0;return!1}$if(e){return e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{const t=this.__handleFunction(e);this.$style("display",t?"":"none")}),this}$class(e,t=!0){e=this.__parseInput(e),t=this.__parseInput(t);var n=null;return this.__handleEffect(this.__isReactive(e,t),()=>{const r=this.__handleFunction(e);if(r)if(typeof r=="object")for(const s in r)r[s]?this.__element.classList.add(s):this.__element.classList.remove(s);else this.__handleFunction(t)?(this.__isReactive(e)&&(n&&this.__element.classList.remove(...n.split(" ").filter(s=>s.length>0)),n=r),this.__element.classList.add(...r.split(" ").filter(s=>s.length>0))):(this.__element.classList.remove(...r.split(" ").filter(s=>s.length>0)),n=null)}),this}get parentElement(){return this.__parent}$parent(e){return this.__parent=e,e.__element!==void 0?(e.__element.appendChild(this.__element),e.__children.push(this)):e.appendChild(this.__element),this.__observeParent(),this}$parentBefore(e){return this.__parent=e,e.__element!==void 0?e.__element.firstChild?e.__element.insertBefore(this.__element,e.__element.firstChild):e.__element.appendChild(this.__element):e.firstChild?e.insertBefore(this.__element,e.firstChild):e.appendChild(this.__element),this.__observeParent(),this}$on(e,t){return this.__element.addEventListener(e,t),this}$mounted(e){this.__mounted_events.push(e)}$unmounted(e){this.__unmounted_events.push(e)}$property(e,t){return e=this.__parseInput(e),t=this.__parseInput(t),this.__handleEffect(this.__isReactive(e,t),()=>{this.__element[this.__handleFunction(e)]=this.__handleFunction(t)}),this}$style(e,t=null){return t?(this.__style(e,t),this):(e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{var n=this.__handleFunction(e);if(typeof n=="object")for(const r in n)this.__element.style[r]=n[r];else{const r=n.split(";").filter(s=>s.length>0);this.__element.style={};for(const s of r){const[o,a]=s.split(":");this.__element.style[o]=this.__handleFunction(a)}}}),this)}__style(e,t){return e=this.__parseInput(e),t=this.__parseInput(t),this.__handleEffect(this.__isReactive(e,t),()=>{this.__element.style[this.__handleFunction(e)]=this.__handleFunction(t)}),this}$get_computed_style(e){return window.getComputedStyle(this.__element).getPropertyValue(e)}$html(e){return e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{this.__element.innerHTML=this.__handleFunction(e)}),this}$child(e){e=this.__parseInput(e);var t;this.__isReactive(e)?t=ae("span").$parent(this):t=this;var n=null;return this.__handleEffect(this.__isReactive(e),()=>{var r=this.__handleFunction(e);n&&n();const s=a=>a==null?()=>{}:a.__element!==void 0?(a.$parent(t),()=>a.$remove()):(a instanceof HTMLElement||(a=document.createTextNode(a)),t.__element.appendChild(a),()=>a.remove());if(Array.isArray(r)){var o=[];for(const a of r)o.push(s(a));n=()=>{for(const a of o)a()}}else n=s(r)}),this}$remove(){return this.__parent=null,this.__element.remove(),this}$model([e,t]){return this.$property("value",e),this.$on("input",n=>t(n.target.value)),this}}const E=(i,e,...t)=>{var n,r=!1;if(typeof i=="function"){if(n=i(e,...t),n===void 0)return t;r=!0}else n=ae(i);const s={ref:a=>{a.__ref_object=n},style:a=>{n.$style(a)},class:a=>{n.$class(a)},parent:a=>{n.$parent(a)},if:a=>{n.$if(a)},model:([a,u])=>{n.$model([a,u])}},o={on:(a,u)=>{n.$on(a,u)}};if(e)for(const[a,u]of Object.entries(e)){const l=a.split(":");l.length==2?o[l[0]]&&o[l[0]](l[1],u):s[a]?s[a](u):r||n.$property(a,u)}if(t&&!r)for(const a of t)n.$child(a);return n};function le(i=null){var e=i;return new Proxy({},{get:(n,r)=>{if(e!=null)return e[r]},set:(n,r,s)=>(r==="__ref_object"&&(e=s),s!=null&&(e[r]=s),!0)})}function he(i){return[(i>>0&255)/255,(i>>8&255)/255,(i>>16&255)/255,1]}function ie(i){return i[0]+(i[1]<<8)+(i[2]<<16)-1}const ce=[[0,0,1,0,0,1,0,0,1,0,0,1],[0,0,-1,0,0,-1,0,0,-1,0,0,-1],[0,1,0,0,1,0,0,1,0,0,1,0],[0,-1,0,0,-1,0,0,-1,0,0,-1,0],[1,0,0,1,0,0,1,0,0,1,0,0],[-1,0,0,-1,0,0,-1,0,0,-1,0,0]],de=[[-1,-1,1,1,-1,1,1,1,1,-1,1,1],[-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1],[-1,1,-1,-1,1,1,1,1,1,1,1,-1],[-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1],[1,-1,-1,1,1,-1,1,1,1,1,-1,1],[-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]],pe=[[0,1,2,0,2,3],[4,5,6,4,6,7],[8,9,10,8,10,11],[12,13,14,12,14,15],[16,17,18,16,18,19],[20,21,22,20,22,23]],me=[[0,1,1,2,2,3,3,0],[4,5,5,6,6,7,7,4],[8,9,9,10,10,11,11,8],[12,13,13,14,14,15,15,12],[16,17,17,18,18,19,19,16],[20,21,21,22,22,23,23,20]],k=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],ve=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];function Y(i,e){return i[0]+1==e[0]&&i[1]==e[1]&&i[2]==e[2]}function X(i,e){return i[0]-1==e[0]&&i[1]==e[1]&&i[2]==e[2]}function G(i,e){return i[1]+1==e[1]&&i[0]==e[0]&&i[2]==e[2]}function W(i,e){return i[1]-1==e[1]&&i[0]==e[0]&&i[2]==e[2]}function V(i,e){return i[2]+1==e[2]&&i[0]==e[0]&&i[1]==e[1]}function q(i,e){return i[2]-1==e[2]&&i[0]==e[0]&&i[1]==e[1]}const te=[[0,1,0,1,0,1],[0,1,0,1,1,0],[0,1,1,0,0,1],[0,1,1,0,1,0],[1,0,0,1,0,1],[1,0,0,1,1,0],[1,0,1,0,0,1],[1,0,1,0,1,0]];class be{constructor(){this.voxels=[[0,0,0]]}build_geometry(){for(var e=[],t=[],n=[],r=[],s=[],o=[],a=[],u=0,l=1,f=0;f<this.voxels.length;f++){for(var d=0,c=0,p=l-1,m=[],v=0;v<6;v++){if(this.faces[f][v]==0){c+=4;continue}n.push(...de[v].map((R,L)=>R+this.voxels[f][L%3]*2-this.center[L%3])),s.push(...ce[v]),a.push(...me[v].map(R=>R+u-c)),r.push(...pe[v].map(R=>R+u-c)),o.push(...ve),d+=4;for(var F=he(l),A=0;A<4;A++)m.push(...F);l++}u+=d,t.push({start:p,end:l-1}),e.push(...m)}this.id=l,this.distance=u,this.geometry_vertexes=n,this.geometry_indexes=r,this.geometry_normals=s,this.geometry_color=o,this.geometry_edge_index=a,this.pick_map=e,this.pick_meta=t}init(){this.build_boundary(),this.build_center(),this.build_faces(),this.build_geometry()}add(...e){this.voxels.push(...e),this.build_boundary(),this.build_center(),this.rebuild_faces(e),this.build_geometry()}subdivide(){var e=[],t=[];for(const o in this.voxels){const a=this.voxels[o],u=this.faces[o],l=[a[0]*2,a[1]*2,a[2]*2];e.push([l[0],l[1],l[2]],[l[0]+1,l[1],l[2]],[l[0],l[1]+1,l[2]],[l[0]+1,l[1]+1,l[2]],[l[0],l[1],l[2]+1],[l[0]+1,l[1],l[2]+1],[l[0],l[1]+1,l[2]+1],[l[0]+1,l[1]+1,l[2]+1]);for(var n in te){var r=Array(6).fill(0);for(var s in te[n])te[n][s]==1&&u[s]==1&&(r[s]=1);t.push(r)}}this.voxels=e,this.faces=t,this.build_boundary(),this.build_center(),this.build_geometry()}remove(...e){for(const n of e)for(var t=0;t<this.voxels.length;t++)if(this.voxels[t][0]==n[0]&&this.voxels[t][1]==n[1]&&this.voxels[t][2]==n[2]){this.voxels.splice(t,1),this.faces.splice(t,1);break}this.build_boundary(),this.build_center(),this.rebuild_remove_faces(e),this.build_geometry()}get_plane_color(e,t){var n=[];for(const a in this.pick_meta){const u=this.faces[a];for(var r=0,s=0;s<u.length;s++){if(u[s]==0){r+=1;continue}if(e.includes(a))if(r==t)for(var o=0;o<4;o++)n.push(1,.6,.6,1);else for(var o=0;o<4;o++)n.push(1,.9,.9,1);else for(var o=0;o<4;o++)n.push(1,1,1,1);r+=1}}return n}get_plane(e,t){var n=[];for(const o in this.voxels){const a=this.voxels[o];var r=!0;for(const u in t)if(t[u]!=0&&e[u]!=a[u]){r=!1;break}if(r){var s=this.voxels[o].map((u,l)=>u+t[l]);this.voxels.some(u=>u[0]==s[0]&&u[1]==s[1]&&u[2]==s[2])||n.push(o)}}return n}get_contiguous(e,t,n){var r=[];const s=this.voxels,o=new Set;function a(u){for(const c of e){const p=s[c];var l=!0;for(const m in n)if(n[m]!=0){if(u[m]!=p[m]){l=!1;break}}else if(Math.abs(u[m]-p[m])>1){l=!1;break}if(l){var f=s[c].map((m,v)=>m+n[v]),d=`${f[0]},${f[1]},${f[2]}`;o.has(d)||(o.add(d),r.push(c),a(s[c]))}}}return a(t),r}get_vertical_line(e,t,n){var r=[];for(const u in this.voxels){const l=this.voxels[u];var s=!0,o=-1;for(const f in t)if(t[f]!=0&&(o=f,e[f]!=l[f])){s=!1;break}if(o==0){for(const f in t)if(t[f]==0&&e[f]!=l[f]&&f==2){s=!1;break}}else if(o==2){for(const f in t)if(t[f]==0&&e[f]!=l[f]&&f==0){s=!1;break}}else if(o==1){for(const f in t)if(t[f]==0&&e[f]!=l[f]&&f==0){s=!1;break}}else s=!1;if(s){var a=this.voxels[u].map((f,d)=>f+t[d]);this.voxels.some(f=>f[0]==a[0]&&f[1]==a[1]&&f[2]==a[2])||r.push(u)}}return r}get_horizontal_line(e,t,n){var r=[];for(const u in this.voxels){const l=this.voxels[u];var s=!0,o=-1;for(const f in t)if(t[f]!=0){if(o=f,e[f]!=l[f]){s=!1;break}}else if(e[f]!=l[f]&&f==1){s=!1;break}if(o==1){for(const f in t)if(t[f]==0&&e[f]!=l[f]&&f==2){s=!1;break}}if(s){var a=this.voxels[u].map((f,d)=>f+t[d]);this.voxels.some(f=>f[0]==a[0]&&f[1]==a[1]&&f[2]==a[2])||r.push(u)}}return r}highlight_plane(e,t,n,r){var s=ie(e),o=[],a=0;for(const c in this.pick_meta){const p=this.faces[c],m=this.pick_meta[c];if(s>=m.start&&s<m.end)for(var u=0,l=0;l<p.length;l++){if(p[l]==0){u+=1;continue}if(s==a){var f;switch(n){case"Plane":f=this.get_plane(this.voxels[c],k[u]);break;case"Horizontal line":f=this.get_horizontal_line(this.voxels[c],k[u]);break;case"Vertical line":f=this.get_vertical_line(this.voxels[c],k[u]);break}return r&&(f=this.get_contiguous(f,this.voxels[c],k[u])),t({voxel:f.map(v=>this.voxels[v]),direction:k[u],index:c}),this.get_plane_color(f,u)}u+=1,a+=1}else for(var l=0;l<p.length;l++)if(p[l]!=0){for(var d=0;d<4;d++)o.push(1,1,1,1);a+=1}}return o}get_highlight(e,t){var n=ie(e),r=[],s=0;for(const l in this.pick_meta){const f=this.faces[l],d=this.pick_meta[l];if(n>=d.start&&n<d.end)for(var o=0,a=0;a<f.length;a++){if(f[a]==0){o+=1;continue}if(n==s){t({voxel:[this.voxels[l]],direction:k[o],index:l});for(var u=0;u<4;u++)r.push(1,.6,.6,1)}else for(var u=0;u<4;u++)r.push(1,.9,.9,1);o+=1,s+=1}else for(var a=0;a<f.length;a++)if(f[a]!=0){for(var u=0;u<4;u++)r.push(1,1,1,1);s+=1}}return r}rebuild_faces(e){const t=new Array(e.length).fill(0).map(s=>[1,1,1,1,1,1]);for(var n=0;n<e.length;n++)for(var r=0;r<this.faces.length;r++)Y(e[n],this.voxels[r])&&(t[n][4]=0,this.faces[r][5]=0),X(e[n],this.voxels[r])&&(t[n][5]=0,this.faces[r][4]=0),G(e[n],this.voxels[r])&&(t[n][2]=0,this.faces[r][3]=0),W(e[n],this.voxels[r])&&(t[n][3]=0,this.faces[r][2]=0),V(e[n],this.voxels[r])&&(t[n][0]=0,this.faces[r][1]=0),q(e[n],this.voxels[r])&&(t[n][1]=0,this.faces[r][0]=0);for(var n=0;n<e.length;n++)for(var r=n+1;r<e.length;r++)Y(e[n],e[r])&&(t[n][4]=0,t[r][5]=0),X(e[n],e[r])&&(t[n][5]=0,t[r][4]=0),G(e[n],e[r])&&(t[n][2]=0,t[r][3]=0),W(e[n],e[r])&&(t[n][3]=0,t[r][2]=0),V(e[n],e[r])&&(t[n][0]=0,t[r][1]=0),q(e[n],e[r])&&(t[n][1]=0,t[r][0]=0);this.faces.push(...t)}rebuild_remove_faces(e){for(var t=0;t<e.length;t++)for(var n=0;n<this.voxels.length;n++)Y(e[t],this.voxels[n])&&(this.faces[n][5]=1),X(e[t],this.voxels[n])&&(this.faces[n][4]=1),G(e[t],this.voxels[n])&&(this.faces[n][3]=1),W(e[t],this.voxels[n])&&(this.faces[n][2]=1),V(e[t],this.voxels[n])&&(this.faces[n][1]=1),q(e[t],this.voxels[n])&&(this.faces[n][0]=1)}build_faces(){const e=this.voxels,t=new Array(e.length).fill(0).map(s=>[1,1,1,1,1,1]);for(var n=0;n<e.length;n++)for(var r=n+1;r<e.length;r++)Y(e[n],e[r])&&(t[n][4]=0,t[r][5]=0),X(e[n],e[r])&&(t[n][5]=0,t[r][4]=0),G(e[n],e[r])&&(t[n][2]=0,t[r][3]=0),W(e[n],e[r])&&(t[n][3]=0,t[r][2]=0),V(e[n],e[r])&&(t[n][0]=0,t[r][1]=0),q(e[n],e[r])&&(t[n][1]=0,t[r][0]=0);this.faces=t}build_center(){const e=this.boundary;this.center=e[0].map((t,n)=>t+e[1][n])}build_boundary(){const e=this.voxels;for(var t=e[0],n=e[0],r=1;r<e.length;r++)t=t.map((s,o)=>Math.min(s,e[r][o])),n=n.map((s,o)=>Math.max(s,e[r][o]));this.boundary=[t,n]}}class ye{constructor(e,t,n){this.gl=e,this.program=t,this.canvas=n,this.attribute_matrix_4_mat_float=C((r,s)=>{var o=e.getUniformLocation(this.program,r);e.uniformMatrix4fv(o,!1,s)}),this.uniform_float=C((r,s)=>{var o=e.getUniformLocation(this.program,r);e.uniform1f(o,s)}),this.uniform_4_float=C((r,s)=>{var o=e.getUniformLocation(this.program,r);e.uniform4f(o,s[0],s[1],s[2],s[3])}),this.uniform_3_float=C((r,s)=>{var o=e.getUniformLocation(this.program,r);e.uniform3f(o,s[0],s[1],s[2])}),this.attribute_matrix_3_float=C((r,s)=>{var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array(s),e.STATIC_DRAW);var a=e.getAttribLocation(this.program,r);e.vertexAttribPointer(a,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a)}),this.attribute_matrix_4_float=C((r,s)=>{var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array(s),e.STATIC_DRAW);var a=e.getAttribLocation(this.program,r);e.vertexAttribPointer(a,4,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a)})}set face(e){this.faces=e}buffer(e){const t=this.gl,n=this.canvas,r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r);var s=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,s),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,s);const o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,o,0),e(),t.bindFramebuffer(t.FRAMEBUFFER,null),o}getPixel(e,t){const n=this.gl,r=new Uint8Array(4);return n.readPixels(e,t,1,1,n.RGBA,n.UNSIGNED_BYTE,r),r}drawSolid(e){const t=this.gl;if(!e){if(this.faces==null)throw"No faces defined";e=this.faces}var n=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),t.STATIC_DRAW),t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),t.drawElements(t.TRIANGLES,e.length,t.UNSIGNED_SHORT,0)}drawLines(e){const t=this.gl;if(!e){if(this.faces==null)throw"No faces defined";e=this.faces}var n=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),t.STATIC_DRAW),t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),t.drawElements(t.LINES,e.length,t.UNSIGNED_SHORT,0)}}function C(i){return new Proxy({},{set:function(e,t,n){return i(t,n),!0}})}function xe(i,e,t){const n=i.getContext("webgl2",{antialias:!0}),r=n.createProgram(),s=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(s,t),n.compileShader(s),n.attachShader(r,s);const o=n.createShader(n.VERTEX_SHADER);return n.shaderSource(o,e),n.compileShader(o),n.attachShader(r,o),n.linkProgram(r),n.useProgram(r),[n,new ye(n,r,i)]}var se=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});function ge(){var i=new se(16);return se!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function Ee(i,e){if(i===e){var t=e[1],n=e[2],r=e[3],s=e[6],o=e[7],a=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=t,i[6]=e[9],i[7]=e[13],i[8]=n,i[9]=s,i[11]=e[14],i[12]=r,i[13]=o,i[14]=a}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i}function Re(i,e){var t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7],f=e[8],d=e[9],c=e[10],p=e[11],m=e[12],v=e[13],F=e[14],A=e[15],R=t*a-n*o,L=t*u-r*o,T=t*l-s*o,S=n*u-r*a,N=n*l-s*a,D=r*l-s*u,B=f*v-d*m,I=f*F-c*m,w=f*A-p*m,M=d*F-c*v,_=d*A-p*v,y=c*A-p*F,h=R*y-L*_+T*M+S*w-N*I+D*B;return h?(h=1/h,i[0]=(a*y-u*_+l*M)*h,i[1]=(r*_-n*y-s*M)*h,i[2]=(v*D-F*N+A*S)*h,i[3]=(c*N-d*D-p*S)*h,i[4]=(u*w-o*y-l*I)*h,i[5]=(t*y-r*w+s*I)*h,i[6]=(F*T-m*D-A*L)*h,i[7]=(f*D-c*T+p*L)*h,i[8]=(o*_-a*w+l*B)*h,i[9]=(n*w-t*_-s*B)*h,i[10]=(m*N-v*T+A*R)*h,i[11]=(d*T-f*N-p*R)*h,i[12]=(a*I-o*M-u*B)*h,i[13]=(t*M-n*I+r*B)*h,i[14]=(v*L-m*S-F*R)*h,i[15]=(f*S-d*L+c*R)*h,i):null}function Fe(i,e,t,n){function r(_,y,h,g){var U=Math.tan(_*.5*Math.PI/180);return[.5/U,0,0,0,0,.5*y/U,0,0,0,0,-(g+h)/(g-h),-1,0,0,-2*g*h/(g-h),0]}var s=r(40,i.width/i.height,1,1e3),o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const u=ge();Re(u,a),Ee(u,u),t.viewport(0,0,i.width,i.height),e.attribute_matrix_4_mat_float.uNormalMatrix=u,a[14]=a[14]-6;var l=0,f=!1,d,c,p=0,m=0,v=null,F=function(_){return _.button==1?v="pan":v="rotate",f=!0,d=_.pageX,c=_.pageY,_.preventDefault(),!1},A=function(_){f=!1};const R={x:0,y:0};var L=function(_){const y=i.__element.getBoundingClientRect();if(R.x=(_.clientX-y.left)*t.canvas.width/t.canvas.clientWidth,R.y=t.canvas.height-(_.clientY-y.top)*t.canvas.height/t.canvas.clientHeight-1,!f)return!1;p=(_.pageX-d)*2*Math.PI/i.width,m=(_.pageY-c)*2*Math.PI/i.height,v=="rotate"?(I+=p,w+=m):v=="pan"&&T(p,m),d=_.pageX,c=_.pageY,_.preventDefault()};function T(_,y){a[12]-=_*a[14]/2,a[13]+=y*a[14]/2}i.$on("mousedown",F),i.$on("mouseup",A),i.$on("mouseout",A),i.$on("mousemove",L);var S=function(_){_.preventDefault();var y=_.wheelDelta?_.wheelDelta/40:_.detail?-_.detail:0,h=1.3;return y&&N(y<0?1*h:1/h),_.preventDefault()&&!1};function N(_){a[14]*=_}i.$on("wheel",S);function D(_,y){var h=Math.cos(y),g=Math.sin(y),U=_[1],j=_[5],ee=_[9];_[1]=_[1]*h-_[2]*g,_[5]=_[5]*h-_[6]*g,_[9]=_[9]*h-_[10]*g,_[2]=_[2]*h+U*g,_[6]=_[6]*h+j*g,_[10]=_[10]*h+ee*g}function B(_,y){var h=Math.cos(y),g=Math.sin(y),U=_[0],j=_[4],ee=_[8];_[0]=h*_[0]+g*_[2],_[4]=h*_[4]+g*_[6],_[8]=h*_[8]+g*_[10],_[2]=h*_[2]-g*U,_[6]=h*_[6]-g*j,_[10]=h*_[10]-g*ee}var I=.8,w=.8;function M(){f||(p*=l,m*=l,I+=p,w+=m),o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,w=Math.max(-Math.PI/2,Math.min(Math.PI/2,w)),B(o,I),D(o,w),e.attribute_matrix_4_mat_float.projection_matrix=s,e.attribute_matrix_4_mat_float.view_matrix=a,e.attribute_matrix_4_mat_float.model_matrix=o}return{update:M,mouse:R,zoom:N}}function Ae(i){var e=0;function t(n){n*=.001;const r=n-e;e=n;const s=1/r;i(s.toFixed(1)),requestAnimationFrame(t)}t()}function ne(i,e){var t=[];const n=oe({name:"Point"});for(const r of i){const s=E("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(n.name==r.name?" button-selected":""),elements:[typeof n<"u"?n:void 0,typeof name<"u"?name:void 0,typeof r<"u"?r:void 0,typeof name<"u"?name:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r.name,elements:[typeof r<"u"?r:void 0,typeof name<"u"?name:void 0]});s.$on("click",()=>{n.name=r.name,e(r.name)}),t.push(s)}return t}function O(i,e){const t=oe({value:!0});var n=E("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(t.value?" button-selected":""),elements:[typeof t<"u"?t:void 0,typeof value<"u"?value:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]});return n.$on("click",()=>{t.value=!t.value,e(t.value)}),n}function $(i,e){var t=E("button",{class:"button"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]});return t.$on("click",()=>{e()}),t}var J=null,K=null,z=null;const re=[{name:"Point"},{name:"Plane"},{name:"Horizontal line"},{name:"Vertical line"}];var H="Point",Q=!0,Z=!0;const P=le(),ue=le(),Te=E("div",{class:"main"},E("canvas",{ref:P}),E("div",{class:"info"},E("p",null,"FPS: ",E("span",{ref:ue})),E("p",null,E("h3",null,"Tool"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>ne(re,i=>H=i),elements:[typeof ne<"u"?ne:void 0,typeof re<"u"?re:void 0,typeof x<"u"?x:void 0,typeof H<"u"?H:void 0,typeof x<"u"?x:void 0]}),E("p",null,E("h3",null,"Tool options"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>O("Contiguous",i=>Q=i),elements:[typeof O<"u"?O:void 0,typeof x<"u"?x:void 0,typeof Q<"u"?Q:void 0,typeof x<"u"?x:void 0]}),E("p",null,E("h3",null,"View"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>O("Wireframe",i=>Z=i),elements:[typeof O<"u"?O:void 0,typeof x<"u"?x:void 0,typeof Z<"u"?Z:void 0,typeof x<"u"?x:void 0]}),E("p",null,E("h3",null,"Actions"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>$("Subdivide",()=>J()),elements:[typeof $<"u"?$:void 0,typeof J<"u"?J:void 0]}),E("p",null,E("h3",null,"Persistence"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>$("Save",()=>K()),elements:[typeof $<"u"?$:void 0,typeof K<"u"?K:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>$("Load",()=>z()),elements:[typeof $<"u"?$:void 0,typeof z<"u"?z:void 0]})));P.width=800;P.height=800;Te.$parent(document.body);var b=new be;b.init();async function Le(){var i=await fetch("./shader.vert").then(f=>f.text()),e=await fetch("./shader.frag").then(f=>f.text()),[t,n]=xe(P.__element,i,e);n.antialias=!1,n.uniform_4_float.color_overlay=[0,0,0,1],K=()=>{var f=JSON.stringify(b.voxels),d=new Blob([f],{type:"application/json"}),c=URL.createObjectURL(d),p=document.createElement("a");p.download="voxel.json",p.href=c,p.textContent="Download",p.click(),p.remove()},z=async()=>{var f=document.createElement("input");f.type="file",f.onchange=d=>{var c=d.target.files[0],p=new FileReader;p.onload=function(m){var v=m.target.result;b.voxels=JSON.parse(v),b.init();var[F,T]=b.boundary,A=F[0]-T[0],R=F[1]-T[1],L=F[2]-T[2],T=Math.abs(Math.max(A,R,L));console.log(T),u(T),n.attribute_matrix_3_float.normal=b.geometry_normals,n.attribute_matrix_3_float.position=b.geometry_vertexes},p.readAsText(c)},f.click(),f.remove()};var r=null,s=null;P.$on("mousedown",f=>{s=[f.offsetX,f.offsetY],f.button==1&&f.preventDefault()}),P.$on("contextmenu",f=>(f.preventDefault(),!1)),P.$on("mouseup",f=>{Math.abs(f.offsetX-s[0])>3||Math.abs(f.offsetY-s[1])>3||(f.button==0?(b.add(...r.voxel.map(d=>d.map((c,p)=>c+r.direction[p]))),n.attribute_matrix_3_float.normal=b.geometry_normals,n.attribute_matrix_3_float.position=b.geometry_vertexes):f.button==2&&(b.remove(...r.voxel),n.attribute_matrix_3_float.normal=b.geometry_normals,n.attribute_matrix_3_float.position=b.geometry_vertexes))});const{update:o,mouse:a,zoom:u}=Fe(P,n,t);J=()=>{b.subdivide(),n.attribute_matrix_3_float.normal=b.geometry_normals,n.attribute_matrix_3_float.position=b.geometry_vertexes,u(2)};function l(){t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.enable(t.CULL_FACE),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}Ae(f=>{ue.$html({key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>f,elements:[typeof f<"u"?f:void 0]}),o(),n.attribute_matrix_3_float.normal=b.geometry_normals,n.attribute_matrix_3_float.position=b.geometry_vertexes;var d=null;n.buffer(()=>{t.clearColor(0,0,0,0),n.uniform_float.disable_lighting=1,l(),n.attribute_matrix_4_float.color=b.pick_map,n.drawSolid(b.geometry_indexes),d=n.getPixel(a.x,a.y)}),n.uniform_float.disable_lighting=0,t.clearColor(.5,.5,.5,.9),t.enable(t.POLYGON_OFFSET_FILL),t.polygonOffset(1,1),l(),r=null,H=="Point"?n.attribute_matrix_4_float.color=b.get_highlight(d,c=>r=c):n.attribute_matrix_4_float.color=b.highlight_plane(d,c=>r=c,H,Q),n.drawSolid(b.geometry_indexes),t.disable(t.POLYGON_OFFSET_FILL),Z&&(n.uniform_float.enable_color_overlay=1,n.drawLines(b.geometry_edge_index),n.uniform_float.enable_color_overlay=0)})}Le();
