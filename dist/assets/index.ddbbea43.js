(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function _e(r){const e=new Set;function t(s){e.add(s)}function n(s){e.delete(s)}const i={get(s,a){return a==="__subscribe"?t:a==="__unsubscribe"?n:typeof s[a]=="object"&&s[a]!==null&&!(s[a]instanceof HTMLElement)?new Proxy(s[a],i):s[a]},set(s,a,l){s[a]=l;for(const d of e)d.__update();return!0}};return new Proxy(r,i)}function Fe(r){return Ae(new Pe(r))}function Ae(r){function e(n,i){return typeof n[i]!="object"||n[i]!==null?n[i]:new Proxy(n[i],{set:(s,a,l)=>(t.__handleEffect(t.__isReactive(l),()=>{s[a]=t.__handleFunction(l)}),!0),get:(s,a)=>e(s,a)})}const t=new Proxy(r,{get:(n,i)=>{if(i in n)return n[i];if(i in n.__element)return e(n.__element,i)},set:(n,i,o)=>(i in n?n[i]=o:i=="style"?n.$set_style(o):i in n.__element&&n.$property(i,o),!0)});return t}class Pe{constructor(e){if(typeof e=="string")this.__element=document.createElement(e);else if(e instanceof HTMLElement)this.__element=e;else throw new Error("Invalid element name");this.__events=[],this.__children=[],this.__states=new Set,this.__unmounted_events=[],this.__mounted_events=[],this.__parent=null}__update(){for(const e of this.__events)e()}$click(){return this.__element.click(),this}$find(e){var t=[];this.__element.matches(e)&&t.push(Ae(this));for(const n of this.__children)t=t.concat(n.$find(e));return t}$update(){for(const e of this.__events)e();for(const e of this.__children)e.$update()}__parseInput(e){if(e&&e.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"){for(const t of e.elements)t&&t.__subscribe&&(this.__states.add(t),t.__subscribe(this));return e.expression}return e}__observeParent(){setTimeout(()=>{for(const t of this.__mounted_events)t()},0),new MutationObserver(t=>{for(const n of t){if(n.type==="childList"&&n.removedNodes.length){for(const i of n.removedNodes)if(i===this.__element){this.__unsubscribe();for(const o of this.__unmounted_events)o()}}if(n.type==="childList"&&n.addedNodes.length){for(const i of n.addedNodes)if(i===this.__element){this.__subscribe();for(const o of this.__mounted_events)o()}}}}).observe(this.__element.parentElement,{childList:!0})}__subscribe(){if(this.__states)for(const e of this.__states)e.__subscribe(this)}__unsubscribe(){for(const e of this.__children)e.__unsubscribe();if(this.__states)for(const e of this.__states)e.__unsubscribe(this)}__handleFunction(e){return typeof e=="function"?e():e}__handleEffect(e,t){e?(t(),this.__events.push(t)):t()}__isReactive(...e){for(const t of e)if(typeof t=="function")return!0;return!1}$if(e){return e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{const t=this.__handleFunction(e);this.$style("display",t?"":"none")}),this}$class(e,t=!0){e=this.__parseInput(e),t=this.__parseInput(t);var n=null;return this.__handleEffect(this.__isReactive(e,t),()=>{const i=this.__handleFunction(e);if(i)if(typeof i=="object")for(const o in i)i[o]?this.__element.classList.add(o):this.__element.classList.remove(o);else this.__handleFunction(t)?(this.__isReactive(e)&&(n&&this.__element.classList.remove(...n.split(" ").filter(o=>o.length>0)),n=i),this.__element.classList.add(...i.split(" ").filter(o=>o.length>0))):(this.__element.classList.remove(...i.split(" ").filter(o=>o.length>0)),n=null)}),this}get parentElement(){return this.__parent}$parent(e){return this.__parent=e,e.__element!==void 0?(e.__element.appendChild(this.__element),e.__children.push(this)):e.appendChild(this.__element),this.__observeParent(),this}$parentBefore(e){return this.__parent=e,e.__element!==void 0?e.__element.firstChild?e.__element.insertBefore(this.__element,e.__element.firstChild):e.__element.appendChild(this.__element):e.firstChild?e.insertBefore(this.__element,e.firstChild):e.appendChild(this.__element),this.__observeParent(),this}$on(e,t){return this.__element.addEventListener(e,t),this}__clean_input(e){return e&&e.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?e.expression:e}$onUpdate(e){return this.__events.push(e),this}$onMounted(e){this.__mounted_events.push(e)}$onUnmounted(e){this.__unmounted_events.push(e)}$property(e,t){return e=this.__parseInput(e),t=this.__parseInput(t),this.__handleEffect(this.__isReactive(e,t),()=>{this.__element[this.__handleFunction(e)]=this.__handleFunction(t)}),this}$style(e,t=null){return t?(this.__style(e,t),this):(e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{var n=this.__handleFunction(e);if(typeof n=="object")for(const i in n)this.__element.style[i]=n[i];else{const i=n.split(";").filter(o=>o.length>0);this.__element.style={};for(const o of i){const[s,a]=o.split(":");this.__element.style.setProperty(s,this.__handleFunction(a))}}}),this)}__style(e,t){return e=this.__parseInput(e),t=this.__parseInput(t),this.__handleEffect(this.__isReactive(e,t),()=>{this.__element.style[this.__handleFunction(e)]=this.__handleFunction(t)}),this}$get_computed_style(e){return window.getComputedStyle(this.__element).getPropertyValue(e)}$html(e){return e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{this.__element.innerHTML=this.__handleFunction(e)}),this}$child(e){e=this.__parseInput(e);var t;this.__isReactive(e)?t=Fe("span").$parent(this):t=this;var n=null;return this.__handleEffect(this.__isReactive(e),()=>{var i=this.__handleFunction(e);n&&n();const o=a=>a==null?()=>{}:a.__element!==void 0?(a.$parent(t),()=>a.$remove()):(a instanceof HTMLElement||(a=document.createTextNode(a)),t.__element.appendChild(a),()=>a.remove());if(Array.isArray(i)){var s=[];for(const a of i)s.push(o(a));n=()=>{for(const a of s)a()}}else n=o(i)}),this}$remove(){return this.__parent=null,this.__element.remove(),this}$model([e,t]){return this.$property("value",e),this.$on("input",n=>t(n.target.value)),this}}function Be(r){return r&&r.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?r.expression:r}const v=(r,e,...t)=>{var n,i=!1;if(typeof r=="function"){var o={};if(e)for(const[l,d]of Object.entries(e))o[l]=Be(d);if(n=r(o,...t),n===void 0)return t;i=!0}else n=Fe(r);const s={ref:l=>{l.__ref_object=n},style:l=>{n.$style(l)},class:l=>{n.$class(l)},parent:l=>{n.$parent(l)},if:l=>{n.$if(l)},model:([l,d])=>{n.$model([l,d])}},a={on:(l,d)=>{n.$on(l,d)}};if(e)for(const[l,d]of Object.entries(e)){const f=l.split(":");f.length==2?a[f[0]]&&a[f[0]](f[1],d):s[l]?s[l](d):i||n.$property(l,d)}if(t&&!i)for(const l of t)n.$child(l);return n};function Q(r=null){var e=r;return new Proxy({},{get:(n,i)=>{if(e!=null)return e[i]},set:(n,i,o)=>(i==="__ref_object"&&(e=o),o!=null&&(e[i]=o),!0)})}function Ne(r){return[(r>>0&255)/255,(r>>8&255)/255,(r>>16&255)/255,1]}function ge(r){return r[0]+(r[1]<<8)+(r[2]<<16)-1}const Ie=[[0,0,1,0,0,1,0,0,1,0,0,1],[0,0,-1,0,0,-1,0,0,-1,0,0,-1],[0,1,0,0,1,0,0,1,0,0,1,0],[0,-1,0,0,-1,0,0,-1,0,0,-1,0],[1,0,0,1,0,0,1,0,0,1,0,0],[-1,0,0,-1,0,0,-1,0,0,-1,0,0]],Ce=[[-1,-1,1,1,-1,1,1,1,1,-1,1,1],[-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1],[-1,1,-1,-1,1,1,1,1,1,1,1,-1],[-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1],[1,-1,-1,1,1,-1,1,1,1,1,-1,1],[-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]],Me=[[0,1,2,0,2,3],[4,5,6,4,6,7],[8,9,10,8,10,11],[12,13,14,12,14,15],[16,17,18,16,18,19],[20,21,22,20,22,23]],De=[[0,1,1,2,2,3,3,0],[4,5,5,6,6,7,7,4],[8,9,9,10,10,11,11,8],[12,13,13,14,14,15,15,12],[16,17,17,18,18,19,19,16],[20,21,21,22,22,23,23,20]],J=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],Ue=[1,1,1];function j(r,e){return r[0]+1==e[0]&&r[1]==e[1]&&r[2]==e[2]}function ee(r,e){return r[0]-1==e[0]&&r[1]==e[1]&&r[2]==e[2]}function te(r,e){return r[1]+1==e[1]&&r[0]==e[0]&&r[2]==e[2]}function ne(r,e){return r[1]-1==e[1]&&r[0]==e[0]&&r[2]==e[2]}function ie(r,e){return r[2]+1==e[2]&&r[0]==e[0]&&r[1]==e[1]}function re(r,e){return r[2]-1==e[2]&&r[0]==e[0]&&r[1]==e[1]}const be=[[0,1,0,1,0,1],[0,1,0,1,1,0],[0,1,1,0,0,1],[0,1,1,0,1,0],[1,0,0,1,0,1],[1,0,0,1,1,0],[1,0,1,0,0,1],[1,0,1,0,1,0]];class Oe{constructor(){this.voxels=[[0,0,0]],this.color=[],this.init_colors(this.voxels)}init_colors(e){for(var t=[],n=0;n<e.length;n++){var i=[];t.push(i);for(var o=0;o<6;o++)i.push([...Ue])}this.color.push(...t)}build_geometry(){for(var e=[],t=[],n=[],i=[],o=[],s=[],a=0,l=1,d=0;d<this.voxels.length;d++){for(var f=0,u=0,k=l-1,$=[],p=0;p<6;p++){if(this.faces[d][p]==0){u+=4;continue}n.push(...Ce[p].map((A,T)=>A+this.voxels[d][T%3]*2-this.center[T%3])),o.push(...Ie[p]),s.push(...De[p].map(A=>A+a-u)),i.push(...Me[p].map(A=>A+a-u)),f+=4;for(var m=Ne(l),F=0;F<4;F++)$.push(...m);l++}a+=f,t.push({start:k,end:l-1}),e.push(...$)}this.id=l,this.distance=a,this.geometry_vertexes=n,this.geometry_indexes=i,this.geometry_normals=o,this.geometry_edge_index=s,this.pick_map=e,this.pick_meta=t}init(){this.build_boundary(),this.build_center(),this.build_faces(),this.build_geometry()}build(){this.build_boundary(),this.build_center(),this.build_geometry()}add(...e){this.voxels.push(...e),this.init_colors(e),this.build_boundary(),this.build_center(),this.rebuild_faces(e),this.build_geometry()}subdivide(){var e=[],t=[],n=[];for(const l in this.voxels){const d=this.voxels[l],f=this.faces[l],u=[d[0]*2,d[1]*2,d[2]*2];for(var i=0;i<8;i++){var o=[];n.push(o);for(var s=0;s<6;s++)o.push([...this.color[l][s]])}e.push([u[0],u[1],u[2]],[u[0]+1,u[1],u[2]],[u[0],u[1]+1,u[2]],[u[0]+1,u[1]+1,u[2]],[u[0],u[1],u[2]+1],[u[0]+1,u[1],u[2]+1],[u[0],u[1]+1,u[2]+1],[u[0]+1,u[1]+1,u[2]+1]);for(var s in be){var a=Array(6).fill(0);for(var i in be[s])be[s][i]==1&&f[i]==1&&(a[i]=1);t.push(a)}}this.voxels=e,this.faces=t,this.color=n,this.build_boundary(),this.build_center(),this.build_geometry()}remove(...e){for(const n of e){if(this.voxels.length==1){e.splice(e.indexOf(n),1);continue}for(var t=0;t<this.voxels.length;t++)if(this.voxels[t][0]==n[0]&&this.voxels[t][1]==n[1]&&this.voxels[t][2]==n[2]){this.voxels.splice(t,1),this.faces.splice(t,1),this.color.splice(t,1);break}}this.build_boundary(),this.build_center(),this.rebuild_remove_faces(e),this.build_geometry()}get_plane_color(e,t,n=null){var i=[];for(const f in this.pick_meta){const u=this.faces[f];for(var o=0,s=0;s<u.length;s++){if(u[s]==0){o+=1;continue}if(e.includes(f)){if(n!=null)var a=this.color[f][s];else var a=this.color[f][s];if(o==t){if(n!=null)var l=this.color[f][s].map((k,$)=>k*(1-n[3])+n[$]*n[3]);else var l=this.color[f][s].map($=>Math.abs(1-$*.5));for(var d=0;d<4;d++)i.push(...l,1)}else for(var d=0;d<4;d++)i.push(...a,1)}else for(var d=0;d<4;d++)i.push(...this.color[f][s],1);o+=1}}return i}get_plane(e,t){var n=[];for(const s in this.voxels){const a=this.voxels[s];var i=!0;for(const l in t)if(t[l]!=0&&e[l]!=a[l]){i=!1;break}if(i){var o=this.voxels[s].map((l,d)=>l+t[d]);this.voxels.some(l=>l[0]==o[0]&&l[1]==o[1]&&l[2]==o[2])||n.push(s)}}return n}get_contiguous(e,t,n){var i=[];const o=this.voxels,s=new Set;function a(l){for(const k of e){const $=o[k];var d=!0;for(const p in n)if(n[p]!=0){if(l[p]!=$[p]){d=!1;break}}else if(Math.abs(l[p]-$[p])>1){d=!1;break}if(d){var f=o[k].map((p,m)=>p+n[m]),u=`${f[0]},${f[1]},${f[2]}`;s.has(u)||(s.add(u),i.push(k),a(o[k]))}}}return a(t),i}get_vertical_line(e,t,n){var i=[];for(const l in this.voxels){const d=this.voxels[l];var o=!0,s=-1;for(const f in t)if(t[f]!=0&&(s=f,e[f]!=d[f])){o=!1;break}if(s==0){for(const f in t)if(t[f]==0&&e[f]!=d[f]&&f==2){o=!1;break}}else if(s==2){for(const f in t)if(t[f]==0&&e[f]!=d[f]&&f==0){o=!1;break}}else if(s==1){for(const f in t)if(t[f]==0&&e[f]!=d[f]&&f==0){o=!1;break}}else o=!1;if(o){var a=this.voxels[l].map((f,u)=>f+t[u]);this.voxels.some(f=>f[0]==a[0]&&f[1]==a[1]&&f[2]==a[2])||i.push(l)}}return i}get_horizontal_line(e,t,n){var i=[];for(const l in this.voxels){const d=this.voxels[l];var o=!0,s=-1;for(const f in t)if(t[f]!=0){if(s=f,e[f]!=d[f]){o=!1;break}}else if(e[f]!=d[f]&&f==1){o=!1;break}if(s==1){for(const f in t)if(t[f]==0&&e[f]!=d[f]&&f==2){o=!1;break}}if(o){var a=this.voxels[l].map((f,u)=>f+t[u]);this.voxels.some(f=>f[0]==a[0]&&f[1]==a[1]&&f[2]==a[2])||i.push(l)}}return i}highlight_plane(e,t,n,i,o=null){var s=ge(e),k=[],a=0;for(const p in this.pick_meta){const m=this.faces[p],F=this.pick_meta[p];if(s>=F.start&&s<F.end)for(var l=0,d=0;d<m.length;d++){if(m[d]==0){l+=1;continue}if(s==a){var f;switch(n){case"Plane":f=this.get_plane(this.voxels[p],J[l]);break;case"Horizontal line":f=this.get_horizontal_line(this.voxels[p],J[l]);break;case"Vertical line":f=this.get_vertical_line(this.voxels[p],J[l]);break}i&&(f=this.get_contiguous(f,this.voxels[p],J[l]));var u=[];for(const A of f)u.push(this.color[A][l]);return t({voxel:f.map(A=>this.voxels[A]),direction:J[l],color:u,mouse_color:this.color[p][d],index:p}),this.get_plane_color(f,l,o)}l+=1,a+=1}else for(var d=0;d<m.length;d++)m[d]!=0&&(a+=1)}var k=[];for(const p in this.pick_meta){const m=this.faces[p];for(var d=0;d<m.length;d++)if(m[d]!=0)for(var $=0;$<4;$++)k.push(...this.color[p][d],1)}return k}get_highlight(e,t,n=null){var i=new Set(e.map(p=>ge(p))),o=Array.from(i),s=[],a=[],l=0;for(const p in this.pick_meta){const m=this.faces[p],F=this.pick_meta[p];if(o.some(A=>A>=F.start&&A<F.end))for(var d=0,f=0;f<m.length;f++){if(m[f]==0){d+=1;continue}if(n!=null)var u=this.color[p][f];else var u=this.color[p][f];if(i.has(l)){if(n!=null)var k=this.color[p][f].map((A,T)=>A*(1-n[3])+n[T]*n[3]);else var k=this.color[p][f].map(T=>Math.abs(1-T*.5));a.push({voxel:[this.voxels[p]],direction:J[d],color:[this.color[p][f]],mouse_color:this.color[p][f],index:p});for(var $=0;$<4;$++)s.push(...k,1)}else for(var $=0;$<4;$++)s.push(...u,1);d+=1,l+=1}else for(var f=0;f<m.length;f++)if(m[f]!=0){for(var $=0;$<4;$++)s.push(...this.color[p][f],1);l+=1}}return t(a),s}rebuild_faces(e){const t=new Array(e.length).fill(0).map(o=>[1,1,1,1,1,1]);for(var n=0;n<e.length;n++)for(var i=0;i<this.faces.length;i++)j(e[n],this.voxels[i])&&(t[n][4]=0,this.faces[i][5]=0),ee(e[n],this.voxels[i])&&(t[n][5]=0,this.faces[i][4]=0),te(e[n],this.voxels[i])&&(t[n][2]=0,this.faces[i][3]=0),ne(e[n],this.voxels[i])&&(t[n][3]=0,this.faces[i][2]=0),ie(e[n],this.voxels[i])&&(t[n][0]=0,this.faces[i][1]=0),re(e[n],this.voxels[i])&&(t[n][1]=0,this.faces[i][0]=0);for(var n=0;n<e.length;n++)for(var i=n+1;i<e.length;i++)j(e[n],e[i])&&(t[n][4]=0,t[i][5]=0),ee(e[n],e[i])&&(t[n][5]=0,t[i][4]=0),te(e[n],e[i])&&(t[n][2]=0,t[i][3]=0),ne(e[n],e[i])&&(t[n][3]=0,t[i][2]=0),ie(e[n],e[i])&&(t[n][0]=0,t[i][1]=0),re(e[n],e[i])&&(t[n][1]=0,t[i][0]=0);this.faces.push(...t)}rebuild_remove_faces(e){for(var t=0;t<e.length;t++)for(var n=0;n<this.voxels.length;n++)j(e[t],this.voxels[n])&&(this.faces[n][5]=1),ee(e[t],this.voxels[n])&&(this.faces[n][4]=1),te(e[t],this.voxels[n])&&(this.faces[n][3]=1),ne(e[t],this.voxels[n])&&(this.faces[n][2]=1),ie(e[t],this.voxels[n])&&(this.faces[n][1]=1),re(e[t],this.voxels[n])&&(this.faces[n][0]=1)}build_faces(){const e=this.voxels,t=new Array(e.length).fill(0).map(o=>[1,1,1,1,1,1]);for(var n=0;n<e.length;n++)for(var i=n+1;i<e.length;i++)j(e[n],e[i])&&(t[n][4]=0,t[i][5]=0),ee(e[n],e[i])&&(t[n][5]=0,t[i][4]=0),te(e[n],e[i])&&(t[n][2]=0,t[i][3]=0),ne(e[n],e[i])&&(t[n][3]=0,t[i][2]=0),ie(e[n],e[i])&&(t[n][0]=0,t[i][1]=0),re(e[n],e[i])&&(t[n][1]=0,t[i][0]=0);this.faces=t}build_center(){const e=this.boundary;this.center=e[0].map((t,n)=>t+e[1][n])}build_boundary(){const e=this.voxels;for(var t=e[0],n=e[0],i=1;i<e.length;i++)t=t.map((o,s)=>Math.min(o,e[i][s])),n=n.map((o,s)=>Math.max(o,e[i][s]));this.boundary=[t,n]}}class He{constructor(e,t,n){this.gl=e,this.program=t,this.canvas=n,this.attribute_matrix_4_mat_float=V((i,o)=>{var s=e.getUniformLocation(this.program,i);e.uniformMatrix4fv(s,!1,o)}),this.uniform_float=V((i,o)=>{var s=e.getUniformLocation(this.program,i);e.uniform1f(s,o)}),this.uniform_4_float=V((i,o)=>{var s=e.getUniformLocation(this.program,i);e.uniform4f(s,o[0],o[1],o[2],o[3])}),this.uniform_3_float=V((i,o)=>{var s=e.getUniformLocation(this.program,i);e.uniform3f(s,o[0],o[1],o[2])}),this.attribute_matrix_3_float=V((i,o)=>{var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array(o),e.STATIC_DRAW);var a=e.getAttribLocation(this.program,i);e.vertexAttribPointer(a,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a)}),this.attribute_matrix_4_float=V((i,o)=>{var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array(o),e.STATIC_DRAW);var a=e.getAttribLocation(this.program,i);e.vertexAttribPointer(a,4,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a)})}set face(e){this.faces=e}buffer(e){const t=this.gl,n=this.canvas,i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i);var o=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,o),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,o);const s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),e(),t.bindFramebuffer(t.FRAMEBUFFER,null),s}getPixel(e,t){const n=this.gl,i=new Uint8Array(4);return n.readPixels(e,t,1,1,n.RGBA,n.UNSIGNED_BYTE,i),i}drawSolid(e){const t=this.gl;if(!e){if(this.faces==null)throw"No faces defined";e=this.faces}var n=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),t.STATIC_DRAW),t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),t.drawElements(t.TRIANGLES,e.length,t.UNSIGNED_SHORT,0)}drawLines(e){const t=this.gl;if(!e){if(this.faces==null)throw"No faces defined";e=this.faces}var n=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),t.STATIC_DRAW),t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),t.drawElements(t.LINES,e.length,t.UNSIGNED_SHORT,0)}}function V(r){return new Proxy({},{set:function(e,t,n){return r(t,n),!0}})}function Xe(r,e,t){const n=r.getContext("webgl2",{antialias:!0}),i=n.createProgram(),o=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(o,t),n.compileShader(o),n.attachShader(i,o);const s=n.createShader(n.VERTEX_SHADER);return n.shaderSource(s,e),n.compileShader(s),n.attachShader(i,s),n.linkProgram(i),n.useProgram(i),[n,new He(n,i,r)]}var Ee=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function Ye(){var r=new Ee(16);return Ee!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Ge(r,e){if(r===e){var t=e[1],n=e[2],i=e[3],o=e[6],s=e[7],a=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=o,r[11]=e[14],r[12]=i,r[13]=s,r[14]=a}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function We(r,e){var t=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],d=e[7],f=e[8],u=e[9],k=e[10],$=e[11],p=e[12],m=e[13],F=e[14],A=e[15],T=t*a-n*s,I=t*l-i*s,U=t*d-o*s,H=n*l-i*a,O=n*d-o*a,b=i*d-o*l,c=f*m-u*p,h=f*F-k*p,E=f*A-$*p,g=u*F-k*m,B=u*A-$*m,w=k*A-$*F,R=T*w-I*B+U*g+H*E-O*h+b*c;return R?(R=1/R,r[0]=(a*w-l*B+d*g)*R,r[1]=(i*B-n*w-o*g)*R,r[2]=(m*b-F*O+A*H)*R,r[3]=(k*O-u*b-$*H)*R,r[4]=(l*E-s*w-d*h)*R,r[5]=(t*w-i*E+o*h)*R,r[6]=(F*U-p*b-A*I)*R,r[7]=(f*b-k*U+$*I)*R,r[8]=(s*B-a*E+d*c)*R,r[9]=(n*E-t*B-o*c)*R,r[10]=(p*O-m*U+A*T)*R,r[11]=(u*U-f*O-$*T)*R,r[12]=(a*h-s*g-l*c)*R,r[13]=(t*g-n*h+i*c)*R,r[14]=(m*I-p*H-F*T)*R,r[15]=(f*H-u*I+k*T)*R,r):null}function Je(r,e,t,n){function i(_,C,L,N){var W=Math.tan(_*.5*Math.PI/180);return[.5/W,0,0,0,0,.5*C/W,0,0,0,0,-(N+L)/(N-L),-1,0,0,-2*N*L/(N-L),0]}var o=i(40,r.width/r.height,1,1e3),s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const l=Ye();We(l,a),Ge(l,l),t.viewport(0,0,r.width,r.height),e.attribute_matrix_4_mat_float.uNormalMatrix=l,a[14]=a[14]-6;var d=0,f=!1,u,k,$=0,p=0,m=null,F=!1;document.addEventListener("keydown",function(_){_.key=="Control"&&(F=!0)}),document.addEventListener("keyup",function(_){_.key=="Control"&&(F=!1)});var A=function(_){if(!!F)return _.button==2?m="pan":m="rotate",f=!0,u=_.pageX,k=_.pageY,_.preventDefault(),!1},T=function(_){f=!1};const I={x:0,y:0};var U=function(_){const C=r.__element.getBoundingClientRect();if(I.x=(_.clientX-C.left)*t.canvas.width/t.canvas.clientWidth,I.y=t.canvas.height-(_.clientY-C.top)*t.canvas.height/t.canvas.clientHeight-1,!f)return!1;$=(_.pageX-u)*2*Math.PI/r.width,p=(_.pageY-k)*2*Math.PI/r.height,m=="rotate"?(E+=$,g+=p):m=="pan"&&H($,p),u=_.pageX,k=_.pageY,_.preventDefault()};function H(_,C){a[12]-=_*a[14]/2,a[13]+=C*a[14]/2}r.$on("mousedown",A),r.$on("mouseup",T),r.$on("mouseout",T),r.$on("mousemove",U);var O=function(_){_.preventDefault();var C=_.wheelDelta?_.wheelDelta/40:_.detail?-_.detail:0,L=1.3;return C&&b(C<0?1*L:1/L),_.preventDefault()&&!1};function b(_){a[14]*=_}r.$on("wheel",O);function c(_,C){var L=Math.cos(C),N=Math.sin(C),W=_[1],he=_[5],pe=_[9];_[1]=_[1]*L-_[2]*N,_[5]=_[5]*L-_[6]*N,_[9]=_[9]*L-_[10]*N,_[2]=_[2]*L+W*N,_[6]=_[6]*L+he*N,_[10]=_[10]*L+pe*N}function h(_,C){var L=Math.cos(C),N=Math.sin(C),W=_[0],he=_[4],pe=_[8];_[0]=L*_[0]+N*_[2],_[4]=L*_[4]+N*_[6],_[8]=L*_[8]+N*_[10],_[2]=L*_[2]-N*W,_[6]=L*_[6]-N*he,_[10]=L*_[10]-N*pe}var E=.8,g=.8;function B(){f||($*=d,p*=d,E+=$,g+=p),s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,g=Math.max(-Math.PI/2,Math.min(Math.PI/2,g)),h(s,E),c(s,g),e.attribute_matrix_4_mat_float.projection_matrix=o,e.attribute_matrix_4_mat_float.view_matrix=a,e.attribute_matrix_4_mat_float.model_matrix=s}function w(){a[12]=0,a[13]=0}function R(){E=.8,g=.8}function Se(_){a[14]=_}return{update:B,mouse:I,zoom:b,resetPan:w,resetRotation:R,setZoom:Se}}function Ve(r){var e=0;function t(n){n*=.001;const i=n-e;e=n;const o=1/i;r(o.toFixed(1)),requestAnimationFrame(t)}t()}function K(r,e,t){var n=[];const i=_e({name:t});for(const o of r){const s=v("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(i.name==o.name?" button-selected":""),elements:[typeof i<"u"?i:void 0,typeof name<"u"?name:void 0,typeof o<"u"?o:void 0,typeof name<"u"?name:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>o.name,elements:[typeof o<"u"?o:void 0,typeof name<"u"?name:void 0]});s.$on("click",()=>{i.name=o.name,e(o.name)}),n.push(s)}return n}function q(r,e){const t=_e({value:!0});var n=v("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(t.value?" button-selected":""),elements:[typeof t<"u"?t:void 0,typeof value<"u"?value:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]});return n.$on("click",()=>{t.value=!t.value,e(t.value)}),n}function S(r,e){var t=v("button",{class:"button"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]});return t.$on("click",()=>{e()}),t}function $e({callback:r,start:e,color:t}){r||(r=d=>{});const n=_e({absolute_value:0,relative_value:0});var i=Q(),o=v("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--accent-color:${t()};`,elements:[typeof t<"u"?t:void 0]}},v("div",{class:"trackbar-background"}),v("div",{class:"trackbar-foreground"}),v("div",{class:"trackbar-thumb",ref:i,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${n.absolute_value}px`,elements:[typeof n<"u"?n:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));o.$onMounted(()=>{var d=o.__element.getBoundingClientRect();n.relative_value=e(),n.absolute_value=d.width*e()/255,r(n.relative_value)}),o.$onUpdate(()=>{var d=o.__element.getBoundingClientRect();n.relative_value=e(),n.absolute_value=d.width*e()/255});var s=!1,a;function l(d){var f=d-a,u=o.__element.getBoundingClientRect();f<0&&(f=0),f>u.width&&(f=u.width),n.absolute_value=f,n.relative_value=n.absolute_value/u.width*255,r(n.relative_value)}return document.addEventListener("mousemove",d=>{s&&l(d.clientX)}),i.$on("mousedown",d=>{d.stopPropagation(),s=!0,a=d.clientX-n.absolute_value}),o.$on("mousedown",d=>{var f=o.__element.getBoundingClientRect();a=f.left,l(d.clientX),s=!0}),document.addEventListener("mouseup",d=>{s=!1}),o}function ve({callback:r,start:e,colorFrom:t,colorTo:n}){r||(r=f=>{});const i=_e({absolute_value:0,relative_value:0});var o=Q(),s=v("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--color-from:${t()};--color-to:${n()};`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0]}},v("div",{class:"trackbar-data"}),v("div",{class:"trackbar-thumb",ref:o,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${i.absolute_value}px`,elements:[typeof i<"u"?i:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));s.$onMounted(()=>{var f=s.__element.getBoundingClientRect();i.relative_value=e(),i.absolute_value=f.width*e()/255,r(i.relative_value)}),s.$onUpdate(()=>{var f=s.__element.getBoundingClientRect();i.relative_value=e(),i.absolute_value=f.width*e()/255});var a=!1,l;function d(f){var u=f-l,k=s.__element.getBoundingClientRect();u<0&&(u=0),u>k.width&&(u=k.width),i.absolute_value=u,i.relative_value=i.absolute_value/k.width*255,r(i.relative_value)}return document.addEventListener("mousemove",f=>{a&&d(f.clientX)}),o.$on("mousedown",f=>{f.stopPropagation(),a=!0,l=f.clientX-i.absolute_value}),s.$on("mousedown",f=>{var u=s.__element.getBoundingClientRect();l=u.left,d(f.clientX),a=!0}),document.addEventListener("mouseup",f=>{a=!1}),s}function Te(r,e){var t=JSON.stringify(e),n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.download=r,o.href=i,o.textContent="Download",o.click(),o.remove()}async function we(r,e){var t=document.createElement("input");t.type="file",t.accept="."+r,t.onchange=n=>{var i=n.target.files[0],o=new FileReader;o.onload=function(s){var a=s.target.result;e(JSON.parse(a))},o.readAsText(i)},t.click(),t.remove()}function Ke({set:r,get:e}){var t=0,n=0,i=0,o=255,s=255,a=255,l=255,d=255;const f=Q();var u=[];function k(){f.$html(""),we("col",c=>{for(var h=0;h<c.length;h++)p(c[h][0],c[h][1],c[h][2],c[h][3])})}function $(){Te("color_list.col",u)}function p(c,h,E,g){u.push([c,h,E,g]);var B=v("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${c},${h},${E},${g/255})`,elements:[typeof c<"u"?c:void 0,typeof h<"u"?h:void 0,typeof E<"u"?E:void 0,typeof g<"u"?g:void 0]}}),w=!1;B.$on("mousedown",R=>(w=!0,R.button==1&&R.preventDefault(),!1)),B.$on("contextmenu",R=>(R.preventDefault(),!1)),document.addEventListener("mouseup",R=>{setTimeout(()=>{w=!1},100)}),B.$on("mouseup",R=>{!w||(R.button==0?(t=c,n=h,i=E,o=g,F(),m&&m.$update()):R.button==2?(s=c,a=h,l=E,d=g,F("background"),m&&m.$update()):B.$remove())}),B.$parent(f)}var m=v("div",null,v("div",{style:"display:flex;flex-direction:row"},v("div",{style:"width:100%;padding:10px"},v(ve,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`0,${n},${i}`,elements:[typeof n<"u"?n:void 0,typeof i<"u"?i:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`255,${n},${i}`,elements:[typeof n<"u"?n:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:c=>T(c),elements:[typeof x<"u"?x:void 0,typeof T<"u"?T:void 0,typeof x<"u"?x:void 0]}}),v(ve,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>n,elements:[typeof n<"u"?n:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${t},0,${i}`,elements:[typeof t<"u"?t:void 0,typeof i<"u"?i:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${t},255,${i}`,elements:[typeof t<"u"?t:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:c=>I(c),elements:[typeof x<"u"?x:void 0,typeof I<"u"?I:void 0,typeof x<"u"?x:void 0]}}),v(ve,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${t},${n},0`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${t},${n},255`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:c=>U(c),elements:[typeof x<"u"?x:void 0,typeof U<"u"?U:void 0,typeof x<"u"?x:void 0]}}))),v("div",{class:"row"},v("div",{class:"color-area"},v("div",{class:"color-container"},v("div",{class:"background color-item"},v("div",{class:"backdrop"}),v("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${s},${a},${l},${d/255})`,elements:[typeof s<"u"?s:void 0,typeof a<"u"?a:void 0,typeof l<"u"?l:void 0,typeof d<"u"?d:void 0]}})),v("div",{class:"foreground color-item"},v("div",{class:"backdrop"}),v("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${t},${n},${i},${o/255})`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0,typeof i<"u"?i:void 0,typeof o<"u"?o:void 0]}}))),v("div",{class:"hover-icon-container",style:"margin-left:5px","on:click":b},v("i",{class:"fa-solid fa-arrows-rotate hover-icon"}))),v("div",{class:"alpha-area",style:"margin-top:-10px"},v($e,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>o,elements:[typeof o<"u"?o:void 0]},color:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${t},${n},${i};`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:c=>H(c),elements:[typeof x<"u"?x:void 0,typeof H<"u"?H:void 0,typeof x<"u"?x:void 0]}}),v($e,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>d,elements:[typeof d<"u"?d:void 0]},color:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${s},${a},${l};`,elements:[typeof s<"u"?s:void 0,typeof a<"u"?a:void 0,typeof l<"u"?l:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:c=>O(c),elements:[typeof x<"u"?x:void 0,typeof O<"u"?O:void 0,typeof x<"u"?x:void 0]}}))),v("div",{class:"color-history-container"},v("div",{style:"display:inline-block",ref:f}),v("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${t},${n},${i},${o/255})`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0,typeof i<"u"?i:void 0,typeof o<"u"?o:void 0]},"on:click":()=>p(t,n,i,o)},v("i",{class:"fa fa-plus"})),v("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${s},${a},${l},${d/255})`,elements:[typeof s<"u"?s:void 0,typeof a<"u"?a:void 0,typeof l<"u"?l:void 0,typeof d<"u"?d:void 0]},"on:click":()=>p(s,a,l,d)},v("i",{class:"fa fa-plus"}))),v("button",{class:"button","on:click":()=>$()},"Save colors"),v("button",{class:"button","on:click":()=>k()},"Load colors"));function F(c="foreground"){e(c,{r:t,g:n,b:i,a:o},{r:s,g:a,b:l,a:d})}r(A());function A(){return(c,h)=>{c!=null&&(t=c.r,n=c.g,i=c.b,o=c.a),h!=null&&(s=h.r,a=h.g,l=h.b,d=h.a),m&&m.$update()}}function T(c){t=c,m&&m.$update(),F()}function I(c){n=c,m&&m.$update(),F()}function U(c){i=c,m&&m.$update(),F()}function H(c){o=c,m&&m.$update(),F()}function O(c){d=c,m&&m.$update(),F("background")}function b(){var c=s;s=t,t=c,c=a,a=n,n=c,c=l,l=i,i=c,c=d,d=o,o=c,m&&m.$update(),F()}return F(),m}var Z=null,oe=null,se=null,fe=null,ae=null,le=null,de=null,M=P;const me=[{name:"Pen"},{name:"Plane"},{name:"Horizontal line"},{name:"Vertical line"}],ye=[{name:"Sculpt"},{name:"Paint"}];var Y="Pen",G="Sculpt",z=!0,ue=!0,P=[1,0,0],X=[1,1,1];function xe(r,e,t){P=[e.r/255,e.g/255,e.b/255,e.a/255],X=[t.r/255,t.g/255,t.b/255,t.a/255],r=="foreground"?M=P:M=X}var ce=null;function ke(r,e){var t=null;r!=null&&(t={r:r[0]*255,g:r[1]*255,b:r[2]*255,a:255});var n=null;e!=null&&(n={r:e[0]*255,g:e[1]*255,b:e[2]*255,a:255}),ce(t,n)}const D=Q(),Le=Q(),qe=v("div",{class:"main"},v("div",{class:"info"},v("p",null,v("h3",null,"Mode"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>K(ye,r=>{G=r,M=P},"Sculpt"),elements:[typeof K<"u"?K:void 0,typeof ye<"u"?ye:void 0,typeof x<"u"?x:void 0,typeof G<"u"?G:void 0,typeof x<"u"?x:void 0,typeof M<"u"?M:void 0,typeof P<"u"?P:void 0]}),v("p",null,v("h3",null,"Color"),v(Ke,{get:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:(r,e,t)=>xe(r,e,t),elements:[typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0,typeof xe<"u"?xe:void 0,typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0]},set:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:r=>ce=r,elements:[typeof fn<"u"?fn:void 0,typeof ce<"u"?ce:void 0,typeof fn<"u"?fn:void 0]}}))),v("canvas",{ref:D}),v("div",{class:"info"},v("p",null,"FPS: ",v("span",{ref:Le})),v("p",null,v("h3",null,"Tool"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>K(me,r=>Y=r,"Pen"),elements:[typeof K<"u"?K:void 0,typeof me<"u"?me:void 0,typeof x<"u"?x:void 0,typeof Y<"u"?Y:void 0,typeof x<"u"?x:void 0]}),v("p",null,v("h3",null,"Tool options"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>q("Contiguous",r=>z=r),elements:[typeof q<"u"?q:void 0,typeof x<"u"?x:void 0,typeof z<"u"?z:void 0,typeof x<"u"?x:void 0]}),v("p",null,v("h3",null,"View"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>q("Wireframe",r=>ue=r),elements:[typeof q<"u"?q:void 0,typeof x<"u"?x:void 0,typeof ue<"u"?ue:void 0,typeof x<"u"?x:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>S("Reset pan",()=>fe()),elements:[typeof S<"u"?S:void 0,typeof fe<"u"?fe:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>S("Reset rotation",()=>ae()),elements:[typeof S<"u"?S:void 0,typeof ae<"u"?ae:void 0]}),v("p",null,v("h3",null,"Actions"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>S("Subdivide",()=>Z()),elements:[typeof S<"u"?S:void 0,typeof Z<"u"?Z:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>S("Undo",()=>le()),elements:[typeof S<"u"?S:void 0,typeof le<"u"?le:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>S("Redo",()=>de()),elements:[typeof S<"u"?S:void 0,typeof de<"u"?de:void 0]}),v("p",null,v("h3",null,"Persistence"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>S("Save project",()=>oe()),elements:[typeof S<"u"?S:void 0,typeof oe<"u"?oe:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>S("Load project",()=>se()),elements:[typeof S<"u"?S:void 0,typeof se<"u"?se:void 0]})));D.width=800;D.height=800;qe.$parent(document.body);var y=new Oe;y.init();function Re(r){const e=D.__element.getBoundingClientRect();var t=(r.clientX-e.left)*D.width/D.clientWidth,n=D.height-(r.clientY-e.top)*D.height/D.clientHeight-1;return[t,n]}function Ze(r,e,t,n,i){var o,s,a,l;r==t?o=1:o=1/Math.abs(t-r),e==n?s=1:s=1/Math.abs(n-e);for(var d=Math.min(o,s)*i,f=0,u=[],k=a,$=l;f<=1;)k=r*(1-f)+t*f,$=e*(1-f)+n*f,u.push([k,$]),f+=d;return u}async function ze(){var r=await fetch("./shader.vert").then(b=>b.text()),e=await fetch("./shader.frag").then(b=>b.text()),[t,n]=Xe(D.__element,r,e);n.antialias=!1,n.uniform_4_float.color_overlay=[0,0,0,1],oe=()=>{Te("voxel_model.vox",{voxels:y.voxels,color:y.color})},se=async()=>{we("vox",({voxels:b,color:c})=>{y.voxels=b,y.color=c,y.init();var[h,w]=y.boundary,E=h[0]-w[0],g=h[1]-w[1],B=h[2]-w[2],w=Math.abs(Math.max(E,g,B));H(-6),I(),U(),T(Math.max(w,1)),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes})};var i=null,o=[],s=0,a=0,l=!1,d=!1,f=-1,u=[];k();function k(b=!1){u.length>30&&(u=u.slice(1),f--),u=u.slice(0,f+1),u.push(JSON.parse(JSON.stringify([y.voxels,y.color,y.faces,b]))),f=u.length-1}le=$,de=p;function $(){if(f>0){const b=u[f][3];f--;const[c,h,E]=JSON.parse(JSON.stringify(u[f]));b&&T(.5),y.voxels=c,y.color=h,y.faces=E,y.init(),y.build(),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes}}function p(){if(f+1<u.length){f++;const[b,c,h,E]=u[f];E&&T(2),y.voxels=b,y.color=c,y.faces=h,y.build(),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes}}document.addEventListener("keydown",function(b){b.key=="Control"&&(d=!0),b.key=="z"&&b.ctrlKey&&$(),b.key=="y"&&b.ctrlKey&&p(),b.key=="x"&&b.ctrlKey&&Z()}),document.addEventListener("keyup",function(b){b.key=="Control"&&(d=!1)});var m=!1;D.$on("mousedown",b=>{if(m=d,!d){if(b.offsetX,b.offsetY,b.button==1)b.preventDefault();else if(b.button==0||b.button==2){const[c,h]=Re(b);s=c,a=h,l=!0,o=[[c,h]]}b.button==0?M=P:b.button==2&&(M=X)}}),D.$on("mousemove",b=>{if(!l)return;const[c,h]=Re(b);o.push(...Ze(c,h,s,a,10)),s=c,a=h}),D.$on("contextmenu",b=>(b.preventDefault(),!1)),D.$on("mouseup",b=>{if(!(d||m)&&(o=[],l=!1,!!i)){if(Y=="Pen")if(G=="Sculpt"){if(b.button==0){var c=[];for(var h of i)c.push(...h.voxel.map(B=>B.map((w,R)=>w+h.direction[R])));c=[...new Set(c.map(JSON.stringify))].map(JSON.parse),y.add(...c),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes}else if(b.button==2){var c=[];for(var h of i)c.push(...h.voxel);y.remove(...c),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes}}else{if(b.button==0){M=P;for(var h of i)for(var E=0;E<h.color.length;E++)for(var g=0;g<3;g++)h.color[E][g]=h.color[E][g]*(1-P[3])+P[g]*P[3]}else if(b.button==2){M=X;for(var h of i)for(var E=0;E<h.color.length;E++)for(var g=0;g<3;g++)h.color[E][g]=h.color[E][g]*(1-X[3])+X[g]*X[3]}b.button==1&&(P=[...i[0].mouse_color,1],M=P,ke(P))}else if(G=="Sculpt")b.button==0?(y.add(...i.voxel.map(B=>B.map((w,R)=>w+i.direction[R]))),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes):b.button==2&&(y.remove(...i.voxel),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes);else{if(b.button==0){M=P;for(var E=0;E<i.color.length;E++)for(var g=0;g<3;g++)i.color[E][g]=i.color[E][g]*(1-P[3])+P[g]*P[3]}else if(b.button==2){M=X;for(var E=0;E<i.color.length;E++)for(var g=0;g<3;g++)i.color[E][g]=i.color[E][g]*(1-X[3])+X[g]*X[3]}b.button==1&&(P=[...i.mouse_color,1],M=P,ke(P))}k()}});const{update:F,mouse:A,zoom:T,resetPan:I,resetRotation:U,setZoom:H}=Je(D,n,t);fe=I,ae=U,Z=()=>{y.subdivide(),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes,T(2),k(!0)};function O(){t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.enable(t.CULL_FACE),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}Ve(b=>{Le.$html({key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>b,elements:[typeof b<"u"?b:void 0]}),F(),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes;var c=null;n.buffer(()=>{t.clearColor(0,0,0,0),n.uniform_float.disable_lighting=1,O(),n.attribute_matrix_4_float.color=y.pick_map,n.drawSolid(y.geometry_indexes),Y=="Pen"?l?c=o.map(h=>n.getPixel(h[0],h[1])):c=[n.getPixel(A.x,A.y)]:c=n.getPixel(A.x,A.y)}),n.uniform_float.disable_lighting=0,t.clearColor(.5,.5,.5,.9),t.enable(t.POLYGON_OFFSET_FILL),t.polygonOffset(1,1),O(),i=null,Y=="Pen"?G=="Sculpt"?n.attribute_matrix_4_float.color=y.get_highlight(c,h=>i=h):n.attribute_matrix_4_float.color=y.get_highlight(c,h=>i=h,M):G=="Sculpt"?n.attribute_matrix_4_float.color=y.highlight_plane(c,h=>i=h,Y,z):n.attribute_matrix_4_float.color=y.highlight_plane(c,h=>i=h,Y,z,M),n.drawSolid(y.geometry_indexes),t.disable(t.POLYGON_OFFSET_FILL),ue&&(n.uniform_float.enable_color_overlay=1,n.drawLines(y.geometry_edge_index),n.uniform_float.enable_color_overlay=0)})}ze();
