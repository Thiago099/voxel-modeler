(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function he(r){const e=new Set;function t(s){e.add(s)}function n(s){e.delete(s)}const i={get(s,a){return a==="__subscribe"?t:a==="__unsubscribe"?n:typeof s[a]=="object"&&s[a]!==null&&!(s[a]instanceof HTMLElement)?new Proxy(s[a],i):s[a]},set(s,a,l){s[a]=l;for(const d of e)d.__update();return!0}};return new Proxy(r,i)}function Ae(r){return Te(new Pe(r))}function Te(r){function e(n,i){return typeof n[i]!="object"||n[i]!==null?n[i]:new Proxy(n[i],{set:(s,a,l)=>(t.__handleEffect(t.__isReactive(l),()=>{s[a]=t.__handleFunction(l)}),!0),get:(s,a)=>e(s,a)})}const t=new Proxy(r,{get:(n,i)=>{if(i in n)return n[i];if(i in n.__element)return e(n.__element,i)},set:(n,i,o)=>(i in n?n[i]=o:i=="style"?n.$set_style(o):i in n.__element&&n.$property(i,o),!0)});return t}class Pe{constructor(e){if(typeof e=="string")this.__element=document.createElement(e);else if(e instanceof HTMLElement)this.__element=e;else throw new Error("Invalid element name");this.__events=[],this.__children=[],this.__states=new Set,this.__unmounted_events=[],this.__mounted_events=[],this.__parent=null}__update(){for(const e of this.__events)e()}$click(){return this.__element.click(),this}$find(e){var t=[];this.__element.matches(e)&&t.push(Te(this));for(const n of this.__children)t=t.concat(n.$find(e));return t}$update(){for(const e of this.__events)e();for(const e of this.__children)e.$update()}__parseInput(e){if(e&&e.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"){for(const t of e.elements)t&&t.__subscribe&&(this.__states.add(t),t.__subscribe(this));return e.expression}return e}__observeParent(){setTimeout(()=>{for(const t of this.__mounted_events)t()},0),new MutationObserver(t=>{for(const n of t){if(n.type==="childList"&&n.removedNodes.length){for(const i of n.removedNodes)if(i===this.__element){this.__unsubscribe();for(const o of this.__unmounted_events)o()}}if(n.type==="childList"&&n.addedNodes.length){for(const i of n.addedNodes)if(i===this.__element){this.__subscribe();for(const o of this.__mounted_events)o()}}}}).observe(this.__element.parentElement,{childList:!0})}__subscribe(){if(this.__states)for(const e of this.__states)e.__subscribe(this)}__unsubscribe(){for(const e of this.__children)e.__unsubscribe();if(this.__states)for(const e of this.__states)e.__unsubscribe(this)}__handleFunction(e){return typeof e=="function"?e():e}__handleEffect(e,t){e?(t(),this.__events.push(t)):t()}__isReactive(...e){for(const t of e)if(typeof t=="function")return!0;return!1}$if(e){return e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{const t=this.__handleFunction(e);this.$style("display",t?"":"none")}),this}$class(e,t=!0){e=this.__parseInput(e),t=this.__parseInput(t);var n=null;return this.__handleEffect(this.__isReactive(e,t),()=>{const i=this.__handleFunction(e);if(i)if(typeof i=="object")for(const o in i)i[o]?this.__element.classList.add(o):this.__element.classList.remove(o);else this.__handleFunction(t)?(this.__isReactive(e)&&(n&&this.__element.classList.remove(...n.split(" ").filter(o=>o.length>0)),n=i),this.__element.classList.add(...i.split(" ").filter(o=>o.length>0))):(this.__element.classList.remove(...i.split(" ").filter(o=>o.length>0)),n=null)}),this}get parentElement(){return this.__parent}$parent(e){return this.__parent=e,e.__element!==void 0?(e.__element.appendChild(this.__element),e.__children.push(this)):e.appendChild(this.__element),this.__observeParent(),this}$parentBefore(e){return this.__parent=e,e.__element!==void 0?e.__element.firstChild?e.__element.insertBefore(this.__element,e.__element.firstChild):e.__element.appendChild(this.__element):e.firstChild?e.insertBefore(this.__element,e.firstChild):e.appendChild(this.__element),this.__observeParent(),this}$on(e,t){return this.__element.addEventListener(e,t),this}__clean_input(e){return e&&e.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?e.expression:e}$onUpdate(e){return this.__events.push(e),this}$onMounted(e){this.__mounted_events.push(e)}$onUnmounted(e){this.__unmounted_events.push(e)}$property(e,t){return e=this.__parseInput(e),t=this.__parseInput(t),this.__handleEffect(this.__isReactive(e,t),()=>{this.__element[this.__handleFunction(e)]=this.__handleFunction(t)}),this}$style(e,t=null){return t?(this.__style(e,t),this):(e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{var n=this.__handleFunction(e);if(typeof n=="object")for(const i in n)this.__element.style[i]=n[i];else{const i=n.split(";").filter(o=>o.length>0);this.__element.style={};for(const o of i){const[s,a]=o.split(":");this.__element.style.setProperty(s,this.__handleFunction(a))}}}),this)}__style(e,t){return e=this.__parseInput(e),t=this.__parseInput(t),this.__handleEffect(this.__isReactive(e,t),()=>{this.__element.style[this.__handleFunction(e)]=this.__handleFunction(t)}),this}$get_computed_style(e){return window.getComputedStyle(this.__element).getPropertyValue(e)}$html(e){return e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{this.__element.innerHTML=this.__handleFunction(e)}),this}$child(e){e=this.__parseInput(e);var t;this.__isReactive(e)?t=Ae("span").$parent(this):t=this;var n=null;return this.__handleEffect(this.__isReactive(e),()=>{var i=this.__handleFunction(e);n&&n();const o=a=>a==null?()=>{}:a.__element!==void 0?(a.$parent(t),()=>a.$remove()):(a instanceof HTMLElement||(a=document.createTextNode(a)),t.__element.appendChild(a),()=>a.remove());if(Array.isArray(i)){var s=[];for(const a of i)s.push(o(a));n=()=>{for(const a of s)a()}}else n=o(i)}),this}$remove(){return this.__parent=null,this.__element.remove(),this}$model([e,t]){return this.$property("value",e),this.$on("input",n=>t(n.target.value)),this}}function Be(r){return r&&r.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?r.expression:r}const p=(r,e,...t)=>{var n,i=!1;if(typeof r=="function"){var o={};if(e)for(const[l,d]of Object.entries(e))o[l]=Be(d);if(n=r(o,...t),n===void 0)return t;i=!0}else n=Ae(r);const s={ref:l=>{l.__ref_object=n},style:l=>{n.$style(l)},class:l=>{n.$class(l)},parent:l=>{n.$parent(l)},if:l=>{n.$if(l)},model:([l,d])=>{n.$model([l,d])}},a={on:(l,d)=>{n.$on(l,d)}};if(e)for(const[l,d]of Object.entries(e)){const f=l.split(":");f.length==2?a[f[0]]&&a[f[0]](f[1],d):s[l]?s[l](d):i||n.$property(l,d)}if(t&&!i)for(const l of t)n.$child(l);return n};function j(r=null){var e=r;return new Proxy({},{get:(n,i)=>{if(e!=null)return e[i]},set:(n,i,o)=>(i==="__ref_object"&&(e=o),o!=null&&(e[i]=o),!0)})}function Ne(r){return[(r>>0&255)/255,(r>>8&255)/255,(r>>16&255)/255,1]}function Ee(r){return r[0]+(r[1]<<8)+(r[2]<<16)-1}const Ie=[[0,0,1,0,0,1,0,0,1,0,0,1],[0,0,-1,0,0,-1,0,0,-1,0,0,-1],[0,1,0,0,1,0,0,1,0,0,1,0],[0,-1,0,0,-1,0,0,-1,0,0,-1,0],[1,0,0,1,0,0,1,0,0,1,0,0],[-1,0,0,-1,0,0,-1,0,0,-1,0,0]],Me=[[-1,-1,1,1,-1,1,1,1,1,-1,1,1],[-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1],[-1,1,-1,-1,1,1,1,1,1,1,1,-1],[-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1],[1,-1,-1,1,1,-1,1,1,1,1,-1,1],[-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]],Ce=[[0,1,2,0,2,3],[4,5,6,4,6,7],[8,9,10,8,10,11],[12,13,14,12,14,15],[16,17,18,16,18,19],[20,21,22,20,22,23]],De=[[0,1,1,2,2,3,3,0],[4,5,5,6,6,7,7,4],[8,9,9,10,10,11,11,8],[12,13,13,14,14,15,15,12],[16,17,17,18,18,19,19,16],[20,21,21,22,22,23,23,20]],J=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],Ue=[1,1,1];function ee(r,e){return r[0]+1==e[0]&&r[1]==e[1]&&r[2]==e[2]}function te(r,e){return r[0]-1==e[0]&&r[1]==e[1]&&r[2]==e[2]}function ne(r,e){return r[1]+1==e[1]&&r[0]==e[0]&&r[2]==e[2]}function ie(r,e){return r[1]-1==e[1]&&r[0]==e[0]&&r[2]==e[2]}function re(r,e){return r[2]+1==e[2]&&r[0]==e[0]&&r[1]==e[1]}function oe(r,e){return r[2]-1==e[2]&&r[0]==e[0]&&r[1]==e[1]}const ve=[[0,1,0,1,0,1],[0,1,0,1,1,0],[0,1,1,0,0,1],[0,1,1,0,1,0],[1,0,0,1,0,1],[1,0,0,1,1,0],[1,0,1,0,0,1],[1,0,1,0,1,0]];class Oe{constructor(){this.voxels=[[0,0,0]],this.color=[],this.init_colors(this.voxels)}init_colors(e){for(var t=[],n=0;n<e.length;n++){var i=[];t.push(i);for(var o=0;o<6;o++)i.push([...Ue])}this.color.push(...t)}build_geometry(){for(var e=[],t=[],n=[],i=[],o=[],s=[],a=0,l=1,d=0;d<this.voxels.length;d++){for(var f=0,c=0,k=l-1,E=[],h=0;h<6;h++){if(this.faces[d][h]==0){c+=4;continue}n.push(...Me[h].map((A,T)=>A+this.voxels[d][T%3]*2-this.center[T%3])),o.push(...Ie[h]),s.push(...De[h].map(A=>A+a-c)),i.push(...Ce[h].map(A=>A+a-c)),f+=4;for(var v=Ne(l),F=0;F<4;F++)E.push(...v);l++}a+=f,t.push({start:k,end:l-1}),e.push(...E)}this.id=l,this.distance=a,this.geometry_vertexes=n,this.geometry_indexes=i,this.geometry_normals=o,this.geometry_edge_index=s,this.pick_map=e,this.pick_meta=t}init(){this.build_boundary(),this.build_center(),this.build_faces(),this.build_geometry()}build(){this.build_boundary(),this.build_center(),this.build_geometry()}add(...e){this.voxels.push(...e),this.init_colors(e),this.build_boundary(),this.build_center(),this.rebuild_faces(e),this.build_geometry()}subdivide(){var e=[],t=[],n=[];for(const l in this.voxels){const d=this.voxels[l],f=this.faces[l],c=[d[0]*2,d[1]*2,d[2]*2];for(var i=0;i<8;i++){var o=[];n.push(o);for(var s=0;s<6;s++)o.push([...this.color[l][s]])}e.push([c[0],c[1],c[2]],[c[0]+1,c[1],c[2]],[c[0],c[1]+1,c[2]],[c[0]+1,c[1]+1,c[2]],[c[0],c[1],c[2]+1],[c[0]+1,c[1],c[2]+1],[c[0],c[1]+1,c[2]+1],[c[0]+1,c[1]+1,c[2]+1]);for(var s in ve){var a=Array(6).fill(0);for(var i in ve[s])ve[s][i]==1&&f[i]==1&&(a[i]=1);t.push(a)}}this.voxels=e,this.faces=t,this.color=n,this.build_boundary(),this.build_center(),this.build_geometry()}remove(...e){for(const n of e){if(this.voxels.length==1){e.splice(e.indexOf(n),1);continue}for(var t=0;t<this.voxels.length;t++)if(this.voxels[t][0]==n[0]&&this.voxels[t][1]==n[1]&&this.voxels[t][2]==n[2]){this.voxels.splice(t,1),this.faces.splice(t,1),this.color.splice(t,1);break}}this.build_boundary(),this.build_center(),this.rebuild_remove_faces(e),this.build_geometry()}get_plane_color(e,t,n=null){var i=[];for(const f in this.pick_meta){const c=this.faces[f];for(var o=0,s=0;s<c.length;s++){if(c[s]==0){o+=1;continue}if(e.includes(f)){if(n!=null)var a=this.color[f][s];else var a=this.color[f][s];if(o==t){if(n!=null)var l=this.color[f][s].map((k,E)=>k*(1-n[3])+n[E]*n[3]);else var l=this.color[f][s].map(E=>Math.abs(1-E*.5));for(var d=0;d<4;d++)i.push(...l,1)}else for(var d=0;d<4;d++)i.push(...a,1)}else for(var d=0;d<4;d++)i.push(...this.color[f][s],1);o+=1}}return i}get_plane(e,t){var n=[];for(const s in this.voxels){const a=this.voxels[s];var i=!0;for(const l in t)if(t[l]!=0&&e[l]!=a[l]){i=!1;break}if(i){var o=this.voxels[s].map((l,d)=>l+t[d]);this.voxels.some(l=>l[0]==o[0]&&l[1]==o[1]&&l[2]==o[2])||n.push(s)}}return n}get_contiguous(e,t,n){var i=[];const o=this.voxels,s=new Set;function a(l){for(const k of e){const E=o[k];var d=!0;for(const h in n)if(n[h]!=0){if(l[h]!=E[h]){d=!1;break}}else if(Math.abs(l[h]-E[h])>1){d=!1;break}if(d){var f=o[k].map((h,v)=>h+n[v]),c=`${f[0]},${f[1]},${f[2]}`;s.has(c)||(s.add(c),i.push(k),a(o[k]))}}}return a(t),i}get_vertical_line(e,t,n){var i=[];for(const l in this.voxels){const d=this.voxels[l];var o=!0,s=-1;for(const f in t)if(t[f]!=0&&(s=f,e[f]!=d[f])){o=!1;break}if(s==0){for(const f in t)if(t[f]==0&&e[f]!=d[f]&&f==2){o=!1;break}}else if(s==2){for(const f in t)if(t[f]==0&&e[f]!=d[f]&&f==0){o=!1;break}}else if(s==1){for(const f in t)if(t[f]==0&&e[f]!=d[f]&&f==0){o=!1;break}}else o=!1;if(o){var a=this.voxels[l].map((f,c)=>f+t[c]);this.voxels.some(f=>f[0]==a[0]&&f[1]==a[1]&&f[2]==a[2])||i.push(l)}}return i}get_horizontal_line(e,t,n){var i=[];for(const l in this.voxels){const d=this.voxels[l];var o=!0,s=-1;for(const f in t)if(t[f]!=0){if(s=f,e[f]!=d[f]){o=!1;break}}else if(e[f]!=d[f]&&f==1){o=!1;break}if(s==1){for(const f in t)if(t[f]==0&&e[f]!=d[f]&&f==2){o=!1;break}}if(o){var a=this.voxels[l].map((f,c)=>f+t[c]);this.voxels.some(f=>f[0]==a[0]&&f[1]==a[1]&&f[2]==a[2])||i.push(l)}}return i}highlight_plane(e,t,n,i,o=null){var s=Ee(e),k=[],a=0;for(const h in this.pick_meta){const v=this.faces[h],F=this.pick_meta[h];if(s>=F.start&&s<F.end)for(var l=0,d=0;d<v.length;d++){if(v[d]==0){l+=1;continue}if(s==a){var f;switch(n){case"Plane":f=this.get_plane(this.voxels[h],J[l]);break;case"Horizontal line":f=this.get_horizontal_line(this.voxels[h],J[l]);break;case"Vertical line":f=this.get_vertical_line(this.voxels[h],J[l]);break}i&&(f=this.get_contiguous(f,this.voxels[h],J[l]));var c=[];for(const A of f)c.push(this.color[A][l]);return t({voxel:f.map(A=>this.voxels[A]),direction:J[l],color:c,mouse_color:this.color[h][d],index:h}),this.get_plane_color(f,l,o)}l+=1,a+=1}else for(var d=0;d<v.length;d++)v[d]!=0&&(a+=1)}var k=[];for(const h in this.pick_meta){const v=this.faces[h];for(var d=0;d<v.length;d++)if(v[d]!=0)for(var E=0;E<4;E++)k.push(...this.color[h][d],1)}return k}get_highlight(e,t,n=null){var i=new Set(e.map(h=>Ee(h))),o=Array.from(i),s=[],a=[],l=0;for(const h in this.pick_meta){const v=this.faces[h],F=this.pick_meta[h];if(o.some(A=>A>=F.start&&A<F.end))for(var d=0,f=0;f<v.length;f++){if(v[f]==0){d+=1;continue}if(n!=null)var c=this.color[h][f];else var c=this.color[h][f];if(i.has(l)){if(n!=null)var k=this.color[h][f].map((A,T)=>A*(1-n[3])+n[T]*n[3]);else var k=this.color[h][f].map(T=>Math.abs(1-T*.5));a.push({voxel:[this.voxels[h]],direction:J[d],color:[this.color[h][f]],mouse_color:this.color[h][f],index:h});for(var E=0;E<4;E++)s.push(...k,1)}else for(var E=0;E<4;E++)s.push(...c,1);d+=1,l+=1}else for(var f=0;f<v.length;f++)if(v[f]!=0){for(var E=0;E<4;E++)s.push(...this.color[h][f],1);l+=1}}return t(a),s}rebuild_faces(e){const t=new Array(e.length).fill(0).map(o=>[1,1,1,1,1,1]);for(var n=0;n<e.length;n++)for(var i=0;i<this.faces.length;i++)ee(e[n],this.voxels[i])&&(t[n][4]=0,this.faces[i][5]=0),te(e[n],this.voxels[i])&&(t[n][5]=0,this.faces[i][4]=0),ne(e[n],this.voxels[i])&&(t[n][2]=0,this.faces[i][3]=0),ie(e[n],this.voxels[i])&&(t[n][3]=0,this.faces[i][2]=0),re(e[n],this.voxels[i])&&(t[n][0]=0,this.faces[i][1]=0),oe(e[n],this.voxels[i])&&(t[n][1]=0,this.faces[i][0]=0);for(var n=0;n<e.length;n++)for(var i=n+1;i<e.length;i++)ee(e[n],e[i])&&(t[n][4]=0,t[i][5]=0),te(e[n],e[i])&&(t[n][5]=0,t[i][4]=0),ne(e[n],e[i])&&(t[n][2]=0,t[i][3]=0),ie(e[n],e[i])&&(t[n][3]=0,t[i][2]=0),re(e[n],e[i])&&(t[n][0]=0,t[i][1]=0),oe(e[n],e[i])&&(t[n][1]=0,t[i][0]=0);this.faces.push(...t)}rebuild_remove_faces(e){for(var t=0;t<e.length;t++)for(var n=0;n<this.voxels.length;n++)ee(e[t],this.voxels[n])&&(this.faces[n][5]=1),te(e[t],this.voxels[n])&&(this.faces[n][4]=1),ne(e[t],this.voxels[n])&&(this.faces[n][3]=1),ie(e[t],this.voxels[n])&&(this.faces[n][2]=1),re(e[t],this.voxels[n])&&(this.faces[n][1]=1),oe(e[t],this.voxels[n])&&(this.faces[n][0]=1)}build_faces(){const e=this.voxels,t=new Array(e.length).fill(0).map(o=>[1,1,1,1,1,1]);for(var n=0;n<e.length;n++)for(var i=n+1;i<e.length;i++)ee(e[n],e[i])&&(t[n][4]=0,t[i][5]=0),te(e[n],e[i])&&(t[n][5]=0,t[i][4]=0),ne(e[n],e[i])&&(t[n][2]=0,t[i][3]=0),ie(e[n],e[i])&&(t[n][3]=0,t[i][2]=0),re(e[n],e[i])&&(t[n][0]=0,t[i][1]=0),oe(e[n],e[i])&&(t[n][1]=0,t[i][0]=0);this.faces=t}build_center(){const e=this.boundary;this.center=e[0].map((t,n)=>t+e[1][n])}build_boundary(){const e=this.voxels;for(var t=e[0],n=e[0],i=1;i<e.length;i++)t=t.map((o,s)=>Math.min(o,e[i][s])),n=n.map((o,s)=>Math.max(o,e[i][s]));this.boundary=[t,n]}}class He{constructor(e,t,n){this.gl=e,this.program=t,this.canvas=n,this.attribute_matrix_4_mat_float=V((i,o)=>{var s=e.getUniformLocation(this.program,i);e.uniformMatrix4fv(s,!1,o)}),this.uniform_float=V((i,o)=>{var s=e.getUniformLocation(this.program,i);e.uniform1f(s,o)}),this.uniform_4_float=V((i,o)=>{var s=e.getUniformLocation(this.program,i);e.uniform4f(s,o[0],o[1],o[2],o[3])}),this.uniform_3_float=V((i,o)=>{var s=e.getUniformLocation(this.program,i);e.uniform3f(s,o[0],o[1],o[2])}),this.attribute_matrix_3_float=V((i,o)=>{var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array(o),e.STATIC_DRAW);var a=e.getAttribLocation(this.program,i);e.vertexAttribPointer(a,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a)}),this.attribute_matrix_4_float=V((i,o)=>{var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array(o),e.STATIC_DRAW);var a=e.getAttribLocation(this.program,i);e.vertexAttribPointer(a,4,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a)})}set face(e){this.faces=e}buffer(e){const t=this.gl,n=this.canvas,i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i);var o=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,o),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,o);const s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),e(),t.bindFramebuffer(t.FRAMEBUFFER,null),s}getPixel(e,t){const n=this.gl,i=new Uint8Array(4);return n.readPixels(e,t,1,1,n.RGBA,n.UNSIGNED_BYTE,i),i}drawSolid(e){const t=this.gl;if(!e){if(this.faces==null)throw"No faces defined";e=this.faces}var n=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),t.STATIC_DRAW),t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),t.drawElements(t.TRIANGLES,e.length,t.UNSIGNED_SHORT,0)}drawLines(e){const t=this.gl;if(!e){if(this.faces==null)throw"No faces defined";e=this.faces}var n=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),t.STATIC_DRAW),t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),t.drawElements(t.LINES,e.length,t.UNSIGNED_SHORT,0)}}function V(r){return new Proxy({},{set:function(e,t,n){return r(t,n),!0}})}function Xe(r,e,t){const n=r.getContext("webgl2",{antialias:!0}),i=n.createProgram(),o=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(o,t),n.compileShader(o),n.attachShader(i,o);const s=n.createShader(n.VERTEX_SHADER);return n.shaderSource(s,e),n.compileShader(s),n.attachShader(i,s),n.linkProgram(i),n.useProgram(i),[n,new He(n,i,r)]}var $e=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function Ye(){var r=new $e(16);return $e!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Ge(r,e){if(r===e){var t=e[1],n=e[2],i=e[3],o=e[6],s=e[7],a=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=o,r[11]=e[14],r[12]=i,r[13]=s,r[14]=a}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function We(r,e){var t=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],d=e[7],f=e[8],c=e[9],k=e[10],E=e[11],h=e[12],v=e[13],F=e[14],A=e[15],T=t*a-n*s,P=t*l-i*s,D=t*d-o*s,U=n*l-i*a,O=n*d-o*a,H=i*d-o*l,u=f*v-c*h,m=f*F-k*h,b=f*A-E*h,g=c*F-k*v,R=c*A-E*v,N=k*A-E*F,$=T*N-P*R+D*g+U*b-O*m+H*u;return $?($=1/$,r[0]=(a*N-l*R+d*g)*$,r[1]=(i*R-n*N-o*g)*$,r[2]=(v*H-F*O+A*U)*$,r[3]=(k*O-c*H-E*U)*$,r[4]=(l*b-s*N-d*m)*$,r[5]=(t*N-i*b+o*m)*$,r[6]=(F*D-h*H-A*P)*$,r[7]=(f*H-k*D+E*P)*$,r[8]=(s*R-a*b+d*u)*$,r[9]=(n*b-t*R-o*u)*$,r[10]=(h*O-v*D+A*T)*$,r[11]=(c*D-f*O-E*T)*$,r[12]=(a*m-s*g-l*u)*$,r[13]=(t*g-n*m+i*u)*$,r[14]=(v*P-h*U-F*T)*$,r[15]=(f*U-c*P+k*T)*$,r):null}function Je(r,e,t,n){function i(_,I,w,B){var W=Math.tan(_*.5*Math.PI/180);return[.5/W,0,0,0,0,.5*I/W,0,0,0,0,-(B+w)/(B-w),-1,0,0,-2*B*w/(B-w),0]}var o=i(40,r.width/r.height,1,1e3),s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const l=Ye();We(l,a),Ge(l,l),t.viewport(0,0,r.width,r.height),e.attribute_matrix_4_mat_float.uNormalMatrix=l,a[14]=a[14]-6;var d=0,f=!1,c,k,E=0,h=0,v=null,F=!1;document.addEventListener("keydown",function(_){_.key=="Control"&&(F=!0)}),document.addEventListener("keyup",function(_){_.key=="Control"&&(F=!1)});var A=function(_){if(!!F)return _.button==2?v="pan":v="rotate",f=!0,c=_.pageX,k=_.pageY,_.preventDefault(),!1},T=function(_){f=!1};const P={x:0,y:0};var D=function(_){const I=r.__element.getBoundingClientRect();if(P.x=(_.clientX-I.left)*t.canvas.width/t.canvas.clientWidth,P.y=t.canvas.height-(_.clientY-I.top)*t.canvas.height/t.canvas.clientHeight-1,!f)return!1;E=(_.pageX-c)*2*Math.PI/r.width,h=(_.pageY-k)*2*Math.PI/r.height,v=="rotate"?(b+=E,g+=h):v=="pan"&&U(E,h),c=_.pageX,k=_.pageY,_.preventDefault()};function U(_,I){a[12]-=_*a[14]/2,a[13]+=I*a[14]/2}r.$on("mousedown",A),r.$on("mouseup",T),r.$on("mouseout",T),r.$on("mousemove",D);var O=function(_){_.preventDefault();var I=_.wheelDelta?_.wheelDelta/40:_.detail?-_.detail:0,w=1.3;return I&&H(I<0?1*w:1/w),_.preventDefault()&&!1};function H(_){a[14]*=_}r.$on("wheel",O);function u(_,I){var w=Math.cos(I),B=Math.sin(I),W=_[1],pe=_[5],be=_[9];_[1]=_[1]*w-_[2]*B,_[5]=_[5]*w-_[6]*B,_[9]=_[9]*w-_[10]*B,_[2]=_[2]*w+W*B,_[6]=_[6]*w+pe*B,_[10]=_[10]*w+be*B}function m(_,I){var w=Math.cos(I),B=Math.sin(I),W=_[0],pe=_[4],be=_[8];_[0]=w*_[0]+B*_[2],_[4]=w*_[4]+B*_[6],_[8]=w*_[8]+B*_[10],_[2]=w*_[2]-B*W,_[6]=w*_[6]-B*pe,_[10]=w*_[10]-B*be}var b=.8,g=.8;function R(){f||(E*=d,h*=d,b+=E,g+=h),s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,g=Math.max(-Math.PI/2,Math.min(Math.PI/2,g)),m(s,b),u(s,g),e.attribute_matrix_4_mat_float.projection_matrix=o,e.attribute_matrix_4_mat_float.view_matrix=a,e.attribute_matrix_4_mat_float.model_matrix=s}function N(){a[12]=0,a[13]=0}function $(){b=.8,g=.8}function Z(_){a[14]=_}return{update:R,mouse:P,zoom:H,resetPan:N,resetRotation:$,setZoom:Z}}function Ve(r){var e=0;function t(n){n*=.001;const i=n-e;e=n;const o=1/i;r(o.toFixed(1)),requestAnimationFrame(t)}t()}function K(r,e,t){var n=[];const i=he({name:t});for(const o of r){const s=p("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(i.name==o.name?" button-selected":""),elements:[typeof i<"u"?i:void 0,typeof name<"u"?name:void 0,typeof o<"u"?o:void 0,typeof name<"u"?name:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>o.name,elements:[typeof o<"u"?o:void 0,typeof name<"u"?name:void 0]});s.$on("click",()=>{i.name=o.name,e(o.name)}),n.push(s)}return n}function q(r,e){const t=he({value:!0});var n=p("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(t.value?" button-selected":""),elements:[typeof t<"u"?t:void 0,typeof value<"u"?value:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]});return n.$on("click",()=>{t.value=!t.value,e(t.value)}),n}function L(r,e){var t=p("button",{class:"button"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]});return t.$on("click",()=>{e()}),t}function ke({callback:r,start:e,color:t}){r||(r=d=>{});const n=he({absolute_value:0,relative_value:0});var i=j(),o=p("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--accent-color:${t()};`,elements:[typeof t<"u"?t:void 0]}},p("div",{class:"trackbar-background"}),p("div",{class:"trackbar-foreground"}),p("div",{class:"trackbar-thumb",ref:i,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${n.absolute_value}px`,elements:[typeof n<"u"?n:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));o.$onUpdate(()=>{var d=o.__element.getBoundingClientRect();n.relative_value=e(),n.absolute_value=d.width*e()/255});var s=!1,a;function l(d){var f=d-a,c=o.__element.getBoundingClientRect();f<0&&(f=0),f>c.width&&(f=c.width),n.absolute_value=f,n.relative_value=n.absolute_value/c.width*255,r(n.relative_value)}return document.addEventListener("mousemove",d=>{s&&l(d.clientX)}),i.$on("mousedown",d=>{d.stopPropagation(),s=!0,a=d.clientX-n.absolute_value}),o.$on("mousedown",d=>{var f=o.__element.getBoundingClientRect();a=f.left,l(d.clientX),s=!0}),document.addEventListener("mouseup",d=>{s=!1}),o}function me({callback:r,start:e,colorFrom:t,colorTo:n}){r||(r=f=>{});const i=he({absolute_value:0,relative_value:0});var o=j(),s=p("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--color-from:${t()};--color-to:${n()};`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0]}},p("div",{class:"trackbar-data"}),p("div",{class:"trackbar-thumb",ref:o,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${i.absolute_value}px`,elements:[typeof i<"u"?i:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));s.$onUpdate(()=>{var f=s.__element.getBoundingClientRect();i.relative_value=e(),i.absolute_value=f.width*e()/255});var a=!1,l;function d(f){var c=f-l,k=s.__element.getBoundingClientRect();c<0&&(c=0),c>k.width&&(c=k.width),i.absolute_value=c,i.relative_value=i.absolute_value/k.width*255,r(i.relative_value)}return document.addEventListener("mousemove",f=>{a&&d(f.clientX)}),o.$on("mousedown",f=>{f.stopPropagation(),a=!0,l=f.clientX-i.absolute_value}),s.$on("mousedown",f=>{var c=s.__element.getBoundingClientRect();l=c.left,d(f.clientX),a=!0}),document.addEventListener("mouseup",f=>{a=!1}),s}function we(r,e){var t=JSON.stringify(e),n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.download=r,o.href=i,o.textContent="Download",o.click(),o.remove()}async function Le(r,e){var t=document.createElement("input");t.type="file",t.accept="."+r,t.onchange=n=>{var i=n.target.files[0],o=new FileReader;o.onload=function(s){var a=s.target.result;e(JSON.parse(a))},o.readAsText(i)},t.click(),t.remove()}function Ke({set:r,get:e}){var t=0,n=0,i=0,o=255,s=255,a=255,l=255,d=255;const f=j();var c=[];function k(){Le("col",u=>{f.$html("");for(var m=0;m<u.length;m++)h(u[m][0],u[m][1],u[m][2],u[m][3])})}function E(){we("color_list.col",c)}function h(u,m,b,g){c.push([u,m,b,g]);var R=p("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${u},${m},${b},${g/255})`,elements:[typeof u<"u"?u:void 0,typeof m<"u"?m:void 0,typeof b<"u"?b:void 0,typeof g<"u"?g:void 0]}}),N=!1;R.$on("mousedown",$=>(N=!0,$.button==1&&$.preventDefault(),!1)),R.$on("contextmenu",$=>($.preventDefault(),!1)),document.addEventListener("mouseup",$=>{setTimeout(()=>{N=!1},100)}),R.$on("mouseup",$=>{!N||($.button==0?(t=u,n=m,i=b,o=g,F(),v&&v.$update()):$.button==2?(s=u,a=m,l=b,d=g,F("background"),v&&v.$update()):R.$remove())}),R.$parent(f)}var v=p("div",null,p("div",{style:"display:flex;flex-direction:row"},p("div",{style:"width:100%;padding:10px"},p(me,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`0,${n},${i}`,elements:[typeof n<"u"?n:void 0,typeof i<"u"?i:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`255,${n},${i}`,elements:[typeof n<"u"?n:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:u=>T(u),elements:[typeof x<"u"?x:void 0,typeof T<"u"?T:void 0,typeof x<"u"?x:void 0]}}),p(me,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>n,elements:[typeof n<"u"?n:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${t},0,${i}`,elements:[typeof t<"u"?t:void 0,typeof i<"u"?i:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${t},255,${i}`,elements:[typeof t<"u"?t:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:u=>P(u),elements:[typeof x<"u"?x:void 0,typeof P<"u"?P:void 0,typeof x<"u"?x:void 0]}}),p(me,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${t},${n},0`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${t},${n},255`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:u=>D(u),elements:[typeof x<"u"?x:void 0,typeof D<"u"?D:void 0,typeof x<"u"?x:void 0]}}))),p("div",{class:"row"},p("div",{class:"color-area"},p("div",{class:"color-container"},p("div",{class:"background color-item"},p("div",{class:"backdrop"}),p("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${s},${a},${l},${d/255})`,elements:[typeof s<"u"?s:void 0,typeof a<"u"?a:void 0,typeof l<"u"?l:void 0,typeof d<"u"?d:void 0]}})),p("div",{class:"foreground color-item"},p("div",{class:"backdrop"}),p("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${t},${n},${i},${o/255})`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0,typeof i<"u"?i:void 0,typeof o<"u"?o:void 0]}}))),p("div",{class:"hover-icon-container",style:"margin-left:5px","on:click":H},p("i",{class:"fa-solid fa-arrows-rotate hover-icon"}))),p("div",{class:"alpha-area",style:"margin-top:-10px"},p(ke,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>o,elements:[typeof o<"u"?o:void 0]},color:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${t},${n},${i};`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:u=>U(u),elements:[typeof x<"u"?x:void 0,typeof U<"u"?U:void 0,typeof x<"u"?x:void 0]}}),p(ke,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>d,elements:[typeof d<"u"?d:void 0]},color:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${s},${a},${l};`,elements:[typeof s<"u"?s:void 0,typeof a<"u"?a:void 0,typeof l<"u"?l:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:u=>O(u),elements:[typeof x<"u"?x:void 0,typeof O<"u"?O:void 0,typeof x<"u"?x:void 0]}}))),p("div",{class:"color-history-container"},p("div",{style:"display:inline-block",ref:f}),p("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${t},${n},${i},${o/255})`,elements:[typeof t<"u"?t:void 0,typeof n<"u"?n:void 0,typeof i<"u"?i:void 0,typeof o<"u"?o:void 0]},"on:click":()=>h(t,n,i,o)},p("i",{class:"fa fa-plus"})),p("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${s},${a},${l},${d/255})`,elements:[typeof s<"u"?s:void 0,typeof a<"u"?a:void 0,typeof l<"u"?l:void 0,typeof d<"u"?d:void 0]},"on:click":()=>h(s,a,l,d)},p("i",{class:"fa fa-plus"}))),p("button",{class:"button","on:click":()=>E()},"Save colors"),p("button",{class:"button","on:click":()=>k()},"Load colors"));function F(u="foreground"){e(u,{r:t,g:n,b:i,a:o},{r:s,g:a,b:l,a:d})}r(A());function A(){return(u,m)=>{u!=null&&(t=u.r,n=u.g,i=u.b,o=u.a),m!=null&&(s=m.r,a=m.g,l=m.b,d=m.a),v&&v.$update()}}function T(u){t=u,v&&v.$update(),F()}function P(u){n=u,v&&v.$update(),F()}function D(u){i=u,v&&v.$update(),F()}function U(u){o=u,v&&v.$update(),F()}function O(u){d=u,v&&v.$update(),F("background")}function H(){var u=s;s=t,t=u,u=a,a=n,n=u,u=l,l=i,i=u,u=d,d=o,o=u,v&&v.$update(),F()}return F(),v.$onMounted(()=>{v.$update()}),v}var z=null,se=null,fe=null,ae=null,le=null,de=null,ue=null,M=S;const ye=[{name:"Pen"},{name:"Plane"},{name:"Horizontal line"},{name:"Vertical line"}],xe=[{name:"Sculpt"},{name:"Paint"}];var Y="Pen",G="Sculpt",Q=!0,ce=!0,S=[1,0,0],X=[1,1,1];function ge(r,e,t){S=[e.r/255,e.g/255,e.b/255,e.a/255],X=[t.r/255,t.g/255,t.b/255,t.a/255],r=="foreground"?M=S:M=X}var _e=null;function Re(r,e){var t=null;r!=null&&(t={r:r[0]*255,g:r[1]*255,b:r[2]*255,a:255});var n=null;e!=null&&(n={r:e[0]*255,g:e[1]*255,b:e[2]*255,a:255}),_e(t,n)}const C=j(),Se=j(),qe=p("div",{class:"main"},p("div",{class:"info"},p("p",null,p("h3",null,"Mode"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>K(xe,r=>{G=r,M=S},"Sculpt"),elements:[typeof K<"u"?K:void 0,typeof xe<"u"?xe:void 0,typeof x<"u"?x:void 0,typeof G<"u"?G:void 0,typeof x<"u"?x:void 0,typeof M<"u"?M:void 0,typeof S<"u"?S:void 0]}),p("p",null,p("h3",null,"Color"),p(Ke,{get:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:(r,e,t)=>ge(r,e,t),elements:[typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0,typeof ge<"u"?ge:void 0,typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0]},set:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:r=>_e=r,elements:[typeof fn<"u"?fn:void 0,typeof _e<"u"?_e:void 0,typeof fn<"u"?fn:void 0]}}))),p("canvas",{ref:C}),p("div",{class:"info"},p("p",null,"FPS: ",p("span",{ref:Se})),p("p",null,p("h3",null,"Tool"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>K(ye,r=>Y=r,"Pen"),elements:[typeof K<"u"?K:void 0,typeof ye<"u"?ye:void 0,typeof x<"u"?x:void 0,typeof Y<"u"?Y:void 0,typeof x<"u"?x:void 0]}),p("p",null,p("h3",null,"Tool options"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>q("Contiguous",r=>Q=r),elements:[typeof q<"u"?q:void 0,typeof x<"u"?x:void 0,typeof Q<"u"?Q:void 0,typeof x<"u"?x:void 0]}),p("p",null,p("h3",null,"View"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>q("Wireframe",r=>ce=r),elements:[typeof q<"u"?q:void 0,typeof x<"u"?x:void 0,typeof ce<"u"?ce:void 0,typeof x<"u"?x:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>L("Reset pan",()=>ae()),elements:[typeof L<"u"?L:void 0,typeof ae<"u"?ae:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>L("Reset rotation",()=>le()),elements:[typeof L<"u"?L:void 0,typeof le<"u"?le:void 0]}),p("p",null,p("h3",null,"Actions"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>L("Subdivide",()=>z()),elements:[typeof L<"u"?L:void 0,typeof z<"u"?z:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>L("Undo",()=>de()),elements:[typeof L<"u"?L:void 0,typeof de<"u"?de:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>L("Redo",()=>ue()),elements:[typeof L<"u"?L:void 0,typeof ue<"u"?ue:void 0]}),p("p",null,p("h3",null,"Persistence"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>L("Save project",()=>se()),elements:[typeof L<"u"?L:void 0,typeof se<"u"?se:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>L("Load project",()=>fe()),elements:[typeof L<"u"?L:void 0,typeof fe<"u"?fe:void 0]})));C.width=800;C.height=800;qe.$parent(document.body);var y=new Oe;y.init();function Fe(r){const e=C.__element.getBoundingClientRect();var t=(r.clientX-e.left)*C.width/C.clientWidth,n=C.height-(r.clientY-e.top)*C.height/C.clientHeight-1;return[t,n]}function Ze(r,e,t,n,i){var o,s,a,l;r==t?o=1:o=1/Math.abs(t-r),e==n?s=1:s=1/Math.abs(n-e);for(var d=Math.min(o,s)*i,f=0,c=[],k=a,E=l;f<=1;)k=r*(1-f)+t*f,E=e*(1-f)+n*f,c.push([k,E]),f+=d;return c}async function ze(){var r=await fetch("./shader.vert").then(u=>u.text()),e=await fetch("./shader.frag").then(u=>u.text()),[t,n]=Xe(C.__element,r,e);n.antialias=!1,n.uniform_4_float.color_overlay=[0,0,0,1],se=()=>{we("voxel_model.vox",{voxels:y.voxels,color:y.color})},fe=async()=>{Le("vox",({voxels:u,color:m})=>{y.voxels=u,y.color=m,y.init();var[b,$]=y.boundary,g=b[0]-$[0],R=b[1]-$[1],N=b[2]-$[2],$=Math.abs(Math.max(g,R,N));O(-6),D(),U(),P(Math.max($,1)),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes})};var i=null,o=[],s=0,a=0,l=!1,d=!1,f=-1,c=[];k();function k(u=!1){c.length>30&&(c=c.slice(1),f--),c=c.slice(0,f+1),c.push(JSON.parse(JSON.stringify([y.voxels,y.color,y.faces,u]))),f=c.length-1}de=E,ue=h;function E(){if(f>0){const u=c[f][3];f--;const[m,b,g]=JSON.parse(JSON.stringify(c[f]));u&&P(.5),y.voxels=m,y.color=b,y.faces=g,y.init(),y.build(),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes}}function h(){if(f+1<c.length){f++;const[u,m,b,g]=c[f];g&&P(2),y.voxels=u,y.color=m,y.faces=b,y.build(),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes}}document.addEventListener("keydown",function(u){u.key=="Control"&&(d=!0),u.key=="z"&&u.ctrlKey&&E(),u.key=="y"&&u.ctrlKey&&h(),u.key=="x"&&u.ctrlKey&&z()}),document.addEventListener("keyup",function(u){u.key=="Control"&&(d=!1)});var v=!1;C.$on("mousedown",u=>{if(v=d,!d){if(u.offsetX,u.offsetY,u.button==1)u.preventDefault();else if(u.button==0||u.button==2&&Y=="Pen"){const[m,b]=Fe(u);s=m,a=b,l=!0,o=[[m,b]]}u.button==0?M=S:u.button==2&&(M=X)}}),C.$on("mousemove",u=>{if(!l)return;const[m,b]=Fe(u);o.push(...Ze(m,b,s,a,5)),s=m,a=b}),C.$on("contextmenu",u=>(u.preventDefault(),!1));var F=[];C.$on("mouseup",u=>{if(!(d||v)&&(F=[],o=[],l=!1,!!i)){if(Y=="Pen")if(G=="Sculpt"){if(u.button==0){var m=[];for(var b of i)m.push(...b.voxel.map(N=>N.map(($,Z)=>$+b.direction[Z])));m=[...new Set(m.map(JSON.stringify))].map(JSON.parse),y.add(...m),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes}else if(u.button==2){var m=[];for(var b of i)m.push(...b.voxel);y.remove(...m),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes}}else{if(u.button==0){M=S;for(var b of i)for(var g=0;g<b.color.length;g++)for(var R=0;R<3;R++)b.color[g][R]=b.color[g][R]*(1-S[3])+S[R]*S[3]}else if(u.button==2){M=X;for(var b of i)for(var g=0;g<b.color.length;g++)for(var R=0;R<3;R++)b.color[g][R]=b.color[g][R]*(1-X[3])+X[R]*X[3]}u.button==1&&(S=[...i[0].mouse_color,1],M=S,Re(S))}else if(G=="Sculpt")u.button==0?(y.add(...i.voxel.map(N=>N.map(($,Z)=>$+i.direction[Z]))),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes):u.button==2&&(y.remove(...i.voxel),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes);else{if(u.button==0){M=S;for(var g=0;g<i.color.length;g++)for(var R=0;R<3;R++)i.color[g][R]=i.color[g][R]*(1-S[3])+S[R]*S[3]}else if(u.button==2){M=X;for(var g=0;g<i.color.length;g++)for(var R=0;R<3;R++)i.color[g][R]=i.color[g][R]*(1-X[3])+X[R]*X[3]}u.button==1&&(S=[...i.mouse_color,1],M=S,Re(S))}k()}});const{update:A,mouse:T,zoom:P,resetPan:D,resetRotation:U,setZoom:O}=Je(C,n,t);ae=D,le=U,z=()=>{y.subdivide(),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes,P(2),k(!0)};function H(){t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.enable(t.CULL_FACE),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}Ve(u=>{Se.$html({key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>u,elements:[typeof u<"u"?u:void 0]}),A(),n.attribute_matrix_3_float.normal=y.geometry_normals,n.attribute_matrix_3_float.position=y.geometry_vertexes;var m=null;n.buffer(()=>{t.clearColor(0,0,0,0),n.uniform_float.disable_lighting=1,H(),n.attribute_matrix_4_float.color=y.pick_map,n.drawSolid(y.geometry_indexes),Y=="Pen"?l?(F.push(...o.map(b=>n.getPixel(b[0],b[1]))),o=[]):F=[n.getPixel(T.x,T.y)]:m=n.getPixel(T.x,T.y)}),n.uniform_float.disable_lighting=0,t.clearColor(.5,.5,.5,.9),t.enable(t.POLYGON_OFFSET_FILL),t.polygonOffset(1,1),H(),i=null,Y=="Pen"?G=="Sculpt"?n.attribute_matrix_4_float.color=y.get_highlight(F,b=>i=b):n.attribute_matrix_4_float.color=y.get_highlight(F,b=>i=b,M):G=="Sculpt"?n.attribute_matrix_4_float.color=y.highlight_plane(m,b=>i=b,Y,Q):n.attribute_matrix_4_float.color=y.highlight_plane(m,b=>i=b,Y,Q,M),n.drawSolid(y.geometry_indexes),t.disable(t.POLYGON_OFFSET_FILL),ce&&(n.uniform_float.enable_color_overlay=1,n.drawLines(y.geometry_edge_index),n.uniform_float.enable_color_overlay=0)})}ze();
