(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const f of i)if(f.type==="childList")for(const o of f.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const f={};return i.integrity&&(f.integrity=i.integrity),i.referrerpolicy&&(f.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?f.credentials="include":i.crossorigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function t(i){if(i.ep)return;i.ep=!0;const f=n(i);fetch(i.href,f)}})();function Ee(r){const e=new Set;function n(o){e.add(o)}function t(o){e.delete(o)}const i={get(o,s){return s==="__subscribe"?n:s==="__unsubscribe"?t:typeof o[s]=="object"&&o[s]!==null&&!(o[s]instanceof HTMLElement)?new Proxy(o[s],i):o[s]},set(o,s,u){o[s]=u;for(const l of e)l.__update();return!0}};return new Proxy(r,i)}function Ve(r){return We(new en(r))}function We(r){function e(t,i){return typeof t[i]!="object"||t[i]!==null?t[i]:new Proxy(t[i],{set:(o,s,u)=>(n.__handleEffect(n.__isReactive(u),()=>{o[s]=n.__handleFunction(u)}),!0),get:(o,s)=>e(o,s)})}const n=new Proxy(r,{get:(t,i)=>{if(i in t)return t[i];if(i in t.__element)return e(t.__element,i)},set:(t,i,f)=>(i in t?t[i]=f:i=="style"?t.$set_style(f):i in t.__element&&t.$property(i,f),!0)});return n}class en{constructor(e){if(typeof e=="string")this.__element=document.createElement(e);else if(e instanceof HTMLElement)this.__element=e;else throw new Error("Invalid element name");this.__events=[],this.__children=[],this.__states=new Set,this.__unmounted_events=[],this.__mounted_events=[],this.__parent=null}__update(){for(const e of this.__events)e()}$click(){return this.__element.click(),this}$find(e){var n=[];this.__element.matches(e)&&n.push(We(this));for(const t of this.__children)n=n.concat(t.$find(e));return n}$update(){for(const e of this.__events)e();for(const e of this.__children)e.$update()}__parseInput(e){if(e&&e.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"){for(const n of e.elements)n&&n.__subscribe&&(this.__states.add(n),n.__subscribe(this));return e.expression}return e}__observeParent(){setTimeout(()=>{for(const n of this.__mounted_events)n()},0),new MutationObserver(n=>{for(const t of n){if(t.type==="childList"&&t.removedNodes.length){for(const i of t.removedNodes)if(i===this.__element){this.__unsubscribe();for(const f of this.__unmounted_events)f()}}if(t.type==="childList"&&t.addedNodes.length){for(const i of t.addedNodes)if(i===this.__element){this.__subscribe();for(const f of this.__mounted_events)f()}}}}).observe(this.__element.parentElement,{childList:!0})}__subscribe(){if(this.__states)for(const e of this.__states)e.__subscribe(this)}__unsubscribe(){for(const e of this.__children)e.__unsubscribe();if(this.__states)for(const e of this.__states)e.__unsubscribe(this)}__handleFunction(e){return typeof e=="function"?e():e}__handleEffect(e,n){e?(n(),this.__events.push(n)):n()}__isReactive(...e){for(const n of e)if(typeof n=="function")return!0;return!1}$if(e){return e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{const n=this.__handleFunction(e);this.$style("display",n?"":"none")}),this}$class(e,n=!0){e=this.__parseInput(e),n=this.__parseInput(n);var t=null;return this.__handleEffect(this.__isReactive(e,n),()=>{const i=this.__handleFunction(e);if(i)if(typeof i=="object")for(const f in i)i[f]?this.__element.classList.add(f):this.__element.classList.remove(f);else this.__handleFunction(n)?(this.__isReactive(e)&&(t&&this.__element.classList.remove(...t.split(" ").filter(f=>f.length>0)),t=i),this.__element.classList.add(...i.split(" ").filter(f=>f.length>0))):(this.__element.classList.remove(...i.split(" ").filter(f=>f.length>0)),t=null)}),this}get parentElement(){return this.__parent}$parent(e){return this.__parent=e,e.__element!==void 0?(e.__element.appendChild(this.__element),e.__children.push(this)):e.appendChild(this.__element),this.__observeParent(),this}$parentBefore(e){return this.__parent=e,e.__element!==void 0?e.__element.firstChild?e.__element.insertBefore(this.__element,e.__element.firstChild):e.__element.appendChild(this.__element):e.firstChild?e.insertBefore(this.__element,e.firstChild):e.appendChild(this.__element),this.__observeParent(),this}$on(e,n){return this.__element.addEventListener(e,n),this}__clean_input(e){return e&&e.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?e.expression:e}$onUpdate(e){return this.__events.push(e),this}$onMounted(e){this.__mounted_events.push(e)}$onUnmounted(e){this.__unmounted_events.push(e)}$property(e,n){return e=this.__parseInput(e),n=this.__parseInput(n),this.__handleEffect(this.__isReactive(e,n),()=>{this.__element[this.__handleFunction(e)]=this.__handleFunction(n)}),this}$style(e,n=null){return n?(this.__style(e,n),this):(e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{var t=this.__handleFunction(e);if(typeof t=="object")for(const i in t)this.__element.style[i]=t[i];else{const i=t.split(";").filter(f=>f.length>0);this.__element.style={};for(const f of i){const[o,s]=f.split(":");this.__element.style.setProperty(o,this.__handleFunction(s))}}}),this)}__style(e,n){return e=this.__parseInput(e),n=this.__parseInput(n),this.__handleEffect(this.__isReactive(e,n),()=>{this.__element.style[this.__handleFunction(e)]=this.__handleFunction(n)}),this}$get_computed_style(e){return window.getComputedStyle(this.__element).getPropertyValue(e)}$html(e){return e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{this.__element.innerHTML=this.__handleFunction(e)}),this}$child(e){e=this.__parseInput(e);var n;this.__isReactive(e)?n=Ve("span").$parent(this):n=this;var t=null;return this.__handleEffect(this.__isReactive(e),()=>{var i=this.__handleFunction(e);t&&t();const f=s=>s==null?()=>{}:s.__element!==void 0?(s.$parent(n),()=>s.$remove()):(s instanceof HTMLElement||(s=document.createTextNode(s)),n.__element.appendChild(s),()=>s.remove());if(Array.isArray(i)){var o=[];for(const s of i)o.push(f(s));t=()=>{for(const s of o)s()}}else t=f(i)}),this}$remove(){return this.__parent=null,this.__element.remove(),this}$model([e,n]){return this.$property("value",e),this.$on("input",t=>n(t.target.value)),this}}function nn(r){return r&&r.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?r.expression:r}const w=(r,e,...n)=>{var t,i=!1;if(typeof r=="function"){var f={};if(e)for(const[u,l]of Object.entries(e))f[u]=nn(l);if(t=r(f,...n),t===void 0)return n;i=!0}else t=Ve(r);const o={ref:u=>{u.__ref_object=t},style:u=>{t.$style(u)},class:u=>{t.$class(u)},parent:u=>{t.$parent(u)},if:u=>{t.$if(u)},model:([u,l])=>{t.$model([u,l])}},s={on:(u,l)=>{t.$on(u,l)}};if(e)for(const[u,l]of Object.entries(e)){const a=u.split(":");a.length==2?s[a[0]]&&s[a[0]](a[1],l):o[u]?o[u](l):i||t.$property(u,l)}if(n&&!i)for(const u of n)t.$child(u);return t};function fe(r=null){var e=r;return new Proxy({},{get:(t,i)=>{if(e!=null)return e[i]},set:(t,i,f)=>(i==="__ref_object"&&(e=f),f!=null&&(e[i]=f),!0)})}function tn(r){return[(r>>0&255)/255,(r>>8&255)/255,(r>>16&255)/255,1]}function Ue(r){return r[0]+(r[1]<<8)+(r[2]<<16)-1}const rn=[[0,0,1,0,0,1,0,0,1,0,0,1],[0,0,-1,0,0,-1,0,0,-1,0,0,-1],[0,1,0,0,1,0,0,1,0,0,1,0],[0,-1,0,0,-1,0,0,-1,0,0,-1,0],[1,0,0,1,0,0,1,0,0,1,0,0],[-1,0,0,-1,0,0,-1,0,0,-1,0,0]],on=[[-1,-1,1,1,-1,1,1,1,1,-1,1,1],[-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1],[-1,1,-1,-1,1,1,1,1,1,1,1,-1],[-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1],[1,-1,-1,1,1,-1,1,1,1,1,-1,1],[-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]],sn=[[0,1,2,0,2,3],[4,5,6,4,6,7],[8,9,10,8,10,11],[12,13,14,12,14,15],[16,17,18,16,18,19],[20,21,22,20,22,23]],an=[[0,1,1,2,2,3,3,0],[4,5,5,6,6,7,7,4],[8,9,9,10,10,11,11,8],[12,13,13,14,14,15,15,12],[16,17,17,18,18,19,19,16],[20,21,21,22,22,23,23,20]],z=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],un=[1,1,1];function oe(r,e){return r[0]+1==e[0]&&r[1]==e[1]&&r[2]==e[2]}function se(r,e){return r[0]-1==e[0]&&r[1]==e[1]&&r[2]==e[2]}function ae(r,e){return r[1]+1==e[1]&&r[0]==e[0]&&r[2]==e[2]}function ue(r,e){return r[1]-1==e[1]&&r[0]==e[0]&&r[2]==e[2]}function le(r,e){return r[2]+1==e[2]&&r[0]==e[0]&&r[1]==e[1]}function de(r,e){return r[2]-1==e[2]&&r[0]==e[0]&&r[1]==e[1]}const Te=[[0,1,0,1,0,1],[0,1,0,1,1,0],[0,1,1,0,0,1],[0,1,1,0,1,0],[1,0,0,1,0,1],[1,0,0,1,1,0],[1,0,1,0,0,1],[1,0,1,0,1,0]];class ln{constructor(){this.voxels=[[0,0,0]],this.color=[],this.init_colors(this.voxels)}init_colors(e){for(var n=[],t=0;t<e.length;t++){var i=[];n.push(i);for(var f=0;f<6;f++)i.push([...un])}this.color.push(...n)}build_geometry(){for(var e=[],n=[],t=[],i=[],f=[],o=[],s=0,u=1,l=0;l<this.voxels.length;l++){for(var a=0,d=0,c=u-1,_=[],h=0;h<6;h++){if(this.faces[l][h]==0){d+=4;continue}t.push(...on[h].map((F,R)=>F+this.voxels[l][R%3]*2-this.center[R%3])),f.push(...rn[h]),o.push(...an[h].map(F=>F+s-d)),i.push(...sn[h].map(F=>F+s-d)),a+=4;for(var v=tn(u),b=0;b<4;b++)_.push(...v);u++}s+=a,n.push({start:c,end:u-1}),e.push(..._)}this.id=u,this.distance=s,this.geometry_vertexes=t,this.geometry_indexes=i,this.geometry_normals=f,this.geometry_edge_index=o,this.pick_map=e,this.pick_meta=n}init(){this.build_boundary(),this.build_center(),this.build_faces(),this.build_geometry()}build(){this.build_boundary(),this.build_center(),this.build_geometry()}add(...e){this.voxels.push(...e),this.init_colors(e),this.build_boundary(),this.build_center(),this.rebuild_faces(e),this.build_geometry()}subdivide(){var e=[],n=[],t=[];for(const u in this.voxels){const l=this.voxels[u],a=this.faces[u],d=[l[0]*2,l[1]*2,l[2]*2];for(var i=0;i<8;i++){var f=[];t.push(f);for(var o=0;o<6;o++)f.push([...this.color[u][o]])}e.push([d[0],d[1],d[2]],[d[0]+1,d[1],d[2]],[d[0],d[1]+1,d[2]],[d[0]+1,d[1]+1,d[2]],[d[0],d[1],d[2]+1],[d[0]+1,d[1],d[2]+1],[d[0],d[1]+1,d[2]+1],[d[0]+1,d[1]+1,d[2]+1]);for(var o in Te){var s=Array(6).fill(0);for(var i in Te[o])Te[o][i]==1&&a[i]==1&&(s[i]=1);n.push(s)}}this.voxels=e,this.faces=n,this.color=t,this.build_boundary(),this.build_center(),this.build_geometry()}remove(...e){for(const t of e){if(this.voxels.length==1){e.splice(e.indexOf(t),1);continue}for(var n=0;n<this.voxels.length;n++)if(this.voxels[n][0]==t[0]&&this.voxels[n][1]==t[1]&&this.voxels[n][2]==t[2]){this.voxels.splice(n,1),this.faces.splice(n,1),this.color.splice(n,1);break}}this.build_boundary(),this.build_center(),this.rebuild_remove_faces(e),this.build_geometry()}get_plane_color(e,n,t=null){var i=[];for(const a in this.pick_meta){const d=this.faces[a];for(var f=0,o=0;o<d.length;o++){if(d[o]==0){f+=1;continue}if(e.includes(a)){if(t!=null)var s=this.color[a][o];else var s=this.color[a][o];if(f==n){if(t!=null)var u=this.color[a][o].map((c,_)=>c*(1-t[3])+t[_]*t[3]);else var u=this.color[a][o].map(_=>Math.abs(1-_*.5));for(var l=0;l<4;l++)i.push(...u,1)}else for(var l=0;l<4;l++)i.push(...s,1)}else for(var l=0;l<4;l++)i.push(...this.color[a][o],1);f+=1}}return i}get_plane(e,n){var t=[];for(const o in this.voxels){const s=this.voxels[o];var i=!0;for(const u in n)if(n[u]!=0&&e[u]!=s[u]){i=!1;break}if(i){var f=this.voxels[o].map((u,l)=>u+n[l]);this.voxels.some(u=>u[0]==f[0]&&u[1]==f[1]&&u[2]==f[2])||t.push(o)}}return t}get_contiguous(e,n,t){var i=[];const f=this.voxels,o=new Set;function s(u){for(const c of e){const _=f[c];var l=!0;for(const h in t)if(t[h]!=0){if(u[h]!=_[h]){l=!1;break}}else if(Math.abs(u[h]-_[h])>1){l=!1;break}if(l){var a=f[c].map((h,v)=>h+t[v]),d=`${a[0]},${a[1]},${a[2]}`;o.has(d)||(o.add(d),i.push(c),s(f[c]))}}}return s(n),i}get_vertical_line(e,n,t){var i=[];for(const u in this.voxels){const l=this.voxels[u];var f=!0,o=-1;for(const a in n)if(n[a]!=0&&(o=a,e[a]!=l[a])){f=!1;break}if(o==0){for(const a in n)if(n[a]==0&&e[a]!=l[a]&&a==2){f=!1;break}}else if(o==2){for(const a in n)if(n[a]==0&&e[a]!=l[a]&&a==0){f=!1;break}}else if(o==1){for(const a in n)if(n[a]==0&&e[a]!=l[a]&&a==0){f=!1;break}}else f=!1;if(f){var s=this.voxels[u].map((a,d)=>a+n[d]);this.voxels.some(a=>a[0]==s[0]&&a[1]==s[1]&&a[2]==s[2])||i.push(u)}}return i}get_horizontal_line(e,n,t){var i=[];for(const u in this.voxels){const l=this.voxels[u];var f=!0,o=-1;for(const a in n)if(n[a]!=0){if(o=a,e[a]!=l[a]){f=!1;break}}else if(e[a]!=l[a]&&a==1){f=!1;break}if(o==1){for(const a in n)if(n[a]==0&&e[a]!=l[a]&&a==2){f=!1;break}}if(f){var s=this.voxels[u].map((a,d)=>a+n[d]);this.voxels.some(a=>a[0]==s[0]&&a[1]==s[1]&&a[2]==s[2])||i.push(u)}}return i}highlight_plane(e,n,t,i,f=null){var o=Ue(e),c=[],s=0;for(const h in this.pick_meta){const v=this.faces[h],b=this.pick_meta[h];if(o>=b.start&&o<b.end)for(var u=0,l=0;l<v.length;l++){if(v[l]==0){u+=1;continue}if(o==s){var a;switch(t){case"Plane":a=this.get_plane(this.voxels[h],z[u]);break;case"Horizontal line":a=this.get_horizontal_line(this.voxels[h],z[u]);break;case"Vertical line":a=this.get_vertical_line(this.voxels[h],z[u]);break}i&&(a=this.get_contiguous(a,this.voxels[h],z[u]));var d=[];for(const F of a)d.push(this.color[F][u]);return n({voxel:a.map(F=>this.voxels[F]),direction:z[u],color:d,mouse_color:this.color[h][l],index:h}),this.get_plane_color(a,u,f)}u+=1,s+=1}else for(var l=0;l<v.length;l++)v[l]!=0&&(s+=1)}var c=[];for(const h in this.pick_meta){const v=this.faces[h];for(var l=0;l<v.length;l++)if(v[l]!=0)for(var _=0;_<4;_++)c.push(...this.color[h][l],1)}return c}get_highlight(e,n,t=null){var i=new Set(e.map(h=>Ue(h))),f=Array.from(i),o=[],s=[],u=0;for(const h in this.pick_meta){const v=this.faces[h],b=this.pick_meta[h];if(f.some(F=>F>=b.start&&F<b.end))for(var l=0,a=0;a<v.length;a++){if(v[a]==0){l+=1;continue}if(t!=null)var d=this.color[h][a];else var d=this.color[h][a];if(i.has(u)){if(t!=null)var c=this.color[h][a].map((F,R)=>F*(1-t[3])+t[R]*t[3]);else var c=this.color[h][a].map(R=>Math.abs(1-R*.5));s.push({voxel:[this.voxels[h]],direction:z[l],color:[this.color[h][a]],mouse_color:this.color[h][a],index:h});for(var _=0;_<4;_++)o.push(...c,1)}else for(var _=0;_<4;_++)o.push(...d,1);l+=1,u+=1}else for(var a=0;a<v.length;a++)if(v[a]!=0){for(var _=0;_<4;_++)o.push(...this.color[h][a],1);u+=1}}return n(s),o}rebuild_faces(e){const n=new Array(e.length).fill(0).map(f=>[1,1,1,1,1,1]);for(var t=0;t<e.length;t++)for(var i=0;i<this.faces.length;i++)oe(e[t],this.voxels[i])&&(n[t][4]=0,this.faces[i][5]=0),se(e[t],this.voxels[i])&&(n[t][5]=0,this.faces[i][4]=0),ae(e[t],this.voxels[i])&&(n[t][2]=0,this.faces[i][3]=0),ue(e[t],this.voxels[i])&&(n[t][3]=0,this.faces[i][2]=0),le(e[t],this.voxels[i])&&(n[t][0]=0,this.faces[i][1]=0),de(e[t],this.voxels[i])&&(n[t][1]=0,this.faces[i][0]=0);for(var t=0;t<e.length;t++)for(var i=t+1;i<e.length;i++)oe(e[t],e[i])&&(n[t][4]=0,n[i][5]=0),se(e[t],e[i])&&(n[t][5]=0,n[i][4]=0),ae(e[t],e[i])&&(n[t][2]=0,n[i][3]=0),ue(e[t],e[i])&&(n[t][3]=0,n[i][2]=0),le(e[t],e[i])&&(n[t][0]=0,n[i][1]=0),de(e[t],e[i])&&(n[t][1]=0,n[i][0]=0);this.faces.push(...n)}rebuild_remove_faces(e){for(var n=0;n<e.length;n++)for(var t=0;t<this.voxels.length;t++)oe(e[n],this.voxels[t])&&(this.faces[t][5]=1),se(e[n],this.voxels[t])&&(this.faces[t][4]=1),ae(e[n],this.voxels[t])&&(this.faces[t][3]=1),ue(e[n],this.voxels[t])&&(this.faces[t][2]=1),le(e[n],this.voxels[t])&&(this.faces[t][1]=1),de(e[n],this.voxels[t])&&(this.faces[t][0]=1)}build_faces(){const e=this.voxels,n=new Array(e.length).fill(0).map(f=>[1,1,1,1,1,1]);for(var t=0;t<e.length;t++)for(var i=t+1;i<e.length;i++)oe(e[t],e[i])&&(n[t][4]=0,n[i][5]=0),se(e[t],e[i])&&(n[t][5]=0,n[i][4]=0),ae(e[t],e[i])&&(n[t][2]=0,n[i][3]=0),ue(e[t],e[i])&&(n[t][3]=0,n[i][2]=0),le(e[t],e[i])&&(n[t][0]=0,n[i][1]=0),de(e[t],e[i])&&(n[t][1]=0,n[i][0]=0);this.faces=n}build_center(){const e=this.boundary;this.center=e[0].map((n,t)=>n+e[1][t])}build_boundary(){const e=this.voxels;for(var n=e[0],t=e[0],i=1;i<e.length;i++)n=n.map((f,o)=>Math.min(f,e[i][o])),t=t.map((f,o)=>Math.max(f,e[i][o]));this.boundary=[n,t]}}class dn{constructor(e,n,t){this.gl=e,this.program=n,this.canvas=t,this.attribute_matrix_4_mat_float=K((i,f)=>{var o=e.getUniformLocation(this.program,i);e.uniformMatrix4fv(o,!1,f)}),this.uniform_float=K((i,f)=>{var o=e.getUniformLocation(this.program,i);e.uniform1f(o,f)}),this.uniform_4_float=K((i,f)=>{var o=e.getUniformLocation(this.program,i);e.uniform4f(o,f[0],f[1],f[2],f[3])}),this.uniform_3_float=K((i,f)=>{var o=e.getUniformLocation(this.program,i);e.uniform3f(o,f[0],f[1],f[2])}),this.attribute_matrix_3_float=K((i,f)=>{var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array(f),e.STATIC_DRAW);var s=e.getAttribLocation(this.program,i);e.vertexAttribPointer(s,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s)}),this.attribute_matrix_4_float=K((i,f)=>{var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array(f),e.STATIC_DRAW);var s=e.getAttribLocation(this.program,i);e.vertexAttribPointer(s,4,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s)})}set face(e){this.faces=e}buffer(e){const n=this.gl,t=this.canvas,i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i);var f=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,f),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,f);const o=n.createTexture();return n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,o,0),e(),n.bindFramebuffer(n.FRAMEBUFFER,null),o}getPixel(e,n){const t=this.gl,i=new Uint8Array(4);return t.readPixels(e,n,1,1,t.RGBA,t.UNSIGNED_BYTE,i),i}drawSolid(e){const n=this.gl;if(!e){if(this.faces==null)throw"No faces defined";e=this.faces}var t=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),n.STATIC_DRAW),n.getParameter(n.ALIASED_LINE_WIDTH_RANGE),n.drawElements(n.TRIANGLES,e.length,n.UNSIGNED_SHORT,0)}drawLines(e){const n=this.gl;if(!e){if(this.faces==null)throw"No faces defined";e=this.faces}var t=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),n.STATIC_DRAW),n.getParameter(n.ALIASED_LINE_WIDTH_RANGE),n.drawElements(n.LINES,e.length,n.UNSIGNED_SHORT,0)}}function K(r){return new Proxy({},{set:function(e,n,t){return r(n,t),!0}})}function cn(r,e,n){const t=r.getContext("webgl2",{antialias:!0}),i=t.createProgram(),f=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(f,n),t.compileShader(f),t.attachShader(i,f);const o=t.createShader(t.VERTEX_SHADER);return t.shaderSource(o,e),t.compileShader(o),t.attachShader(i,o),t.linkProgram(i),t.useProgram(i),[t,new dn(t,i,r)]}var Oe=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function hn(){var r=new Oe(16);return Oe!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function vn(r,e){if(r===e){var n=e[1],t=e[2],i=e[3],f=e[6],o=e[7],s=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=n,r[6]=e[9],r[7]=e[13],r[8]=t,r[9]=f,r[11]=e[14],r[12]=i,r[13]=o,r[14]=s}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function pn(r,e){var n=e[0],t=e[1],i=e[2],f=e[3],o=e[4],s=e[5],u=e[6],l=e[7],a=e[8],d=e[9],c=e[10],_=e[11],h=e[12],v=e[13],b=e[14],F=e[15],R=n*s-t*o,$=n*u-i*o,E=n*l-f*o,S=t*u-i*s,M=t*l-f*s,P=i*l-f*u,p=a*v-d*h,g=a*b-c*h,y=a*F-_*h,k=d*b-c*v,A=d*F-_*v,N=c*F-_*b,T=R*N-$*A+E*k+S*y-M*g+P*p;return T?(T=1/T,r[0]=(s*N-u*A+l*k)*T,r[1]=(i*A-t*N-f*k)*T,r[2]=(v*P-b*M+F*S)*T,r[3]=(c*M-d*P-_*S)*T,r[4]=(u*y-o*N-l*g)*T,r[5]=(n*N-i*y+f*g)*T,r[6]=(b*E-h*P-F*$)*T,r[7]=(a*P-c*E+_*$)*T,r[8]=(o*A-s*y+l*p)*T,r[9]=(t*y-n*A-f*p)*T,r[10]=(h*M-v*E+F*R)*T,r[11]=(d*E-a*M-_*R)*T,r[12]=(s*g-o*k-u*p)*T,r[13]=(n*k-t*g+i*p)*T,r[14]=(v*$-h*S-b*R)*T,r[15]=(a*S-d*$+c*R)*T,r):null}function _n(r,e,n,t){function i(m,C,D,O){var J=Math.tan(m*.5*Math.PI/180);return[.5/J,0,0,0,0,.5*C/J,0,0,0,0,-(O+D)/(O-D),-1,0,0,-2*O*D/(O-D),0]}var f=i(40,r.width/r.height,1,1e3),o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const u=hn();pn(u,s),vn(u,u),n.viewport(0,0,r.width,r.height),e.attribute_matrix_4_mat_float.uNormalMatrix=u,s[14]=s[14]-6;var l=0,a=!1,d,c,_=0,h=0,v=null,b=!1;document.addEventListener("keydown",function(m){m.key=="Control"&&(b=!0)}),document.addEventListener("keyup",function(m){m.key=="Control"&&(b=!1)});var F=function(m){if(!!b)return m.button==2?v="pan":v="rotate",a=!0,d=m.pageX,c=m.pageY,m.preventDefault(),!1},R=function(m){a=!1};const $={x:0,y:0};var E=function(m){const C=r.__element.getBoundingClientRect();if($.x=(m.clientX-C.left)*n.canvas.width/n.canvas.clientWidth,$.y=n.canvas.height-(m.clientY-C.top)*n.canvas.height/n.canvas.clientHeight-1,!a)return!1;_=(m.pageX-d)*2*Math.PI/r.width,h=(m.pageY-c)*2*Math.PI/r.height,v=="rotate"?(y+=_,k+=h):v=="pan"&&S(_,h),d=m.pageX,c=m.pageY,m.preventDefault()};function S(m,C){s[12]-=m*s[14]/2,s[13]+=C*s[14]/2}r.$on("mousedown",F),r.$on("mouseup",R),r.$on("mouseout",R),r.$on("mousemove",E);var M=function(m){m.preventDefault();var C=m.wheelDelta?m.wheelDelta/40:m.detail?-m.detail:0,D=1.3;return C&&P(C<0?1*D:1/D),m.preventDefault()&&!1};function P(m){s[14]*=m}r.$on("wheel",M);function p(m,C){var D=Math.cos(C),O=Math.sin(C),J=m[1],Fe=m[5],Ae=m[9];m[1]=m[1]*D-m[2]*O,m[5]=m[5]*D-m[6]*O,m[9]=m[9]*D-m[10]*O,m[2]=m[2]*D+J*O,m[6]=m[6]*D+Fe*O,m[10]=m[10]*D+Ae*O}function g(m,C){var D=Math.cos(C),O=Math.sin(C),J=m[0],Fe=m[4],Ae=m[8];m[0]=D*m[0]+O*m[2],m[4]=D*m[4]+O*m[6],m[8]=D*m[8]+O*m[10],m[2]=D*m[2]-O*J,m[6]=D*m[6]-O*Fe,m[10]=D*m[10]-O*Ae}var y=.8,k=.8;function A(){a||(_*=l,h*=l,y+=_,k+=h),o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,k=Math.max(-Math.PI/2,Math.min(Math.PI/2,k)),g(o,y),p(o,k),e.attribute_matrix_4_mat_float.projection_matrix=f,e.attribute_matrix_4_mat_float.view_matrix=s,e.attribute_matrix_4_mat_float.model_matrix=o}function N(){s[12]=0,s[13]=0}function T(){y=.8,k=.8}function Y(m){s[14]=m}return{update:A,mouse:$,zoom:P,resetPan:N,resetRotation:T,setZoom:Y}}function bn(r){var e=0;function n(t){t*=.001;const i=t-e;e=t;const f=1/i;r(f.toFixed(1)),requestAnimationFrame(n)}n()}function Q(r,e,n){var t=[];const i=Ee({name:n});for(const f of r){const o=w("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(i.name==f.name?" button-selected":""),elements:[typeof i<"u"?i:void 0,typeof name<"u"?name:void 0,typeof f<"u"?f:void 0,typeof name<"u"?name:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>f.name,elements:[typeof f<"u"?f:void 0,typeof name<"u"?name:void 0]});o.$on("click",()=>{i.name=f.name,e(f.name)}),t.push(o)}return t}function q(r,e){const n=Ee({value:!0});var t=w("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(n.value?" button-selected":""),elements:[typeof n<"u"?n:void 0,typeof value<"u"?value:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]});return t.$on("click",()=>{n.value=!n.value,e(n.value)}),t}function B(r,e){var n=w("button",{class:"button"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]});return n.$on("click",()=>{e()}),n}function Ze({callback:r,start:e,color:n}){r||(r=l=>{});const t=Ee({absolute_value:0,relative_value:0});var i=fe(),f=w("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--accent-color:${n()};`,elements:[typeof n<"u"?n:void 0]}},w("div",{class:"trackbar-background"}),w("div",{class:"trackbar-foreground"}),w("div",{class:"trackbar-thumb",ref:i,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${t.absolute_value}px`,elements:[typeof t<"u"?t:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));f.$onUpdate(()=>{var l=f.__element.getBoundingClientRect();t.relative_value=e(),t.absolute_value=l.width*e()/255});var o=!1,s;function u(l){var a=l-s,d=f.__element.getBoundingClientRect();a<0&&(a=0),a>d.width&&(a=d.width),t.absolute_value=a,t.relative_value=t.absolute_value/d.width*255,r(t.relative_value)}return document.addEventListener("mousemove",l=>{o&&u(l.clientX)}),i.$on("mousedown",l=>{l.stopPropagation(),o=!0,s=l.clientX-t.absolute_value}),f.$on("mousedown",l=>{var a=f.__element.getBoundingClientRect();s=a.left,u(l.clientX),o=!0}),document.addEventListener("mouseup",l=>{o=!1}),f}function Le({callback:r,start:e,colorFrom:n,colorTo:t}){r||(r=a=>{});const i=Ee({absolute_value:0,relative_value:0});var f=fe(),o=w("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--color-from:${n()};--color-to:${t()};`,elements:[typeof n<"u"?n:void 0,typeof t<"u"?t:void 0]}},w("div",{class:"trackbar-data"}),w("div",{class:"trackbar-thumb",ref:f,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${i.absolute_value}px`,elements:[typeof i<"u"?i:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));o.$onUpdate(()=>{var a=o.__element.getBoundingClientRect();i.relative_value=e(),i.absolute_value=a.width*e()/255});var s=!1,u;function l(a){var d=a-u,c=o.__element.getBoundingClientRect();d<0&&(d=0),d>c.width&&(d=c.width),i.absolute_value=d,i.relative_value=i.absolute_value/c.width*255,r(i.relative_value)}return document.addEventListener("mousemove",a=>{s&&l(a.clientX)}),f.$on("mousedown",a=>{a.stopPropagation(),s=!0,u=a.clientX-i.absolute_value}),o.$on("mousedown",a=>{var d=o.__element.getBoundingClientRect();u=d.left,l(a.clientX),s=!0}),document.addEventListener("mouseup",a=>{s=!1}),o}function Je(r,e){var n=JSON.stringify(e),t=new Blob([n],{type:"application/json"}),i=URL.createObjectURL(t),f=document.createElement("a");f.download=r,f.href=i,f.textContent="Download",f.click(),f.remove()}function mn(r,e){var n=new Blob([e],{type:"plain/text"}),t=URL.createObjectURL(n),i=document.createElement("a");i.download=r,i.href=t,i.textContent="Download",i.click(),i.remove()}async function ze(r,e){var n=document.createElement("input");n.type="file",n.accept="."+r,n.onchange=t=>{var i=t.target.files[0],f=new FileReader;f.onload=function(o){var s=o.target.result;e(JSON.parse(s))},f.readAsText(i)},n.click(),n.remove()}function yn({set:r,get:e}){var n=0,t=0,i=0,f=255,o=255,s=255,u=255,l=255;const a=fe();var d=[];function c(){ze("col",p=>{a.$html("");for(var g=0;g<p.length;g++)h(p[g][0],p[g][1],p[g][2],p[g][3])})}function _(){Je("color_list.col",d)}function h(p,g,y,k){d.push([p,g,y,k]);var A=w("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${p},${g},${y},${k/255})`,elements:[typeof p<"u"?p:void 0,typeof g<"u"?g:void 0,typeof y<"u"?y:void 0,typeof k<"u"?k:void 0]}}),N=!1;A.$on("mousedown",T=>(N=!0,T.button==1&&T.preventDefault(),!1)),A.$on("contextmenu",T=>(T.preventDefault(),!1)),document.addEventListener("mouseup",T=>{setTimeout(()=>{N=!1},100)}),A.$on("mouseup",T=>{!N||(T.button==0?(n=p,t=g,i=y,f=k,b(),v&&v.$update()):T.button==2?(o=p,s=g,u=y,l=k,b("background"),v&&v.$update()):A.$remove())}),A.$parent(a)}var v=w("div",null,w("div",{style:"display:flex;flex-direction:row"},w("div",{style:"width:100%;padding:10px"},w(Le,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>n,elements:[typeof n<"u"?n:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`0,${t},${i}`,elements:[typeof t<"u"?t:void 0,typeof i<"u"?i:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`255,${t},${i}`,elements:[typeof t<"u"?t:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:p=>R(p),elements:[typeof x<"u"?x:void 0,typeof R<"u"?R:void 0,typeof x<"u"?x:void 0]}}),w(Le,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${n},0,${i}`,elements:[typeof n<"u"?n:void 0,typeof i<"u"?i:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${n},255,${i}`,elements:[typeof n<"u"?n:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:p=>$(p),elements:[typeof x<"u"?x:void 0,typeof $<"u"?$:void 0,typeof x<"u"?x:void 0]}}),w(Le,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${n},${t},0`,elements:[typeof n<"u"?n:void 0,typeof t<"u"?t:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${n},${t},255`,elements:[typeof n<"u"?n:void 0,typeof t<"u"?t:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:p=>E(p),elements:[typeof x<"u"?x:void 0,typeof E<"u"?E:void 0,typeof x<"u"?x:void 0]}}))),w("div",{class:"row"},w("div",{class:"color-area"},w("div",{class:"color-container"},w("div",{class:"background color-item"},w("div",{class:"backdrop"}),w("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${o},${s},${u},${l/255})`,elements:[typeof o<"u"?o:void 0,typeof s<"u"?s:void 0,typeof u<"u"?u:void 0,typeof l<"u"?l:void 0]}})),w("div",{class:"foreground color-item"},w("div",{class:"backdrop"}),w("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${n},${t},${i},${f/255})`,elements:[typeof n<"u"?n:void 0,typeof t<"u"?t:void 0,typeof i<"u"?i:void 0,typeof f<"u"?f:void 0]}}))),w("div",{class:"hover-icon-container",style:"margin-left:5px","on:click":P},w("i",{class:"fa-solid fa-arrows-rotate hover-icon"}))),w("div",{class:"alpha-area",style:"margin-top:-10px"},w(Ze,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>f,elements:[typeof f<"u"?f:void 0]},color:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${n},${t},${i};`,elements:[typeof n<"u"?n:void 0,typeof t<"u"?t:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:p=>S(p),elements:[typeof x<"u"?x:void 0,typeof S<"u"?S:void 0,typeof x<"u"?x:void 0]}}),w(Ze,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>l,elements:[typeof l<"u"?l:void 0]},color:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${o},${s},${u};`,elements:[typeof o<"u"?o:void 0,typeof s<"u"?s:void 0,typeof u<"u"?u:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:p=>M(p),elements:[typeof x<"u"?x:void 0,typeof M<"u"?M:void 0,typeof x<"u"?x:void 0]}}))),w("div",{class:"color-history-container"},w("div",{style:"display:inline-block",ref:a}),w("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${n},${t},${i},${f/255})`,elements:[typeof n<"u"?n:void 0,typeof t<"u"?t:void 0,typeof i<"u"?i:void 0,typeof f<"u"?f:void 0]},"on:click":()=>h(n,t,i,f)},w("i",{class:"fa fa-plus"})),w("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${o},${s},${u},${l/255})`,elements:[typeof o<"u"?o:void 0,typeof s<"u"?s:void 0,typeof u<"u"?u:void 0,typeof l<"u"?l:void 0]},"on:click":()=>h(o,s,u,l)},w("i",{class:"fa fa-plus"}))),w("button",{class:"button","on:click":()=>_()},"Save colors"),w("button",{class:"button","on:click":()=>c()},"Load colors"));function b(p="foreground"){e(p,{r:n,g:t,b:i,a:f},{r:o,g:s,b:u,a:l})}r(F());function F(){return(p,g)=>{p!=null&&(n=p.r,t=p.g,i=p.b,f=p.a),g!=null&&(o=g.r,s=g.g,u=g.b,l=g.a),v&&v.$update()}}function R(p){n=p,v&&v.$update(),b()}function $(p){t=p,v&&v.$update(),b()}function E(p){i=p,v&&v.$update(),b()}function S(p){f=p,v&&v.$update(),b()}function M(p){l=p,v&&v.$update(),b("background")}function P(){var p=o;o=n,n=p,p=s,s=t,t=p,p=u,u=i,i=p,p=l,l=f,f=p,v&&v.$update(),b()}return b(),v.$onMounted(()=>{v.$update()}),v}var De={exports:{}};De.exports=we;De.exports.default=we;function we(r,e,n){n=n||2;var t=e&&e.length,i=t?e[0]*n:r.length,f=Ke(r,0,i,n,!0),o=[];if(!f||f.next===f.prev)return o;var s,u,l,a,d,c,_;if(t&&(f=En(r,e,f,n)),r.length>80*n){s=l=r[0],u=a=r[1];for(var h=n;h<i;h+=n)d=r[h],c=r[h+1],d<s&&(s=d),c<u&&(u=c),d>l&&(l=d),c>a&&(a=c);_=Math.max(l-s,a-u),_=_!==0?32767/_:0}return te(f,o,n,s,u,_,0),o}function Ke(r,e,n,t,i){var f,o;if(i===Ie(r,e,n,t)>0)for(f=e;f<n;f+=t)o=He(f,r[f],r[f+1],o);else for(f=n-t;f>=e;f-=t)o=He(f,r[f],r[f+1],o);return o&&Re(o,o.next)&&(ie(o),o=o.next),o}function W(r,e){if(!r)return r;e||(e=r);var n=r,t;do if(t=!1,!n.steiner&&(Re(n,n.next)||I(n.prev,n,n.next)===0)){if(ie(n),n=e=n.prev,n===n.next)break;t=!0}else n=n.next;while(t||n!==e);return e}function te(r,e,n,t,i,f,o){if(!!r){!o&&f&&Tn(r,t,i,f);for(var s=r,u,l;r.prev!==r.next;){if(u=r.prev,l=r.next,f?gn(r,t,i,f):xn(r)){e.push(u.i/n|0),e.push(r.i/n|0),e.push(l.i/n|0),ie(r),r=l.next,s=l.next;continue}if(r=l,r===s){o?o===1?(r=$n(W(r),e,n),te(r,e,n,t,i,f,2)):o===2&&kn(r,e,n,t,i,f):te(W(r),e,n,t,i,f,1);break}}}}function xn(r){var e=r.prev,n=r,t=r.next;if(I(e,n,t)>=0)return!1;for(var i=e.x,f=n.x,o=t.x,s=e.y,u=n.y,l=t.y,a=i<f?i<o?i:o:f<o?f:o,d=s<u?s<l?s:l:u<l?u:l,c=i>f?i>o?i:o:f>o?f:o,_=s>u?s>l?s:l:u>l?u:l,h=t.next;h!==e;){if(h.x>=a&&h.x<=c&&h.y>=d&&h.y<=_&&j(i,s,f,u,o,l,h.x,h.y)&&I(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function gn(r,e,n,t){var i=r.prev,f=r,o=r.next;if(I(i,f,o)>=0)return!1;for(var s=i.x,u=f.x,l=o.x,a=i.y,d=f.y,c=o.y,_=s<u?s<l?s:l:u<l?u:l,h=a<d?a<c?a:c:d<c?d:c,v=s>u?s>l?s:l:u>l?u:l,b=a>d?a>c?a:c:d>c?d:c,F=Be(_,h,e,n,t),R=Be(v,b,e,n,t),$=r.prevZ,E=r.nextZ;$&&$.z>=F&&E&&E.z<=R;){if($.x>=_&&$.x<=v&&$.y>=h&&$.y<=b&&$!==i&&$!==o&&j(s,a,u,d,l,c,$.x,$.y)&&I($.prev,$,$.next)>=0||($=$.prevZ,E.x>=_&&E.x<=v&&E.y>=h&&E.y<=b&&E!==i&&E!==o&&j(s,a,u,d,l,c,E.x,E.y)&&I(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;$&&$.z>=F;){if($.x>=_&&$.x<=v&&$.y>=h&&$.y<=b&&$!==i&&$!==o&&j(s,a,u,d,l,c,$.x,$.y)&&I($.prev,$,$.next)>=0)return!1;$=$.prevZ}for(;E&&E.z<=R;){if(E.x>=_&&E.x<=v&&E.y>=h&&E.y<=b&&E!==i&&E!==o&&j(s,a,u,d,l,c,E.x,E.y)&&I(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function $n(r,e,n){var t=r;do{var i=t.prev,f=t.next.next;!Re(i,f)&&Qe(i,t,t.next,f)&&re(i,f)&&re(f,i)&&(e.push(i.i/n|0),e.push(t.i/n|0),e.push(f.i/n|0),ie(t),ie(t.next),t=r=f),t=t.next}while(t!==r);return W(t)}function kn(r,e,n,t,i,f){var o=r;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Pn(o,s)){var u=qe(o,s);o=W(o,o.next),u=W(u,u.next),te(o,e,n,t,i,f,0),te(u,e,n,t,i,f,0);return}s=s.next}o=o.next}while(o!==r)}function En(r,e,n,t){var i=[],f,o,s,u,l;for(f=0,o=e.length;f<o;f++)s=e[f]*t,u=f<o-1?e[f+1]*t:r.length,l=Ke(r,s,u,t,!1),l===l.next&&(l.steiner=!0),i.push(Sn(l));for(i.sort(wn),f=0;f<i.length;f++)n=Rn(i[f],n);return n}function wn(r,e){return r.x-e.x}function Rn(r,e){var n=Fn(r,e);if(!n)return e;var t=qe(n,r);return W(t,t.next),W(n,n.next)}function Fn(r,e){var n=e,t=r.x,i=r.y,f=-1/0,o;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var s=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=t&&s>f&&(f=s,o=n.x<n.next.x?n:n.next,s===t))return o}n=n.next}while(n!==e);if(!o)return null;var u=o,l=o.x,a=o.y,d=1/0,c;n=o;do t>=n.x&&n.x>=l&&t!==n.x&&j(i<a?t:f,i,l,a,i<a?f:t,i,n.x,n.y)&&(c=Math.abs(i-n.y)/(t-n.x),re(n,r)&&(c<d||c===d&&(n.x>o.x||n.x===o.x&&An(o,n)))&&(o=n,d=c)),n=n.next;while(n!==u);return o}function An(r,e){return I(r.prev,r,e.prev)<0&&I(e.next,r,r.next)<0}function Tn(r,e,n,t){var i=r;do i.z===0&&(i.z=Be(i.x,i.y,e,n,t)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,Ln(i)}function Ln(r){var e,n,t,i,f,o,s,u,l=1;do{for(n=r,r=null,f=null,o=0;n;){for(o++,t=n,s=0,e=0;e<l&&(s++,t=t.nextZ,!!t);e++);for(u=l;s>0||u>0&&t;)s!==0&&(u===0||!t||n.z<=t.z)?(i=n,n=n.nextZ,s--):(i=t,t=t.nextZ,u--),f?f.nextZ=i:r=i,i.prevZ=f,f=i;n=t}f.nextZ=null,l*=2}while(o>1);return r}function Be(r,e,n,t,i){return r=(r-n)*i|0,e=(e-t)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function Sn(r){var e=r,n=r;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==r);return n}function j(r,e,n,t,i,f,o,s){return(i-o)*(e-s)>=(r-o)*(f-s)&&(r-o)*(t-s)>=(n-o)*(e-s)&&(n-o)*(f-s)>=(i-o)*(t-s)}function Pn(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!Mn(r,e)&&(re(r,e)&&re(e,r)&&Bn(r,e)&&(I(r.prev,r,e.prev)||I(r,e.prev,e))||Re(r,e)&&I(r.prev,r,r.next)>0&&I(e.prev,e,e.next)>0)}function I(r,e,n){return(e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y)}function Re(r,e){return r.x===e.x&&r.y===e.y}function Qe(r,e,n,t){var i=he(I(r,e,n)),f=he(I(r,e,t)),o=he(I(n,t,r)),s=he(I(n,t,e));return!!(i!==f&&o!==s||i===0&&ce(r,n,e)||f===0&&ce(r,t,e)||o===0&&ce(n,r,t)||s===0&&ce(n,e,t))}function ce(r,e,n){return e.x<=Math.max(r.x,n.x)&&e.x>=Math.min(r.x,n.x)&&e.y<=Math.max(r.y,n.y)&&e.y>=Math.min(r.y,n.y)}function he(r){return r>0?1:r<0?-1:0}function Mn(r,e){var n=r;do{if(n.i!==r.i&&n.next.i!==r.i&&n.i!==e.i&&n.next.i!==e.i&&Qe(n,n.next,r,e))return!0;n=n.next}while(n!==r);return!1}function re(r,e){return I(r.prev,r,r.next)<0?I(r,e,r.next)>=0&&I(r,r.prev,e)>=0:I(r,e,r.prev)<0||I(r,r.next,e)<0}function Bn(r,e){var n=r,t=!1,i=(r.x+e.x)/2,f=(r.y+e.y)/2;do n.y>f!=n.next.y>f&&n.next.y!==n.y&&i<(n.next.x-n.x)*(f-n.y)/(n.next.y-n.y)+n.x&&(t=!t),n=n.next;while(n!==r);return t}function qe(r,e){var n=new Ne(r.i,r.x,r.y),t=new Ne(e.i,e.x,e.y),i=r.next,f=e.prev;return r.next=e,e.prev=r,n.next=i,i.prev=n,t.next=n,n.prev=t,f.next=t,t.prev=f,t}function He(r,e,n,t){var i=new Ne(r,e,n);return t?(i.next=t.next,i.prev=t,t.next.prev=i,t.next=i):(i.prev=i,i.next=i),i}function ie(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Ne(r,e,n){this.i=r,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}we.deviation=function(r,e,n,t){var i=e&&e.length,f=i?e[0]*n:r.length,o=Math.abs(Ie(r,0,f,n));if(i)for(var s=0,u=e.length;s<u;s++){var l=e[s]*n,a=s<u-1?e[s+1]*n:r.length;o-=Math.abs(Ie(r,l,a,n))}var d=0;for(s=0;s<t.length;s+=3){var c=t[s]*n,_=t[s+1]*n,h=t[s+2]*n;d+=Math.abs((r[c]-r[h])*(r[_+1]-r[c+1])-(r[c]-r[_])*(r[h+1]-r[c+1]))}return o===0&&d===0?0:Math.abs((d-o)/o)};function Ie(r,e,n,t){for(var i=0,f=e,o=n-t;f<n;f+=t)i+=(r[o]-r[f])*(r[f+1]+r[o+1]),o=f;return i}we.flatten=function(r){for(var e=r[0][0].length,n={vertices:[],holes:[],dimensions:e},t=0,i=0;i<r.length;i++){for(var f=0;f<r[i].length;f++)for(var o=0;o<e;o++)n.vertices.push(r[i][f][o]);i>0&&(t+=r[i-1].length,n.holes.push(t))}return n};function Nn(r){const[e]=Xe(r),n=Cn(r,e),[t]=Xe(n),i=Dn(n,t,e),f=Un(i,n,e),[o,s]=On(f,n);return Zn(f,n,o,s)}function In(r,e){for(var n={},t=[],i=1,f=0;f<e.length;f++){var o=e[f].join(",");n[o]==null&&(n[o]=i,t.push(e[f]),i++)}for(var s of r)for(var u in s)s[u]=n[e[s[u]].join(",")];return[t,r]}function Ce(r){return r.join(",")}function Xe(r){for(var e={},n=0;n<r.length;n++){var t=Ce(r[n]);e[t]=n}function i(...f){var o=Ce(f);return e[o]}return[i]}function Cn(r,e){for(var n=Array(r.length).fill(0).map(()=>Array(4).fill(1)),t=r[0][0],i=r[0][1],f=0;f<r.length;f++){r[f][0]<t&&(t=r[f][0]),r[f][1]<i&&(i=r[f][1]);var o=e(r[f][0]+1,r[f][1]),s=e(r[f][0],r[f][1]+1),u=e(r[f][0]-1,r[f][1]),l=e(r[f][0],r[f][1]-1);o!=null&&(n[f][1]=0,n[f][2]=0,n[o][0]=0,n[o][3]=0),s!=null&&(n[s][0]=0,n[s][1]=0,n[f][2]=0,n[f][3]=0),u!=null&&(n[u][1]=0,n[u][2]=0,n[f][0]=0,n[f][3]=0),l!=null&&(n[f][0]=0,n[f][1]=0,n[l][2]=0,n[l][3]=0)}var a={};for(var d in r)for(var c=r[d][0],_=r[d][1],f=0;f<4;f++){var h=c,v=_;f==1&&(h+=1),f==2&&(h+=1,v+=1),f==3&&(v+=1);var b=h+","+v;a[b]==null?a[b]={number:1,index:d,face_index:f}:a[b].number+=1}for(const[E,S]of Object.entries(a))S.number==3&&(n[S.index][S.face_index]=1);var F=[];for(var d in n){var c=r[d][0],_=r[d][1];for(var R in n[d])n[d][R]==1&&(R==0&&F.push([c,_]),R==1&&F.push([c+1,_]),R==2&&F.push([c+1,_+1]),R==3&&F.push([c,_+1]))}function $(E){for(var S=new Set,M=0;M<E.length;M++){var P=E[M].join(",");S.add(P)}return Array.from(S)}return $(F).map(E=>E.split(",").map(S=>parseInt(S)))}function Dn(r,e,n){var t=r[0][0],i=r[0][1],f=r[0][0],o=r[0][1];for(var s in r)r[s][0]<t&&(t=r[s][0]),r[s][1]<i&&(i=r[s][1]),r[s][0]>f&&(f=r[s][0]),r[s][1]>o&&(o=r[s][1]);function u(c,_,h){var v=c,b=void 0;if(_=="x")if(h=="forward")do{v=[v[0]+1,v[1]];var b=e(v)}while(b==null&&v[0]<f);else do{v=[v[0]-1,v[1]];var b=e(v)}while(b==null&&v[0]>t);else if(h=="forward")do{v=[v[0],v[1]+1];var b=e(v)}while(b==null&&v[1]<o);else do{v=[v[0],v[1]-1];var b=e(v)}while(b==null&&v[1]>i);return b}var l=new Set;function a(c,_,h){var v=c,b=u(r[c],h,_);if(b!=null){if(v>b)var F=[b,v];else var F=[v,b];var R=r[F[0]],$=r[F[1]];d(R,$,h)&&l.add(Ce(F))}}function d(c,_,h){if(h=="x"){var v=c[1],b,F;if(c[0]>_[0]?(b=_[0],F=c[0]):(b=c[0],F=_[0]),n([b,v-1])==null){for(var R=b;R<F;R++)if(n([R,v-1])!=null||n([R,v])==null)return!1}else for(var R=b;R<F;R++)if(n([R,v-1])==null||n([R,v])!=null)return!1}else{var R=c[0],$,E;if(c[1]>_[1]?($=_[1],E=c[1]):($=c[1],E=_[1]),n([R-1,$])==null){for(var v=$;v<E;v++)if(n([R-1,v])!=null||n([R,v])==null)return!1}else for(var v=$;v<E;v++)if(n([R-1,v])==null||n([R,v])!=null)return!1}return!0}for(var s in r)a(s,"forward","x"),a(s,"forward","y"),a(s,"backward","x"),a(s,"backward","y");return Array.from(l).map(c=>c.split(",").map(_=>parseInt(_)))}function Un(r,e,n){for(var t=new Array(e.length).fill(0).map(g=>[]),i=0;i<r.length;i++)t[r[i][0]].push(r[i][1]),t[r[i][1]].push(r[i][0]);function f(g,y){if(g[0]>y[0])var k=y,A=g;else var k=g,A=y;if(k[0]==A[0]||k[1]==A[1])return!1;if(A[1]>k[1])var N=k[0],T=A[0]-1,Y=k[1],m=A[1]-1;else var N=k[0],T=A[0]-1,Y=A[1],m=k[1]-1;for(var g=N;g<=T;g++){for(var C=!0,y=Y;y<=m;y++)if(n([g,y])==null){C=!1;break}if(C)return!0}for(var y=Y;y<=m;y++){for(var C=!0,g=N;g<=T;g++)if(n([g,y])==null){C=!1;break}if(C)return!0}return!1}var o=new Array(t.length).fill(0).map(g=>[]);for(var s in t){var u=t[s];if(u.length<=2){o[s]=[u];continue}for(var l=[],i=0;i<u.length;i++)for(var a=u[i],d=e[a],c=i+1;c<u.length;c++){var _=u[c];if(!(a==null||_==null)){var h=e[_];if(f(d,h)){var v=[a,_];l.push(v)}}}o[s]=l}function b(g,y){return o[g].findIndex(k=>k.includes(y))}var F=[],R=new Set,$=new Set;for(var s in o)for(var E in o[s]){let y=function(k){for(const T in o[k])if(!!P.has(`${k},${T}`)&&!$.has(`${k},${T}`)&&!M.has(`${k},${T}`)){P=new Set,M.add(`${k},${T}`),$.add(`${k},${T}`);var A=o[k][T];P.add(`${A[0]},${b(A[0],k)}`),P.add(`${A[1]},${b(A[1],k)}`),S.push(k);for(var N of A)y(N)}};var p=y;s=Number(s);var S=[],M=new Set;R.add(s),M.add(s);var P=new Set;P.add(`${s},${E}`),y(s),S.length!=0&&F.push(S)}return F}function On(r,e){function n(c,_){for(var h=!1,v=_[0],b=_[1],F=c.map(function(g){return g[0]}),R=0,$=F.length-1;R<F.length;$=R++){var E=F[R],S=c[R][1],M=F[$],P=c[$][1],p=S>b!=P>b&&v<(M-E)*(b-S)/(P-S)+E;if(p&&(h=!h),S===b&&E===v||P===b&&M===v){h=!0;break}}return h}for(var t=Array.from(r).fill(0).map(c=>[]),i=0;i<r.length;i++)for(var f=r[i].map(c=>e[c]),o=0;o<r.length;o++)i!=o&&r[o].every(c=>n(f,e[c]))&&t[i].push(o);for(var s=new Array(r.length).fill(!1),u=new Array(r.length).fill(0).map(c=>[]),i=0;i<t.length;i++)for(var o=0;o<t[i].length;o++)u[t[i][o]].push(i);for(var i=0;i<u.length;i++)for(var o=0;o<u[i].length;o++)t[u[i][o]]=t[u[i][o]].filter(h=>!t[i].includes(h));var l=new Array(r.length).fill(0).map((c,_)=>_);l.sort((c,_)=>t[c].includes(_)?-1:1);var a=new Set;for(const c of l)a.has(c)||d(c);function d(c,_=0){if(!a.has(c)){a.add(c);for(const h of t[c])d(h,_+1);_%2==1&&(t[c]=[],s[c]=!0)}}return[t,s]}function Zn(r,e,n,t){var i=[];for(var f in r)if(!t[f]){var o=0,s=[];for(var u of r[f])s.push(...e[u]),o+=1;var l=[];for(var u of n[f]){var a=[];l.push(o);for(var d of r[u])a.push(...e[d]),o+=1;s.push(...a)}var c=De.exports(s,l);i.push({positions:s,indices:c})}return i}const ve=[2,2,1,1,0,0],Hn=[1,0,1,0,1,0];function Xn(r){for(var e=r.voxels,n=r.faces,t={},i=0;i<n.length;i++)for(var f=0,o=0;o<n[i].length;o++){if(n[i][o]==0){f+=1;continue}var s=`${e[i][ve[f]]},${f}`;t[s]==null&&(t[s]={direction:f,relevant:ve[f],position:e[i][ve[f]]+Hn[f],data:[]}),t[s].data.push(e[i].filter((R,$)=>$!=ve[f])),f+=1}console.log(t);for(var i in t)t[i].data=Nn(t[i].data);var u=[],l=[],a=0;for(var i in t){var d=t[i];for(var c of d.data){for(var o=0;o<c.positions.length;o+=2){var _=[c.positions[o],c.positions[o+1]];_.splice(d.relevant,0,d.position),u.push(_)}for(var o=0;o<c.indices.length;o+=3){var h=[c.indices[o]+a,c.indices[o+1]+a,c.indices[o+2]+a];if(d.direction==1){var v=h[0];h[0]=h[1],h[1]=v}if(d.direction==2){var v=h[0];h[0]=h[2],h[2]=v}if(d.direction==5){var v=h[1];h[1]=h[2],h[2]=v}l.push(h)}a+=c.positions.length/2}}var[b,F]=In(l,u);return{vert:b,index:F}}var ee=null,pe=null,_e=null,be=null,me=null,ye=null,xe=null,ge=null,Z=U;const Se=[{name:"Pen"},{name:"Plane"},{name:"Horizontal line"},{name:"Vertical line"}],Pe=[{name:"Sculpt"},{name:"Paint"}];var G="Pen",V="Sculpt",ne=!0,$e=!0,U=[1,0,0],X=[1,1,1];function Me(r,e,n){U=[e.r/255,e.g/255,e.b/255,e.a/255],X=[n.r/255,n.g/255,n.b/255,n.a/255],r=="foreground"?Z=U:Z=X}var ke=null;function Ye(r,e){var n=null;r!=null&&(n={r:r[0]*255,g:r[1]*255,b:r[2]*255,a:255});var t=null;e!=null&&(t={r:e[0]*255,g:e[1]*255,b:e[2]*255,a:255}),ke(n,t)}const H=fe(),je=fe(),Yn=w("div",{class:"main"},w("div",{class:"info"},w("p",null,w("h3",null,"Mode"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>Q(Pe,r=>{V=r,Z=U},"Sculpt"),elements:[typeof Q<"u"?Q:void 0,typeof Pe<"u"?Pe:void 0,typeof x<"u"?x:void 0,typeof V<"u"?V:void 0,typeof x<"u"?x:void 0,typeof Z<"u"?Z:void 0,typeof U<"u"?U:void 0]}),w("p",null,w("h3",null,"Color"),w(yn,{get:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:(r,e,n)=>Me(r,e,n),elements:[typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0,typeof Me<"u"?Me:void 0,typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0]},set:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:r=>ke=r,elements:[typeof fn<"u"?fn:void 0,typeof ke<"u"?ke:void 0,typeof fn<"u"?fn:void 0]}}))),w("canvas",{ref:H}),w("div",{class:"info"},w("p",null,"FPS: ",w("span",{ref:je})),w("p",null,w("h3",null,"Tool"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>Q(Se,r=>G=r,"Pen"),elements:[typeof Q<"u"?Q:void 0,typeof Se<"u"?Se:void 0,typeof x<"u"?x:void 0,typeof G<"u"?G:void 0,typeof x<"u"?x:void 0]}),w("p",null,w("h3",null,"Tool options"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>q("Contiguous",r=>ne=r),elements:[typeof q<"u"?q:void 0,typeof x<"u"?x:void 0,typeof ne<"u"?ne:void 0,typeof x<"u"?x:void 0]}),w("p",null,w("h3",null,"View"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>q("Wireframe",r=>$e=r),elements:[typeof q<"u"?q:void 0,typeof x<"u"?x:void 0,typeof $e<"u"?$e:void 0,typeof x<"u"?x:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>B("Reset pan",()=>me()),elements:[typeof B<"u"?B:void 0,typeof me<"u"?me:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>B("Reset rotation",()=>ye()),elements:[typeof B<"u"?B:void 0,typeof ye<"u"?ye:void 0]}),w("p",null,w("h3",null,"Actions"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>B("Subdivide",()=>ee()),elements:[typeof B<"u"?B:void 0,typeof ee<"u"?ee:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>B("Undo",()=>xe()),elements:[typeof B<"u"?B:void 0,typeof xe<"u"?xe:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>B("Redo",()=>ge()),elements:[typeof B<"u"?B:void 0,typeof ge<"u"?ge:void 0]}),w("p",null,w("h3",null,"Persistence"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>B("Save project",()=>pe()),elements:[typeof B<"u"?B:void 0,typeof pe<"u"?pe:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>B("Load project",()=>_e()),elements:[typeof B<"u"?B:void 0,typeof _e<"u"?_e:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>B("Export obj",()=>be()),elements:[typeof B<"u"?B:void 0,typeof be<"u"?be:void 0]})));H.width=800;H.height=800;Yn.$parent(document.body);var L=new ln;L.init();be=()=>{const{vert:r,index:e}=Xn(L);for(var n="",t=0;t<r.length;t++)n+=`v ${r[t][0]} ${r[t][1]} ${r[t][2]}
`;n+=`
`;for(var t=0;t<e.length;t++)n+=`f ${e[t][0]} ${e[t][1]} ${e[t][2]}
`;mn("voxel.obj",n)};function Ge(r){const e=H.__element.getBoundingClientRect();var n=(r.clientX-e.left)*H.width/H.clientWidth,t=H.height-(r.clientY-e.top)*H.height/H.clientHeight-1;return[n,t]}function Gn(r,e,n,t,i){var f,o,s,u;r==n?f=1:f=1/Math.abs(n-r),e==t?o=1:o=1/Math.abs(t-e);for(var l=Math.min(f,o)*i,a=0,d=[],c=s,_=u;a<=1;)c=r*(1-a)+n*a,_=e*(1-a)+t*a,d.push([c,_]),a+=l;return d}async function Vn(){var r=await fetch("./shader.vert").then(p=>p.text()),e=await fetch("./shader.frag").then(p=>p.text()),[n,t]=cn(H.__element,r,e);t.antialias=!1,t.uniform_4_float.color_overlay=[0,0,0,1],pe=()=>{Je("voxel_model.vox",{voxels:L.voxels,color:L.color})},_e=async()=>{ze("vox",({voxels:p,color:g})=>{L.voxels=p,L.color=g,L.init();var[y,T]=L.boundary,k=y[0]-T[0],A=y[1]-T[1],N=y[2]-T[2],T=Math.abs(Math.max(k,A,N));M(-6),E(),S(),$(Math.max(T,1)),t.attribute_matrix_3_float.normal=L.geometry_normals,t.attribute_matrix_3_float.position=L.geometry_vertexes})};var i=null,f=[],o=0,s=0,u=!1,l=!1,a=-1,d=[];c();function c(p=!1){d.length>30&&(d=d.slice(1),a--),d=d.slice(0,a+1),d.push(JSON.parse(JSON.stringify([L.voxels,L.color,L.faces,p]))),a=d.length-1}xe=_,ge=h;function _(){if(a>0){const p=d[a][3];a--;const[g,y,k]=JSON.parse(JSON.stringify(d[a]));p&&$(.5),L.voxels=g,L.color=y,L.faces=k,L.init(),L.build(),t.attribute_matrix_3_float.normal=L.geometry_normals,t.attribute_matrix_3_float.position=L.geometry_vertexes}}function h(){if(a+1<d.length){a++;const[p,g,y,k]=d[a];k&&$(2),L.voxels=p,L.color=g,L.faces=y,L.build(),t.attribute_matrix_3_float.normal=L.geometry_normals,t.attribute_matrix_3_float.position=L.geometry_vertexes}}document.addEventListener("keydown",function(p){p.key=="Control"&&(l=!0),p.key=="z"&&p.ctrlKey&&_(),p.key=="y"&&p.ctrlKey&&h(),p.key=="x"&&p.ctrlKey&&ee()}),document.addEventListener("keyup",function(p){p.key=="Control"&&(l=!1)});var v=!1;H.$on("mousedown",p=>{if(v=l,!l){if(p.offsetX,p.offsetY,p.button==1)p.preventDefault();else if(p.button==0||p.button==2&&G=="Pen"){const[g,y]=Ge(p);o=g,s=y,u=!0,f=[[g,y]]}p.button==0?Z=U:p.button==2&&(Z=X)}}),H.$on("mousemove",p=>{if(!u)return;const[g,y]=Ge(p);f.push(...Gn(g,y,o,s,5)),o=g,s=y}),H.$on("contextmenu",p=>(p.preventDefault(),!1));var b=[];H.$on("mouseup",p=>{if(!(l||v)&&(b=[],f=[],u=!1,!!i)){if(G=="Pen")if(V=="Sculpt"){if(p.button==0){var g=[];for(var y of i)g.push(...y.voxel.map(N=>N.map((T,Y)=>T+y.direction[Y])));g=[...new Set(g.map(JSON.stringify))].map(JSON.parse),L.add(...g),t.attribute_matrix_3_float.normal=L.geometry_normals,t.attribute_matrix_3_float.position=L.geometry_vertexes}else if(p.button==2){var g=[];for(var y of i)g.push(...y.voxel);L.remove(...g),t.attribute_matrix_3_float.normal=L.geometry_normals,t.attribute_matrix_3_float.position=L.geometry_vertexes}}else{if(p.button==0){Z=U;for(var y of i)for(var k=0;k<y.color.length;k++)for(var A=0;A<3;A++)y.color[k][A]=y.color[k][A]*(1-U[3])+U[A]*U[3]}else if(p.button==2){Z=X;for(var y of i)for(var k=0;k<y.color.length;k++)for(var A=0;A<3;A++)y.color[k][A]=y.color[k][A]*(1-X[3])+X[A]*X[3]}p.button==1&&(U=[...i[0].mouse_color,1],Z=U,Ye(U))}else if(V=="Sculpt")p.button==0?(L.add(...i.voxel.map(N=>N.map((T,Y)=>T+i.direction[Y]))),t.attribute_matrix_3_float.normal=L.geometry_normals,t.attribute_matrix_3_float.position=L.geometry_vertexes):p.button==2&&(L.remove(...i.voxel),t.attribute_matrix_3_float.normal=L.geometry_normals,t.attribute_matrix_3_float.position=L.geometry_vertexes);else{if(p.button==0){Z=U;for(var k=0;k<i.color.length;k++)for(var A=0;A<3;A++)i.color[k][A]=i.color[k][A]*(1-U[3])+U[A]*U[3]}else if(p.button==2){Z=X;for(var k=0;k<i.color.length;k++)for(var A=0;A<3;A++)i.color[k][A]=i.color[k][A]*(1-X[3])+X[A]*X[3]}p.button==1&&(U=[...i.mouse_color,1],Z=U,Ye(U))}c()}});const{update:F,mouse:R,zoom:$,resetPan:E,resetRotation:S,setZoom:M}=_n(H,t,n);me=E,ye=S,ee=()=>{L.subdivide(),t.attribute_matrix_3_float.normal=L.geometry_normals,t.attribute_matrix_3_float.position=L.geometry_vertexes,$(2),c(!0)};function P(){n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL),n.enable(n.CULL_FACE),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT)}bn(p=>{je.$html({key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>p,elements:[typeof p<"u"?p:void 0]}),F(),t.attribute_matrix_3_float.normal=L.geometry_normals,t.attribute_matrix_3_float.position=L.geometry_vertexes;var g=null;t.buffer(()=>{n.clearColor(0,0,0,0),t.uniform_float.disable_lighting=1,P(),t.attribute_matrix_4_float.color=L.pick_map,t.drawSolid(L.geometry_indexes),G=="Pen"?u?(b.push(...f.map(y=>t.getPixel(y[0],y[1]))),f=[]):b=[t.getPixel(R.x,R.y)]:g=t.getPixel(R.x,R.y)}),t.uniform_float.disable_lighting=0,n.clearColor(.5,.5,.5,.9),n.enable(n.POLYGON_OFFSET_FILL),n.polygonOffset(1,1),P(),i=null,G=="Pen"?V=="Sculpt"?t.attribute_matrix_4_float.color=L.get_highlight(b,y=>i=y):t.attribute_matrix_4_float.color=L.get_highlight(b,y=>i=y,Z):V=="Sculpt"?t.attribute_matrix_4_float.color=L.highlight_plane(g,y=>i=y,G,ne):t.attribute_matrix_4_float.color=L.highlight_plane(g,y=>i=y,G,ne,Z),t.drawSolid(L.geometry_indexes),n.disable(n.POLYGON_OFFSET_FILL),$e&&(t.uniform_float.enable_color_overlay=1,t.drawLines(L.geometry_edge_index),t.uniform_float.enable_color_overlay=0)})}Vn();
