(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const f of o.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();function fe(t){const n=new Set;function e(f){n.add(f)}function r(f){n.delete(f)}const i={get(f,a){return a==="__subscribe"?e:a==="__unsubscribe"?r:typeof f[a]=="object"&&f[a]!==null&&!(f[a]instanceof HTMLElement)?new Proxy(f[a],i):f[a]},set(f,a,s){f[a]=s;for(const u of n)u.__update();return!0}};return new Proxy(t,i)}function Ve(t){return Ke(new on(t))}function Ke(t){function n(r,i){return typeof r[i]!="object"||r[i]!==null?r[i]:new Proxy(r[i],{set:(f,a,s)=>(e.__handleEffect(e.__isReactive(s),()=>{f[a]=e.__handleFunction(s)}),!0),get:(f,a)=>n(f,a)})}const e=new Proxy(t,{get:(r,i)=>{if(i in r)return r[i];if(i in r.__element)return n(r.__element,i)},set:(r,i,o)=>(i in r?r[i]=o:i=="style"?r.$set_style(o):i in r.__element&&r.$property(i,o),!0)});return e}class on{constructor(n){if(typeof n=="string")this.__element=document.createElement(n);else if(n instanceof HTMLElement)this.__element=n;else throw new Error("Invalid element name");this.__events=[],this.__children=[],this.__states=new Set,this.__unmounted_events=[],this.__mounted_events=[],this.__parent=null}__update(){for(const n of this.__events)n()}$click(){return this.__element.click(),this}$find(n){var e=[];this.__element.matches(n)&&e.push(Ke(this));for(const r of this.__children)e=e.concat(r.$find(n));return e}$update(){for(const n of this.__events)n();for(const n of this.__children)n.$update()}__parseInput(n){if(n&&n.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"){for(const e of n.elements)e&&e.__subscribe&&(this.__states.add(e),e.__subscribe(this));return n.expression}return n}__observeParent(){setTimeout(()=>{for(const e of this.__mounted_events)e()},0),new MutationObserver(e=>{for(const r of e){if(r.type==="childList"&&r.removedNodes.length){for(const i of r.removedNodes)if(i===this.__element){this.__unsubscribe();for(const o of this.__unmounted_events)o()}}if(r.type==="childList"&&r.addedNodes.length){for(const i of r.addedNodes)if(i===this.__element){this.__subscribe();for(const o of this.__mounted_events)o()}}}}).observe(this.__element.parentElement,{childList:!0})}__subscribe(){if(this.__states)for(const n of this.__states)n.__subscribe(this)}__unsubscribe(){for(const n of this.__children)n.__unsubscribe();if(this.__states)for(const n of this.__states)n.__unsubscribe(this)}__handleFunction(n){return typeof n=="function"?n():n}__handleEffect(n,e){n?(e(),this.__events.push(e)):e()}__isReactive(...n){for(const e of n)if(typeof e=="function")return!0;return!1}$if(n){return n=this.__parseInput(n),this.__handleEffect(this.__isReactive(n),()=>{const e=this.__handleFunction(n);this.$style("display",e?"":"none")}),this}$class(n,e=!0){n=this.__parseInput(n),e=this.__parseInput(e);var r=null;return this.__handleEffect(this.__isReactive(n,e),()=>{const i=this.__handleFunction(n);if(i)if(typeof i=="object")for(const o in i)i[o]?this.__element.classList.add(o):this.__element.classList.remove(o);else this.__handleFunction(e)?(this.__isReactive(n)&&(r&&this.__element.classList.remove(...r.split(" ").filter(o=>o.length>0)),r=i),this.__element.classList.add(...i.split(" ").filter(o=>o.length>0))):(this.__element.classList.remove(...i.split(" ").filter(o=>o.length>0)),r=null)}),this}get parentElement(){return this.__parent}$parent(n){return this.__parent=n,n.__element!==void 0?(n.__element.appendChild(this.__element),n.__children.push(this)):n.appendChild(this.__element),this.__observeParent(),this}$parentBefore(n){return this.__parent=n,n.__element!==void 0?n.__element.firstChild?n.__element.insertBefore(this.__element,n.__element.firstChild):n.__element.appendChild(this.__element):n.firstChild?n.insertBefore(this.__element,n.firstChild):n.appendChild(this.__element),this.__observeParent(),this}$on(n,e){return this.__element.addEventListener(n,e),this}__clean_input(n){return n&&n.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?n.expression:n}$onUpdate(n){return this.__events.push(n),this}$onMounted(n){this.__mounted_events.push(n)}$onUnmounted(n){this.__unmounted_events.push(n)}$property(n,e){return n=this.__parseInput(n),e=this.__parseInput(e),this.__handleEffect(this.__isReactive(n,e),()=>{this.__element[this.__handleFunction(n)]=this.__handleFunction(e)}),this}$style(n,e=null){return e?(this.__style(n,e),this):(n=this.__parseInput(n),this.__handleEffect(this.__isReactive(n),()=>{var r=this.__handleFunction(n);if(typeof r=="object")for(const i in r)this.__element.style[i]=r[i];else{const i=r.split(";").filter(o=>o.length>0);this.__element.style={};for(const o of i){const[f,a]=o.split(":");this.__element.style.setProperty(f,this.__handleFunction(a))}}}),this)}__style(n,e){return n=this.__parseInput(n),e=this.__parseInput(e),this.__handleEffect(this.__isReactive(n,e),()=>{this.__element.style[this.__handleFunction(n)]=this.__handleFunction(e)}),this}$get_computed_style(n){return window.getComputedStyle(this.__element).getPropertyValue(n)}$html(n){return n=this.__parseInput(n),this.__handleEffect(this.__isReactive(n),()=>{this.__element.innerHTML=this.__handleFunction(n)}),this}$child(n){n=this.__parseInput(n);var e;this.__isReactive(n)?e=Ve("span").$parent(this):e=this;var r=null;return this.__handleEffect(this.__isReactive(n),()=>{var i=this.__handleFunction(n);r&&r();const o=a=>a==null?()=>{}:a.__element!==void 0?(a.$parent(e),()=>a.$remove()):(a instanceof HTMLElement||(a=document.createTextNode(a)),e.__element.appendChild(a),()=>a.remove());if(Array.isArray(i)){var f=[];for(const a of i)f.push(o(a));r=()=>{for(const a of f)a()}}else r=o(i)}),this}$remove(){return this.__parent=null,this.__element.remove(),this}$model([n,e]){return this.$property("value",n),this.$on("input",r=>e(r.target.value)),this}}function an(t){return t&&t.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?t.expression:t}const y=(t,n,...e)=>{var r,i=!1;if(typeof t=="function"){var o={};if(n)for(const[s,u]of Object.entries(n))o[s]=an(u);if(r=t(o,...e),r===void 0)return e;i=!0}else r=Ve(t);const f={ref:s=>{s.__ref_object=r},style:s=>{r.$style(s)},class:s=>{r.$class(s)},parent:s=>{r.$parent(s)},if:s=>{r.$if(s)},model:([s,u])=>{r.$model([s,u])}},a={on:(s,u)=>{r.$on(s,u)}};if(n)for(const[s,u]of Object.entries(n)){const l=s.split(":");l.length==2?a[l[0]]&&a[l[0]](l[1],u):f[s]?f[s](u):i||r.$property(s,u)}if(e&&!i)for(const s of e)r.$child(s);return r};function V(t=null){var n=t;return new Proxy({},{get:(r,i)=>{if(n!=null)return n[i]},set:(r,i,o)=>(i==="__ref_object"&&(n=o),o!=null&&(n[i]=o),!0)})}var Ze={exports:{}};Ze.exports=Le;Ze.exports.default=Le;function Le(t,n,e){e=e||2;var r=n&&n.length,i=r?n[0]*e:t.length,o=je(t,0,i,e,!0),f=[];if(!o||o.next===o.prev)return f;var a,s,u,l,d,c,h;if(r&&(o=cn(t,n,o,e)),t.length>80*e){a=u=t[0],s=l=t[1];for(var v=e;v<i;v+=e)d=t[v],c=t[v+1],d<a&&(a=d),c<s&&(s=c),d>u&&(u=d),c>l&&(l=c);h=Math.max(u-a,l-s),h=h!==0?32767/h:0}return de(o,f,e,a,s,h,0),f}function je(t,n,e,r,i){var o,f;if(i===Oe(t,n,e,r)>0)for(o=n;o<e;o+=r)f=He(o,t[o],t[o+1],f);else for(o=e-r;o>=n;o-=r)f=He(o,t[o],t[o+1],f);return f&&Te(f,f.next)&&(ve(f),f=f.next),f}function ee(t,n){if(!t)return t;n||(n=t);var e=t,r;do if(r=!1,!e.steiner&&(Te(e,e.next)||Z(e.prev,e,e.next)===0)){if(ve(e),e=n=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==n);return n}function de(t,n,e,r,i,o,f){if(!!t){!f&&o&&bn(t,r,i,o);for(var a=t,s,u;t.prev!==t.next;){if(s=t.prev,u=t.next,o?un(t,r,i,o):sn(t)){n.push(s.i/e|0),n.push(t.i/e|0),n.push(u.i/e|0),ve(t),t=u.next,a=u.next;continue}if(t=u,t===a){f?f===1?(t=ln(ee(t),n,e),de(t,n,e,r,i,o,2)):f===2&&dn(t,n,e,r,i,o):de(ee(t),n,e,r,i,o,1);break}}}}function sn(t){var n=t.prev,e=t,r=t.next;if(Z(n,e,r)>=0)return!1;for(var i=n.x,o=e.x,f=r.x,a=n.y,s=e.y,u=r.y,l=i<o?i<f?i:f:o<f?o:f,d=a<s?a<u?a:u:s<u?s:u,c=i>o?i>f?i:f:o>f?o:f,h=a>s?a>u?a:u:s>u?s:u,v=r.next;v!==n;){if(v.x>=l&&v.x<=c&&v.y>=d&&v.y<=h&&ie(i,a,o,s,f,u,v.x,v.y)&&Z(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function un(t,n,e,r){var i=t.prev,o=t,f=t.next;if(Z(i,o,f)>=0)return!1;for(var a=i.x,s=o.x,u=f.x,l=i.y,d=o.y,c=f.y,h=a<s?a<u?a:u:s<u?s:u,v=l<d?l<c?l:c:d<c?d:c,p=a>s?a>u?a:u:s>u?s:u,g=l>d?l>c?l:c:d>c?d:c,L=De(h,v,n,e,r),F=De(p,g,n,e,r),E=t.prevZ,$=t.nextZ;E&&E.z>=L&&$&&$.z<=F;){if(E.x>=h&&E.x<=p&&E.y>=v&&E.y<=g&&E!==i&&E!==f&&ie(a,l,s,d,u,c,E.x,E.y)&&Z(E.prev,E,E.next)>=0||(E=E.prevZ,$.x>=h&&$.x<=p&&$.y>=v&&$.y<=g&&$!==i&&$!==f&&ie(a,l,s,d,u,c,$.x,$.y)&&Z($.prev,$,$.next)>=0))return!1;$=$.nextZ}for(;E&&E.z>=L;){if(E.x>=h&&E.x<=p&&E.y>=v&&E.y<=g&&E!==i&&E!==f&&ie(a,l,s,d,u,c,E.x,E.y)&&Z(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;$&&$.z<=F;){if($.x>=h&&$.x<=p&&$.y>=v&&$.y<=g&&$!==i&&$!==f&&ie(a,l,s,d,u,c,$.x,$.y)&&Z($.prev,$,$.next)>=0)return!1;$=$.nextZ}return!0}function ln(t,n,e){var r=t;do{var i=r.prev,o=r.next.next;!Te(i,o)&&Qe(i,r,r.next,o)&&ce(i,o)&&ce(o,i)&&(n.push(i.i/e|0),n.push(r.i/e|0),n.push(o.i/e|0),ve(r),ve(r.next),r=t=o),r=r.next}while(r!==t);return ee(r)}function dn(t,n,e,r,i,o){var f=t;do{for(var a=f.next.next;a!==f.prev;){if(f.i!==a.i&&xn(f,a)){var s=qe(f,a);f=ee(f,f.next),s=ee(s,s.next),de(f,n,e,r,i,o,0),de(s,n,e,r,i,o,0);return}a=a.next}f=f.next}while(f!==t)}function cn(t,n,e,r){var i=[],o,f,a,s,u;for(o=0,f=n.length;o<f;o++)a=n[o]*r,s=o<f-1?n[o+1]*r:t.length,u=je(t,a,s,r,!1),u===u.next&&(u.steiner=!0),i.push(yn(u));for(i.sort(vn),o=0;o<i.length;o++)e=hn(i[o],e);return e}function vn(t,n){return t.x-n.x}function hn(t,n){var e=pn(t,n);if(!e)return n;var r=qe(e,t);return ee(r,r.next),ee(e,e.next)}function pn(t,n){var e=n,r=t.x,i=t.y,o=-1/0,f;do{if(i<=e.y&&i>=e.next.y&&e.next.y!==e.y){var a=e.x+(i-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=r&&a>o&&(o=a,f=e.x<e.next.x?e:e.next,a===r))return f}e=e.next}while(e!==n);if(!f)return null;var s=f,u=f.x,l=f.y,d=1/0,c;e=f;do r>=e.x&&e.x>=u&&r!==e.x&&ie(i<l?r:o,i,u,l,i<l?o:r,i,e.x,e.y)&&(c=Math.abs(i-e.y)/(r-e.x),ce(e,t)&&(c<d||c===d&&(e.x>f.x||e.x===f.x&&_n(f,e)))&&(f=e,d=c)),e=e.next;while(e!==s);return f}function _n(t,n){return Z(t.prev,t,n.prev)<0&&Z(n.next,t,t.next)<0}function bn(t,n,e,r){var i=t;do i.z===0&&(i.z=De(i.x,i.y,n,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,mn(i)}function mn(t){var n,e,r,i,o,f,a,s,u=1;do{for(e=t,t=null,o=null,f=0;e;){for(f++,r=e,a=0,n=0;n<u&&(a++,r=r.nextZ,!!r);n++);for(s=u;a>0||s>0&&r;)a!==0&&(s===0||!r||e.z<=r.z)?(i=e,e=e.nextZ,a--):(i=r,r=r.nextZ,s--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;e=r}o.nextZ=null,u*=2}while(f>1);return t}function De(t,n,e,r,i){return t=(t-e)*i|0,n=(n-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,t|n<<1}function yn(t){var n=t,e=t;do(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),n=n.next;while(n!==t);return e}function ie(t,n,e,r,i,o,f,a){return(i-f)*(n-a)>=(t-f)*(o-a)&&(t-f)*(r-a)>=(e-f)*(n-a)&&(e-f)*(o-a)>=(i-f)*(r-a)}function xn(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!gn(t,n)&&(ce(t,n)&&ce(n,t)&&$n(t,n)&&(Z(t.prev,t,n.prev)||Z(t,n.prev,n))||Te(t,n)&&Z(t.prev,t,t.next)>0&&Z(n.prev,n,n.next)>0)}function Z(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function Te(t,n){return t.x===n.x&&t.y===n.y}function Qe(t,n,e,r){var i=pe(Z(t,n,e)),o=pe(Z(t,n,r)),f=pe(Z(e,r,t)),a=pe(Z(e,r,n));return!!(i!==o&&f!==a||i===0&&he(t,e,n)||o===0&&he(t,r,n)||f===0&&he(e,t,r)||a===0&&he(e,n,r))}function he(t,n,e){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function pe(t){return t>0?1:t<0?-1:0}function gn(t,n){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&Qe(e,e.next,t,n))return!0;e=e.next}while(e!==t);return!1}function ce(t,n){return Z(t.prev,t,t.next)<0?Z(t,n,t.next)>=0&&Z(t,t.prev,n)>=0:Z(t,n,t.prev)<0||Z(t,t.next,n)<0}function $n(t,n){var e=t,r=!1,i=(t.x+n.x)/2,o=(t.y+n.y)/2;do e.y>o!=e.next.y>o&&e.next.y!==e.y&&i<(e.next.x-e.x)*(o-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==t);return r}function qe(t,n){var e=new Ue(t.i,t.x,t.y),r=new Ue(n.i,n.x,n.y),i=t.next,o=n.prev;return t.next=n,n.prev=t,e.next=i,i.prev=e,r.next=e,e.prev=r,o.next=r,r.prev=o,r}function He(t,n,e,r){var i=new Ue(t,n,e);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ve(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ue(t,n,e){this.i=t,this.x=n,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Le.deviation=function(t,n,e,r){var i=n&&n.length,o=i?n[0]*e:t.length,f=Math.abs(Oe(t,0,o,e));if(i)for(var a=0,s=n.length;a<s;a++){var u=n[a]*e,l=a<s-1?n[a+1]*e:t.length;f-=Math.abs(Oe(t,u,l,e))}var d=0;for(a=0;a<r.length;a+=3){var c=r[a]*e,h=r[a+1]*e,v=r[a+2]*e;d+=Math.abs((t[c]-t[v])*(t[h+1]-t[c+1])-(t[c]-t[h])*(t[v+1]-t[c+1]))}return f===0&&d===0?0:Math.abs((d-f)/f)};function Oe(t,n,e,r){for(var i=0,o=n,f=e-r;o<e;o+=r)i+=(t[f]-t[o])*(t[o+1]+t[f+1]),f=o;return i}Le.flatten=function(t){for(var n=t[0][0].length,e={vertices:[],holes:[],dimensions:n},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var f=0;f<n;f++)e.vertices.push(t[i][o][f]);i>0&&(r+=t[i-1].length,e.holes.push(r))}return e};function wn(t){const[n]=Ae(t),e=En(t,n),[r]=Ae(e),i=Rn(e,r,n),o=Fn(i,e,n),[f,a]=An(o,e);return Ln(o,e,f,a)}function kn(t,n){for(var e={},r=[],i=1,o=0;o<n.length;o++){var f=n[o].join(",");e[f]==null&&(e[f]=i,r.push(n[o]),i++)}for(var a of t)for(var s in a)a[s]=e[n[a[s]].join(",")];return[r,t]}function j(t){return t.join(",")}function Ae(t){for(var n={},e=0;e<t.length;e++){var r=j(t[e]);n[r]=e}function i(...o){var f=j(o);return n[f]}return[i]}function En(t,n){for(var e=Array(t.length).fill(0).map(()=>Array(4).fill(1)),r=t[0][0],i=t[0][1],o=0;o<t.length;o++){t[o][0]<r&&(r=t[o][0]),t[o][1]<i&&(i=t[o][1]);var f=n(t[o][0]+1,t[o][1]),a=n(t[o][0],t[o][1]+1),s=n(t[o][0]-1,t[o][1]),u=n(t[o][0],t[o][1]-1);f!=null&&(e[o][1]=0,e[o][2]=0,e[f][0]=0,e[f][3]=0),a!=null&&(e[a][0]=0,e[a][1]=0,e[o][2]=0,e[o][3]=0),s!=null&&(e[s][1]=0,e[s][2]=0,e[o][0]=0,e[o][3]=0),u!=null&&(e[o][0]=0,e[o][1]=0,e[u][2]=0,e[u][3]=0)}var l={};for(var d in t)for(var c=t[d][0],h=t[d][1],o=0;o<4;o++){var v=c,p=h;o==1&&(v+=1),o==2&&(v+=1,p+=1),o==3&&(p+=1);var g=v+","+p;l[g]==null?l[g]={number:1,index:d,face_index:o}:l[g].number+=1}for(const[$,P]of Object.entries(l))P.number==3&&(e[P.index][P.face_index]=1);var L=[];for(var d in e){var c=t[d][0],h=t[d][1];for(var F in e[d])e[d][F]==1&&(F==0&&L.push([c,h]),F==1&&L.push([c+1,h]),F==2&&L.push([c+1,h+1]),F==3&&L.push([c,h+1]))}function E($){for(var P=new Set,N=0;N<$.length;N++){var M=$[N].join(",");P.add(M)}return Array.from(P)}return E(L).map($=>$.split(",").map(P=>parseInt(P)))}function Rn(t,n,e){var r=t[0][0],i=t[0][1],o=t[0][0],f=t[0][1];for(var a in t)t[a][0]<r&&(r=t[a][0]),t[a][1]<i&&(i=t[a][1]),t[a][0]>o&&(o=t[a][0]),t[a][1]>f&&(f=t[a][1]);function s(c,h,v){var p=c,g=void 0;if(h=="x")if(v=="forward")do{p=[p[0]+1,p[1]];var g=n(p)}while(g==null&&p[0]<o);else do{p=[p[0]-1,p[1]];var g=n(p)}while(g==null&&p[0]>r);else if(v=="forward")do{p=[p[0],p[1]+1];var g=n(p)}while(g==null&&p[1]<f);else do{p=[p[0],p[1]-1];var g=n(p)}while(g==null&&p[1]>i);return g}var u=new Set;function l(c,h,v){var p=c,g=s(t[c],v,h);if(g!=null){if(p>g)var L=[g,p];else var L=[p,g];var F=t[L[0]],E=t[L[1]];d(F,E,v)&&u.add(j(L))}}function d(c,h,v){if(v=="x"){var p=c[1],g,L;if(c[0]>h[0]?(g=h[0],L=c[0]):(g=c[0],L=h[0]),e([g,p-1])==null){for(var F=g;F<L;F++)if(e([F,p-1])!=null||e([F,p])==null)return!1}else for(var F=g;F<L;F++)if(e([F,p-1])==null||e([F,p])!=null)return!1}else{var F=c[0],E,$;if(c[1]>h[1]?(E=h[1],$=c[1]):(E=c[1],$=h[1]),e([F-1,E])==null){for(var p=E;p<$;p++)if(e([F-1,p])!=null||e([F,p])==null)return!1}else for(var p=E;p<$;p++)if(e([F-1,p])==null||e([F,p])!=null)return!1}return!0}for(var a in t)l(a,"forward","x"),l(a,"forward","y"),l(a,"backward","x"),l(a,"backward","y");return Array.from(u).map(c=>c.split(",").map(h=>parseInt(h)))}function Fn(t,n,e){for(var r=new Array(n.length).fill(0).map(k=>[]),i=0;i<t.length;i++)r[t[i][0]].push(t[i][1]),r[t[i][1]].push(t[i][0]);function o(k,_){if(k[0]>_[0])var A=_,S=k;else var A=k,S=_;if(A[0]==S[0]||A[1]==S[1])return!1;if(S[1]>A[1])var w=A[0],R=S[0]-1,C=A[1],m=S[1]-1;else var w=A[0],R=S[0]-1,C=S[1],m=A[1]-1;for(var k=w;k<=R;k++){for(var B=!0,_=C;_<=m;_++)if(e([k,_])==null){B=!1;break}if(B)return!0}for(var _=C;_<=m;_++){for(var B=!0,k=w;k<=R;k++)if(e([k,_])==null){B=!1;break}if(B)return!0}return!1}var f=new Array(r.length).fill(0).map(k=>[]);for(var a in r){var s=r[a];if(s.length<=2){f[a]=[s];continue}for(var u=[],i=0;i<s.length;i++)for(var l=s[i],d=n[l],c=i+1;c<s.length;c++){var h=s[c];if(!(l==null||h==null)){var v=n[h];if(o(d,v)){var p=[l,h];u.push(p)}}}f[a]=u}function g(k,_){return f[k].findIndex(A=>A.includes(_))}var L=[],F=new Set,E=new Set;for(var a in f)for(var $ in f[a]){let _=function(A){for(const R in f[A])if(!!M.has(`${A},${R}`)&&!E.has(`${A},${R}`)&&!N.has(`${A},${R}`)){M=new Set,N.add(`${A},${R}`),E.add(`${A},${R}`);var S=f[A][R];M.add(`${S[0]},${g(S[0],A)}`),M.add(`${S[1]},${g(S[1],A)}`),P.push(A);for(var w of S)_(w)}};var b=_;a=Number(a);var P=[],N=new Set;F.add(a),N.add(a);var M=new Set;M.add(`${a},${$}`),_(a),P.length!=0&&L.push(P)}return L}function An(t,n){function e(c,h){for(var v=!1,p=h[0],g=h[1],L=c.map(function(k){return k[0]}),F=0,E=L.length-1;F<L.length;E=F++){var $=L[F],P=c[F][1],N=L[E],M=c[E][1],b=P>g!=M>g&&p<(N-$)*(g-P)/(M-P)+$;if(b&&(v=!v),P===g&&$===p||M===g&&N===p){v=!0;break}}return v}for(var r=Array.from(t).fill(0).map(c=>[]),i=0;i<t.length;i++)for(var o=t[i].map(c=>n[c]),f=0;f<t.length;f++)i!=f&&t[f].every(c=>e(o,n[c]))&&r[i].push(f);for(var a=new Array(t.length).fill(!1),s=new Array(t.length).fill(0).map(c=>[]),i=0;i<r.length;i++)for(var f=0;f<r[i].length;f++)s[r[i][f]].push(i);for(var i=0;i<s.length;i++)for(var f=0;f<s[i].length;f++)r[s[i][f]]=r[s[i][f]].filter(v=>!r[i].includes(v));var u=new Array(t.length).fill(0).map((c,h)=>h);u.sort((c,h)=>r[c].includes(h)?-1:1);var l=new Set;for(const c of u)l.has(c)||d(c);function d(c,h=0){if(!l.has(c)){l.add(c);for(const v of r[c])d(v,h+1);h%2==1&&(r[c]=[],a[c]=!0)}}return[r,a]}function Ln(t,n,e,r){var i=[];for(var o in t)if(!r[o]){var f=0,a=[];for(var s of t[o])a.push(...n[s]),f+=1;var u=[];for(var s of e[o]){var l=[];u.push(f);for(var d of t[s])l.push(...n[d]),f+=1;a.push(...l)}var c=Ze.exports(a,u);i.push({positions:a,indices:c})}return i}function Tn(t){return[(t>>0&255)/255,(t>>8&255)/255,(t>>16&255)/255,1]}function Xe(t){return t[0]+(t[1]<<8)+(t[2]<<16)-1}const Sn=[[0,0,1,0,0,1,0,0,1,0,0,1],[0,0,-1,0,0,-1,0,0,-1,0,0,-1],[0,1,0,0,1,0,0,1,0,0,1,0],[0,-1,0,0,-1,0,0,-1,0,0,-1,0],[1,0,0,1,0,0,1,0,0,1,0,0],[-1,0,0,-1,0,0,-1,0,0,-1,0,0]],Pn=[[-1,-1,1,1,-1,1,1,1,1,-1,1,1],[-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1],[-1,1,-1,-1,1,1,1,1,1,1,1,-1],[-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1],[1,-1,-1,1,1,-1,1,1,1,1,-1,1],[-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]],Mn=[[0,1,2,0,2,3],[4,5,6,4,6,7],[8,9,10,8,10,11],[12,13,14,12,14,15],[16,17,18,16,18,19],[20,21,22,20,22,23]],In=[[0,1,1,2,2,3,3,0],[4,5,5,6,6,7,7,4],[8,9,9,10,10,11,11,8],[12,13,13,14,14,15,15,12],[16,17,17,18,18,19,19,16],[20,21,21,22,22,23,23,20]],ne=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],Bn=[1,1,1];function Nn(t,n){var e=j([t[0]+1,t[1],t[2]]);return n(e)}function Cn(t,n){var e=j([t[0]-1,t[1],t[2]]);return n(e)}function Dn(t,n){var e=j([t[0],t[1]+1,t[2]]);return n(e)}function Un(t,n){var e=j([t[0],t[1]-1,t[2]]);return n(e)}function On(t,n){var e=j([t[0],t[1],t[2]+1]);return n(e)}function Zn(t,n){var e=j([t[0],t[1],t[2]-1]);return n(e)}const Se=[[0,1,0,1,0,1],[0,1,0,1,1,0],[0,1,1,0,0,1],[0,1,1,0,1,0],[1,0,0,1,0,1],[1,0,0,1,1,0],[1,0,1,0,0,1],[1,0,1,0,1,0]];var Pe=[2,2,1,1,0,0];class Hn{constructor(){this.voxels=[[0,0,0]],this.color=[],this.init_colors(this.voxels)}init_colors(n){for(var e=[],r=0;r<n.length;r++){var i=[];e.push(i);for(var o=0;o<6;o++)i.push([...Bn])}this.color.push(...e)}build_geometry(){for(var n=[],e=[],r=[],i=[],o=[],f=[],a=0,s=1,u=0;u<this.voxels.length;u++){for(var l=0,d=0,c=s-1,h=[],v=0;v<6;v++){if(this.faces[u][v]==0){d+=4;continue}r.push(...Pn[v].map((L,F)=>L+this.voxels[u][F%3]*2-this.center[F%3])),o.push(...Sn[v]),f.push(...In[v].map(L=>L+a-d)),i.push(...Mn[v].map(L=>L+a-d)),l+=4;for(var p=Tn(s),g=0;g<4;g++)h.push(...p);s++}a+=l,e.push({start:c,end:s-1}),n.push(...h)}this.id=s,this.distance=a,this.geometry_vertexes=r,this.geometry_indexes=i,this.geometry_normals=o,this.geometry_edge_index=f,this.pick_map=n,this.pick_meta=e}init(){this.build_boundary(),this.build_center(),this.build_faces(),this.build_geometry()}build(){this.build_boundary(),this.build_center(),this.build_geometry()}add(...n){this.voxels.push(...n),this.init_colors(n),this.init()}subdivide(){var n=[],e=[],r=[];for(const s in this.voxels){const u=this.voxels[s],l=this.faces[s],d=[u[0]*2,u[1]*2,u[2]*2];for(var i=0;i<8;i++){var o=[];r.push(o);for(var f=0;f<6;f++)o.push([...this.color[s][f]])}n.push([d[0],d[1],d[2]],[d[0]+1,d[1],d[2]],[d[0],d[1]+1,d[2]],[d[0]+1,d[1]+1,d[2]],[d[0],d[1],d[2]+1],[d[0]+1,d[1],d[2]+1],[d[0],d[1]+1,d[2]+1],[d[0]+1,d[1]+1,d[2]+1]);for(var f in Se){var a=Array(6).fill(0);for(var i in Se[f])Se[f][i]==1&&l[i]==1&&(a[i]=1);e.push(a)}}this.voxels=n,this.faces=e,this.color=r,this.build_boundary(),this.build_center(),this.build_geometry()}remove(...n){for(const r of n){if(this.voxels.length==1){n.splice(n.indexOf(r),1);continue}for(var e=0;e<this.voxels.length;e++)if(this.voxels[e][0]==r[0]&&this.voxels[e][1]==r[1]&&this.voxels[e][2]==r[2]){this.voxels.splice(e,1),this.faces.splice(e,1),this.color.splice(e,1);break}}this.init()}get_plane_color(n,e,r=null){var i=[];for(const l in this.pick_meta){const d=this.faces[l];for(var o=0,f=0;f<d.length;f++){if(d[f]==0){o+=1;continue}if(n.includes(l)){if(r!=null)var a=this.color[l][f];else var a=this.color[l][f];if(o==e){if(r!=null)var s=this.color[l][f].map((c,h)=>c*(1-r[3])+r[h]*r[3]);else var s=this.color[l][f].map(h=>Math.abs(1-h*.5));for(var u=0;u<4;u++)i.push(...s,1)}else for(var u=0;u<4;u++)i.push(...a,1)}else for(var u=0;u<4;u++)i.push(...this.color[l][f],1);o+=1}}return i}get_plane(n,e){var r=[];for(const f in this.voxels){const a=this.voxels[f];var i=!0;for(const s in e)if(e[s]!=0&&n[s]!=a[s]){i=!1;break}if(i){var o=this.voxels[f].map((s,u)=>s+e[u]);this.voxels.some(s=>s[0]==o[0]&&s[1]==o[1]&&s[2]==o[2])||r.push(f)}}return r}get_contiguous(n,e,r){var i=[];const o=this.voxels,f=new Set;function a(s){for(const c of n){const h=o[c];var u=!0;for(const v in r)if(r[v]!=0){if(s[v]!=h[v]){u=!1;break}}else if(Math.abs(s[v]-h[v])>1){u=!1;break}if(u){var l=o[c].map((v,p)=>v+r[p]),d=`${l[0]},${l[1]},${l[2]}`;f.has(d)||(f.add(d),i.push(c),a(o[c]))}}}return a(e),i}get_vertical_line(n,e,r){var i=[];for(const s in this.voxels){const u=this.voxels[s];var o=!0,f=-1;for(const l in e)if(e[l]!=0&&(f=l,n[l]!=u[l])){o=!1;break}if(f==0){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==2){o=!1;break}}else if(f==2){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==0){o=!1;break}}else if(f==1){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==0){o=!1;break}}else o=!1;if(o){var a=this.voxels[s].map((l,d)=>l+e[d]);this.voxels.some(l=>l[0]==a[0]&&l[1]==a[1]&&l[2]==a[2])||i.push(s)}}return i}get_horizontal_line(n,e,r){var i=[];for(const s in this.voxels){const u=this.voxels[s];var o=!0,f=-1;for(const l in e)if(e[l]!=0){if(f=l,n[l]!=u[l]){o=!1;break}}else if(n[l]!=u[l]&&l==1){o=!1;break}if(f==1){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==2){o=!1;break}}if(o){var a=this.voxels[s].map((l,d)=>l+e[d]);this.voxels.some(l=>l[0]==a[0]&&l[1]==a[1]&&l[2]==a[2])||i.push(s)}}return i}highlight_plane(n,e,r,i,o=null){var f=Xe(n),c=[],a=0;for(const v in this.pick_meta){const p=this.faces[v],g=this.pick_meta[v];if(f>=g.start&&f<g.end)for(var s=0,u=0;u<p.length;u++){if(p[u]==0){s+=1;continue}if(f==a){var l;switch(r){case"Plane":l=this.get_plane(this.voxels[v],ne[s]);break;case"Horizontal line":l=this.get_horizontal_line(this.voxels[v],ne[s]);break;case"Vertical line":l=this.get_vertical_line(this.voxels[v],ne[s]);break}i&&(l=this.get_contiguous(l,this.voxels[v],ne[s]));var d=[];for(const L of l)d.push(this.color[L][s]);return e({voxel:l.map(L=>this.voxels[L]),direction:ne[s],color:d,mouse_color:this.color[v][u],index:v}),this.get_plane_color(l,s,o)}s+=1,a+=1}else for(var u=0;u<p.length;u++)p[u]!=0&&(a+=1)}var c=[];for(const v in this.pick_meta){const p=this.faces[v];for(var u=0;u<p.length;u++)if(p[u]!=0)for(var h=0;h<4;h++)c.push(...this.color[v][u],1)}return c}printPointsWithinCircle(n,e){if(n<1)return[[e[0],e[1]]];const r={x:e[0],y:e[1]};var i=[];for(let o=r.x-n;o<=r.x+n;o++)for(let f=r.y-n;f<=r.y+n;f++)Math.sqrt((o-r.x)**2+(f-r.y)**2)<=n&&i.push([o,f]);return i}printPointsWithinSquare(n,e){if(n<1)return[[e[0],e[1]]];n=Math.round(n/2);const r={x:e[0],y:e[1]};var i=[];for(let o=r.x-n;o<=r.x+n;o++)for(let f=r.y-n;f<=r.y+n;f++)i.push([o,f]);return i}get_highlight(n,e,r=null,i,o){const[f]=Ae(this.voxels);var a=new Set(n.map(M=>Xe(M))),s=Array.from(a),u=[],d=[],l=0,d=[],c=new Set;for(const M in this.pick_meta){const b=this.faces[M],k=this.pick_meta[M];if(s.some(_=>_>=k.start&&_<k.end))for(var h=0,v=0;v<b.length;v++){if(b[v]==0){h+=1;continue}if(a.has(l)){var p=[...this.voxels[M]];if(p.splice(Pe[h],1),o)var g=this.printPointsWithinCircle(i-1,p);else var g=this.printPointsWithinSquare(i,p);for(const _ of g){var L=[..._];L.splice(Pe[h],0,this.voxels[M][Pe[h]]);var F=f(L),E=`${F},${v}`;F==null||c.has(E)||(c.add(E),d.push({voxel:[this.voxels[F]],direction:ne[h],color:[this.color[F][v]],mouse_color:this.color[F][v],index:M}))}}h+=1,l+=1}else for(var v=0;v<b.length;v++)b[v]!=0&&(l+=1)}for(const M in this.faces)for(var $=this.faces[M],v=0;v<$.length;v++)if($[v]!=0){for(var P=0;P<4;P++)if(c.has(`${M},${v}`)){if(r)var N=this.color[M][v].map((k,_)=>k*(1-r[3])+r[_]*r[3]);else var N=this.color[M][v].map(_=>Math.abs(1-_*.5));u.push(...N,1)}else u.push(...this.color[M][v],1);l+=1}return e(d),u}build_faces(){const n=this.voxels,e=new Array(n.length).fill(0).map(d=>[1,1,1,1,1,1]),[r]=Ae(this.voxels);for(var i=0;i<n.length;i++){var o=Nn(n[i],r);o&&(e[i][4]=0,e[o][5]=0);var f=Cn(n[i],r);f&&(e[i][5]=0,e[f][4]=0);var a=Dn(n[i],r);a&&(e[i][2]=0,e[a][3]=0);var s=Un(n[i],r);s&&(e[i][3]=0,e[s][2]=0);var u=On(n[i],r);u&&(e[i][0]=0,e[u][1]=0);var l=Zn(n[i],r);l&&(e[i][1]=0,e[l][0]=0)}this.faces=e}build_center(){const n=this.boundary;this.center=n[0].map((e,r)=>e+n[1][r])}build_boundary(){const n=this.voxels;for(var e=n[0],r=n[0],i=1;i<n.length;i++)e=e.map((o,f)=>Math.min(o,n[i][f])),r=r.map((o,f)=>Math.max(o,n[i][f]));this.boundary=[e,r]}}class Xn{constructor(n,e,r){this.gl=n,this.program=e,this.canvas=r,this.attribute_matrix_4_mat_float=te((i,o)=>{var f=n.getUniformLocation(this.program,i);n.uniformMatrix4fv(f,!1,o)}),this.uniform_float=te((i,o)=>{var f=n.getUniformLocation(this.program,i);n.uniform1f(f,o)}),this.uniform_4_float=te((i,o)=>{var f=n.getUniformLocation(this.program,i);n.uniform4f(f,o[0],o[1],o[2],o[3])}),this.uniform_3_float=te((i,o)=>{var f=n.getUniformLocation(this.program,i);n.uniform3f(f,o[0],o[1],o[2])}),this.attribute_matrix_3_float=te((i,o)=>{var f=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,f),n.bufferData(n.ARRAY_BUFFER,new Float32Array(o),n.STATIC_DRAW);var a=n.getAttribLocation(this.program,i);n.vertexAttribPointer(a,3,n.FLOAT,!1,0,0),n.enableVertexAttribArray(a)}),this.attribute_matrix_4_float=te((i,o)=>{var f=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,f),n.bufferData(n.ARRAY_BUFFER,new Float32Array(o),n.STATIC_DRAW);var a=n.getAttribLocation(this.program,i);n.vertexAttribPointer(a,4,n.FLOAT,!1,0,0),n.enableVertexAttribArray(a)})}set face(n){this.faces=n}buffer(n){const e=this.gl,r=this.canvas,i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i);var o=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,o),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,o);const f=e.createTexture();return e.bindTexture(e.TEXTURE_2D,f),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,f,0),n(),e.bindFramebuffer(e.FRAMEBUFFER,null),f}getPixel(n,e){const r=this.gl,i=new Uint8Array(4);return r.readPixels(n,e,1,1,r.RGBA,r.UNSIGNED_BYTE,i),i}drawSolid(n){const e=this.gl;if(!n){if(this.faces==null)throw"No faces defined";n=this.faces}var r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),e.STATIC_DRAW),e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),e.drawElements(e.TRIANGLES,n.length,e.UNSIGNED_SHORT,0)}drawLines(n){const e=this.gl;if(!n){if(this.faces==null)throw"No faces defined";n=this.faces}var r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),e.STATIC_DRAW),e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),e.drawElements(e.LINES,n.length,e.UNSIGNED_SHORT,0)}}function te(t){return new Proxy({},{set:function(n,e,r){return t(e,r),!0}})}function Gn(t,n,e){const r=t.getContext("webgl2",{antialias:!0}),i=r.createProgram(),o=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(o,e),r.compileShader(o),r.attachShader(i,o);const f=r.createShader(r.VERTEX_SHADER);return r.shaderSource(f,n),r.compileShader(f),r.attachShader(i,f),r.linkProgram(i),r.useProgram(i),[r,new Xn(r,i,t)]}var Ge=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)});function Yn(){var t=new Ge(16);return Ge!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Wn(t,n){if(t===n){var e=n[1],r=n[2],i=n[3],o=n[6],f=n[7],a=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=e,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=o,t[11]=n[14],t[12]=i,t[13]=f,t[14]=a}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t}function Jn(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],f=n[4],a=n[5],s=n[6],u=n[7],l=n[8],d=n[9],c=n[10],h=n[11],v=n[12],p=n[13],g=n[14],L=n[15],F=e*a-r*f,E=e*s-i*f,$=e*u-o*f,P=r*s-i*a,N=r*u-o*a,M=i*u-o*s,b=l*p-d*v,k=l*g-c*v,_=l*L-h*v,A=d*g-c*p,S=d*L-h*p,w=c*L-h*g,R=F*w-E*S+$*A+P*_-N*k+M*b;return R?(R=1/R,t[0]=(a*w-s*S+u*A)*R,t[1]=(i*S-r*w-o*A)*R,t[2]=(p*M-g*N+L*P)*R,t[3]=(c*N-d*M-h*P)*R,t[4]=(s*_-f*w-u*k)*R,t[5]=(e*w-i*_+o*k)*R,t[6]=(g*$-v*M-L*E)*R,t[7]=(l*M-c*$+h*E)*R,t[8]=(f*S-a*_+u*b)*R,t[9]=(r*_-e*S-o*b)*R,t[10]=(v*N-p*$+L*F)*R,t[11]=(d*$-l*N-h*F)*R,t[12]=(a*k-f*A-s*b)*R,t[13]=(e*A-r*k+i*b)*R,t[14]=(p*E-v*P-g*F)*R,t[15]=(l*P-d*E+c*F)*R,t):null}function zn(t,n,e,r){function i(m,B,D,I){var W=Math.tan(m*.5*Math.PI/180);return[.5/W,0,0,0,0,.5*B/W,0,0,0,0,-(I+D)/(I-D),-1,0,0,-2*I*D/(I-D),0]}var o=i(40,t.width/t.height,1,1e3),f=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const s=Yn();Jn(s,a),Wn(s,s),e.viewport(0,0,t.width,t.height),n.attribute_matrix_4_mat_float.uNormalMatrix=s,a[14]=a[14]-6;var u=0,l=!1,d,c,h=0,v=0,p=null,g=!1;document.addEventListener("keydown",function(m){m.key=="Control"&&(g=!0)}),document.addEventListener("keyup",function(m){m.key=="Control"&&(g=!1)});var L=function(m){if(!!g)return m.button==2?p="pan":p="rotate",l=!0,d=m.pageX,c=m.pageY,m.preventDefault(),!1},F=function(m){l=!1};const E={x:0,y:0};var $=function(m){const B=t.__element.getBoundingClientRect();if(E.x=(m.clientX-B.left)*e.canvas.width/e.canvas.clientWidth,E.y=e.canvas.height-(m.clientY-B.top)*e.canvas.height/e.canvas.clientHeight-1,!l)return!1;h=(m.pageX-d)*2*Math.PI/t.width,v=(m.pageY-c)*2*Math.PI/t.height,p=="rotate"?(_+=h,A+=v):p=="pan"&&P(h,v),d=m.pageX,c=m.pageY,m.preventDefault()};function P(m,B){a[12]-=m*a[14]/2,a[13]+=B*a[14]/2}t.$on("mousedown",L),t.$on("mouseup",F),t.$on("mouseout",F),t.$on("mousemove",$);var N=function(m){m.preventDefault();var B=m.wheelDelta?m.wheelDelta/40:m.detail?-m.detail:0,D=1.3;return B&&M(B<0?1*D:1/D),m.preventDefault()&&!1};function M(m){a[14]*=m}t.$on("wheel",N);function b(m,B){var D=Math.cos(B),I=Math.sin(B),W=m[1],ae=m[5],z=m[9];m[1]=m[1]*D-m[2]*I,m[5]=m[5]*D-m[6]*I,m[9]=m[9]*D-m[10]*I,m[2]=m[2]*D+W*I,m[6]=m[6]*D+ae*I,m[10]=m[10]*D+z*I}function k(m,B){var D=Math.cos(B),I=Math.sin(B),W=m[0],ae=m[4],z=m[8];m[0]=D*m[0]+I*m[2],m[4]=D*m[4]+I*m[6],m[8]=D*m[8]+I*m[10],m[2]=D*m[2]-I*W,m[6]=D*m[6]-I*ae,m[10]=D*m[10]-I*z}var _=.8,A=.8;function S(){l||(h*=u,v*=u,_+=h,A+=v),f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,A=Math.max(-Math.PI/2,Math.min(Math.PI/2,A)),k(f,_),b(f,A),n.attribute_matrix_4_mat_float.projection_matrix=o,n.attribute_matrix_4_mat_float.view_matrix=a,n.attribute_matrix_4_mat_float.model_matrix=f}function w(){a[12]=0,a[13]=0}function R(){_=.8,A=.8}function C(m){a[14]=m}return{update:S,mouse:E,zoom:M,resetPan:w,resetRotation:R,setZoom:C}}function Vn(t){var n=0;function e(r){r*=.001;const i=r-n;n=r;const o=1/i;t(o.toFixed(1)),requestAnimationFrame(e)}e()}function re(t,n,e){var r=[];const i=fe({name:e});for(const o of t){const f=y("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(i.name==o.name?" button-selected":""),elements:[typeof i<"u"?i:void 0,typeof name<"u"?name:void 0,typeof o<"u"?o:void 0,typeof name<"u"?name:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>o.name,elements:[typeof o<"u"?o:void 0,typeof name<"u"?name:void 0]});f.$on("click",()=>{i.name=o.name,n(o.name)}),r.push(f)}return r}function X(t,n,e=!0){const r=fe({value:e});var i=y("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(r.value?" button-selected":""),elements:[typeof r<"u"?r:void 0,typeof value<"u"?value:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]});return i.$on("click",()=>{r.value=!r.value,n(r.value)}),i}function U(t,n){var e=y("button",{class:"button"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]});return e.$on("click",()=>{n()}),e}function Kn({callback:t,start:n,color:e}){t||(t=u=>{});const r=fe({absolute_value:0,relative_value:0});var i=V(),o=y("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--accent-color:${e()};`,elements:[typeof e<"u"?e:void 0]}},y("div",{class:"trackbar-background"}),y("div",{class:"trackbar-foreground"}),y("div",{class:"trackbar-thumb",ref:i,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${r.absolute_value}px`,elements:[typeof r<"u"?r:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));o.$onUpdate(()=>{var u=o.__element.getBoundingClientRect();r.relative_value=n(),r.absolute_value=u.width*n()/255});var f=!1,a;function s(u){var l=u-a,d=o.__element.getBoundingClientRect();l<0&&(l=0),l>d.width&&(l=d.width),r.absolute_value=l,r.relative_value=r.absolute_value/d.width*255,t(r.relative_value)}return document.addEventListener("mousemove",u=>{f&&s(u.clientX)}),i.$on("mousedown",u=>{u.stopPropagation(),f=!0,a=u.clientX-r.absolute_value}),o.$on("mousedown",u=>{var l=o.__element.getBoundingClientRect();a=l.left,s(u.clientX),f=!0}),document.addEventListener("mouseup",u=>{f=!1}),o}function Me({callback:t,start:n,colorFrom:e,colorTo:r}){t||(t=l=>{});const i=fe({absolute_value:0,relative_value:0});var o=V(),f=y("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--color-from:${e()};--color-to:${r()};`,elements:[typeof e<"u"?e:void 0,typeof r<"u"?r:void 0]}},y("div",{class:"trackbar-data"}),y("div",{class:"trackbar-thumb",ref:o,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${i.absolute_value}px`,elements:[typeof i<"u"?i:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));f.$onUpdate(()=>{var l=f.__element.getBoundingClientRect();i.relative_value=n(),i.absolute_value=l.width*n()/255});var a=!1,s;function u(l){var d=l-s,c=f.__element.getBoundingClientRect();d<0&&(d=0),d>c.width&&(d=c.width),i.absolute_value=d,i.relative_value=i.absolute_value/c.width*255,t(i.relative_value)}return document.addEventListener("mousemove",l=>{a&&u(l.clientX)}),o.$on("mousedown",l=>{l.stopPropagation(),a=!0,s=l.clientX-i.absolute_value}),f.$on("mousedown",l=>{var d=f.__element.getBoundingClientRect();s=d.left,u(l.clientX),a=!0}),document.addEventListener("mouseup",l=>{a=!1}),f}function jn({callback:t,start:n}){const e=fe({absolute_value:0,relative_value:0,min_color:"0,0,0",max_color:"255,255,255",min_limit_percent:0,max_limit_percent:100});var r=0,i=0,o=0,f=0,a=255;t||(t=h=>{});var s=V(),u=y("div",null,y("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--color-from:${e.min_color};--color-to:${e.max_color};--min-limit:${e.min_limit_percent}%;--max-limit:${e.max_limit_percent}%`,elements:[typeof e<"u"?e:void 0,typeof min_color<"u"?min_color:void 0,typeof e<"u"?e:void 0,typeof max_color<"u"?max_color:void 0,typeof e<"u"?e:void 0,typeof min_limit_percent<"u"?min_limit_percent:void 0,typeof e<"u"?e:void 0,typeof max_limit_percent<"u"?max_limit_percent:void 0]}},y("div",{class:"trackbar-bright-data"}),y("div",{class:"trackbar-thumb",ref:s,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${e.absolute_value}px`,elements:[typeof e<"u"?e:void 0,typeof absolute_value<"u"?absolute_value:void 0]}})));u.$onUpdate(()=>{var h=u.__element.getBoundingClientRect(),v=n();r=v[0],i=v[1],o=v[2];var p=Math.min(r,i,o),g=Math.max(r,i,o),L=(r+i+o)/3;e.min_color=[r-p,i-p,o-p].join(","),e.max_color=[r+(255-g),i+(255-g),o+(255-g)].join(","),e.relative_value=L,e.absolute_value=h.width*L/255;var F=L-p,E=255-(g-L);f=h.width*F/255,a=h.width*E/255,e.min_limit_percent=F/255*100,e.max_limit_percent=E/255*100});var l=!1,d;function c(h){var v=e.relative_value,p=r-v,g=i-v,L=o-v,F=h-d,E=u.__element.getBoundingClientRect();F<f&&(F=f),F>a&&(F=a),e.absolute_value=F,e.relative_value=e.absolute_value/E.width*255,r=e.relative_value+p,i=e.relative_value+g,o=e.relative_value+L,console.log(r,i,o),t([r,i,o])}return document.addEventListener("mousemove",h=>{l&&c(h.clientX)}),s.$on("mousedown",h=>{h.stopPropagation(),l=!0,d=h.clientX-e.absolute_value}),u.$on("mousedown",h=>{var v=u.__element.getBoundingClientRect();d=v.left,c(h.clientX),l=!0}),document.addEventListener("mouseup",h=>{l=!1}),u}function en(t,n){var e=JSON.stringify(n),r=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(r),o=document.createElement("a");o.download=t,o.href=i,o.textContent="Download",o.click(),o.remove()}function Qn(t,n){var e=new Blob([n],{type:"plain/text"}),r=URL.createObjectURL(e),i=document.createElement("a");i.download=t,i.href=r,i.textContent="Download",i.click(),i.remove()}async function nn(t,n){var e=document.createElement("input");e.type="file",e.accept="."+t,e.onchange=r=>{var i=r.target.files[0],o=new FileReader;o.onload=function(f){var a=f.target.result;n(JSON.parse(a))},o.readAsText(i)},e.click(),e.remove()}function Ye(t,n){var e=document.createElement("a");e.download=t,e.href=n,e.click(),e.remove()}function qn({set:t,get:n}){const e=V();var r=0,i=0,o=0,f=255,a=255,s=255,u=255,l=255;const d=V();var c=[];function h(){nn("col",w=>{d.$html("");for(var R=0;R<w.length;R++)p(w[R][0],w[R][1],w[R][2],w[R][3])})}function v(){en("color_list.col",c)}function p(w,R,C,m){c.push([w,R,C,m]);var B=y("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${w},${R},${C},${m/255})`,elements:[typeof w<"u"?w:void 0,typeof R<"u"?R:void 0,typeof C<"u"?C:void 0,typeof m<"u"?m:void 0]}}),D=!1;B.$on("mousedown",I=>(D=!0,I.button==1&&I.preventDefault(),!1)),B.$on("contextmenu",I=>(I.preventDefault(),!1)),document.addEventListener("mouseup",I=>{setTimeout(()=>{D=!1},100)}),B.$on("mouseup",I=>{!D||(I.button==0?(r=w,i=R,o=C,f=m,P(),$&&$.$update()):I.button==2?(a=w,s=R,u=C,l=m,P("background"),$&&$.$update()):B.$remove())}),B.$parent(d)}function g(w,R,C){return console.log(w,R,C),[w,R,C].map(m=>parseInt(m).toString(16).padStart(2,"0")).join("")}function L(w){var R=parseInt(w.substring(0,2),16),C=parseInt(w.substring(2,4),16),m=parseInt(w.substring(4,6),16);return[R,C,m]}function F(w){return w.length==6&&!isNaN(parseInt(w,16))}function E(w){var R=w.target.value;if(R.startsWith("#")&&(R=R.substring(1),e.value=R),!!F(R)){var C=L(R);r=C[0],i=C[1],o=C[2],P(),$&&$.$update()}}var $=y("div",{style:"width:100%"},y("div",{style:"width:100px;margin:10px;position:relative"},y("div",{class:"hash-tag"},"#"),y("input",{type:"text",class:"input hex-input",maxLength:"6","on:input":E,ref:e})),y("div",{style:"display:flex;flex-direction:row"},y("div",{style:"width:100%;padding:10px"},y(Me,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`0,${i},${o}`,elements:[typeof i<"u"?i:void 0,typeof o<"u"?o:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`255,${i},${o}`,elements:[typeof i<"u"?i:void 0,typeof o<"u"?o:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:w=>M(w),elements:[typeof x<"u"?x:void 0,typeof M<"u"?M:void 0,typeof x<"u"?x:void 0]}}),y(Me,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},0,${o}`,elements:[typeof r<"u"?r:void 0,typeof o<"u"?o:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},255,${o}`,elements:[typeof r<"u"?r:void 0,typeof o<"u"?o:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:w=>b(w),elements:[typeof x<"u"?x:void 0,typeof b<"u"?b:void 0,typeof x<"u"?x:void 0]}}),y(Me,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>o,elements:[typeof o<"u"?o:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},${i},0`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},${i},255`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:w=>k(w),elements:[typeof x<"u"?x:void 0,typeof k<"u"?k:void 0,typeof x<"u"?x:void 0]}}),y(jn,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>[r,i,o],elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof o<"u"?o:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:w=>A(w),elements:[typeof x<"u"?x:void 0,typeof A<"u"?A:void 0,typeof x<"u"?x:void 0]}}))),y("div",{class:"row"},y("div",{class:"color-area"},y("div",{class:"color-container"},y("div",{class:"background color-item"},y("div",{class:"backdrop"}),y("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${a},${s},${u},${l/255})`,elements:[typeof a<"u"?a:void 0,typeof s<"u"?s:void 0,typeof u<"u"?u:void 0,typeof l<"u"?l:void 0]}})),y("div",{class:"foreground color-item"},y("div",{class:"backdrop"}),y("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${r},${i},${o},${f/255})`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof o<"u"?o:void 0,typeof f<"u"?f:void 0]}}))),y("div",{class:"hover-icon-container",style:"margin-left:5px","on:click":S},y("i",{class:"fa-solid fa-arrows-rotate hover-icon"}))),y("div",{class:"alpha-area",style:"margin-top:-10px"},y(Kn,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>f,elements:[typeof f<"u"?f:void 0]},color:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},${i},${o};`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof o<"u"?o:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:w=>_(w),elements:[typeof x<"u"?x:void 0,typeof _<"u"?_:void 0,typeof x<"u"?x:void 0]}}))),y("div",{class:"color-history-container"},y("div",{style:"display:inline-block",ref:d}),y("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${r},${i},${o},${f/255})`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof o<"u"?o:void 0,typeof f<"u"?f:void 0]},"on:click":()=>p(r,i,o,f)},y("i",{class:"fa fa-plus"})),y("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${a},${s},${u},${l/255})`,elements:[typeof a<"u"?a:void 0,typeof s<"u"?s:void 0,typeof u<"u"?u:void 0,typeof l<"u"?l:void 0]},"on:click":()=>p(a,s,u,l)},y("i",{class:"fa fa-plus"}))),y("button",{class:"button","on:click":()=>v()},"Save colors"),y("button",{class:"button","on:click":()=>h()},"Load colors"));function P(w="foreground"){n(w,{r,g:i,b:o,a:f},{r:a,g:s,b:u,a:l}),e.value=g(r,i,o)}t(N());function N(){return(w,R)=>{w!=null&&(r=w.r,i=w.g,o=w.b,f=w.a),R!=null&&(a=R.r,s=R.g,u=R.b,l=R.a),$&&$.$update()}}function M(w){r=w,$&&$.$update(),P()}function b(w){i=w,$&&$.$update(),P()}function k(w){o=w,$&&$.$update(),P()}function _(w){f=w,$&&$.$update(),P()}function A(w){r=w[0],i=w[1],o=w[2],$&&$.$update(),P()}function S(){var w=a;a=r,r=w,w=s,s=i,i=w,w=u,u=o,o=w,w=l,l=f,f=w,$&&$.$update(),P()}return P(),$.$onMounted(()=>{$.$update()}),$}const _e=[2,2,1,1,0,0],et=[1,0,1,0,1,0];function We(t){for(var n=t[0][0],e=t[0][0],r=t[0][1],i=t[0][1],o=1;o<t.length;o++){var f=t[o];f[0]<n&&(n=f[0]),f[0]>e&&(e=f[0]),f[1]<r&&(r=f[1]),f[1]>i&&(i=f[1])}return[n,r,e,i]}function nt(t){for(var n=t.voxels,e=t.faces,r=t.color,i={},o=0;o<e.length;o++)for(var f=0,a=0;a<e[o].length;a++){if(e[o][a]==0){f+=1;continue}var s=`${n[o][_e[f]]},${f}`;i[s]==null&&(i[s]={direction:f,relevant:_e[f],position:n[o][_e[f]]+et[f],data:[],colors:[]}),i[s].data.push(n[o].filter((K,Q)=>Q!=_e[f])),i[s].colors.push(r[o][f]),f+=1}for(var o in i)i[o].geometry=wn(i[o].data);var u=[],l=[],d=[],c=[],h=[],v=[],p=0,g=0,L=0,F=0,E=0,$=Object.values(i).map(K=>We(K.data)),P=$.reduce((K,Q)=>K+Q[2]-Q[0]+1,0),N=$.reduce((K,Q)=>Math.max(K,Q[3]-Q[1]+1),0),M=Math.ceil(Math.sqrt(P*N));for(var o in i){var b=i[o],k=!1;(b.direction==4||b.direction==5)&&(k=!0);var[_,A,S,w]=We(b.data);if(k){var R=w;g-=A}else{var R=S;g-=_}g>M&&(g=0,L+=N);for(var z in b.data){var C=b.colors[z],m=b.data[z];k?v.push({color:C,position:[m[1]+g,L+m[0]]}):v.push({color:C,position:[m[0]+g,L+m[1]]})}for(var z in b.geometry){for(var B=b.geometry[z],a=0;a<B.positions.length;a+=2){var D=[B.positions[a],B.positions[a+1]];D.splice(b.relevant,0,b.position),d.push(D),k?u.push([B.positions[a+1]+g,L-1+B.positions[a]+1]):u.push([B.positions[a]+g,L-1+B.positions[a+1]+1])}for(var a=0;a<B.indices.length;a+=3){h.push(b.direction+1);var I=[B.indices[a]+p,B.indices[a+1]+p,B.indices[a+2]+p];if(b.direction==1){var W=I[0];I[0]=I[1],I[1]=W}if(b.direction==2){var W=I[0];I[0]=I[2],I[2]=W}if(b.direction==5){var W=I[1];I[1]=I[2],I[2]=W}l.push(I.map(rn=>rn+1)),c.push(I)}p+=B.positions.length/2}g+=R+1,g>E&&(E=g),L>F&&(F=L)}F+=N,u=u.map(K=>[K[0]/E,K[1]/F]);for(var o in v)v[o].position=[v[o].position[0],F-1-v[o].position[1]];var[ae,z]=kn(c,d);return{vert:ae,index:z,normal:h,uv_position:u,uv_index:l,uv_color:v,width:E,height:F}}var be=1e3;function tn(t){const n=V(),e=y("div",{class:"modal-background","v-show":"visible"},y("div",{class:"modal-prompt"},y("span",{class:"close-button",ref:n,id:"close"},y("i",{class:"fa-solid fa-xmark"})),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]}));e.$style("z-index",{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>be++,elements:[typeof be<"u"?be:void 0]});function r(){be--,e.$remove()}return n.$on("click",r),e.$parent(document.body),{close:r}}var tt=`
vn -0.000000 0.000000 1.000000
vn 0.000000 0.000000 -1.000000
vn 0.000000 1.000000 0.000000
vn 0.000000 -1.000000 0.000000
vn 1.000000 0.000000 0.000000
vn -1.000000 -0.000000 -0.000000
`;function rt({vert:t,index:n,normal:e,uv_position:r,uv_index:i,uv_color:o,width:f,height:a}){for(var s="",u=0;u<t.length;u++)s+=`v ${t[u][0]} ${t[u][1]} ${t[u][2]}
`;s+=`
`;for(var u=0;u<r.length;u++)s+=`vt ${r[u][0]} ${r[u][1]}
`;s+=`
`,s+=tt,s+=`
`;for(var u=0;u<n.length;u++)s+=`f ${n[u][0]}/${i[u][0]}/${e[u]} ${n[u][1]}/${i[u][1]}/${e[u]} ${n[u][2]}/${i[u][2]}/${e[u]}
`;return s}function it({uv_color:t,width:n,height:e},r=32){var i=document.createElement("canvas");i.width=n*r,i.height=e*r;var o=i.getContext("2d");for(var f of t){var[a,s]=f.position,[u,l,d]=f.color;o.fillStyle=`rgb(${u*255},${l*255},${d*255})`,o.fillRect(a*r,s*r,r,r)}var c=i.toDataURL("image/png");return i.remove(),c}function ot({uv_color:t,width:n,height:e}){var r=document.createElement("canvas");r.width=n,r.height=e;for(var i=r.getContext("2d"),o=i.createImageData(n,e),f=0;f<o.width;f++)for(var a=0;a<o.height;a++){var s=(f+a*o.width)*4;o.data[s]=255,o.data[s+1]=1,o.data[s+2]=1,o.data[s+3]=1}for(var u of t){var[f,a]=u.position,[l,d,c]=u.color,s=(f+a*n)*4;o.data[s+0]=l*255,o.data[s+1]=d*255,o.data[s+2]=c*255,o.data[s+3]=255}i.putImageData(o,0,0);var h=r.toDataURL("image/png");return r.remove(),h}var se=null,me=null,ye=null,xe=null,ge=null,$e=null,we=null,ke=null,H=O;const Ie=[{name:"Pen"},{name:"Line"},{name:"Plane"},{name:"Horizontal line"},{name:"Vertical line"}],Be=[{name:"Sculpt"},{name:"Paint"}];var Y="Pen",q="Sculpt",ue=!0,Ee=!0,O=[1,0,0],J=[1,1,1];function Ne(t,n,e){O=[n.r/255,n.g/255,n.b/255,n.a/255],J=[e.r/255,e.g/255,e.b/255,e.a/255],t=="foreground"?H=O:H=J}var Re=null,Fe=null;function Je(t,n){var e=null;t!=null&&(e={r:t[0]*255,g:t[1]*255,b:t[2]*255,a:255});var r=null;n!=null&&(r={r:n[0]*255,g:n[1]*255,b:n[2]*255,a:255}),Re(e,r)}const oe=fe({radius:1}),G=V(),ft=V();var le=!0;const at=y("div",{class:"main"},y("div",{class:"info"},y("p",null,y("h3",null,"Mode"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>re(Be,t=>{q=t,H=O},"Sculpt"),elements:[typeof re<"u"?re:void 0,typeof Be<"u"?Be:void 0,typeof x<"u"?x:void 0,typeof q<"u"?q:void 0,typeof x<"u"?x:void 0,typeof H<"u"?H:void 0,typeof O<"u"?O:void 0]}),y("p",null,y("h3",null,"Color"),y(qn,{get:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:(t,n,e)=>Ne(t,n,e),elements:[typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0,typeof Ne<"u"?Ne:void 0,typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0]},set:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:t=>Re=t,elements:[typeof fn<"u"?fn:void 0,typeof Re<"u"?Re:void 0,typeof fn<"u"?fn:void 0]}}),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Fill all",()=>Fe()),elements:[typeof U<"u"?U:void 0,typeof Fe<"u"?Fe:void 0]})),y("canvas",{ref:G}),y("div",{class:"info"},y("p",null,"FPS: ",y("span",{ref:ft})),y("p",null,y("h3",null,"Tool"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>re(Ie,t=>Y=t,"Pen"),elements:[typeof re<"u"?re:void 0,typeof Ie<"u"?Ie:void 0,typeof x<"u"?x:void 0,typeof Y<"u"?Y:void 0,typeof x<"u"?x:void 0]}),y("p",null,y("h3",null,"Tool options"),y("label",null,"Radius"),y("div",{style:"width:300px"},y("input",{type:"number",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>oe.radius,elements:[typeof oe<"u"?oe:void 0,typeof radius<"u"?radius:void 0]},t=>oe.radius=t],class:"input"})),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>X("Contiguous",t=>ue=t),elements:[typeof X<"u"?X:void 0,typeof x<"u"?x:void 0,typeof ue<"u"?ue:void 0,typeof x<"u"?x:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>X("Circle",t=>le=t),elements:[typeof X<"u"?X:void 0,typeof x<"u"?x:void 0,typeof le<"u"?le:void 0,typeof x<"u"?x:void 0]}),y("p",null,y("h3",null,"View"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>X("Wireframe",t=>Ee=t),elements:[typeof X<"u"?X:void 0,typeof x<"u"?x:void 0,typeof Ee<"u"?Ee:void 0,typeof x<"u"?x:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Reset pan",()=>ge()),elements:[typeof U<"u"?U:void 0,typeof ge<"u"?ge:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Reset rotation",()=>$e()),elements:[typeof U<"u"?U:void 0,typeof $e<"u"?$e:void 0]}),y("p",null,y("h3",null,"Actions"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Subdivide",()=>se()),elements:[typeof U<"u"?U:void 0,typeof se<"u"?se:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Undo",()=>we()),elements:[typeof U<"u"?U:void 0,typeof we<"u"?we:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Redo",()=>ke()),elements:[typeof U<"u"?U:void 0,typeof ke<"u"?ke:void 0]}),y("p",null,y("h3",null,"Persistence"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Save project",()=>me()),elements:[typeof U<"u"?U:void 0,typeof me<"u"?me:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Load project",()=>ye()),elements:[typeof U<"u"?U:void 0,typeof ye<"u"?ye:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Export obj",()=>xe()),elements:[typeof U<"u"?U:void 0,typeof xe<"u"?xe:void 0]})));G.width=800;G.height=800;at.$parent(document.body);var T=new Hn;T.init();xe=()=>{var t=localStorage.getItem("save_obj_preferences"),n=!0,e=!0,r="object",i=1;t!=null&&(t=JSON.parse(t),n=t.texture,e=t.geometry,r=t.filename,i=t.square_size);var o=V(),f=y("div",{class:"prompt col"},y("div",{class:"row margin"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>X("Geometry",s=>e=s,e),elements:[typeof X<"u"?X:void 0,typeof x<"u"?x:void 0,typeof e<"u"?e:void 0,typeof x<"u"?x:void 0,typeof e<"u"?e:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>X("Texture",s=>n=s,n),elements:[typeof X<"u"?X:void 0,typeof x<"u"?x:void 0,typeof n<"u"?n:void 0,typeof x<"u"?x:void 0,typeof n<"u"?n:void 0]}),y("div",{class:"row margin"},y("div",null,y("label",null,"File name"),y("input",{type:"text",class:"input",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]},s=>r=s]})),y("div",null,y("label",null,"Texture voxel size"),y("input",{type:"number",class:"input",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]},s=>i=s]}))),y("button",{class:"footer-button button",ref:o},"Export")),{close:a}=tn(f);o.$on("click",()=>{var s=nt(T);if(n)if(i<=1){var u=ot(s);Ye(r+".png",u)}else{var u=it(s,i);Ye(r+".png",u)}if(e){var l=rt(s);Qn(r+".obj",l)}var d={filename:r,geometry:e,texture:n,square_size:i};localStorage.setItem("save_obj_preferences",JSON.stringify(d)),a()})};function Ce(t){const n=G.__element.getBoundingClientRect();var e=(t.clientX-n.left)*G.width/G.clientWidth,r=G.height-(t.clientY-n.top)*G.height/G.clientHeight-1;return[e,r]}function ze(t,n,e,r,i){var o,f,a,s;t==e?o=1:o=1/Math.abs(e-t),n==r?f=1:f=1/Math.abs(r-n);for(var u=Math.min(o,f)*i,l=0,d=[],c=a,h=s;l<=1;)c=t*(1-l)+e*l,h=n*(1-l)+r*l,d.push([c,h]),l+=u;return d}async function st(){var t=await fetch("./shader.vert").then(b=>b.text()),n=await fetch("./shader.frag").then(b=>b.text()),[e,r]=Gn(G.__element,t,n);r.antialias=!1,r.uniform_4_float.color_overlay=[0,0,0,1],me=()=>{var b=localStorage.getItem("save_obj_preferences"),k="";b!=null&&(b=JSON.parse(b),k=b.filename);const _=V();var A=y("div",{class:"prompt-small col"},y("div",{class:"row margin"},y("div",null,y("label",null,"File name"),y("input",{type:"text",class:"input",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>k,elements:[typeof k<"u"?k:void 0]},w=>k=w]}))),y("button",{class:"footer-button button",ref:_},"Export")),{close:S}=tn(A);_.$on("click",()=>{b.filename=k,localStorage.setItem("save_obj_preferences",JSON.stringify(b)),en(k+".vox",{voxels:T.voxels,color:T.color}),S()})},ye=async()=>{nn("vox",({voxels:b,color:k})=>{T.voxels=b,T.color=k,T.init();var[_,R]=T.boundary,A=_[0]-R[0],S=_[1]-R[1],w=_[2]-R[2],R=Math.abs(Math.max(A,S,w));N(-6),$(),P(),E(Math.max(R,1)),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes,c()})},Fe=()=>{for(var b=0;b<T.color.length;b++)for(var k=0;k<T.color[b].length;k++)for(var _=0;_<3;_++)T.color[b][k][_]=T.color[b][k][_]*(1-O[3])+O[_]*O[3];c()};var i=null,o=[],f=0,a=0,s=!1,u=!1,l=-1,d=[];c();function c(b=!1){d.length>30&&(d=d.slice(1),l--),d=d.slice(0,l+1),d.push(JSON.parse(JSON.stringify([T.voxels,T.color,T.faces,b]))),l=d.length-1}we=h,ke=v;function h(){if(l>0){const b=d[l][3];l--;const[k,_,A]=JSON.parse(JSON.stringify(d[l]));b&&E(.5),T.voxels=k,T.color=_,T.faces=A,T.init(),T.build(),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes}}function v(){if(l+1<d.length){l++;const[b,k,_,A]=d[l];A&&E(2),T.voxels=b,T.color=k,T.faces=_,T.build(),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes}}document.addEventListener("keydown",function(b){b.key=="Control"&&(u=!0),b.key=="z"&&b.ctrlKey&&h(),b.key=="y"&&b.ctrlKey&&v(),b.key=="x"&&b.ctrlKey&&se()}),document.addEventListener("keyup",function(b){b.key=="Control"&&(u=!1)});var p=!1;G.$on("mousedown",b=>{if(p=u,!u){if(b.offsetX,b.offsetY,b.button==1)b.preventDefault();else if(b.button==0||b.button==2&&Y=="Pen"){const[k,_]=Ce(b);f=k,a=_,s=!0,o=[[k,_]]}if(Y=="Line"){const[k,_]=Ce(b);f=k,a=_,s=!0}b.button==0?H=O:b.button==2&&(H=J)}}),G.$on("mousemove",b=>{if(!s)return;const[k,_]=Ce(b);Y=="Line"?o=[[f,a],...ze(k,_,f,a,5),[k,_]]:(o.push(...ze(k,_,f,a,5)),f=k,a=_)}),G.$on("contextmenu",b=>(b.preventDefault(),!1));var g=[];G.$on("mouseup",b=>{if(!(u||p)&&(g=[],o=[],s=!1,!!i)){if(Y=="Pen"||Y=="Line")if(q=="Sculpt"){if(b.button==0){var k=[];for(var _ of i)k.push(..._.voxel.map(w=>w.map((R,C)=>R+_.direction[C])));k=[...new Set(k.map(JSON.stringify))].map(JSON.parse),T.add(...k),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes}else if(b.button==2){var k=[];for(var _ of i)k.push(..._.voxel);T.remove(...k),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes}}else{if(b.button==0){H=O;for(var _ of i)for(var A=0;A<_.color.length;A++)for(var S=0;S<3;S++)_.color[A][S]=_.color[A][S]*(1-O[3])+O[S]*O[3]}else if(b.button==2){H=J;for(var _ of i)for(var A=0;A<_.color.length;A++)for(var S=0;S<3;S++)_.color[A][S]=_.color[A][S]*(1-J[3])+J[S]*J[3]}b.button==1&&(O=[...i[0].mouse_color,1],H=O,Je(O))}else if(q=="Sculpt")b.button==0?(T.add(...i.voxel.map(w=>w.map((R,C)=>R+i.direction[C]))),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes):b.button==2&&(T.remove(...i.voxel),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes);else if(b.button==0){H=O;for(var A=0;A<i.color.length;A++)for(var S=0;S<3;S++)i.color[A][S]=i.color[A][S]*(1-O[3])+O[S]*O[3]}else if(b.button==2){H=J;for(var A=0;A<i.color.length;A++)for(var S=0;S<3;S++)i.color[A][S]=i.color[A][S]*(1-J[3])+J[S]*J[3]}b.button==1&&(O=[...i.mouse_color,1],H=O,Je(O)),c()}});const{update:L,mouse:F,zoom:E,resetPan:$,resetRotation:P,setZoom:N}=zn(G,r,e);ge=$,$e=P,se=()=>{T.subdivide(),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes,E(2),c(!0)};function M(){e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.enable(e.CULL_FACE),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}Vn(b=>{L(),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes;var k=null;r.buffer(()=>{e.clearColor(0,0,0,0),r.uniform_float.disable_lighting=1,M(),r.attribute_matrix_4_float.color=T.pick_map,r.drawSolid(T.geometry_indexes),Y=="Pen"?s?(g.push(...o.map(_=>r.getPixel(_[0],_[1]))),o=[]):g=[r.getPixel(F.x,F.y)]:Y=="Line"?s?g=o.map(_=>r.getPixel(_[0],_[1])):g=[r.getPixel(F.x,F.y)]:k=r.getPixel(F.x,F.y)}),r.uniform_float.disable_lighting=0,e.clearColor(.5,.5,.5,.9),e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(1,1),M(),i=null,Y=="Pen"||Y=="Line"?q=="Sculpt"?r.attribute_matrix_4_float.color=T.get_highlight(g,_=>i=_,null,oe.radius,le):r.attribute_matrix_4_float.color=T.get_highlight(g,_=>i=_,H,oe.radius,le):q=="Sculpt"?r.attribute_matrix_4_float.color=T.highlight_plane(k,_=>i=_,Y,ue):r.attribute_matrix_4_float.color=T.highlight_plane(k,_=>i=_,Y,ue,H),r.drawSolid(T.geometry_indexes),e.disable(e.POLYGON_OFFSET_FILL),Ee&&(r.uniform_float.enable_color_overlay=1,r.drawLines(T.geometry_edge_index),r.uniform_float.enable_color_overlay=0)})}st();
