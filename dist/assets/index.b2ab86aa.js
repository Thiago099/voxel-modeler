(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function ue(i){const e=new Set;function t(o){e.add(o)}function n(o){e.delete(o)}const r={get(o,a){return a==="__subscribe"?t:a==="__unsubscribe"?n:typeof o[a]=="object"&&o[a]!==null&&!(o[a]instanceof HTMLElement)?new Proxy(o[a],r):o[a]},set(o,a,_){o[a]=_;for(const u of e)u.__update();return!0}};return new Proxy(i,r)}function _e(i){return he(new pe(i))}function he(i){function e(n,r){return typeof n[r]!="object"||n[r]!==null?n[r]:new Proxy(n[r],{set:(o,a,_)=>(t.__handleEffect(t.__isReactive(_),()=>{o[a]=t.__handleFunction(_)}),!0),get:(o,a)=>e(o,a)})}const t=new Proxy(i,{get:(n,r)=>{if(r in n)return n[r];if(r in n.__element)return e(n.__element,r)},set:(n,r,s)=>(r in n?n[r]=s:r=="style"?n.$set_style(s):r in n.__element&&n.$property(r,s),!0)});return t}class pe{constructor(e){if(typeof e=="string")this.__element=document.createElement(e);else if(e instanceof HTMLElement)this.__element=e;else throw new Error("Invalid element name");this.__events=[],this.__children=[],this.__states=new Set,this.__unmounted_events=[],this.__mounted_events=[],this.__parent=null}__update(){for(const e of this.__events)e()}$click(){return this.__element.click(),this}$find(e){var t=[];this.__element.matches(e)&&t.push(he(this));for(const n of this.__children)t=t.concat(n.$find(e));return t}$update(){for(const e of this.__events)e();for(const e of this.__children)e.$update()}__parseInput(e){if(e&&e.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"){for(const t of e.elements)t&&t.__subscribe&&(this.__states.add(t),t.__subscribe(this));return e.expression}return e}__observeParent(){setTimeout(()=>{for(const t of this.__mounted_events)t()},0),new MutationObserver(t=>{for(const n of t){if(n.type==="childList"&&n.removedNodes.length){for(const r of n.removedNodes)if(r===this.__element){this.__unsubscribe();for(const s of this.__unmounted_events)s()}}if(n.type==="childList"&&n.addedNodes.length){for(const r of n.addedNodes)if(r===this.__element){this.__subscribe();for(const s of this.__mounted_events)s()}}}}).observe(this.__element.parentElement,{childList:!0})}__subscribe(){if(this.__states)for(const e of this.__states)e.__subscribe(this)}__unsubscribe(){for(const e of this.__children)e.__unsubscribe();if(this.__states)for(const e of this.__states)e.__unsubscribe(this)}__handleFunction(e){return typeof e=="function"?e():e}__handleEffect(e,t){e?(t(),this.__events.push(t)):t()}__isReactive(...e){for(const t of e)if(typeof t=="function")return!0;return!1}$if(e){return e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{const t=this.__handleFunction(e);this.$style("display",t?"":"none")}),this}$class(e,t=!0){e=this.__parseInput(e),t=this.__parseInput(t);var n=null;return this.__handleEffect(this.__isReactive(e,t),()=>{const r=this.__handleFunction(e);if(r)if(typeof r=="object")for(const s in r)r[s]?this.__element.classList.add(s):this.__element.classList.remove(s);else this.__handleFunction(t)?(this.__isReactive(e)&&(n&&this.__element.classList.remove(...n.split(" ").filter(s=>s.length>0)),n=r),this.__element.classList.add(...r.split(" ").filter(s=>s.length>0))):(this.__element.classList.remove(...r.split(" ").filter(s=>s.length>0)),n=null)}),this}get parentElement(){return this.__parent}$parent(e){return this.__parent=e,e.__element!==void 0?(e.__element.appendChild(this.__element),e.__children.push(this)):e.appendChild(this.__element),this.__observeParent(),this}$parentBefore(e){return this.__parent=e,e.__element!==void 0?e.__element.firstChild?e.__element.insertBefore(this.__element,e.__element.firstChild):e.__element.appendChild(this.__element):e.firstChild?e.insertBefore(this.__element,e.firstChild):e.appendChild(this.__element),this.__observeParent(),this}$on(e,t){return this.__element.addEventListener(e,t),this}$mounted(e){this.__mounted_events.push(e)}$unmounted(e){this.__unmounted_events.push(e)}$property(e,t){return e=this.__parseInput(e),t=this.__parseInput(t),this.__handleEffect(this.__isReactive(e,t),()=>{this.__element[this.__handleFunction(e)]=this.__handleFunction(t)}),this}$style(e,t=null){return t?(this.__style(e,t),this):(e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{var n=this.__handleFunction(e);if(typeof n=="object")for(const r in n)this.__element.style[r]=n[r];else{const r=n.split(";").filter(s=>s.length>0);this.__element.style={};for(const s of r){const[o,a]=s.split(":");this.__element.style[o]=this.__handleFunction(a)}}}),this)}__style(e,t){return e=this.__parseInput(e),t=this.__parseInput(t),this.__handleEffect(this.__isReactive(e,t),()=>{this.__element.style[this.__handleFunction(e)]=this.__handleFunction(t)}),this}$get_computed_style(e){return window.getComputedStyle(this.__element).getPropertyValue(e)}$html(e){return e=this.__parseInput(e),this.__handleEffect(this.__isReactive(e),()=>{this.__element.innerHTML=this.__handleFunction(e)}),this}$child(e){e=this.__parseInput(e);var t;this.__isReactive(e)?t=_e("span").$parent(this):t=this;var n=null;return this.__handleEffect(this.__isReactive(e),()=>{var r=this.__handleFunction(e);n&&n();const s=a=>a==null?()=>{}:a.__element!==void 0?(a.$parent(t),()=>a.$remove()):(a instanceof HTMLElement||(a=document.createTextNode(a)),t.__element.appendChild(a),()=>a.remove());if(Array.isArray(r)){var o=[];for(const a of r)o.push(s(a));n=()=>{for(const a of o)a()}}else n=s(r)}),this}$remove(){return this.__parent=null,this.__element.remove(),this}$model([e,t]){return this.$property("value",e),this.$on("input",n=>t(n.target.value)),this}}const v=(i,e,...t)=>{var n,r=!1;if(typeof i=="function"){if(n=i(e,...t),n===void 0)return t;r=!0}else n=_e(i);const s={ref:a=>{a.__ref_object=n},style:a=>{n.$style(a)},class:a=>{n.$class(a)},parent:a=>{n.$parent(a)},if:a=>{n.$if(a)},model:([a,_])=>{n.$model([a,_])}},o={on:(a,_)=>{n.$on(a,_)}};if(e)for(const[a,_]of Object.entries(e)){const u=a.split(":");u.length==2?o[u[0]]&&o[u[0]](u[1],_):s[a]?s[a](_):r||n.$property(a,_)}if(t&&!r)for(const a of t)n.$child(a);return n};function ce(i=null){var e=i;return new Proxy({},{get:(n,r)=>{if(e!=null)return e[r]},set:(n,r,s)=>(r==="__ref_object"&&(e=s),s!=null&&(e[r]=s),!0)})}function me(i){return[(i>>0&255)/255,(i>>8&255)/255,(i>>16&255)/255,1]}function fe(i){return i[0]+(i[1]<<8)+(i[2]<<16)-1}const ve=[[0,0,1,0,0,1,0,0,1,0,0,1],[0,0,-1,0,0,-1,0,0,-1,0,0,-1],[0,1,0,0,1,0,0,1,0,0,1,0],[0,-1,0,0,-1,0,0,-1,0,0,-1,0],[1,0,0,1,0,0,1,0,0,1,0,0],[-1,0,0,-1,0,0,-1,0,0,-1,0,0]],be=[[-1,-1,1,1,-1,1,1,1,1,-1,1,1],[-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1],[-1,1,-1,-1,1,1,1,1,1,1,1,-1],[-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1],[1,-1,-1,1,1,-1,1,1,1,1,-1,1],[-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]],ye=[[0,1,2,0,2,3],[4,5,6,4,6,7],[8,9,10,8,10,11],[12,13,14,12,14,15],[16,17,18,16,18,19],[20,21,22,20,22,23]],xe=[[0,1,1,2,2,3,3,0],[4,5,5,6,6,7,7,4],[8,9,9,10,10,11,11,8],[12,13,13,14,14,15,15,12],[16,17,17,18,18,19,19,16],[20,21,21,22,22,23,23,20]],O=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],ge=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];function G(i,e){return i[0]+1==e[0]&&i[1]==e[1]&&i[2]==e[2]}function W(i,e){return i[0]-1==e[0]&&i[1]==e[1]&&i[2]==e[2]}function V(i,e){return i[1]+1==e[1]&&i[0]==e[0]&&i[2]==e[2]}function q(i,e){return i[1]-1==e[1]&&i[0]==e[0]&&i[2]==e[2]}function J(i,e){return i[2]+1==e[2]&&i[0]==e[0]&&i[1]==e[1]}function z(i,e){return i[2]-1==e[2]&&i[0]==e[0]&&i[1]==e[1]}const se=[[0,1,0,1,0,1],[0,1,0,1,1,0],[0,1,1,0,0,1],[0,1,1,0,1,0],[1,0,0,1,0,1],[1,0,0,1,1,0],[1,0,1,0,0,1],[1,0,1,0,1,0]];class Ee{constructor(){this.voxels=[[0,0,0]]}build_geometry(){for(var e=[],t=[],n=[],r=[],s=[],o=[],a=[],_=0,u=1,l=0;l<this.voxels.length;l++){for(var m=0,h=0,p=u-1,c=[],d=0;d<6;d++){if(this.faces[l][d]==0){h+=4;continue}n.push(...be[d].map((g,w)=>g+this.voxels[l][w%3]*2-this.center[w%3])),s.push(...ve[d]),a.push(...xe[d].map(g=>g+_-h)),r.push(...ye[d].map(g=>g+_-h)),o.push(...ge),m+=4;for(var L=me(u),T=0;T<4;T++)c.push(...L);u++}_+=m,t.push({start:p,end:u-1}),e.push(...c)}this.id=u,this.distance=_,this.geometry_vertexes=n,this.geometry_indexes=r,this.geometry_normals=s,this.geometry_color=o,this.geometry_edge_index=a,this.pick_map=e,this.pick_meta=t}init(){this.build_boundary(),this.build_center(),this.build_faces(),this.build_geometry()}add(...e){this.voxels.push(...e),this.build_boundary(),this.build_center(),this.rebuild_faces(e),this.build_geometry()}subdivide(){var e=[],t=[];for(const o in this.voxels){const a=this.voxels[o],_=this.faces[o],u=[a[0]*2,a[1]*2,a[2]*2];e.push([u[0],u[1],u[2]],[u[0]+1,u[1],u[2]],[u[0],u[1]+1,u[2]],[u[0]+1,u[1]+1,u[2]],[u[0],u[1],u[2]+1],[u[0]+1,u[1],u[2]+1],[u[0],u[1]+1,u[2]+1],[u[0]+1,u[1]+1,u[2]+1]);for(var n in se){var r=Array(6).fill(0);for(var s in se[n])se[n][s]==1&&_[s]==1&&(r[s]=1);t.push(r)}}this.voxels=e,this.faces=t,this.build_boundary(),this.build_center(),this.build_geometry()}remove(...e){for(const n of e){if(this.voxels.length==1){e.splice(e.indexOf(n),1);continue}for(var t=0;t<this.voxels.length;t++)if(this.voxels[t][0]==n[0]&&this.voxels[t][1]==n[1]&&this.voxels[t][2]==n[2]){this.voxels.splice(t,1),this.faces.splice(t,1);break}}this.build_boundary(),this.build_center(),this.rebuild_remove_faces(e),this.build_geometry()}get_plane_color(e,t){var n=[];for(const a in this.pick_meta){const _=this.faces[a];for(var r=0,s=0;s<_.length;s++){if(_[s]==0){r+=1;continue}if(e.includes(a))if(r==t)for(var o=0;o<4;o++)n.push(1,.6,.6,1);else for(var o=0;o<4;o++)n.push(1,.9,.9,1);else for(var o=0;o<4;o++)n.push(1,1,1,1);r+=1}}return n}get_plane(e,t){var n=[];for(const o in this.voxels){const a=this.voxels[o];var r=!0;for(const _ in t)if(t[_]!=0&&e[_]!=a[_]){r=!1;break}if(r){var s=this.voxels[o].map((_,u)=>_+t[u]);this.voxels.some(_=>_[0]==s[0]&&_[1]==s[1]&&_[2]==s[2])||n.push(o)}}return n}get_contiguous(e,t,n){var r=[];const s=this.voxels,o=new Set;function a(_){for(const h of e){const p=s[h];var u=!0;for(const c in n)if(n[c]!=0){if(_[c]!=p[c]){u=!1;break}}else if(Math.abs(_[c]-p[c])>1){u=!1;break}if(u){var l=s[h].map((c,d)=>c+n[d]),m=`${l[0]},${l[1]},${l[2]}`;o.has(m)||(o.add(m),r.push(h),a(s[h]))}}}return a(t),r}get_vertical_line(e,t,n){var r=[];for(const _ in this.voxels){const u=this.voxels[_];var s=!0,o=-1;for(const l in t)if(t[l]!=0&&(o=l,e[l]!=u[l])){s=!1;break}if(o==0){for(const l in t)if(t[l]==0&&e[l]!=u[l]&&l==2){s=!1;break}}else if(o==2){for(const l in t)if(t[l]==0&&e[l]!=u[l]&&l==0){s=!1;break}}else if(o==1){for(const l in t)if(t[l]==0&&e[l]!=u[l]&&l==0){s=!1;break}}else s=!1;if(s){var a=this.voxels[_].map((l,m)=>l+t[m]);this.voxels.some(l=>l[0]==a[0]&&l[1]==a[1]&&l[2]==a[2])||r.push(_)}}return r}get_horizontal_line(e,t,n){var r=[];for(const _ in this.voxels){const u=this.voxels[_];var s=!0,o=-1;for(const l in t)if(t[l]!=0){if(o=l,e[l]!=u[l]){s=!1;break}}else if(e[l]!=u[l]&&l==1){s=!1;break}if(o==1){for(const l in t)if(t[l]==0&&e[l]!=u[l]&&l==2){s=!1;break}}if(s){var a=this.voxels[_].map((l,m)=>l+t[m]);this.voxels.some(l=>l[0]==a[0]&&l[1]==a[1]&&l[2]==a[2])||r.push(_)}}return r}highlight_plane(e,t,n,r){var s=fe(e),o=[],a=0;for(const h in this.pick_meta){const p=this.faces[h],c=this.pick_meta[h];if(s>=c.start&&s<c.end)for(var _=0,u=0;u<p.length;u++){if(p[u]==0){_+=1;continue}if(s==a){var l;switch(n){case"Plane":l=this.get_plane(this.voxels[h],O[_]);break;case"Horizontal line":l=this.get_horizontal_line(this.voxels[h],O[_]);break;case"Vertical line":l=this.get_vertical_line(this.voxels[h],O[_]);break}return r&&(l=this.get_contiguous(l,this.voxels[h],O[_])),t({voxel:l.map(d=>this.voxels[d]),direction:O[_],index:h}),this.get_plane_color(l,_)}_+=1,a+=1}else for(var u=0;u<p.length;u++)if(p[u]!=0){for(var m=0;m<4;m++)o.push(1,1,1,1);a+=1}}return o}get_highlight(e,t){var n=fe(e),r=[],s=0;for(const u in this.pick_meta){const l=this.faces[u],m=this.pick_meta[u];if(n>=m.start&&n<m.end)for(var o=0,a=0;a<l.length;a++){if(l[a]==0){o+=1;continue}if(n==s){t({voxel:[this.voxels[u]],direction:O[o],index:u});for(var _=0;_<4;_++)r.push(1,.6,.6,1)}else for(var _=0;_<4;_++)r.push(1,.9,.9,1);o+=1,s+=1}else for(var a=0;a<l.length;a++)if(l[a]!=0){for(var _=0;_<4;_++)r.push(1,1,1,1);s+=1}}return r}rebuild_faces(e){const t=new Array(e.length).fill(0).map(s=>[1,1,1,1,1,1]);for(var n=0;n<e.length;n++)for(var r=0;r<this.faces.length;r++)G(e[n],this.voxels[r])&&(t[n][4]=0,this.faces[r][5]=0),W(e[n],this.voxels[r])&&(t[n][5]=0,this.faces[r][4]=0),V(e[n],this.voxels[r])&&(t[n][2]=0,this.faces[r][3]=0),q(e[n],this.voxels[r])&&(t[n][3]=0,this.faces[r][2]=0),J(e[n],this.voxels[r])&&(t[n][0]=0,this.faces[r][1]=0),z(e[n],this.voxels[r])&&(t[n][1]=0,this.faces[r][0]=0);for(var n=0;n<e.length;n++)for(var r=n+1;r<e.length;r++)G(e[n],e[r])&&(t[n][4]=0,t[r][5]=0),W(e[n],e[r])&&(t[n][5]=0,t[r][4]=0),V(e[n],e[r])&&(t[n][2]=0,t[r][3]=0),q(e[n],e[r])&&(t[n][3]=0,t[r][2]=0),J(e[n],e[r])&&(t[n][0]=0,t[r][1]=0),z(e[n],e[r])&&(t[n][1]=0,t[r][0]=0);this.faces.push(...t)}rebuild_remove_faces(e){for(var t=0;t<e.length;t++)for(var n=0;n<this.voxels.length;n++)G(e[t],this.voxels[n])&&(this.faces[n][5]=1),W(e[t],this.voxels[n])&&(this.faces[n][4]=1),V(e[t],this.voxels[n])&&(this.faces[n][3]=1),q(e[t],this.voxels[n])&&(this.faces[n][2]=1),J(e[t],this.voxels[n])&&(this.faces[n][1]=1),z(e[t],this.voxels[n])&&(this.faces[n][0]=1)}build_faces(){const e=this.voxels,t=new Array(e.length).fill(0).map(s=>[1,1,1,1,1,1]);for(var n=0;n<e.length;n++)for(var r=n+1;r<e.length;r++)G(e[n],e[r])&&(t[n][4]=0,t[r][5]=0),W(e[n],e[r])&&(t[n][5]=0,t[r][4]=0),V(e[n],e[r])&&(t[n][2]=0,t[r][3]=0),q(e[n],e[r])&&(t[n][3]=0,t[r][2]=0),J(e[n],e[r])&&(t[n][0]=0,t[r][1]=0),z(e[n],e[r])&&(t[n][1]=0,t[r][0]=0);this.faces=t}build_center(){const e=this.boundary;this.center=e[0].map((t,n)=>t+e[1][n])}build_boundary(){const e=this.voxels;for(var t=e[0],n=e[0],r=1;r<e.length;r++)t=t.map((s,o)=>Math.min(s,e[r][o])),n=n.map((s,o)=>Math.max(s,e[r][o]));this.boundary=[t,n]}}class Re{constructor(e,t,n){this.gl=e,this.program=t,this.canvas=n,this.attribute_matrix_4_mat_float=H((r,s)=>{var o=e.getUniformLocation(this.program,r);e.uniformMatrix4fv(o,!1,s)}),this.uniform_float=H((r,s)=>{var o=e.getUniformLocation(this.program,r);e.uniform1f(o,s)}),this.uniform_4_float=H((r,s)=>{var o=e.getUniformLocation(this.program,r);e.uniform4f(o,s[0],s[1],s[2],s[3])}),this.uniform_3_float=H((r,s)=>{var o=e.getUniformLocation(this.program,r);e.uniform3f(o,s[0],s[1],s[2])}),this.attribute_matrix_3_float=H((r,s)=>{var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array(s),e.STATIC_DRAW);var a=e.getAttribLocation(this.program,r);e.vertexAttribPointer(a,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a)}),this.attribute_matrix_4_float=H((r,s)=>{var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array(s),e.STATIC_DRAW);var a=e.getAttribLocation(this.program,r);e.vertexAttribPointer(a,4,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a)})}set face(e){this.faces=e}buffer(e){const t=this.gl,n=this.canvas,r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r);var s=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,s),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,s);const o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,o,0),e(),t.bindFramebuffer(t.FRAMEBUFFER,null),o}getPixel(e,t){const n=this.gl,r=new Uint8Array(4);return n.readPixels(e,t,1,1,n.RGBA,n.UNSIGNED_BYTE,r),r}drawSolid(e){const t=this.gl;if(!e){if(this.faces==null)throw"No faces defined";e=this.faces}var n=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),t.STATIC_DRAW),t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),t.drawElements(t.TRIANGLES,e.length,t.UNSIGNED_SHORT,0)}drawLines(e){const t=this.gl;if(!e){if(this.faces==null)throw"No faces defined";e=this.faces}var n=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),t.STATIC_DRAW),t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),t.drawElements(t.LINES,e.length,t.UNSIGNED_SHORT,0)}}function H(i){return new Proxy({},{set:function(e,t,n){return i(t,n),!0}})}function Fe(i,e,t){const n=i.getContext("webgl2",{antialias:!0}),r=n.createProgram(),s=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(s,t),n.compileShader(s),n.attachShader(r,s);const o=n.createShader(n.VERTEX_SHADER);return n.shaderSource(o,e),n.compileShader(o),n.attachShader(r,o),n.linkProgram(r),n.useProgram(r),[n,new Re(n,r,i)]}var le=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});function Ae(){var i=new le(16);return le!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function Te(i,e){if(i===e){var t=e[1],n=e[2],r=e[3],s=e[6],o=e[7],a=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=t,i[6]=e[9],i[7]=e[13],i[8]=n,i[9]=s,i[11]=e[14],i[12]=r,i[13]=o,i[14]=a}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i}function Le(i,e){var t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],_=e[6],u=e[7],l=e[8],m=e[9],h=e[10],p=e[11],c=e[12],d=e[13],L=e[14],T=e[15],g=t*a-n*o,w=t*_-r*o,P=t*u-s*o,N=n*_-r*a,R=n*u-s*a,D=r*u-s*_,B=l*d-m*c,$=l*L-h*c,I=l*T-p*c,k=m*L-h*d,M=m*T-p*d,U=h*T-p*L,f=g*U-w*M+P*k+N*I-R*$+D*B;return f?(f=1/f,i[0]=(a*U-_*M+u*k)*f,i[1]=(r*M-n*U-s*k)*f,i[2]=(d*D-L*R+T*N)*f,i[3]=(h*R-m*D-p*N)*f,i[4]=(_*I-o*U-u*$)*f,i[5]=(t*U-r*I+s*$)*f,i[6]=(L*P-c*D-T*w)*f,i[7]=(l*D-h*P+p*w)*f,i[8]=(o*M-a*I+u*B)*f,i[9]=(n*I-t*M-s*B)*f,i[10]=(c*R-d*P+T*g)*f,i[11]=(m*P-l*R-p*g)*f,i[12]=(a*$-o*k-_*B)*f,i[13]=(t*k-n*$+r*B)*f,i[14]=(d*w-c*N-L*g)*f,i[15]=(l*N-m*w+h*g)*f,i):null}function we(i,e,t,n){function r(f,F,y,E){var C=Math.tan(f*.5*Math.PI/180);return[.5/C,0,0,0,0,.5*F/C,0,0,0,0,-(E+y)/(E-y),-1,0,0,-2*E*y/(E-y),0]}var s=r(40,i.width/i.height,1,1e3),o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const _=Ae();Le(_,a),Te(_,_),t.viewport(0,0,i.width,i.height),e.attribute_matrix_4_mat_float.uNormalMatrix=_,a[14]=a[14]-6;var u=0,l=!1,m,h,p=0,c=0,d=null,L=function(f){return f.button==2?d="pan":d="rotate",l=!0,m=f.pageX,h=f.pageY,f.preventDefault(),!1},T=function(f){l=!1};const g={x:0,y:0};var w=function(f){const F=i.__element.getBoundingClientRect();if(g.x=(f.clientX-F.left)*t.canvas.width/t.canvas.clientWidth,g.y=t.canvas.height-(f.clientY-F.top)*t.canvas.height/t.canvas.clientHeight-1,!l)return!1;p=(f.pageX-m)*2*Math.PI/i.width,c=(f.pageY-h)*2*Math.PI/i.height,d=="rotate"?($+=p,I+=c):d=="pan"&&P(p,c),m=f.pageX,h=f.pageY,f.preventDefault()};function P(f,F){a[12]-=f*a[14]/2,a[13]+=F*a[14]/2}i.$on("mousedown",L),i.$on("mouseup",T),i.$on("mouseout",T),i.$on("mousemove",w);var N=function(f){f.preventDefault();var F=f.wheelDelta?f.wheelDelta/40:f.detail?-f.detail:0,y=1.3;return F&&R(F<0?1*y:1/y),f.preventDefault()&&!1};function R(f){a[14]*=f}i.$on("wheel",N);function D(f,F){var y=Math.cos(F),E=Math.sin(F),C=f[1],re=f[5],ie=f[9];f[1]=f[1]*y-f[2]*E,f[5]=f[5]*y-f[6]*E,f[9]=f[9]*y-f[10]*E,f[2]=f[2]*y+C*E,f[6]=f[6]*y+re*E,f[10]=f[10]*y+ie*E}function B(f,F){var y=Math.cos(F),E=Math.sin(F),C=f[0],re=f[4],ie=f[8];f[0]=y*f[0]+E*f[2],f[4]=y*f[4]+E*f[6],f[8]=y*f[8]+E*f[10],f[2]=y*f[2]-E*C,f[6]=y*f[6]-E*re,f[10]=y*f[10]-E*ie}var $=.8,I=.8;function k(){l||(p*=u,c*=u,$+=p,I+=c),o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,I=Math.max(-Math.PI/2,Math.min(Math.PI/2,I)),B(o,$),D(o,I),e.attribute_matrix_4_mat_float.projection_matrix=s,e.attribute_matrix_4_mat_float.view_matrix=a,e.attribute_matrix_4_mat_float.model_matrix=o}function M(){a[12]=0,a[13]=0}function U(){$=.8,I=.8}return{update:k,mouse:g,zoom:R,resetPan:M,resetRotation:U}}function Ie(i){var e=0;function t(n){n*=.001;const r=n-e;e=n;const s=1/r;i(s.toFixed(1)),requestAnimationFrame(t)}t()}function oe(i,e){var t=[];const n=ue({name:"Point"});for(const r of i){const s=v("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(n.name==r.name?" button-selected":""),elements:[typeof n<"u"?n:void 0,typeof name<"u"?name:void 0,typeof r<"u"?r:void 0,typeof name<"u"?name:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r.name,elements:[typeof r<"u"?r:void 0,typeof name<"u"?name:void 0]});s.$on("click",()=>{n.name=r.name,e(r.name)}),t.push(s)}return t}function Y(i,e){const t=ue({value:!0});var n=v("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(t.value?" button-selected":""),elements:[typeof t<"u"?t:void 0,typeof value<"u"?value:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]});return n.$on("click",()=>{t.value=!t.value,e(t.value)}),n}function A(i,e){var t=v("button",{class:"button"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]});return t.$on("click",()=>{e()}),t}var K=null,Q=null,Z=null,j=null,ee=null;const ae=[{name:"Point"},{name:"Plane"},{name:"Horizontal line"},{name:"Vertical line"}];var X="Point",te=!0,ne=!0;const S=ce(),de=ce(),$e=v("div",{class:"main"},v("div",{class:"tip-box"},v("h2",null,"Tips:"),v("p",null,v("h3",null," Camera: "),v("p",null,"\u25CF Left click and drag to rotate"),v("p",null,"\u25CF Right click and drag to pan"),v("p",null,"\u25CF Scroll to zoom")),v("p",null,v("h3",null," Object:"),v("p",null,"\u25CF Left click to add a voxels from the highlighted faces"),v("p",null,"\u25CF Right click to remove a voxel from the highlighted faces"))),v("canvas",{ref:S}),v("div",{class:"info"},v("p",null,"FPS: ",v("span",{ref:de})),v("p",null,v("h3",null,"Tool"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>oe(ae,i=>X=i),elements:[typeof oe<"u"?oe:void 0,typeof ae<"u"?ae:void 0,typeof x<"u"?x:void 0,typeof X<"u"?X:void 0,typeof x<"u"?x:void 0]}),v("p",null,v("h3",null,"Tool options"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>Y("Contiguous",i=>te=i),elements:[typeof Y<"u"?Y:void 0,typeof x<"u"?x:void 0,typeof te<"u"?te:void 0,typeof x<"u"?x:void 0]}),v("p",null,v("h3",null,"View"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>Y("Wireframe",i=>ne=i),elements:[typeof Y<"u"?Y:void 0,typeof x<"u"?x:void 0,typeof ne<"u"?ne:void 0,typeof x<"u"?x:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>A("Reset pan",()=>j()),elements:[typeof A<"u"?A:void 0,typeof j<"u"?j:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>A("Reset rotation",()=>ee()),elements:[typeof A<"u"?A:void 0,typeof ee<"u"?ee:void 0]}),v("p",null,v("h3",null,"Actions"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>A("Subdivide",()=>K()),elements:[typeof A<"u"?A:void 0,typeof K<"u"?K:void 0]}),v("p",null,v("h3",null,"Persistence"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>A("Save",()=>Q()),elements:[typeof A<"u"?A:void 0,typeof Q<"u"?Q:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>A("Load",()=>Z()),elements:[typeof A<"u"?A:void 0,typeof Z<"u"?Z:void 0]})));S.width=800;S.height=800;$e.$parent(document.body);var b=new Ee;b.init();async function Pe(){var i=await fetch("./shader.vert").then(h=>h.text()),e=await fetch("./shader.frag").then(h=>h.text()),[t,n]=Fe(S.__element,i,e);n.antialias=!1,n.uniform_4_float.color_overlay=[0,0,0,1],Q=()=>{var h=JSON.stringify(b.voxels),p=new Blob([h],{type:"application/json"}),c=URL.createObjectURL(p),d=document.createElement("a");d.download="voxel.json",d.href=c,d.textContent="Download",d.click(),d.remove()},Z=async()=>{var h=document.createElement("input");h.type="file",h.onchange=p=>{var c=p.target.files[0],d=new FileReader;d.onload=function(L){var T=L.target.result;b.voxels=JSON.parse(T),b.init();var[g,R]=b.boundary,w=g[0]-R[0],P=g[1]-R[1],N=g[2]-R[2],R=Math.abs(Math.max(w,P,N));console.log(R),_(R),n.attribute_matrix_3_float.normal=b.geometry_normals,n.attribute_matrix_3_float.position=b.geometry_vertexes},d.readAsText(c)},h.click(),h.remove()};var r=null,s=null;S.$on("mousedown",h=>{s=[h.offsetX,h.offsetY],h.button==1&&h.preventDefault()}),S.$on("contextmenu",h=>(h.preventDefault(),!1)),S.$on("mouseup",h=>{Math.abs(h.offsetX-s[0])>3||Math.abs(h.offsetY-s[1])>3||(h.button==0?(b.add(...r.voxel.map(p=>p.map((c,d)=>c+r.direction[d]))),n.attribute_matrix_3_float.normal=b.geometry_normals,n.attribute_matrix_3_float.position=b.geometry_vertexes):h.button==2&&(b.remove(...r.voxel),n.attribute_matrix_3_float.normal=b.geometry_normals,n.attribute_matrix_3_float.position=b.geometry_vertexes))});const{update:o,mouse:a,zoom:_,resetPan:u,resetRotation:l}=we(S,n,t);j=u,ee=l,K=()=>{b.subdivide(),n.attribute_matrix_3_float.normal=b.geometry_normals,n.attribute_matrix_3_float.position=b.geometry_vertexes,_(2)};function m(){t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.enable(t.CULL_FACE),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}Ie(h=>{de.$html({key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>h,elements:[typeof h<"u"?h:void 0]}),o(),n.attribute_matrix_3_float.normal=b.geometry_normals,n.attribute_matrix_3_float.position=b.geometry_vertexes;var p=null;n.buffer(()=>{t.clearColor(0,0,0,0),n.uniform_float.disable_lighting=1,m(),n.attribute_matrix_4_float.color=b.pick_map,n.drawSolid(b.geometry_indexes),p=n.getPixel(a.x,a.y)}),n.uniform_float.disable_lighting=0,t.clearColor(.5,.5,.5,.9),t.enable(t.POLYGON_OFFSET_FILL),t.polygonOffset(1,1),m(),r=null,X=="Point"?n.attribute_matrix_4_float.color=b.get_highlight(p,c=>r=c):n.attribute_matrix_4_float.color=b.highlight_plane(p,c=>r=c,X,te),n.drawSolid(b.geometry_indexes),t.disable(t.POLYGON_OFFSET_FILL),ne&&(n.uniform_float.enable_color_overlay=1,n.drawLines(b.geometry_edge_index),n.uniform_float.enable_color_overlay=0)})}Pe();
