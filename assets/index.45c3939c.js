(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const f of o.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();function de(t){const n=new Set;function e(f){n.add(f)}function r(f){n.delete(f)}const i={get(f,a){return a==="__subscribe"?e:a==="__unsubscribe"?r:typeof f[a]=="object"&&f[a]!==null&&!(f[a]instanceof HTMLElement)?new Proxy(f[a],i):f[a]},set(f,a,s){f[a]=s;for(const u of n)u.__update();return!0}};return new Proxy(t,i)}function Je(t){return ze(new tn(t))}function ze(t){function n(r,i){return typeof r[i]!="object"||r[i]!==null?r[i]:new Proxy(r[i],{set:(f,a,s)=>(e.__handleEffect(e.__isReactive(s),()=>{f[a]=e.__handleFunction(s)}),!0),get:(f,a)=>n(f,a)})}const e=new Proxy(t,{get:(r,i)=>{if(i in r)return r[i];if(i in r.__element)return n(r.__element,i)},set:(r,i,o)=>(i in r?r[i]=o:i=="style"?r.$set_style(o):i in r.__element&&r.$property(i,o),!0)});return e}class tn{constructor(n){if(typeof n=="string")this.__element=document.createElement(n);else if(n instanceof HTMLElement)this.__element=n;else throw new Error("Invalid element name");this.__events=[],this.__children=[],this.__states=new Set,this.__unmounted_events=[],this.__mounted_events=[],this.__parent=null}__update(){for(const n of this.__events)n()}$click(){return this.__element.click(),this}$find(n){var e=[];this.__element.matches(n)&&e.push(ze(this));for(const r of this.__children)e=e.concat(r.$find(n));return e}$update(){for(const n of this.__events)n();for(const n of this.__children)n.$update()}__parseInput(n){if(n&&n.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"){for(const e of n.elements)e&&e.__subscribe&&(this.__states.add(e),e.__subscribe(this));return n.expression}return n}__observeParent(){setTimeout(()=>{for(const e of this.__mounted_events)e()},0),new MutationObserver(e=>{for(const r of e){if(r.type==="childList"&&r.removedNodes.length){for(const i of r.removedNodes)if(i===this.__element){this.__unsubscribe();for(const o of this.__unmounted_events)o()}}if(r.type==="childList"&&r.addedNodes.length){for(const i of r.addedNodes)if(i===this.__element){this.__subscribe();for(const o of this.__mounted_events)o()}}}}).observe(this.__element.parentElement,{childList:!0})}__subscribe(){if(this.__states)for(const n of this.__states)n.__subscribe(this)}__unsubscribe(){for(const n of this.__children)n.__unsubscribe();if(this.__states)for(const n of this.__states)n.__unsubscribe(this)}__handleFunction(n){return typeof n=="function"?n():n}__handleEffect(n,e){n?(e(),this.__events.push(e)):e()}__isReactive(...n){for(const e of n)if(typeof e=="function")return!0;return!1}$if(n){return n=this.__parseInput(n),this.__handleEffect(this.__isReactive(n),()=>{const e=this.__handleFunction(n);this.$style("display",e?"":"none")}),this}$class(n,e=!0){n=this.__parseInput(n),e=this.__parseInput(e);var r=null;return this.__handleEffect(this.__isReactive(n,e),()=>{const i=this.__handleFunction(n);if(i)if(typeof i=="object")for(const o in i)i[o]?this.__element.classList.add(o):this.__element.classList.remove(o);else this.__handleFunction(e)?(this.__isReactive(n)&&(r&&this.__element.classList.remove(...r.split(" ").filter(o=>o.length>0)),r=i),this.__element.classList.add(...i.split(" ").filter(o=>o.length>0))):(this.__element.classList.remove(...i.split(" ").filter(o=>o.length>0)),r=null)}),this}get parentElement(){return this.__parent}$parent(n){return this.__parent=n,n.__element!==void 0?(n.__element.appendChild(this.__element),n.__children.push(this)):n.appendChild(this.__element),this.__observeParent(),this}$parentBefore(n){return this.__parent=n,n.__element!==void 0?n.__element.firstChild?n.__element.insertBefore(this.__element,n.__element.firstChild):n.__element.appendChild(this.__element):n.firstChild?n.insertBefore(this.__element,n.firstChild):n.appendChild(this.__element),this.__observeParent(),this}$on(n,e){return this.__element.addEventListener(n,e),this}__clean_input(n){return n&&n.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?n.expression:n}$onUpdate(n){return this.__events.push(n),this}$onMounted(n){this.__mounted_events.push(n)}$onUnmounted(n){this.__unmounted_events.push(n)}$property(n,e){return n=this.__parseInput(n),e=this.__parseInput(e),this.__handleEffect(this.__isReactive(n,e),()=>{this.__element[this.__handleFunction(n)]=this.__handleFunction(e)}),this}$style(n,e=null){return e?(this.__style(n,e),this):(n=this.__parseInput(n),this.__handleEffect(this.__isReactive(n),()=>{var r=this.__handleFunction(n);if(typeof r=="object")for(const i in r)this.__element.style[i]=r[i];else{const i=r.split(";").filter(o=>o.length>0);this.__element.style={};for(const o of i){const[f,a]=o.split(":");this.__element.style.setProperty(f,this.__handleFunction(a))}}}),this)}__style(n,e){return n=this.__parseInput(n),e=this.__parseInput(e),this.__handleEffect(this.__isReactive(n,e),()=>{this.__element.style[this.__handleFunction(n)]=this.__handleFunction(e)}),this}$get_computed_style(n){return window.getComputedStyle(this.__element).getPropertyValue(n)}$html(n){return n=this.__parseInput(n),this.__handleEffect(this.__isReactive(n),()=>{this.__element.innerHTML=this.__handleFunction(n)}),this}$child(n){n=this.__parseInput(n);var e;this.__isReactive(n)?e=Je("span").$parent(this):e=this;var r=null;return this.__handleEffect(this.__isReactive(n),()=>{var i=this.__handleFunction(n);r&&r();const o=a=>a==null?()=>{}:a.__element!==void 0?(a.$parent(e),()=>a.$remove()):(a instanceof HTMLElement||(a=document.createTextNode(a)),e.__element.appendChild(a),()=>a.remove());if(Array.isArray(i)){var f=[];for(const a of i)f.push(o(a));r=()=>{for(const a of f)a()}}else r=o(i)}),this}$remove(){return this.__parent=null,this.__element.remove(),this}$model([n,e]){return this.$property("value",n),this.$on("input",r=>e(r.target.value)),this}}function rn(t){return t&&t.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?t.expression:t}const g=(t,n,...e)=>{var r,i=!1;if(typeof t=="function"){var o={};if(n)for(const[s,u]of Object.entries(n))o[s]=rn(u);if(r=t(o,...e),r===void 0)return e;i=!0}else r=Je(t);const f={ref:s=>{s.__ref_object=r},style:s=>{r.$style(s)},class:s=>{r.$class(s)},parent:s=>{r.$parent(s)},if:s=>{r.$if(s)},model:([s,u])=>{r.$model([s,u])}},a={on:(s,u)=>{r.$on(s,u)}};if(n)for(const[s,u]of Object.entries(n)){const l=s.split(":");l.length==2?a[l[0]]&&a[l[0]](l[1],u):f[s]?f[s](u):i||r.$property(s,u)}if(e&&!i)for(const s of e)r.$child(s);return r};function W(t=null){var n=t;return new Proxy({},{get:(r,i)=>{if(n!=null)return n[i]},set:(r,i,o)=>(i==="__ref_object"&&(n=o),o!=null&&(n[i]=o),!0)})}var De={exports:{}};De.exports=Re;De.exports.default=Re;function Re(t,n,e){e=e||2;var r=n&&n.length,i=r?n[0]*e:t.length,o=Ve(t,0,i,e,!0),f=[];if(!o||o.next===o.prev)return f;var a,s,u,l,d,c,h;if(r&&(o=ln(t,n,o,e)),t.length>80*e){a=u=t[0],s=l=t[1];for(var v=e;v<i;v+=e)d=t[v],c=t[v+1],d<a&&(a=d),c<s&&(s=c),d>u&&(u=d),c>l&&(l=c);h=Math.max(u-a,l-s),h=h!==0?32767/h:0}return se(o,f,e,a,s,h,0),f}function Ve(t,n,e,r,i){var o,f;if(i===Ne(t,n,e,r)>0)for(o=n;o<e;o+=r)f=Ue(o,t[o],t[o+1],f);else for(o=e-r;o>=n;o-=r)f=Ue(o,t[o],t[o+1],f);return f&&Fe(f,f.next)&&(le(f),f=f.next),f}function ee(t,n){if(!t)return t;n||(n=t);var e=t,r;do if(r=!1,!e.steiner&&(Fe(e,e.next)||Z(e.prev,e,e.next)===0)){if(le(e),e=n=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==n);return n}function se(t,n,e,r,i,o,f){if(!!t){!f&&o&&pn(t,r,i,o);for(var a=t,s,u;t.prev!==t.next;){if(s=t.prev,u=t.next,o?an(t,r,i,o):on(t)){n.push(s.i/e|0),n.push(t.i/e|0),n.push(u.i/e|0),le(t),t=u.next,a=u.next;continue}if(t=u,t===a){f?f===1?(t=sn(ee(t),n,e),se(t,n,e,r,i,o,2)):f===2&&un(t,n,e,r,i,o):se(ee(t),n,e,r,i,o,1);break}}}}function on(t){var n=t.prev,e=t,r=t.next;if(Z(n,e,r)>=0)return!1;for(var i=n.x,o=e.x,f=r.x,a=n.y,s=e.y,u=r.y,l=i<o?i<f?i:f:o<f?o:f,d=a<s?a<u?a:u:s<u?s:u,c=i>o?i>f?i:f:o>f?o:f,h=a>s?a>u?a:u:s>u?s:u,v=r.next;v!==n;){if(v.x>=l&&v.x<=c&&v.y>=d&&v.y<=h&&ie(i,a,o,s,f,u,v.x,v.y)&&Z(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function an(t,n,e,r){var i=t.prev,o=t,f=t.next;if(Z(i,o,f)>=0)return!1;for(var a=i.x,s=o.x,u=f.x,l=i.y,d=o.y,c=f.y,h=a<s?a<u?a:u:s<u?s:u,v=l<d?l<c?l:c:d<c?d:c,p=a>s?a>u?a:u:s>u?s:u,b=l>d?l>c?l:c:d>c?d:c,A=Ie(h,v,n,e,r),R=Ie(p,b,n,e,r),F=t.prevZ,w=t.nextZ;F&&F.z>=A&&w&&w.z<=R;){if(F.x>=h&&F.x<=p&&F.y>=v&&F.y<=b&&F!==i&&F!==f&&ie(a,l,s,d,u,c,F.x,F.y)&&Z(F.prev,F,F.next)>=0||(F=F.prevZ,w.x>=h&&w.x<=p&&w.y>=v&&w.y<=b&&w!==i&&w!==f&&ie(a,l,s,d,u,c,w.x,w.y)&&Z(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;F&&F.z>=A;){if(F.x>=h&&F.x<=p&&F.y>=v&&F.y<=b&&F!==i&&F!==f&&ie(a,l,s,d,u,c,F.x,F.y)&&Z(F.prev,F,F.next)>=0)return!1;F=F.prevZ}for(;w&&w.z<=R;){if(w.x>=h&&w.x<=p&&w.y>=v&&w.y<=b&&w!==i&&w!==f&&ie(a,l,s,d,u,c,w.x,w.y)&&Z(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function sn(t,n,e){var r=t;do{var i=r.prev,o=r.next.next;!Fe(i,o)&&We(i,r,r.next,o)&&ue(i,o)&&ue(o,i)&&(n.push(i.i/e|0),n.push(r.i/e|0),n.push(o.i/e|0),le(r),le(r.next),r=t=o),r=r.next}while(r!==t);return ee(r)}function un(t,n,e,r,i,o){var f=t;do{for(var a=f.next.next;a!==f.prev;){if(f.i!==a.i&&bn(f,a)){var s=je(f,a);f=ee(f,f.next),s=ee(s,s.next),se(f,n,e,r,i,o,0),se(s,n,e,r,i,o,0);return}a=a.next}f=f.next}while(f!==t)}function ln(t,n,e,r){var i=[],o,f,a,s,u;for(o=0,f=n.length;o<f;o++)a=n[o]*r,s=o<f-1?n[o+1]*r:t.length,u=Ve(t,a,s,r,!1),u===u.next&&(u.steiner=!0),i.push(mn(u));for(i.sort(dn),o=0;o<i.length;o++)e=cn(i[o],e);return e}function dn(t,n){return t.x-n.x}function cn(t,n){var e=vn(t,n);if(!e)return n;var r=je(e,t);return ee(r,r.next),ee(e,e.next)}function vn(t,n){var e=n,r=t.x,i=t.y,o=-1/0,f;do{if(i<=e.y&&i>=e.next.y&&e.next.y!==e.y){var a=e.x+(i-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=r&&a>o&&(o=a,f=e.x<e.next.x?e:e.next,a===r))return f}e=e.next}while(e!==n);if(!f)return null;var s=f,u=f.x,l=f.y,d=1/0,c;e=f;do r>=e.x&&e.x>=u&&r!==e.x&&ie(i<l?r:o,i,u,l,i<l?o:r,i,e.x,e.y)&&(c=Math.abs(i-e.y)/(r-e.x),ue(e,t)&&(c<d||c===d&&(e.x>f.x||e.x===f.x&&hn(f,e)))&&(f=e,d=c)),e=e.next;while(e!==s);return f}function hn(t,n){return Z(t.prev,t,n.prev)<0&&Z(n.next,t,t.next)<0}function pn(t,n,e,r){var i=t;do i.z===0&&(i.z=Ie(i.x,i.y,n,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,_n(i)}function _n(t){var n,e,r,i,o,f,a,s,u=1;do{for(e=t,t=null,o=null,f=0;e;){for(f++,r=e,a=0,n=0;n<u&&(a++,r=r.nextZ,!!r);n++);for(s=u;a>0||s>0&&r;)a!==0&&(s===0||!r||e.z<=r.z)?(i=e,e=e.nextZ,a--):(i=r,r=r.nextZ,s--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;e=r}o.nextZ=null,u*=2}while(f>1);return t}function Ie(t,n,e,r,i){return t=(t-e)*i|0,n=(n-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,t|n<<1}function mn(t){var n=t,e=t;do(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),n=n.next;while(n!==t);return e}function ie(t,n,e,r,i,o,f,a){return(i-f)*(n-a)>=(t-f)*(o-a)&&(t-f)*(r-a)>=(e-f)*(n-a)&&(e-f)*(o-a)>=(i-f)*(r-a)}function bn(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!yn(t,n)&&(ue(t,n)&&ue(n,t)&&xn(t,n)&&(Z(t.prev,t,n.prev)||Z(t,n.prev,n))||Fe(t,n)&&Z(t.prev,t,t.next)>0&&Z(n.prev,n,n.next)>0)}function Z(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function Fe(t,n){return t.x===n.x&&t.y===n.y}function We(t,n,e,r){var i=ve(Z(t,n,e)),o=ve(Z(t,n,r)),f=ve(Z(e,r,t)),a=ve(Z(e,r,n));return!!(i!==o&&f!==a||i===0&&ce(t,e,n)||o===0&&ce(t,r,n)||f===0&&ce(e,t,r)||a===0&&ce(e,n,r))}function ce(t,n,e){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function ve(t){return t>0?1:t<0?-1:0}function yn(t,n){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&We(e,e.next,t,n))return!0;e=e.next}while(e!==t);return!1}function ue(t,n){return Z(t.prev,t,t.next)<0?Z(t,n,t.next)>=0&&Z(t,t.prev,n)>=0:Z(t,n,t.prev)<0||Z(t,t.next,n)<0}function xn(t,n){var e=t,r=!1,i=(t.x+n.x)/2,o=(t.y+n.y)/2;do e.y>o!=e.next.y>o&&e.next.y!==e.y&&i<(e.next.x-e.x)*(o-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==t);return r}function je(t,n){var e=new Be(t.i,t.x,t.y),r=new Be(n.i,n.x,n.y),i=t.next,o=n.prev;return t.next=n,n.prev=t,e.next=i,i.prev=e,r.next=e,e.prev=r,o.next=r,r.prev=o,r}function Ue(t,n,e,r){var i=new Be(t,n,e);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function le(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Be(t,n,e){this.i=t,this.x=n,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Re.deviation=function(t,n,e,r){var i=n&&n.length,o=i?n[0]*e:t.length,f=Math.abs(Ne(t,0,o,e));if(i)for(var a=0,s=n.length;a<s;a++){var u=n[a]*e,l=a<s-1?n[a+1]*e:t.length;f-=Math.abs(Ne(t,u,l,e))}var d=0;for(a=0;a<r.length;a+=3){var c=r[a]*e,h=r[a+1]*e,v=r[a+2]*e;d+=Math.abs((t[c]-t[v])*(t[h+1]-t[c+1])-(t[c]-t[h])*(t[v+1]-t[c+1]))}return f===0&&d===0?0:Math.abs((d-f)/f)};function Ne(t,n,e,r){for(var i=0,o=n,f=e-r;o<e;o+=r)i+=(t[f]-t[o])*(t[o+1]+t[f+1]),f=o;return i}Re.flatten=function(t){for(var n=t[0][0].length,e={vertices:[],holes:[],dimensions:n},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var f=0;f<n;f++)e.vertices.push(t[i][o][f]);i>0&&(r+=t[i-1].length,e.holes.push(r))}return e};function gn(t){const[n]=Ce(t),e=wn(t,n),[r]=Ce(e),i=kn(e,r,n),o=En(i,e,n),[f,a]=Rn(o,e);return Fn(o,e,f,a)}function $n(t,n){for(var e={},r=[],i=1,o=0;o<n.length;o++){var f=n[o].join(",");e[f]==null&&(e[f]=i,r.push(n[o]),i++)}for(var a of t)for(var s in a)a[s]=e[n[a[s]].join(",")];return[r,t]}function K(t){return t.join(",")}function Ce(t){for(var n={},e=0;e<t.length;e++){var r=K(t[e]);n[r]=e}function i(...o){var f=K(o);return n[f]}return[i]}function wn(t,n){for(var e=Array(t.length).fill(0).map(()=>Array(4).fill(1)),r=t[0][0],i=t[0][1],o=0;o<t.length;o++){t[o][0]<r&&(r=t[o][0]),t[o][1]<i&&(i=t[o][1]);var f=n(t[o][0]+1,t[o][1]),a=n(t[o][0],t[o][1]+1),s=n(t[o][0]-1,t[o][1]),u=n(t[o][0],t[o][1]-1);f!=null&&(e[o][1]=0,e[o][2]=0,e[f][0]=0,e[f][3]=0),a!=null&&(e[a][0]=0,e[a][1]=0,e[o][2]=0,e[o][3]=0),s!=null&&(e[s][1]=0,e[s][2]=0,e[o][0]=0,e[o][3]=0),u!=null&&(e[o][0]=0,e[o][1]=0,e[u][2]=0,e[u][3]=0)}var l={};for(var d in t)for(var c=t[d][0],h=t[d][1],o=0;o<4;o++){var v=c,p=h;o==1&&(v+=1),o==2&&(v+=1,p+=1),o==3&&(p+=1);var b=v+","+p;l[b]==null?l[b]={number:1,index:d,face_index:o}:l[b].number+=1}for(const[w,M]of Object.entries(l))M.number==3&&(e[M.index][M.face_index]=1);var A=[];for(var d in e){var c=t[d][0],h=t[d][1];for(var R in e[d])e[d][R]==1&&(R==0&&A.push([c,h]),R==1&&A.push([c+1,h]),R==2&&A.push([c+1,h+1]),R==3&&A.push([c,h+1]))}function F(w){for(var M=new Set,U=0;U<w.length;U++){var B=w[U].join(",");M.add(B)}return Array.from(M)}return F(A).map(w=>w.split(",").map(M=>parseInt(M)))}function kn(t,n,e){var r=t[0][0],i=t[0][1],o=t[0][0],f=t[0][1];for(var a in t)t[a][0]<r&&(r=t[a][0]),t[a][1]<i&&(i=t[a][1]),t[a][0]>o&&(o=t[a][0]),t[a][1]>f&&(f=t[a][1]);function s(c,h,v){var p=c,b=void 0;if(h=="x")if(v=="forward")do{p=[p[0]+1,p[1]];var b=n(p)}while(b==null&&p[0]<o);else do{p=[p[0]-1,p[1]];var b=n(p)}while(b==null&&p[0]>r);else if(v=="forward")do{p=[p[0],p[1]+1];var b=n(p)}while(b==null&&p[1]<f);else do{p=[p[0],p[1]-1];var b=n(p)}while(b==null&&p[1]>i);return b}var u=new Set;function l(c,h,v){var p=c,b=s(t[c],v,h);if(b!=null){if(p>b)var A=[b,p];else var A=[p,b];var R=t[A[0]],F=t[A[1]];d(R,F,v)&&u.add(K(A))}}function d(c,h,v){if(v=="x"){var p=c[1],b,A;if(c[0]>h[0]?(b=h[0],A=c[0]):(b=c[0],A=h[0]),e([b,p-1])==null){for(var R=b;R<A;R++)if(e([R,p-1])!=null||e([R,p])==null)return!1}else for(var R=b;R<A;R++)if(e([R,p-1])==null||e([R,p])!=null)return!1}else{var R=c[0],F,w;if(c[1]>h[1]?(F=h[1],w=c[1]):(F=c[1],w=h[1]),e([R-1,F])==null){for(var p=F;p<w;p++)if(e([R-1,p])!=null||e([R,p])==null)return!1}else for(var p=F;p<w;p++)if(e([R-1,p])==null||e([R,p])!=null)return!1}return!0}for(var a in t)l(a,"forward","x"),l(a,"forward","y"),l(a,"backward","x"),l(a,"backward","y");return Array.from(u).map(c=>c.split(",").map(h=>parseInt(h)))}function En(t,n,e){for(var r=new Array(n.length).fill(0).map(E=>[]),i=0;i<t.length;i++)r[t[i][0]].push(t[i][1]),r[t[i][1]].push(t[i][0]);function o(E,y){if(E[0]>y[0])var L=y,S=E;else var L=E,S=y;if(L[0]==S[0]||L[1]==S[1])return!1;if(S[1]>L[1])var $=L[0],k=S[0]-1,N=L[1],m=S[1]-1;else var $=L[0],k=S[0]-1,N=S[1],m=L[1]-1;for(var E=$;E<=k;E++){for(var I=!0,y=N;y<=m;y++)if(e([E,y])==null){I=!1;break}if(I)return!0}for(var y=N;y<=m;y++){for(var I=!0,E=$;E<=k;E++)if(e([E,y])==null){I=!1;break}if(I)return!0}return!1}var f=new Array(r.length).fill(0).map(E=>[]);for(var a in r){var s=r[a];if(s.length<=2){f[a]=[s];continue}for(var u=[],i=0;i<s.length;i++)for(var l=s[i],d=n[l],c=i+1;c<s.length;c++){var h=s[c];if(!(l==null||h==null)){var v=n[h];if(o(d,v)){var p=[l,h];u.push(p)}}}f[a]=u}function b(E,y){return f[E].findIndex(L=>L.includes(y))}var A=[],R=new Set,F=new Set;for(var a in f)for(var w in f[a]){let y=function(L){for(const k in f[L])if(!!B.has(`${L},${k}`)&&!F.has(`${L},${k}`)&&!U.has(`${L},${k}`)){B=new Set,U.add(`${L},${k}`),F.add(`${L},${k}`);var S=f[L][k];B.add(`${S[0]},${b(S[0],L)}`),B.add(`${S[1]},${b(S[1],L)}`),M.push(L);for(var $ of S)y($)}};var _=y;a=Number(a);var M=[],U=new Set;R.add(a),U.add(a);var B=new Set;B.add(`${a},${w}`),y(a),M.length!=0&&A.push(M)}return A}function Rn(t,n){function e(c,h){for(var v=!1,p=h[0],b=h[1],A=c.map(function(E){return E[0]}),R=0,F=A.length-1;R<A.length;F=R++){var w=A[R],M=c[R][1],U=A[F],B=c[F][1],_=M>b!=B>b&&p<(U-w)*(b-M)/(B-M)+w;if(_&&(v=!v),M===b&&w===p||B===b&&U===p){v=!0;break}}return v}for(var r=Array.from(t).fill(0).map(c=>[]),i=0;i<t.length;i++)for(var o=t[i].map(c=>n[c]),f=0;f<t.length;f++)i!=f&&t[f].every(c=>e(o,n[c]))&&r[i].push(f);for(var a=new Array(t.length).fill(!1),s=new Array(t.length).fill(0).map(c=>[]),i=0;i<r.length;i++)for(var f=0;f<r[i].length;f++)s[r[i][f]].push(i);for(var i=0;i<s.length;i++)for(var f=0;f<s[i].length;f++)r[s[i][f]]=r[s[i][f]].filter(v=>!r[i].includes(v));var u=new Array(t.length).fill(0).map((c,h)=>h);u.sort((c,h)=>r[c].includes(h)?-1:1);var l=new Set;for(const c of u)l.has(c)||d(c);function d(c,h=0){if(!l.has(c)){l.add(c);for(const v of r[c])d(v,h+1);h%2==1&&(r[c]=[],a[c]=!0)}}return[r,a]}function Fn(t,n,e,r){var i=[];for(var o in t)if(!r[o]){var f=0,a=[];for(var s of t[o])a.push(...n[s]),f+=1;var u=[];for(var s of e[o]){var l=[];u.push(f);for(var d of t[s])l.push(...n[d]),f+=1;a.push(...l)}var c=De.exports(a,u);i.push({positions:a,indices:c})}return i}function An(t){return[(t>>0&255)/255,(t>>8&255)/255,(t>>16&255)/255,1]}function Oe(t){return t[0]+(t[1]<<8)+(t[2]<<16)-1}const Ln=[[0,0,1,0,0,1,0,0,1,0,0,1],[0,0,-1,0,0,-1,0,0,-1,0,0,-1],[0,1,0,0,1,0,0,1,0,0,1,0],[0,-1,0,0,-1,0,0,-1,0,0,-1,0],[1,0,0,1,0,0,1,0,0,1,0,0],[-1,0,0,-1,0,0,-1,0,0,-1,0,0]],Tn=[[-1,-1,1,1,-1,1,1,1,1,-1,1,1],[-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1],[-1,1,-1,-1,1,1,1,1,1,1,1,-1],[-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1],[1,-1,-1,1,1,-1,1,1,1,1,-1,1],[-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]],Sn=[[0,1,2,0,2,3],[4,5,6,4,6,7],[8,9,10,8,10,11],[12,13,14,12,14,15],[16,17,18,16,18,19],[20,21,22,20,22,23]],Pn=[[0,1,1,2,2,3,3,0],[4,5,5,6,6,7,7,4],[8,9,9,10,10,11,11,8],[12,13,13,14,14,15,15,12],[16,17,17,18,18,19,19,16],[20,21,21,22,22,23,23,20]],ne=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],Mn=[1,1,1];function In(t,n){var e=K([t[0]+1,t[1],t[2]]);return n(e)}function Bn(t,n){var e=K([t[0]-1,t[1],t[2]]);return n(e)}function Nn(t,n){var e=K([t[0],t[1]+1,t[2]]);return n(e)}function Cn(t,n){var e=K([t[0],t[1]-1,t[2]]);return n(e)}function Dn(t,n){var e=K([t[0],t[1],t[2]+1]);return n(e)}function Un(t,n){var e=K([t[0],t[1],t[2]-1]);return n(e)}const Ae=[[0,1,0,1,0,1],[0,1,0,1,1,0],[0,1,1,0,0,1],[0,1,1,0,1,0],[1,0,0,1,0,1],[1,0,0,1,1,0],[1,0,1,0,0,1],[1,0,1,0,1,0]];class On{constructor(){this.voxels=[[0,0,0]],this.color=[],this.init_colors(this.voxels)}init_colors(n){for(var e=[],r=0;r<n.length;r++){var i=[];e.push(i);for(var o=0;o<6;o++)i.push([...Mn])}this.color.push(...e)}build_geometry(){for(var n=[],e=[],r=[],i=[],o=[],f=[],a=0,s=1,u=0;u<this.voxels.length;u++){for(var l=0,d=0,c=s-1,h=[],v=0;v<6;v++){if(this.faces[u][v]==0){d+=4;continue}r.push(...Tn[v].map((A,R)=>A+this.voxels[u][R%3]*2-this.center[R%3])),o.push(...Ln[v]),f.push(...Pn[v].map(A=>A+a-d)),i.push(...Sn[v].map(A=>A+a-d)),l+=4;for(var p=An(s),b=0;b<4;b++)h.push(...p);s++}a+=l,e.push({start:c,end:s-1}),n.push(...h)}this.id=s,this.distance=a,this.geometry_vertexes=r,this.geometry_indexes=i,this.geometry_normals=o,this.geometry_edge_index=f,this.pick_map=n,this.pick_meta=e}init(){this.build_boundary(),this.build_center(),this.build_faces(),this.build_geometry()}build(){this.build_boundary(),this.build_center(),this.build_geometry()}add(...n){this.voxels.push(...n),this.init_colors(n),this.init()}subdivide(){var n=[],e=[],r=[];for(const s in this.voxels){const u=this.voxels[s],l=this.faces[s],d=[u[0]*2,u[1]*2,u[2]*2];for(var i=0;i<8;i++){var o=[];r.push(o);for(var f=0;f<6;f++)o.push([...this.color[s][f]])}n.push([d[0],d[1],d[2]],[d[0]+1,d[1],d[2]],[d[0],d[1]+1,d[2]],[d[0]+1,d[1]+1,d[2]],[d[0],d[1],d[2]+1],[d[0]+1,d[1],d[2]+1],[d[0],d[1]+1,d[2]+1],[d[0]+1,d[1]+1,d[2]+1]);for(var f in Ae){var a=Array(6).fill(0);for(var i in Ae[f])Ae[f][i]==1&&l[i]==1&&(a[i]=1);e.push(a)}}this.voxels=n,this.faces=e,this.color=r,this.build_boundary(),this.build_center(),this.build_geometry()}remove(...n){for(const r of n){if(this.voxels.length==1){n.splice(n.indexOf(r),1);continue}for(var e=0;e<this.voxels.length;e++)if(this.voxels[e][0]==r[0]&&this.voxels[e][1]==r[1]&&this.voxels[e][2]==r[2]){this.voxels.splice(e,1),this.faces.splice(e,1),this.color.splice(e,1);break}}this.init()}get_plane_color(n,e,r=null){var i=[];for(const l in this.pick_meta){const d=this.faces[l];for(var o=0,f=0;f<d.length;f++){if(d[f]==0){o+=1;continue}if(n.includes(l)){if(r!=null)var a=this.color[l][f];else var a=this.color[l][f];if(o==e){if(r!=null)var s=this.color[l][f].map((c,h)=>c*(1-r[3])+r[h]*r[3]);else var s=this.color[l][f].map(h=>Math.abs(1-h*.5));for(var u=0;u<4;u++)i.push(...s,1)}else for(var u=0;u<4;u++)i.push(...a,1)}else for(var u=0;u<4;u++)i.push(...this.color[l][f],1);o+=1}}return i}get_plane(n,e){var r=[];for(const f in this.voxels){const a=this.voxels[f];var i=!0;for(const s in e)if(e[s]!=0&&n[s]!=a[s]){i=!1;break}if(i){var o=this.voxels[f].map((s,u)=>s+e[u]);this.voxels.some(s=>s[0]==o[0]&&s[1]==o[1]&&s[2]==o[2])||r.push(f)}}return r}get_contiguous(n,e,r){var i=[];const o=this.voxels,f=new Set;function a(s){for(const c of n){const h=o[c];var u=!0;for(const v in r)if(r[v]!=0){if(s[v]!=h[v]){u=!1;break}}else if(Math.abs(s[v]-h[v])>1){u=!1;break}if(u){var l=o[c].map((v,p)=>v+r[p]),d=`${l[0]},${l[1]},${l[2]}`;f.has(d)||(f.add(d),i.push(c),a(o[c]))}}}return a(e),i}get_vertical_line(n,e,r){var i=[];for(const s in this.voxels){const u=this.voxels[s];var o=!0,f=-1;for(const l in e)if(e[l]!=0&&(f=l,n[l]!=u[l])){o=!1;break}if(f==0){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==2){o=!1;break}}else if(f==2){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==0){o=!1;break}}else if(f==1){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==0){o=!1;break}}else o=!1;if(o){var a=this.voxels[s].map((l,d)=>l+e[d]);this.voxels.some(l=>l[0]==a[0]&&l[1]==a[1]&&l[2]==a[2])||i.push(s)}}return i}get_horizontal_line(n,e,r){var i=[];for(const s in this.voxels){const u=this.voxels[s];var o=!0,f=-1;for(const l in e)if(e[l]!=0){if(f=l,n[l]!=u[l]){o=!1;break}}else if(n[l]!=u[l]&&l==1){o=!1;break}if(f==1){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==2){o=!1;break}}if(o){var a=this.voxels[s].map((l,d)=>l+e[d]);this.voxels.some(l=>l[0]==a[0]&&l[1]==a[1]&&l[2]==a[2])||i.push(s)}}return i}highlight_plane(n,e,r,i,o=null){var f=Oe(n),c=[],a=0;for(const v in this.pick_meta){const p=this.faces[v],b=this.pick_meta[v];if(f>=b.start&&f<b.end)for(var s=0,u=0;u<p.length;u++){if(p[u]==0){s+=1;continue}if(f==a){var l;switch(r){case"Plane":l=this.get_plane(this.voxels[v],ne[s]);break;case"Horizontal line":l=this.get_horizontal_line(this.voxels[v],ne[s]);break;case"Vertical line":l=this.get_vertical_line(this.voxels[v],ne[s]);break}i&&(l=this.get_contiguous(l,this.voxels[v],ne[s]));var d=[];for(const A of l)d.push(this.color[A][s]);return e({voxel:l.map(A=>this.voxels[A]),direction:ne[s],color:d,mouse_color:this.color[v][u],index:v}),this.get_plane_color(l,s,o)}s+=1,a+=1}else for(var u=0;u<p.length;u++)p[u]!=0&&(a+=1)}var c=[];for(const v in this.pick_meta){const p=this.faces[v];for(var u=0;u<p.length;u++)if(p[u]!=0)for(var h=0;h<4;h++)c.push(...this.color[v][u],1)}return c}get_highlight(n,e,r=null){var i=new Set(n.map(v=>Oe(v))),o=Array.from(i),f=[],a=[],s=0;for(const v in this.pick_meta){const p=this.faces[v],b=this.pick_meta[v];if(o.some(A=>A>=b.start&&A<b.end))for(var u=0,l=0;l<p.length;l++){if(p[l]==0){u+=1;continue}if(r!=null)var d=this.color[v][l];else var d=this.color[v][l];if(i.has(s)){if(r!=null)var c=this.color[v][l].map((A,R)=>A*(1-r[3])+r[R]*r[3]);else var c=this.color[v][l].map(R=>Math.abs(1-R*.5));a.push({voxel:[this.voxels[v]],direction:ne[u],color:[this.color[v][l]],mouse_color:this.color[v][l],index:v});for(var h=0;h<4;h++)f.push(...c,1)}else for(var h=0;h<4;h++)f.push(...d,1);u+=1,s+=1}else for(var l=0;l<p.length;l++)if(p[l]!=0){for(var h=0;h<4;h++)f.push(...this.color[v][l],1);s+=1}}return e(a),f}build_faces(){const n=this.voxels,e=new Array(n.length).fill(0).map(d=>[1,1,1,1,1,1]),[r]=Ce(this.voxels);for(var i=0;i<n.length;i++){var o=In(n[i],r);o&&(e[i][4]=0,e[o][5]=0);var f=Bn(n[i],r);f&&(e[i][5]=0,e[f][4]=0);var a=Nn(n[i],r);a&&(e[i][2]=0,e[a][3]=0);var s=Cn(n[i],r);s&&(e[i][3]=0,e[s][2]=0);var u=Dn(n[i],r);u&&(e[i][0]=0,e[u][1]=0);var l=Un(n[i],r);l&&(e[i][1]=0,e[l][0]=0)}this.faces=e}build_center(){const n=this.boundary;this.center=n[0].map((e,r)=>e+n[1][r])}build_boundary(){const n=this.voxels;for(var e=n[0],r=n[0],i=1;i<n.length;i++)e=e.map((o,f)=>Math.min(o,n[i][f])),r=r.map((o,f)=>Math.max(o,n[i][f]));this.boundary=[e,r]}}class Zn{constructor(n,e,r){this.gl=n,this.program=e,this.canvas=r,this.attribute_matrix_4_mat_float=te((i,o)=>{var f=n.getUniformLocation(this.program,i);n.uniformMatrix4fv(f,!1,o)}),this.uniform_float=te((i,o)=>{var f=n.getUniformLocation(this.program,i);n.uniform1f(f,o)}),this.uniform_4_float=te((i,o)=>{var f=n.getUniformLocation(this.program,i);n.uniform4f(f,o[0],o[1],o[2],o[3])}),this.uniform_3_float=te((i,o)=>{var f=n.getUniformLocation(this.program,i);n.uniform3f(f,o[0],o[1],o[2])}),this.attribute_matrix_3_float=te((i,o)=>{var f=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,f),n.bufferData(n.ARRAY_BUFFER,new Float32Array(o),n.STATIC_DRAW);var a=n.getAttribLocation(this.program,i);n.vertexAttribPointer(a,3,n.FLOAT,!1,0,0),n.enableVertexAttribArray(a)}),this.attribute_matrix_4_float=te((i,o)=>{var f=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,f),n.bufferData(n.ARRAY_BUFFER,new Float32Array(o),n.STATIC_DRAW);var a=n.getAttribLocation(this.program,i);n.vertexAttribPointer(a,4,n.FLOAT,!1,0,0),n.enableVertexAttribArray(a)})}set face(n){this.faces=n}buffer(n){const e=this.gl,r=this.canvas,i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i);var o=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,o),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,o);const f=e.createTexture();return e.bindTexture(e.TEXTURE_2D,f),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,f,0),n(),e.bindFramebuffer(e.FRAMEBUFFER,null),f}getPixel(n,e){const r=this.gl,i=new Uint8Array(4);return r.readPixels(n,e,1,1,r.RGBA,r.UNSIGNED_BYTE,i),i}drawSolid(n){const e=this.gl;if(!n){if(this.faces==null)throw"No faces defined";n=this.faces}var r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),e.STATIC_DRAW),e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),e.drawElements(e.TRIANGLES,n.length,e.UNSIGNED_SHORT,0)}drawLines(n){const e=this.gl;if(!n){if(this.faces==null)throw"No faces defined";n=this.faces}var r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),e.STATIC_DRAW),e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),e.drawElements(e.LINES,n.length,e.UNSIGNED_SHORT,0)}}function te(t){return new Proxy({},{set:function(n,e,r){return t(e,r),!0}})}function Hn(t,n,e){const r=t.getContext("webgl2",{antialias:!0}),i=r.createProgram(),o=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(o,e),r.compileShader(o),r.attachShader(i,o);const f=r.createShader(r.VERTEX_SHADER);return r.shaderSource(f,n),r.compileShader(f),r.attachShader(i,f),r.linkProgram(i),r.useProgram(i),[r,new Zn(r,i,t)]}var Ze=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)});function Xn(){var t=new Ze(16);return Ze!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Gn(t,n){if(t===n){var e=n[1],r=n[2],i=n[3],o=n[6],f=n[7],a=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=e,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=o,t[11]=n[14],t[12]=i,t[13]=f,t[14]=a}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t}function Yn(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],f=n[4],a=n[5],s=n[6],u=n[7],l=n[8],d=n[9],c=n[10],h=n[11],v=n[12],p=n[13],b=n[14],A=n[15],R=e*a-r*f,F=e*s-i*f,w=e*u-o*f,M=r*s-i*a,U=r*u-o*a,B=i*u-o*s,_=l*p-d*v,E=l*b-c*v,y=l*A-h*v,L=d*b-c*p,S=d*A-h*p,$=c*A-h*b,k=R*$-F*S+w*L+M*y-U*E+B*_;return k?(k=1/k,t[0]=(a*$-s*S+u*L)*k,t[1]=(i*S-r*$-o*L)*k,t[2]=(p*B-b*U+A*M)*k,t[3]=(c*U-d*B-h*M)*k,t[4]=(s*y-f*$-u*E)*k,t[5]=(e*$-i*y+o*E)*k,t[6]=(b*w-v*B-A*F)*k,t[7]=(l*B-c*w+h*F)*k,t[8]=(f*S-a*y+u*_)*k,t[9]=(r*y-e*S-o*_)*k,t[10]=(v*U-p*w+A*R)*k,t[11]=(d*w-l*U-h*R)*k,t[12]=(a*E-f*L-s*_)*k,t[13]=(e*L-r*E+i*_)*k,t[14]=(p*F-v*M-b*R)*k,t[15]=(l*M-d*F+c*R)*k,t):null}function Jn(t,n,e,r){function i(m,I,C,P){var Y=Math.tan(m*.5*Math.PI/180);return[.5/Y,0,0,0,0,.5*I/Y,0,0,0,0,-(P+C)/(P-C),-1,0,0,-2*P*C/(P-C),0]}var o=i(40,t.width/t.height,1,1e3),f=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const s=Xn();Yn(s,a),Gn(s,s),e.viewport(0,0,t.width,t.height),n.attribute_matrix_4_mat_float.uNormalMatrix=s,a[14]=a[14]-6;var u=0,l=!1,d,c,h=0,v=0,p=null,b=!1;document.addEventListener("keydown",function(m){m.key=="Control"&&(b=!0)}),document.addEventListener("keyup",function(m){m.key=="Control"&&(b=!1)});var A=function(m){if(!!b)return m.button==2?p="pan":p="rotate",l=!0,d=m.pageX,c=m.pageY,m.preventDefault(),!1},R=function(m){l=!1};const F={x:0,y:0};var w=function(m){const I=t.__element.getBoundingClientRect();if(F.x=(m.clientX-I.left)*e.canvas.width/e.canvas.clientWidth,F.y=e.canvas.height-(m.clientY-I.top)*e.canvas.height/e.canvas.clientHeight-1,!l)return!1;h=(m.pageX-d)*2*Math.PI/t.width,v=(m.pageY-c)*2*Math.PI/t.height,p=="rotate"?(y+=h,L+=v):p=="pan"&&M(h,v),d=m.pageX,c=m.pageY,m.preventDefault()};function M(m,I){a[12]-=m*a[14]/2,a[13]+=I*a[14]/2}t.$on("mousedown",A),t.$on("mouseup",R),t.$on("mouseout",R),t.$on("mousemove",w);var U=function(m){m.preventDefault();var I=m.wheelDelta?m.wheelDelta/40:m.detail?-m.detail:0,C=1.3;return I&&B(I<0?1*C:1/C),m.preventDefault()&&!1};function B(m){a[14]*=m}t.$on("wheel",U);function _(m,I){var C=Math.cos(I),P=Math.sin(I),Y=m[1],oe=m[5],V=m[9];m[1]=m[1]*C-m[2]*P,m[5]=m[5]*C-m[6]*P,m[9]=m[9]*C-m[10]*P,m[2]=m[2]*C+Y*P,m[6]=m[6]*C+oe*P,m[10]=m[10]*C+V*P}function E(m,I){var C=Math.cos(I),P=Math.sin(I),Y=m[0],oe=m[4],V=m[8];m[0]=C*m[0]+P*m[2],m[4]=C*m[4]+P*m[6],m[8]=C*m[8]+P*m[10],m[2]=C*m[2]-P*Y,m[6]=C*m[6]-P*oe,m[10]=C*m[10]-P*V}var y=.8,L=.8;function S(){l||(h*=u,v*=u,y+=h,L+=v),f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,L=Math.max(-Math.PI/2,Math.min(Math.PI/2,L)),E(f,y),_(f,L),n.attribute_matrix_4_mat_float.projection_matrix=o,n.attribute_matrix_4_mat_float.view_matrix=a,n.attribute_matrix_4_mat_float.model_matrix=f}function $(){a[12]=0,a[13]=0}function k(){y=.8,L=.8}function N(m){a[14]=m}return{update:S,mouse:F,zoom:B,resetPan:$,resetRotation:k,setZoom:N}}function zn(t){var n=0;function e(r){r*=.001;const i=r-n;n=r;const o=1/i;t(o.toFixed(1)),requestAnimationFrame(e)}e()}function re(t,n,e){var r=[];const i=de({name:e});for(const o of t){const f=g("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(i.name==o.name?" button-selected":""),elements:[typeof i<"u"?i:void 0,typeof name<"u"?name:void 0,typeof o<"u"?o:void 0,typeof name<"u"?name:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>o.name,elements:[typeof o<"u"?o:void 0,typeof name<"u"?name:void 0]});f.$on("click",()=>{i.name=o.name,n(o.name)}),r.push(f)}return r}function J(t,n,e=!0){const r=de({value:e});var i=g("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(r.value?" button-selected":""),elements:[typeof r<"u"?r:void 0,typeof value<"u"?value:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]});return i.$on("click",()=>{r.value=!r.value,n(r.value)}),i}function D(t,n){var e=g("button",{class:"button"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]});return e.$on("click",()=>{n()}),e}function Vn({callback:t,start:n,color:e}){t||(t=u=>{});const r=de({absolute_value:0,relative_value:0});var i=W(),o=g("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--accent-color:${e()};`,elements:[typeof e<"u"?e:void 0]}},g("div",{class:"trackbar-background"}),g("div",{class:"trackbar-foreground"}),g("div",{class:"trackbar-thumb",ref:i,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${r.absolute_value}px`,elements:[typeof r<"u"?r:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));o.$onUpdate(()=>{var u=o.__element.getBoundingClientRect();r.relative_value=n(),r.absolute_value=u.width*n()/255});var f=!1,a;function s(u){var l=u-a,d=o.__element.getBoundingClientRect();l<0&&(l=0),l>d.width&&(l=d.width),r.absolute_value=l,r.relative_value=r.absolute_value/d.width*255,t(r.relative_value)}return document.addEventListener("mousemove",u=>{f&&s(u.clientX)}),i.$on("mousedown",u=>{u.stopPropagation(),f=!0,a=u.clientX-r.absolute_value}),o.$on("mousedown",u=>{var l=o.__element.getBoundingClientRect();a=l.left,s(u.clientX),f=!0}),document.addEventListener("mouseup",u=>{f=!1}),o}function Le({callback:t,start:n,colorFrom:e,colorTo:r}){t||(t=l=>{});const i=de({absolute_value:0,relative_value:0});var o=W(),f=g("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--color-from:${e()};--color-to:${r()};`,elements:[typeof e<"u"?e:void 0,typeof r<"u"?r:void 0]}},g("div",{class:"trackbar-data"}),g("div",{class:"trackbar-thumb",ref:o,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${i.absolute_value}px`,elements:[typeof i<"u"?i:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));f.$onUpdate(()=>{var l=f.__element.getBoundingClientRect();i.relative_value=n(),i.absolute_value=l.width*n()/255});var a=!1,s;function u(l){var d=l-s,c=f.__element.getBoundingClientRect();d<0&&(d=0),d>c.width&&(d=c.width),i.absolute_value=d,i.relative_value=i.absolute_value/c.width*255,t(i.relative_value)}return document.addEventListener("mousemove",l=>{a&&u(l.clientX)}),o.$on("mousedown",l=>{l.stopPropagation(),a=!0,s=l.clientX-i.absolute_value}),f.$on("mousedown",l=>{var d=f.__element.getBoundingClientRect();s=d.left,u(l.clientX),a=!0}),document.addEventListener("mouseup",l=>{a=!1}),f}function Wn({callback:t,start:n}){const e=de({absolute_value:0,relative_value:0,min_color:"0,0,0",max_color:"255,255,255",min_limit_percent:0,max_limit_percent:100});var r=0,i=0,o=0,f=0,a=255;t||(t=h=>{});var s=W(),u=g("div",null,g("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--color-from:${e.min_color};--color-to:${e.max_color};--min-limit:${e.min_limit_percent}%;--max-limit:${e.max_limit_percent}%`,elements:[typeof e<"u"?e:void 0,typeof min_color<"u"?min_color:void 0,typeof e<"u"?e:void 0,typeof max_color<"u"?max_color:void 0,typeof e<"u"?e:void 0,typeof min_limit_percent<"u"?min_limit_percent:void 0,typeof e<"u"?e:void 0,typeof max_limit_percent<"u"?max_limit_percent:void 0]}},g("div",{class:"trackbar-bright-data"}),g("div",{class:"trackbar-thumb",ref:s,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${e.absolute_value}px`,elements:[typeof e<"u"?e:void 0,typeof absolute_value<"u"?absolute_value:void 0]}})));u.$onUpdate(()=>{var h=u.__element.getBoundingClientRect(),v=n();r=v[0],i=v[1],o=v[2];var p=Math.min(r,i,o),b=Math.max(r,i,o),A=(r+i+o)/3;e.min_color=[r-p,i-p,o-p].join(","),e.max_color=[r+(255-b),i+(255-b),o+(255-b)].join(","),e.relative_value=A,e.absolute_value=h.width*A/255;var R=A-p,F=255-(b-A);f=h.width*R/255,a=h.width*F/255,e.min_limit_percent=R/255*100,e.max_limit_percent=F/255*100});var l=!1,d;function c(h){var v=e.relative_value,p=r-v,b=i-v,A=o-v,R=h-d,F=u.__element.getBoundingClientRect();R<f&&(R=f),R>a&&(R=a),e.absolute_value=R,e.relative_value=e.absolute_value/F.width*255,r=e.relative_value+p,i=e.relative_value+b,o=e.relative_value+A,console.log(r,i,o),t([r,i,o])}return document.addEventListener("mousemove",h=>{l&&c(h.clientX)}),s.$on("mousedown",h=>{h.stopPropagation(),l=!0,d=h.clientX-e.absolute_value}),u.$on("mousedown",h=>{var v=u.__element.getBoundingClientRect();d=v.left,c(h.clientX),l=!0}),document.addEventListener("mouseup",h=>{l=!1}),u}function Ke(t,n){var e=JSON.stringify(n),r=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(r),o=document.createElement("a");o.download=t,o.href=i,o.textContent="Download",o.click(),o.remove()}function jn(t,n){var e=new Blob([n],{type:"plain/text"}),r=URL.createObjectURL(e),i=document.createElement("a");i.download=t,i.href=r,i.textContent="Download",i.click(),i.remove()}async function Qe(t,n){var e=document.createElement("input");e.type="file",e.accept="."+t,e.onchange=r=>{var i=r.target.files[0],o=new FileReader;o.onload=function(f){var a=f.target.result;n(JSON.parse(a))},o.readAsText(i)},e.click(),e.remove()}function He(t,n){var e=document.createElement("a");e.download=t,e.href=n,e.click(),e.remove()}function Kn({set:t,get:n}){const e=W();var r=0,i=0,o=0,f=255,a=255,s=255,u=255,l=255;const d=W();var c=[];function h(){Qe("col",$=>{d.$html("");for(var k=0;k<$.length;k++)p($[k][0],$[k][1],$[k][2],$[k][3])})}function v(){Ke("color_list.col",c)}function p($,k,N,m){c.push([$,k,N,m]);var I=g("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${$},${k},${N},${m/255})`,elements:[typeof $<"u"?$:void 0,typeof k<"u"?k:void 0,typeof N<"u"?N:void 0,typeof m<"u"?m:void 0]}}),C=!1;I.$on("mousedown",P=>(C=!0,P.button==1&&P.preventDefault(),!1)),I.$on("contextmenu",P=>(P.preventDefault(),!1)),document.addEventListener("mouseup",P=>{setTimeout(()=>{C=!1},100)}),I.$on("mouseup",P=>{!C||(P.button==0?(r=$,i=k,o=N,f=m,M(),w&&w.$update()):P.button==2?(a=$,s=k,u=N,l=m,M("background"),w&&w.$update()):I.$remove())}),I.$parent(d)}function b($,k,N){return console.log($,k,N),[$,k,N].map(m=>parseInt(m).toString(16).padStart(2,"0")).join("")}function A($){var k=parseInt($.substring(0,2),16),N=parseInt($.substring(2,4),16),m=parseInt($.substring(4,6),16);return[k,N,m]}function R($){return $.length==6&&!isNaN(parseInt($,16))}function F($){var k=$.target.value;if(k.startsWith("#")&&(k=k.substring(1),e.value=k),!!R(k)){var N=A(k);r=N[0],i=N[1],o=N[2],M(),w&&w.$update()}}var w=g("div",{style:"width:100%"},g("div",{style:"width:100px;margin:10px;position:relative"},g("div",{class:"hash-tag"},"#"),g("input",{type:"text",class:"input hex-input",maxLength:"6","on:input":F,ref:e})),g("div",{style:"display:flex;flex-direction:row"},g("div",{style:"width:100%;padding:10px"},g(Le,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`0,${i},${o}`,elements:[typeof i<"u"?i:void 0,typeof o<"u"?o:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`255,${i},${o}`,elements:[typeof i<"u"?i:void 0,typeof o<"u"?o:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:$=>B($),elements:[typeof x<"u"?x:void 0,typeof B<"u"?B:void 0,typeof x<"u"?x:void 0]}}),g(Le,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},0,${o}`,elements:[typeof r<"u"?r:void 0,typeof o<"u"?o:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},255,${o}`,elements:[typeof r<"u"?r:void 0,typeof o<"u"?o:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:$=>_($),elements:[typeof x<"u"?x:void 0,typeof _<"u"?_:void 0,typeof x<"u"?x:void 0]}}),g(Le,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>o,elements:[typeof o<"u"?o:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},${i},0`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},${i},255`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:$=>E($),elements:[typeof x<"u"?x:void 0,typeof E<"u"?E:void 0,typeof x<"u"?x:void 0]}}),g(Wn,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>[r,i,o],elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof o<"u"?o:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:$=>L($),elements:[typeof x<"u"?x:void 0,typeof L<"u"?L:void 0,typeof x<"u"?x:void 0]}}))),g("div",{class:"row"},g("div",{class:"color-area"},g("div",{class:"color-container"},g("div",{class:"background color-item"},g("div",{class:"backdrop"}),g("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${a},${s},${u},${l/255})`,elements:[typeof a<"u"?a:void 0,typeof s<"u"?s:void 0,typeof u<"u"?u:void 0,typeof l<"u"?l:void 0]}})),g("div",{class:"foreground color-item"},g("div",{class:"backdrop"}),g("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${r},${i},${o},${f/255})`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof o<"u"?o:void 0,typeof f<"u"?f:void 0]}}))),g("div",{class:"hover-icon-container",style:"margin-left:5px","on:click":S},g("i",{class:"fa-solid fa-arrows-rotate hover-icon"}))),g("div",{class:"alpha-area",style:"margin-top:-10px"},g(Vn,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>f,elements:[typeof f<"u"?f:void 0]},color:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},${i},${o};`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof o<"u"?o:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:$=>y($),elements:[typeof x<"u"?x:void 0,typeof y<"u"?y:void 0,typeof x<"u"?x:void 0]}}))),g("div",{class:"color-history-container"},g("div",{style:"display:inline-block",ref:d}),g("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${r},${i},${o},${f/255})`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof o<"u"?o:void 0,typeof f<"u"?f:void 0]},"on:click":()=>p(r,i,o,f)},g("i",{class:"fa fa-plus"})),g("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${a},${s},${u},${l/255})`,elements:[typeof a<"u"?a:void 0,typeof s<"u"?s:void 0,typeof u<"u"?u:void 0,typeof l<"u"?l:void 0]},"on:click":()=>p(a,s,u,l)},g("i",{class:"fa fa-plus"}))),g("button",{class:"button","on:click":()=>v()},"Save colors"),g("button",{class:"button","on:click":()=>h()},"Load colors"));function M($="foreground"){n($,{r,g:i,b:o,a:f},{r:a,g:s,b:u,a:l}),e.value=b(r,i,o)}t(U());function U(){return($,k)=>{$!=null&&(r=$.r,i=$.g,o=$.b,f=$.a),k!=null&&(a=k.r,s=k.g,u=k.b,l=k.a),w&&w.$update()}}function B($){r=$,w&&w.$update(),M()}function _($){i=$,w&&w.$update(),M()}function E($){o=$,w&&w.$update(),M()}function y($){f=$,w&&w.$update(),M()}function L($){r=$[0],i=$[1],o=$[2],w&&w.$update(),M()}function S(){var $=a;a=r,r=$,$=s,s=i,i=$,$=u,u=o,o=$,$=l,l=f,f=$,w&&w.$update(),M()}return M(),w.$onMounted(()=>{w.$update()}),w}const he=[2,2,1,1,0,0],Qn=[1,0,1,0,1,0];function Xe(t){for(var n=t[0][0],e=t[0][0],r=t[0][1],i=t[0][1],o=1;o<t.length;o++){var f=t[o];f[0]<n&&(n=f[0]),f[0]>e&&(e=f[0]),f[1]<r&&(r=f[1]),f[1]>i&&(i=f[1])}return[n,r,e,i]}function qn(t){for(var n=t.voxels,e=t.faces,r=t.color,i={},o=0;o<e.length;o++)for(var f=0,a=0;a<e[o].length;a++){if(e[o][a]==0){f+=1;continue}var s=`${n[o][he[f]]},${f}`;i[s]==null&&(i[s]={direction:f,relevant:he[f],position:n[o][he[f]]+Qn[f],data:[],colors:[]}),i[s].data.push(n[o].filter((j,Q)=>Q!=he[f])),i[s].colors.push(r[o][f]),f+=1}for(var o in i)i[o].geometry=gn(i[o].data);var u=[],l=[],d=[],c=[],h=[],v=[],p=0,b=0,A=0,R=0,F=0,w=Object.values(i).map(j=>Xe(j.data)),M=w.reduce((j,Q)=>j+Q[2]-Q[0]+1,0),U=w.reduce((j,Q)=>Math.max(j,Q[3]-Q[1]+1),0),B=Math.ceil(Math.sqrt(M*U));for(var o in i){var _=i[o],E=!1;(_.direction==4||_.direction==5)&&(E=!0);var[y,L,S,$]=Xe(_.data);if(E){var k=$;b-=L}else{var k=S;b-=y}b>B&&(b=0,A+=U);for(var V in _.data){var N=_.colors[V],m=_.data[V];E?v.push({color:N,position:[m[1]+b,A+m[0]]}):v.push({color:N,position:[m[0]+b,A+m[1]]})}for(var V in _.geometry){for(var I=_.geometry[V],a=0;a<I.positions.length;a+=2){var C=[I.positions[a],I.positions[a+1]];C.splice(_.relevant,0,_.position),d.push(C),E?u.push([I.positions[a+1]+b,A-1+I.positions[a]+1]):u.push([I.positions[a]+b,A-1+I.positions[a+1]+1])}for(var a=0;a<I.indices.length;a+=3){h.push(_.direction+1);var P=[I.indices[a]+p,I.indices[a+1]+p,I.indices[a+2]+p];if(_.direction==1){var Y=P[0];P[0]=P[1],P[1]=Y}if(_.direction==2){var Y=P[0];P[0]=P[2],P[2]=Y}if(_.direction==5){var Y=P[1];P[1]=P[2],P[2]=Y}l.push(P.map(nn=>nn+1)),c.push(P)}p+=I.positions.length/2}b+=k+1,b>F&&(F=b),A>R&&(R=A)}R+=U,u=u.map(j=>[j[0]/F,j[1]/R]);for(var o in v)v[o].position=[v[o].position[0],R-1-v[o].position[1]];var[oe,V]=$n(c,d);return{vert:oe,index:V,normal:h,uv_position:u,uv_index:l,uv_color:v,width:F,height:R}}var pe=1e3;function qe(t){const n=W(),e=g("div",{class:"modal-background","v-show":"visible"},g("div",{class:"modal-prompt"},g("span",{class:"close-button",ref:n,id:"close"},g("i",{class:"fa-solid fa-xmark"})),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]}));e.$style("z-index",{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>pe++,elements:[typeof pe<"u"?pe:void 0]});function r(){pe--,e.$remove()}return n.$on("click",r),e.$parent(document.body),{close:r}}var et=`
vn -0.000000 0.000000 1.000000
vn 0.000000 0.000000 -1.000000
vn 0.000000 1.000000 0.000000
vn 0.000000 -1.000000 0.000000
vn 1.000000 0.000000 0.000000
vn -1.000000 -0.000000 -0.000000
`;function nt({vert:t,index:n,normal:e,uv_position:r,uv_index:i,uv_color:o,width:f,height:a}){for(var s="",u=0;u<t.length;u++)s+=`v ${t[u][0]} ${t[u][1]} ${t[u][2]}
`;s+=`
`;for(var u=0;u<r.length;u++)s+=`vt ${r[u][0]} ${r[u][1]}
`;s+=`
`,s+=et,s+=`
`;for(var u=0;u<n.length;u++)s+=`f ${n[u][0]}/${i[u][0]}/${e[u]} ${n[u][1]}/${i[u][1]}/${e[u]} ${n[u][2]}/${i[u][2]}/${e[u]}
`;return s}function tt({uv_color:t,width:n,height:e},r=32){var i=document.createElement("canvas");i.width=n*r,i.height=e*r;var o=i.getContext("2d");for(var f of t){var[a,s]=f.position,[u,l,d]=f.color;o.fillStyle=`rgb(${u*255},${l*255},${d*255})`,o.fillRect(a*r,s*r,r,r)}var c=i.toDataURL("image/png");return i.remove(),c}function rt({uv_color:t,width:n,height:e}){var r=document.createElement("canvas");r.width=n,r.height=e;for(var i=r.getContext("2d"),o=i.createImageData(n,e),f=0;f<o.width;f++)for(var a=0;a<o.height;a++){var s=(f+a*o.width)*4;o.data[s]=255,o.data[s+1]=1,o.data[s+2]=1,o.data[s+3]=1}for(var u of t){var[f,a]=u.position,[l,d,c]=u.color,s=(f+a*n)*4;o.data[s+0]=l*255,o.data[s+1]=d*255,o.data[s+2]=c*255,o.data[s+3]=255}i.putImageData(o,0,0);var h=r.toDataURL("image/png");return r.remove(),h}var fe=null,_e=null,me=null,be=null,ye=null,xe=null,ge=null,$e=null,H=O;const Te=[{name:"Pen"},{name:"Line"},{name:"Plane"},{name:"Horizontal line"},{name:"Vertical line"}],Se=[{name:"Sculpt"},{name:"Paint"}];var G="Pen",q="Sculpt",ae=!0,we=!0,O=[1,0,0],z=[1,1,1];function Pe(t,n,e){O=[n.r/255,n.g/255,n.b/255,n.a/255],z=[e.r/255,e.g/255,e.b/255,e.a/255],t=="foreground"?H=O:H=z}var ke=null,Ee=null;function Ge(t,n){var e=null;t!=null&&(e={r:t[0]*255,g:t[1]*255,b:t[2]*255,a:255});var r=null;n!=null&&(r={r:n[0]*255,g:n[1]*255,b:n[2]*255,a:255}),ke(e,r)}const X=W(),en=W(),it=g("div",{class:"main"},g("div",{class:"info"},g("p",null,g("h3",null,"Mode"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>re(Se,t=>{q=t,H=O},"Sculpt"),elements:[typeof re<"u"?re:void 0,typeof Se<"u"?Se:void 0,typeof x<"u"?x:void 0,typeof q<"u"?q:void 0,typeof x<"u"?x:void 0,typeof H<"u"?H:void 0,typeof O<"u"?O:void 0]}),g("p",null,g("h3",null,"Color"),g(Kn,{get:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:(t,n,e)=>Pe(t,n,e),elements:[typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0,typeof Pe<"u"?Pe:void 0,typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0]},set:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:t=>ke=t,elements:[typeof fn<"u"?fn:void 0,typeof ke<"u"?ke:void 0,typeof fn<"u"?fn:void 0]}}),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>D("Fill all",()=>Ee()),elements:[typeof D<"u"?D:void 0,typeof Ee<"u"?Ee:void 0]})),g("canvas",{ref:X}),g("div",{class:"info"},g("p",null,"FPS: ",g("span",{ref:en})),g("p",null,g("h3",null,"Tool"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>re(Te,t=>G=t,"Pen"),elements:[typeof re<"u"?re:void 0,typeof Te<"u"?Te:void 0,typeof x<"u"?x:void 0,typeof G<"u"?G:void 0,typeof x<"u"?x:void 0]}),g("p",null,g("h3",null,"Tool options"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>J("Contiguous",t=>ae=t),elements:[typeof J<"u"?J:void 0,typeof x<"u"?x:void 0,typeof ae<"u"?ae:void 0,typeof x<"u"?x:void 0]}),g("p",null,g("h3",null,"View"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>J("Wireframe",t=>we=t),elements:[typeof J<"u"?J:void 0,typeof x<"u"?x:void 0,typeof we<"u"?we:void 0,typeof x<"u"?x:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>D("Reset pan",()=>ye()),elements:[typeof D<"u"?D:void 0,typeof ye<"u"?ye:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>D("Reset rotation",()=>xe()),elements:[typeof D<"u"?D:void 0,typeof xe<"u"?xe:void 0]}),g("p",null,g("h3",null,"Actions"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>D("Subdivide",()=>fe()),elements:[typeof D<"u"?D:void 0,typeof fe<"u"?fe:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>D("Undo",()=>ge()),elements:[typeof D<"u"?D:void 0,typeof ge<"u"?ge:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>D("Redo",()=>$e()),elements:[typeof D<"u"?D:void 0,typeof $e<"u"?$e:void 0]}),g("p",null,g("h3",null,"Persistence"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>D("Save project",()=>_e()),elements:[typeof D<"u"?D:void 0,typeof _e<"u"?_e:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>D("Load project",()=>me()),elements:[typeof D<"u"?D:void 0,typeof me<"u"?me:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>D("Export obj",()=>be()),elements:[typeof D<"u"?D:void 0,typeof be<"u"?be:void 0]})));X.width=800;X.height=800;it.$parent(document.body);var T=new On;T.init();be=()=>{var t=localStorage.getItem("save_obj_preferences"),n=!0,e=!0,r="object",i=1;t!=null&&(console.log(t),t=JSON.parse(t),n=t.texture,e=t.geometry,r=t.filename,i=t.square_size);var o=W(),f=g("div",{class:"prompt col"},g("div",{class:"row margin"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>J("Geometry",s=>e=s,e),elements:[typeof J<"u"?J:void 0,typeof x<"u"?x:void 0,typeof e<"u"?e:void 0,typeof x<"u"?x:void 0,typeof e<"u"?e:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>J("Texture",s=>n=s,n),elements:[typeof J<"u"?J:void 0,typeof x<"u"?x:void 0,typeof n<"u"?n:void 0,typeof x<"u"?x:void 0,typeof n<"u"?n:void 0]}),g("div",{class:"row margin"},g("div",null,g("label",null,"File name"),g("input",{type:"text",class:"input",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]},s=>r=s]})),g("div",null,g("label",null,"Texture voxel size"),g("input",{type:"number",class:"input",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]},s=>i=s]}))),g("button",{class:"footer-button button",ref:o},"Export")),{close:a}=qe(f);o.$on("click",()=>{var s=qn(T);if(n)if(i<=1){var u=rt(s);He(r+".png",u)}else{var u=tt(s,i);He(r+".png",u)}if(e){var l=nt(s);jn(r+".obj",l)}var d={filename:r,geometry:e,texture:n,square_size:i};localStorage.setItem("save_obj_preferences",JSON.stringify(d)),a()})};function Me(t){const n=X.__element.getBoundingClientRect();var e=(t.clientX-n.left)*X.width/X.clientWidth,r=X.height-(t.clientY-n.top)*X.height/X.clientHeight-1;return[e,r]}function Ye(t,n,e,r,i){var o,f,a,s;t==e?o=1:o=1/Math.abs(e-t),n==r?f=1:f=1/Math.abs(r-n);for(var u=Math.min(o,f)*i,l=0,d=[],c=a,h=s;l<=1;)c=t*(1-l)+e*l,h=n*(1-l)+r*l,d.push([c,h]),l+=u;return d}async function ot(){var t=await fetch("./shader.vert").then(_=>_.text()),n=await fetch("./shader.frag").then(_=>_.text()),[e,r]=Hn(X.__element,t,n);r.antialias=!1,r.uniform_4_float.color_overlay=[0,0,0,1],_e=()=>{var _=localStorage.getItem("save_obj_preferences"),E="";_!=null&&(_=JSON.parse(_),E=_.filename);const y=W();var L=g("div",{class:"prompt-small col"},g("div",{class:"row margin"},g("div",null,g("label",null,"File name"),g("input",{type:"text",class:"input",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>E,elements:[typeof E<"u"?E:void 0]},$=>E=$]}))),g("button",{class:"footer-button button",ref:y},"Export")),{close:S}=qe(L);y.$on("click",()=>{_.filename=E,localStorage.setItem("save_obj_preferences",JSON.stringify(_)),Ke(E+".vox",{voxels:T.voxels,color:T.color}),S()})},me=async()=>{Qe("vox",({voxels:_,color:E})=>{T.voxels=_,T.color=E,T.init();var[y,k]=T.boundary,L=y[0]-k[0],S=y[1]-k[1],$=y[2]-k[2],k=Math.abs(Math.max(L,S,$));U(-6),w(),M(),F(Math.max(k,1)),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes,c()})},Ee=()=>{for(var _=0;_<T.color.length;_++)for(var E=0;E<T.color[_].length;E++)for(var y=0;y<3;y++)T.color[_][E][y]=T.color[_][E][y]*(1-O[3])+O[y]*O[3];c()};var i=null,o=[],f=0,a=0,s=!1,u=!1,l=-1,d=[];c();function c(_=!1){d.length>30&&(d=d.slice(1),l--),d=d.slice(0,l+1),d.push(JSON.parse(JSON.stringify([T.voxels,T.color,T.faces,_]))),l=d.length-1}ge=h,$e=v;function h(){if(l>0){const _=d[l][3];l--;const[E,y,L]=JSON.parse(JSON.stringify(d[l]));_&&F(.5),T.voxels=E,T.color=y,T.faces=L,T.init(),T.build(),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes}}function v(){if(l+1<d.length){l++;const[_,E,y,L]=d[l];L&&F(2),T.voxels=_,T.color=E,T.faces=y,T.build(),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes}}document.addEventListener("keydown",function(_){_.key=="Control"&&(u=!0),_.key=="z"&&_.ctrlKey&&h(),_.key=="y"&&_.ctrlKey&&v(),_.key=="x"&&_.ctrlKey&&fe()}),document.addEventListener("keyup",function(_){_.key=="Control"&&(u=!1)});var p=!1;X.$on("mousedown",_=>{if(p=u,!u){if(_.offsetX,_.offsetY,_.button==1)_.preventDefault();else if(_.button==0||_.button==2&&G=="Pen"){const[E,y]=Me(_);f=E,a=y,s=!0,o=[[E,y]]}if(G=="Line"){const[E,y]=Me(_);f=E,a=y,s=!0}_.button==0?H=O:_.button==2&&(H=z)}}),X.$on("mousemove",_=>{if(!s)return;const[E,y]=Me(_);G=="Line"?o=[[f,a],...Ye(E,y,f,a,5),[E,y]]:(o.push(...Ye(E,y,f,a,5)),f=E,a=y)}),X.$on("contextmenu",_=>(_.preventDefault(),!1));var b=[];X.$on("mouseup",_=>{if(!(u||p)&&(b=[],o=[],s=!1,!!i)){if(G=="Pen"||G=="Line")if(q=="Sculpt"){if(_.button==0){var E=[];for(var y of i)E.push(...y.voxel.map($=>$.map((k,N)=>k+y.direction[N])));E=[...new Set(E.map(JSON.stringify))].map(JSON.parse),T.add(...E),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes}else if(_.button==2){var E=[];for(var y of i)E.push(...y.voxel);T.remove(...E),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes}}else{if(_.button==0){H=O;for(var y of i)for(var L=0;L<y.color.length;L++)for(var S=0;S<3;S++)y.color[L][S]=y.color[L][S]*(1-O[3])+O[S]*O[3]}else if(_.button==2){H=z;for(var y of i)for(var L=0;L<y.color.length;L++)for(var S=0;S<3;S++)y.color[L][S]=y.color[L][S]*(1-z[3])+z[S]*z[3]}_.button==1&&(O=[...i[0].mouse_color,1],H=O,Ge(O))}else if(q=="Sculpt")_.button==0?(T.add(...i.voxel.map($=>$.map((k,N)=>k+i.direction[N]))),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes):_.button==2&&(T.remove(...i.voxel),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes);else if(_.button==0){H=O;for(var L=0;L<i.color.length;L++)for(var S=0;S<3;S++)i.color[L][S]=i.color[L][S]*(1-O[3])+O[S]*O[3]}else if(_.button==2){H=z;for(var L=0;L<i.color.length;L++)for(var S=0;S<3;S++)i.color[L][S]=i.color[L][S]*(1-z[3])+z[S]*z[3]}_.button==1&&(O=[...i.mouse_color,1],H=O,Ge(O)),c()}});const{update:A,mouse:R,zoom:F,resetPan:w,resetRotation:M,setZoom:U}=Jn(X,r,e);ye=w,xe=M,fe=()=>{T.subdivide(),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes,F(2),c(!0)};function B(){e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.enable(e.CULL_FACE),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}zn(_=>{en.$html({key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>_,elements:[typeof _<"u"?_:void 0]}),A(),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes;var E=null;r.buffer(()=>{e.clearColor(0,0,0,0),r.uniform_float.disable_lighting=1,B(),r.attribute_matrix_4_float.color=T.pick_map,r.drawSolid(T.geometry_indexes),G=="Pen"?s?(b.push(...o.map(y=>r.getPixel(y[0],y[1]))),o=[]):b=[r.getPixel(R.x,R.y)]:G=="Line"?s?b=o.map(y=>r.getPixel(y[0],y[1])):b=[r.getPixel(R.x,R.y)]:E=r.getPixel(R.x,R.y)}),r.uniform_float.disable_lighting=0,e.clearColor(.5,.5,.5,.9),e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(1,1),B(),i=null,G=="Pen"||G=="Line"?q=="Sculpt"?r.attribute_matrix_4_float.color=T.get_highlight(b,y=>i=y):r.attribute_matrix_4_float.color=T.get_highlight(b,y=>i=y,H):q=="Sculpt"?r.attribute_matrix_4_float.color=T.highlight_plane(E,y=>i=y,G,ae):r.attribute_matrix_4_float.color=T.highlight_plane(E,y=>i=y,G,ae,H),r.drawSolid(T.geometry_indexes),e.disable(e.POLYGON_OFFSET_FILL),we&&(r.uniform_float.enable_color_overlay=1,r.drawLines(T.geometry_edge_index),r.uniform_float.enable_color_overlay=0)})}ot();
