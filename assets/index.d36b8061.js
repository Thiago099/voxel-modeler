(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const f of i)if(f.type==="childList")for(const o of f.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const f={};return i.integrity&&(f.integrity=i.integrity),i.referrerpolicy&&(f.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?f.credentials="include":i.crossorigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(i){if(i.ep)return;i.ep=!0;const f=e(i);fetch(i.href,f)}})();function se(t){const n=new Set;function e(o){n.add(o)}function r(o){n.delete(o)}const i={get(o,a){return a==="__subscribe"?e:a==="__unsubscribe"?r:typeof o[a]=="object"&&o[a]!==null&&!(o[a]instanceof HTMLElement)?new Proxy(o[a],i):o[a]},set(o,a,s){o[a]=s;for(const u of n)u.__update();return!0}};return new Proxy(t,i)}function Ke(t){return je(new sn(t))}function je(t){function n(r,i){return typeof r[i]!="object"||r[i]!==null?r[i]:new Proxy(r[i],{set:(o,a,s)=>(e.__handleEffect(e.__isReactive(s),()=>{o[a]=e.__handleFunction(s)}),!0),get:(o,a)=>n(o,a)})}const e=new Proxy(t,{get:(r,i)=>{if(i in r)return r[i];if(i in r.__element)return n(r.__element,i)},set:(r,i,f)=>(i in r?r[i]=f:i=="style"?r.$set_style(f):i in r.__element&&r.$property(i,f),!0)});return e}class sn{constructor(n){if(typeof n=="string")this.__element=document.createElement(n);else if(n instanceof HTMLElement)this.__element=n;else throw new Error("Invalid element name");this.__events=[],this.__children=[],this.__states=new Set,this.__unmounted_events=[],this.__mounted_events=[],this.__parent=null}__update(){for(const n of this.__events)n()}$click(){return this.__element.click(),this}$find(n){var e=[];this.__element.matches(n)&&e.push(je(this));for(const r of this.__children)e=e.concat(r.$find(n));return e}$update(){for(const n of this.__events)n();for(const n of this.__children)n.$update()}__parseInput(n){if(n&&n.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"){for(const e of n.elements)e&&e.__subscribe&&(this.__states.add(e),e.__subscribe(this));return n.expression}return n}__observeParent(){setTimeout(()=>{for(const e of this.__mounted_events)e()},0),new MutationObserver(e=>{for(const r of e){if(r.type==="childList"&&r.removedNodes.length){for(const i of r.removedNodes)if(i===this.__element){this.__unsubscribe();for(const f of this.__unmounted_events)f()}}if(r.type==="childList"&&r.addedNodes.length){for(const i of r.addedNodes)if(i===this.__element){this.__subscribe();for(const f of this.__mounted_events)f()}}}}).observe(this.__element.parentElement,{childList:!0})}__subscribe(){if(this.__states)for(const n of this.__states)n.__subscribe(this)}__unsubscribe(){for(const n of this.__children)n.__unsubscribe();if(this.__states)for(const n of this.__states)n.__unsubscribe(this)}__handleFunction(n){return typeof n=="function"?n():n}__handleEffect(n,e){n?(e(),this.__events.push(e)):e()}__isReactive(...n){for(const e of n)if(typeof e=="function")return!0;return!1}$if(n){return n=this.__parseInput(n),this.__handleEffect(this.__isReactive(n),()=>{const e=this.__handleFunction(n);this.$style("display",e?"":"none")}),this}$class(n,e=!0){n=this.__parseInput(n),e=this.__parseInput(e);var r=null;return this.__handleEffect(this.__isReactive(n,e),()=>{const i=this.__handleFunction(n);if(i)if(typeof i=="object")for(const f in i)i[f]?this.__element.classList.add(f):this.__element.classList.remove(f);else this.__handleFunction(e)?(this.__isReactive(n)&&(r&&this.__element.classList.remove(...r.split(" ").filter(f=>f.length>0)),r=i),this.__element.classList.add(...i.split(" ").filter(f=>f.length>0))):(this.__element.classList.remove(...i.split(" ").filter(f=>f.length>0)),r=null)}),this}get parentElement(){return this.__parent}$parent(n){return this.__parent=n,n.__element!==void 0?(n.__element.appendChild(this.__element),n.__children.push(this)):n.appendChild(this.__element),this.__observeParent(),this}$parentBefore(n){return this.__parent=n,n.__element!==void 0?n.__element.firstChild?n.__element.insertBefore(this.__element,n.__element.firstChild):n.__element.appendChild(this.__element):n.firstChild?n.insertBefore(this.__element,n.firstChild):n.appendChild(this.__element),this.__observeParent(),this}$on(n,e){return this.__element.addEventListener(n,e),this}__clean_input(n){return n&&n.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?n.expression:n}$onUpdate(n){return this.__events.push(n),this}$onMounted(n){this.__mounted_events.push(n)}$onUnmounted(n){this.__unmounted_events.push(n)}$property(n,e){return n=this.__parseInput(n),e=this.__parseInput(e),this.__handleEffect(this.__isReactive(n,e),()=>{this.__element[this.__handleFunction(n)]=this.__handleFunction(e)}),this}$style(n,e=null){return e?(this.__style(n,e),this):(n=this.__parseInput(n),this.__handleEffect(this.__isReactive(n),()=>{var r=this.__handleFunction(n);if(typeof r=="object")for(const i in r)this.__element.style[i]=r[i];else{const i=r.split(";").filter(f=>f.length>0);this.__element.style={};for(const f of i){const[o,a]=f.split(":");this.__element.style.setProperty(o,this.__handleFunction(a))}}}),this)}__style(n,e){return n=this.__parseInput(n),e=this.__parseInput(e),this.__handleEffect(this.__isReactive(n,e),()=>{this.__element.style[this.__handleFunction(n)]=this.__handleFunction(e)}),this}$get_computed_style(n){return window.getComputedStyle(this.__element).getPropertyValue(n)}$html(n){return n=this.__parseInput(n),this.__handleEffect(this.__isReactive(n),()=>{this.__element.innerHTML=this.__handleFunction(n)}),this}$child(n){n=this.__parseInput(n);var e;this.__isReactive(n)?e=Ke("span").$parent(this):e=this;var r=null;return this.__handleEffect(this.__isReactive(n),()=>{var i=this.__handleFunction(n);r&&r();const f=a=>a==null?()=>{}:a.__element!==void 0?(a.$parent(e),()=>a.$remove()):(a instanceof HTMLElement||(a=document.createTextNode(a)),e.__element.appendChild(a),()=>a.remove());if(Array.isArray(i)){var o=[];for(const a of i)o.push(f(a));r=()=>{for(const a of o)a()}}else r=f(i)}),this}$remove(){return this.__parent=null,this.__element.remove(),this}$model([n,e]){return this.$property("value",n),this.$on("input",r=>e(r.target.value)),this}}function un(t){return t&&t.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?t.expression:t}const g=(t,n,...e)=>{var r,i=!1;if(typeof t=="function"){var f={};if(n)for(const[s,u]of Object.entries(n))f[s]=un(u);if(r=t(f,...e),r===void 0)return e;i=!0}else r=Ke(t);const o={ref:s=>{s.__ref_object=r},style:s=>{r.$style(s)},class:s=>{r.$class(s)},parent:s=>{r.$parent(s)},if:s=>{r.$if(s)},model:([s,u])=>{r.$model([s,u])}},a={on:(s,u)=>{r.$on(s,u)}};if(n)for(const[s,u]of Object.entries(n)){const l=s.split(":");l.length==2?a[l[0]]&&a[l[0]](l[1],u):o[s]?o[s](u):i||r.$property(s,u)}if(e&&!i)for(const s of e)r.$child(s);return r};function V(t=null){var n=t;return new Proxy({},{get:(r,i)=>{if(n!=null)return n[i]},set:(r,i,f)=>(i==="__ref_object"&&(n=f),f!=null&&(n[i]=f),!0)})}var He={exports:{}};He.exports=Le;He.exports.default=Le;function Le(t,n,e){e=e||2;var r=n&&n.length,i=r?n[0]*e:t.length,f=Qe(t,0,i,e,!0),o=[];if(!f||f.next===f.prev)return o;var a,s,u,l,d,c,h;if(r&&(f=hn(t,n,f,e)),t.length>80*e){a=u=t[0],s=l=t[1];for(var v=e;v<i;v+=e)d=t[v],c=t[v+1],d<a&&(a=d),c<s&&(s=c),d>u&&(u=d),c>l&&(l=c);h=Math.max(u-a,l-s),h=h!==0?32767/h:0}return ce(f,o,e,a,s,h,0),o}function Qe(t,n,e,r,i){var f,o;if(i===Ze(t,n,e,r)>0)for(f=n;f<e;f+=r)o=Xe(f,t[f],t[f+1],o);else for(f=e-r;f>=n;f-=r)o=Xe(f,t[f],t[f+1],o);return o&&Se(o,o.next)&&(he(o),o=o.next),o}function te(t,n){if(!t)return t;n||(n=t);var e=t,r;do if(r=!1,!e.steiner&&(Se(e,e.next)||O(e.prev,e,e.next)===0)){if(he(e),e=n=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==n);return n}function ce(t,n,e,r,i,f,o){if(!!t){!o&&f&&yn(t,r,i,f);for(var a=t,s,u;t.prev!==t.next;){if(s=t.prev,u=t.next,f?dn(t,r,i,f):ln(t)){n.push(s.i/e|0),n.push(t.i/e|0),n.push(u.i/e|0),he(t),t=u.next,a=u.next;continue}if(t=u,t===a){o?o===1?(t=cn(te(t),n,e),ce(t,n,e,r,i,f,2)):o===2&&vn(t,n,e,r,i,f):ce(te(t),n,e,r,i,f,1);break}}}}function ln(t){var n=t.prev,e=t,r=t.next;if(O(n,e,r)>=0)return!1;for(var i=n.x,f=e.x,o=r.x,a=n.y,s=e.y,u=r.y,l=i<f?i<o?i:o:f<o?f:o,d=a<s?a<u?a:u:s<u?s:u,c=i>f?i>o?i:o:f>o?f:o,h=a>s?a>u?a:u:s>u?s:u,v=r.next;v!==n;){if(v.x>=l&&v.x<=c&&v.y>=d&&v.y<=h&&ae(i,a,f,s,o,u,v.x,v.y)&&O(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function dn(t,n,e,r){var i=t.prev,f=t,o=t.next;if(O(i,f,o)>=0)return!1;for(var a=i.x,s=f.x,u=o.x,l=i.y,d=f.y,c=o.y,h=a<s?a<u?a:u:s<u?s:u,v=l<d?l<c?l:c:d<c?d:c,p=a>s?a>u?a:u:s>u?s:u,_=l>d?l>c?l:c:d>c?d:c,L=Ue(h,v,n,e,r),F=Ue(p,_,n,e,r),R=t.prevZ,w=t.nextZ;R&&R.z>=L&&w&&w.z<=F;){if(R.x>=h&&R.x<=p&&R.y>=v&&R.y<=_&&R!==i&&R!==o&&ae(a,l,s,d,u,c,R.x,R.y)&&O(R.prev,R,R.next)>=0||(R=R.prevZ,w.x>=h&&w.x<=p&&w.y>=v&&w.y<=_&&w!==i&&w!==o&&ae(a,l,s,d,u,c,w.x,w.y)&&O(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;R&&R.z>=L;){if(R.x>=h&&R.x<=p&&R.y>=v&&R.y<=_&&R!==i&&R!==o&&ae(a,l,s,d,u,c,R.x,R.y)&&O(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;w&&w.z<=F;){if(w.x>=h&&w.x<=p&&w.y>=v&&w.y<=_&&w!==i&&w!==o&&ae(a,l,s,d,u,c,w.x,w.y)&&O(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function cn(t,n,e){var r=t;do{var i=r.prev,f=r.next.next;!Se(i,f)&&qe(i,r,r.next,f)&&ve(i,f)&&ve(f,i)&&(n.push(i.i/e|0),n.push(r.i/e|0),n.push(f.i/e|0),he(r),he(r.next),r=t=f),r=r.next}while(r!==t);return te(r)}function vn(t,n,e,r,i,f){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&$n(o,a)){var s=en(o,a);o=te(o,o.next),s=te(s,s.next),ce(o,n,e,r,i,f,0),ce(s,n,e,r,i,f,0);return}a=a.next}o=o.next}while(o!==t)}function hn(t,n,e,r){var i=[],f,o,a,s,u;for(f=0,o=n.length;f<o;f++)a=n[f]*r,s=f<o-1?n[f+1]*r:t.length,u=Qe(t,a,s,r,!1),u===u.next&&(u.steiner=!0),i.push(gn(u));for(i.sort(pn),f=0;f<i.length;f++)e=_n(i[f],e);return e}function pn(t,n){return t.x-n.x}function _n(t,n){var e=bn(t,n);if(!e)return n;var r=en(e,t);return te(r,r.next),te(e,e.next)}function bn(t,n){var e=n,r=t.x,i=t.y,f=-1/0,o;do{if(i<=e.y&&i>=e.next.y&&e.next.y!==e.y){var a=e.x+(i-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=r&&a>f&&(f=a,o=e.x<e.next.x?e:e.next,a===r))return o}e=e.next}while(e!==n);if(!o)return null;var s=o,u=o.x,l=o.y,d=1/0,c;e=o;do r>=e.x&&e.x>=u&&r!==e.x&&ae(i<l?r:f,i,u,l,i<l?f:r,i,e.x,e.y)&&(c=Math.abs(i-e.y)/(r-e.x),ve(e,t)&&(c<d||c===d&&(e.x>o.x||e.x===o.x&&mn(o,e)))&&(o=e,d=c)),e=e.next;while(e!==s);return o}function mn(t,n){return O(t.prev,t,n.prev)<0&&O(n.next,t,t.next)<0}function yn(t,n,e,r){var i=t;do i.z===0&&(i.z=Ue(i.x,i.y,n,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,xn(i)}function xn(t){var n,e,r,i,f,o,a,s,u=1;do{for(e=t,t=null,f=null,o=0;e;){for(o++,r=e,a=0,n=0;n<u&&(a++,r=r.nextZ,!!r);n++);for(s=u;a>0||s>0&&r;)a!==0&&(s===0||!r||e.z<=r.z)?(i=e,e=e.nextZ,a--):(i=r,r=r.nextZ,s--),f?f.nextZ=i:t=i,i.prevZ=f,f=i;e=r}f.nextZ=null,u*=2}while(o>1);return t}function Ue(t,n,e,r,i){return t=(t-e)*i|0,n=(n-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,t|n<<1}function gn(t){var n=t,e=t;do(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),n=n.next;while(n!==t);return e}function ae(t,n,e,r,i,f,o,a){return(i-o)*(n-a)>=(t-o)*(f-a)&&(t-o)*(r-a)>=(e-o)*(n-a)&&(e-o)*(f-a)>=(i-o)*(r-a)}function $n(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!wn(t,n)&&(ve(t,n)&&ve(n,t)&&kn(t,n)&&(O(t.prev,t,n.prev)||O(t,n.prev,n))||Se(t,n)&&O(t.prev,t,t.next)>0&&O(n.prev,n,n.next)>0)}function O(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function Se(t,n){return t.x===n.x&&t.y===n.y}function qe(t,n,e,r){var i=_e(O(t,n,e)),f=_e(O(t,n,r)),o=_e(O(e,r,t)),a=_e(O(e,r,n));return!!(i!==f&&o!==a||i===0&&pe(t,e,n)||f===0&&pe(t,r,n)||o===0&&pe(e,t,r)||a===0&&pe(e,n,r))}function pe(t,n,e){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function _e(t){return t>0?1:t<0?-1:0}function wn(t,n){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&qe(e,e.next,t,n))return!0;e=e.next}while(e!==t);return!1}function ve(t,n){return O(t.prev,t,t.next)<0?O(t,n,t.next)>=0&&O(t,t.prev,n)>=0:O(t,n,t.prev)<0||O(t,t.next,n)<0}function kn(t,n){var e=t,r=!1,i=(t.x+n.x)/2,f=(t.y+n.y)/2;do e.y>f!=e.next.y>f&&e.next.y!==e.y&&i<(e.next.x-e.x)*(f-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==t);return r}function en(t,n){var e=new Oe(t.i,t.x,t.y),r=new Oe(n.i,n.x,n.y),i=t.next,f=n.prev;return t.next=n,n.prev=t,e.next=i,i.prev=e,r.next=e,e.prev=r,f.next=r,r.prev=f,r}function Xe(t,n,e,r){var i=new Oe(t,n,e);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function he(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Oe(t,n,e){this.i=t,this.x=n,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Le.deviation=function(t,n,e,r){var i=n&&n.length,f=i?n[0]*e:t.length,o=Math.abs(Ze(t,0,f,e));if(i)for(var a=0,s=n.length;a<s;a++){var u=n[a]*e,l=a<s-1?n[a+1]*e:t.length;o-=Math.abs(Ze(t,u,l,e))}var d=0;for(a=0;a<r.length;a+=3){var c=r[a]*e,h=r[a+1]*e,v=r[a+2]*e;d+=Math.abs((t[c]-t[v])*(t[h+1]-t[c+1])-(t[c]-t[h])*(t[v+1]-t[c+1]))}return o===0&&d===0?0:Math.abs((d-o)/o)};function Ze(t,n,e,r){for(var i=0,f=n,o=e-r;f<e;f+=r)i+=(t[o]-t[f])*(t[f+1]+t[o+1]),o=f;return i}Le.flatten=function(t){for(var n=t[0][0].length,e={vertices:[],holes:[],dimensions:n},r=0,i=0;i<t.length;i++){for(var f=0;f<t[i].length;f++)for(var o=0;o<n;o++)e.vertices.push(t[i][f][o]);i>0&&(r+=t[i-1].length,e.holes.push(r))}return e};function En(t){const[n]=Te(t),e=Fn(t,n),[r]=Te(e),i=An(e,r,n),f=Tn(i,e,n),[o,a]=Ln(f,e);return Sn(f,e,o,a)}function Rn(t,n){for(var e={},r=[],i=1,f=0;f<n.length;f++){var o=n[f].join(",");e[o]==null&&(e[o]=i,r.push(n[f]),i++)}for(var a of t)for(var s in a)a[s]=e[n[a[s]].join(",")];return[r,t]}function q(t){return t.join(",")}function Te(t){for(var n={},e=0;e<t.length;e++){var r=q(t[e]);n[r]=e}function i(...f){var o=q(f);return n[o]}return[i]}function Fn(t,n){for(var e=Array(t.length).fill(0).map(()=>Array(4).fill(1)),r=t[0][0],i=t[0][1],f=0;f<t.length;f++){t[f][0]<r&&(r=t[f][0]),t[f][1]<i&&(i=t[f][1]);var o=n(t[f][0]+1,t[f][1]),a=n(t[f][0],t[f][1]+1),s=n(t[f][0]-1,t[f][1]),u=n(t[f][0],t[f][1]-1);o!=null&&(e[f][1]=0,e[f][2]=0,e[o][0]=0,e[o][3]=0),a!=null&&(e[a][0]=0,e[a][1]=0,e[f][2]=0,e[f][3]=0),s!=null&&(e[s][1]=0,e[s][2]=0,e[f][0]=0,e[f][3]=0),u!=null&&(e[f][0]=0,e[f][1]=0,e[u][2]=0,e[u][3]=0)}var l={};for(var d in t)for(var c=t[d][0],h=t[d][1],f=0;f<4;f++){var v=c,p=h;f==1&&(v+=1),f==2&&(v+=1,p+=1),f==3&&(p+=1);var _=v+","+p;l[_]==null?l[_]={number:1,index:d,face_index:f}:l[_].number+=1}for(const[w,P]of Object.entries(l))P.number==3&&(e[P.index][P.face_index]=1);var L=[];for(var d in e){var c=t[d][0],h=t[d][1];for(var F in e[d])e[d][F]==1&&(F==0&&L.push([c,h]),F==1&&L.push([c+1,h]),F==2&&L.push([c+1,h+1]),F==3&&L.push([c,h+1]))}function R(w){for(var P=new Set,D=0;D<w.length;D++){var N=w[D].join(",");P.add(N)}return Array.from(P)}return R(L).map(w=>w.split(",").map(P=>parseInt(P)))}function An(t,n,e){var r=t[0][0],i=t[0][1],f=t[0][0],o=t[0][1];for(var a in t)t[a][0]<r&&(r=t[a][0]),t[a][1]<i&&(i=t[a][1]),t[a][0]>f&&(f=t[a][0]),t[a][1]>o&&(o=t[a][1]);function s(c,h,v){var p=c,_=void 0;if(h=="x")if(v=="forward")do{p=[p[0]+1,p[1]];var _=n(p)}while(_==null&&p[0]<f);else do{p=[p[0]-1,p[1]];var _=n(p)}while(_==null&&p[0]>r);else if(v=="forward")do{p=[p[0],p[1]+1];var _=n(p)}while(_==null&&p[1]<o);else do{p=[p[0],p[1]-1];var _=n(p)}while(_==null&&p[1]>i);return _}var u=new Set;function l(c,h,v){var p=c,_=s(t[c],v,h);if(_!=null){if(p>_)var L=[_,p];else var L=[p,_];var F=t[L[0]],R=t[L[1]];d(F,R,v)&&u.add(q(L))}}function d(c,h,v){if(v=="x"){var p=c[1],_,L;if(c[0]>h[0]?(_=h[0],L=c[0]):(_=c[0],L=h[0]),e([_,p-1])==null){for(var F=_;F<L;F++)if(e([F,p-1])!=null||e([F,p])==null)return!1}else for(var F=_;F<L;F++)if(e([F,p-1])==null||e([F,p])!=null)return!1}else{var F=c[0],R,w;if(c[1]>h[1]?(R=h[1],w=c[1]):(R=c[1],w=h[1]),e([F-1,R])==null){for(var p=R;p<w;p++)if(e([F-1,p])!=null||e([F,p])==null)return!1}else for(var p=R;p<w;p++)if(e([F-1,p])==null||e([F,p])!=null)return!1}return!0}for(var a in t)l(a,"forward","x"),l(a,"forward","y"),l(a,"backward","x"),l(a,"backward","y");return Array.from(u).map(c=>c.split(",").map(h=>parseInt(h)))}function Tn(t,n,e){for(var r=new Array(n.length).fill(0).map($=>[]),i=0;i<t.length;i++)r[t[i][0]].push(t[i][1]),r[t[i][1]].push(t[i][0]);function f($,b){if($[0]>b[0])var A=b,T=$;else var A=$,T=b;if(A[0]==T[0]||A[1]==T[1])return!1;if(T[1]>A[1])var y=A[0],E=T[0]-1,I=A[1],m=T[1]-1;else var y=A[0],E=T[0]-1,I=T[1],m=A[1]-1;for(var $=y;$<=E;$++){for(var C=!0,b=I;b<=m;b++)if(e([$,b])==null){C=!1;break}if(C)return!0}for(var b=I;b<=m;b++){for(var C=!0,$=y;$<=E;$++)if(e([$,b])==null){C=!1;break}if(C)return!0}return!1}var o=new Array(r.length).fill(0).map($=>[]);for(var a in r){var s=r[a];if(s.length<=2){o[a]=[s];continue}for(var u=[],i=0;i<s.length;i++)for(var l=s[i],d=n[l],c=i+1;c<s.length;c++){var h=s[c];if(!(l==null||h==null)){var v=n[h];if(f(d,v)){var p=[l,h];u.push(p)}}}o[a]=u}function _($,b){return o[$].findIndex(A=>A.includes(b))}var L=[],F=new Set,R=new Set;for(var a in o)for(var w in o[a]){let b=function(A){for(const E in o[A])if(!!N.has(`${A},${E}`)&&!R.has(`${A},${E}`)&&!D.has(`${A},${E}`)){N=new Set,D.add(`${A},${E}`),R.add(`${A},${E}`);var T=o[A][E];N.add(`${T[0]},${_(T[0],A)}`),N.add(`${T[1]},${_(T[1],A)}`),P.push(A);for(var y of T)b(y)}};var k=b;a=Number(a);var P=[],D=new Set;F.add(a),D.add(a);var N=new Set;N.add(`${a},${w}`),b(a),P.length!=0&&L.push(P)}return L}function Ln(t,n){function e(c,h){for(var v=!1,p=h[0],_=h[1],L=c.map(function($){return $[0]}),F=0,R=L.length-1;F<L.length;R=F++){var w=L[F],P=c[F][1],D=L[R],N=c[R][1],k=P>_!=N>_&&p<(D-w)*(_-P)/(N-P)+w;if(k&&(v=!v),P===_&&w===p||N===_&&D===p){v=!0;break}}return v}for(var r=Array.from(t).fill(0).map(c=>[]),i=0;i<t.length;i++)for(var f=t[i].map(c=>n[c]),o=0;o<t.length;o++)i!=o&&t[o].every(c=>e(f,n[c]))&&r[i].push(o);for(var a=new Array(t.length).fill(!1),s=new Array(t.length).fill(0).map(c=>[]),i=0;i<r.length;i++)for(var o=0;o<r[i].length;o++)s[r[i][o]].push(i);for(var i=0;i<s.length;i++)for(var o=0;o<s[i].length;o++)r[s[i][o]]=r[s[i][o]].filter(v=>!r[i].includes(v));var u=new Array(t.length).fill(0).map((c,h)=>h);u.sort((c,h)=>r[c].includes(h)?-1:1);var l=new Set;for(const c of u)l.has(c)||d(c);function d(c,h=0){if(!l.has(c)){l.add(c);for(const v of r[c])d(v,h+1);h%2==1&&(r[c]=[],a[c]=!0)}}return[r,a]}function Sn(t,n,e,r){var i=[];for(var f in t)if(!r[f]){var o=0,a=[];for(var s of t[f])a.push(...n[s]),o+=1;var u=[];for(var s of e[f]){var l=[];u.push(o);for(var d of t[s])l.push(...n[d]),o+=1;a.push(...l)}var c=He.exports(a,u);i.push({positions:a,indices:c})}return i}function Mn(t){return[(t>>0&255)/255,(t>>8&255)/255,(t>>16&255)/255,1]}function Ye(t){return t[0]+(t[1]<<8)+(t[2]<<16)-1}const Pn=[[0,0,1,0,0,1,0,0,1,0,0,1],[0,0,-1,0,0,-1,0,0,-1,0,0,-1],[0,1,0,0,1,0,0,1,0,0,1,0],[0,-1,0,0,-1,0,0,-1,0,0,-1,0],[1,0,0,1,0,0,1,0,0,1,0,0],[-1,0,0,-1,0,0,-1,0,0,-1,0,0]],Bn=[[-1,-1,1,1,-1,1,1,1,1,-1,1,1],[-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1],[-1,1,-1,-1,1,1,1,1,1,1,1,-1],[-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1],[1,-1,-1,1,1,-1,1,1,1,1,-1,1],[-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]],In=[[0,1,2,0,2,3],[4,5,6,4,6,7],[8,9,10,8,10,11],[12,13,14,12,14,15],[16,17,18,16,18,19],[20,21,22,20,22,23]],Nn=[[0,1,1,2,2,3,3,0],[4,5,5,6,6,7,7,4],[8,9,9,10,10,11,11,8],[12,13,13,14,14,15,15,12],[16,17,17,18,18,19,19,16],[20,21,21,22,22,23,23,20]],ie=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],Cn=[1,1,1];function Dn(t,n){var e=q([t[0]+1,t[1],t[2]]);return n(e)}function Un(t,n){var e=q([t[0]-1,t[1],t[2]]);return n(e)}function On(t,n){var e=q([t[0],t[1]+1,t[2]]);return n(e)}function Zn(t,n){var e=q([t[0],t[1]-1,t[2]]);return n(e)}function Hn(t,n){var e=q([t[0],t[1],t[2]+1]);return n(e)}function Xn(t,n){var e=q([t[0],t[1],t[2]-1]);return n(e)}const Me=[[0,1,0,1,0,1],[0,1,0,1,1,0],[0,1,1,0,0,1],[0,1,1,0,1,0],[1,0,0,1,0,1],[1,0,0,1,1,0],[1,0,1,0,0,1],[1,0,1,0,1,0]];var Pe=[2,2,1,1,0,0];class Yn{constructor(){this.voxels=[[0,0,0]],this.color=[],this.init_colors(this.voxels)}init_colors(n){for(var e=[],r=0;r<n.length;r++){var i=[];e.push(i);for(var f=0;f<6;f++)i.push([...Cn])}this.color.push(...e)}build_geometry(){for(var n=[],e=[],r=[],i=[],f=[],o=[],a=0,s=1,u=0;u<this.voxels.length;u++){for(var l=0,d=0,c=s-1,h=[],v=0;v<6;v++){if(this.faces[u][v]==0){d+=4;continue}r.push(...Bn[v].map((L,F)=>L+this.voxels[u][F%3]*2-this.center[F%3])),f.push(...Pn[v]),o.push(...Nn[v].map(L=>L+a-d)),i.push(...In[v].map(L=>L+a-d)),l+=4;for(var p=Mn(s),_=0;_<4;_++)h.push(...p);s++}a+=l,e.push({start:c,end:s-1}),n.push(...h)}this.id=s,this.distance=a,this.geometry_vertexes=r,this.geometry_indexes=i,this.geometry_normals=f,this.geometry_edge_index=o,this.pick_map=n,this.pick_meta=e}init(){this.build_boundary(),this.build_center(),this.build_faces(),this.build_geometry()}build(){this.build_boundary(),this.build_center(),this.build_geometry()}add(...n){this.voxels.push(...n),this.init_colors(n),this.init()}subdivide(){var n=[],e=[],r=[];for(const s in this.voxels){const u=this.voxels[s],l=this.faces[s],d=[u[0]*2,u[1]*2,u[2]*2];for(var i=0;i<8;i++){var f=[];r.push(f);for(var o=0;o<6;o++)f.push([...this.color[s][o]])}n.push([d[0],d[1],d[2]],[d[0]+1,d[1],d[2]],[d[0],d[1]+1,d[2]],[d[0]+1,d[1]+1,d[2]],[d[0],d[1],d[2]+1],[d[0]+1,d[1],d[2]+1],[d[0],d[1]+1,d[2]+1],[d[0]+1,d[1]+1,d[2]+1]);for(var o in Me){var a=Array(6).fill(0);for(var i in Me[o])Me[o][i]==1&&l[i]==1&&(a[i]=1);e.push(a)}}this.voxels=n,this.faces=e,this.color=r,this.build_boundary(),this.build_center(),this.build_geometry()}remove(...n){for(const r of n){if(this.voxels.length==1){n.splice(n.indexOf(r),1);continue}for(var e=0;e<this.voxels.length;e++)if(this.voxels[e][0]==r[0]&&this.voxels[e][1]==r[1]&&this.voxels[e][2]==r[2]){this.voxels.splice(e,1),this.faces.splice(e,1),this.color.splice(e,1);break}}this.init()}get_plane_color(n,e,r=null){var i=[];for(const l in this.pick_meta){const d=this.faces[l];for(var f=0,o=0;o<d.length;o++){if(d[o]==0){f+=1;continue}if(n.includes(l)){if(r!=null)var a=this.color[l][o];else var a=this.color[l][o];if(f==e){if(r!=null)var s=this.color[l][o].map((c,h)=>c*(1-r[3])+r[h]*r[3]);else var s=this.color[l][o].map(h=>Math.abs(1-h*.5));for(var u=0;u<4;u++)i.push(...s,1)}else for(var u=0;u<4;u++)i.push(...a,1)}else for(var u=0;u<4;u++)i.push(...this.color[l][o],1);f+=1}}return i}get_plane(n,e){var r=[];for(const o in this.voxels){const a=this.voxels[o];var i=!0;for(const s in e)if(e[s]!=0&&n[s]!=a[s]){i=!1;break}if(i){var f=this.voxels[o].map((s,u)=>s+e[u]);this.voxels.some(s=>s[0]==f[0]&&s[1]==f[1]&&s[2]==f[2])||r.push(o)}}return r}get_contiguous(n,e,r){var i=[];const f=this.voxels,o=new Set;function a(s){for(const c of n){const h=f[c];var u=!0;for(const v in r)if(r[v]!=0){if(s[v]!=h[v]){u=!1;break}}else if(Math.abs(s[v]-h[v])>1){u=!1;break}if(u){var l=f[c].map((v,p)=>v+r[p]),d=`${l[0]},${l[1]},${l[2]}`;o.has(d)||(o.add(d),i.push(c),a(f[c]))}}}return a(e),i}get_vertical_line(n,e,r){var i=[];for(const s in this.voxels){const u=this.voxels[s];var f=!0,o=-1;for(const l in e)if(e[l]!=0&&(o=l,n[l]!=u[l])){f=!1;break}if(o==0){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==2){f=!1;break}}else if(o==2){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==0){f=!1;break}}else if(o==1){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==0){f=!1;break}}else f=!1;if(f){var a=this.voxels[s].map((l,d)=>l+e[d]);this.voxels.some(l=>l[0]==a[0]&&l[1]==a[1]&&l[2]==a[2])||i.push(s)}}return i}get_horizontal_line(n,e,r){var i=[];for(const s in this.voxels){const u=this.voxels[s];var f=!0,o=-1;for(const l in e)if(e[l]!=0){if(o=l,n[l]!=u[l]){f=!1;break}}else if(n[l]!=u[l]&&l==1){f=!1;break}if(o==1){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==2){f=!1;break}}if(f){var a=this.voxels[s].map((l,d)=>l+e[d]);this.voxels.some(l=>l[0]==a[0]&&l[1]==a[1]&&l[2]==a[2])||i.push(s)}}return i}highlight_plane(n,e,r,i,f=null){var o=Ye(n),c=[],a=0;for(const v in this.pick_meta){const p=this.faces[v],_=this.pick_meta[v];if(o>=_.start&&o<_.end)for(var s=0,u=0;u<p.length;u++){if(p[u]==0){s+=1;continue}if(o==a){var l;switch(r){case"Plane":l=this.get_plane(this.voxels[v],ie[s]);break;case"Horizontal line":l=this.get_horizontal_line(this.voxels[v],ie[s]);break;case"Vertical line":l=this.get_vertical_line(this.voxels[v],ie[s]);break}i&&(l=this.get_contiguous(l,this.voxels[v],ie[s]));var d=[];for(const L of l)d.push(this.color[L][s]);return e({voxel:l.map(L=>this.voxels[L]),direction:ie[s],color:d,mouse_color:this.color[v][u],index:v}),this.get_plane_color(l,s,f)}s+=1,a+=1}else for(var u=0;u<p.length;u++)p[u]!=0&&(a+=1)}var c=[];for(const v in this.pick_meta){const p=this.faces[v];for(var u=0;u<p.length;u++)if(p[u]!=0)for(var h=0;h<4;h++)c.push(...this.color[v][u],1)}return c}printPointsWithinCircle(n,e){if(n<1)return[[[e[0],e[1]],1]];const r={x:e[0],y:e[1]};var i=[];for(let f=r.x-n;f<=r.x+n;f++)for(let o=r.y-n;o<=r.y+n;o++){const a=Math.sqrt((f-r.x)**2+(o-r.y)**2);a<=n&&i.push([[f,o],1-a/n])}return i}printPointsWithinSquare(n,e){if(n<1)return[[[e[0],e[1]],1]];n=Math.round(n/2);const r={x:e[0],y:e[1]};var i=[];for(let o=r.x-n;o<=r.x+n;o++)for(let a=r.y-n;a<=r.y+n;a++){var f=Math.max(Math.abs(o-r.x)+Math.abs(a-r.y),1);i.push([[o,a],1-f/n/2])}return i}get_highlight(n,e,r=null,i,f,o){const[a]=Te(this.voxels),s={};var u=new Set(n.map(T=>Ye(T))),l=Array.from(u),d=[],c=0,h=[],v=new Set;for(const T in this.pick_meta){const y=this.faces[T],E=this.pick_meta[T];if(l.some(I=>I>=E.start&&I<E.end))for(var p=0,_=0;_<y.length;_++){if(y[_]==0){p+=1;continue}if(u.has(c)){var L=[...this.voxels[T]];if(L.splice(Pe[p],1),f)var F=this.printPointsWithinCircle(i-1,L);else var F=this.printPointsWithinSquare(i,L);for(const I of F){var[R,w]=I,P=[...R];P.splice(Pe[p],0,this.voxels[T][Pe[p]]);var D=a(P),N=`${D},${_}`;if(v.has(N)){s[N].distance=Math.max(s[N].distance,w);continue}if(D!=null){v.add(N);var k={voxel:[this.voxels[D]],direction:ie[p],color:[this.color[D][_]],distance:w,mouse_color:this.color[D][_],index:T};s[N]=k,h.push(k)}}}p+=1,c+=1}else for(var _=0;_<y.length;_++)y[_]!=0&&(c+=1)}for(const T in this.faces)for(var $=this.faces[T],_=0;_<$.length;_++)if($[_]!=0){for(var b=0;b<4;b++)if(v.has(`${T},${_}`)){const E=s[`${T},${_}`];if(r)var A=this.color[T][_].map((I,m)=>{var C=o;if(C>0)var B=E.distance/C;else var B=1;var M=I*(1-r[3]*B)+r[m]*r[3]*B;return M});else var A=this.color[T][_].map(m=>Math.abs(1-m*.5));d.push(...A,1)}else d.push(...this.color[T][_],1);c+=1}return e(h),d}build_faces(){const n=this.voxels,e=new Array(n.length).fill(0).map(d=>[1,1,1,1,1,1]),[r]=Te(this.voxels);for(var i=0;i<n.length;i++){var f=Dn(n[i],r);f&&(e[i][4]=0,e[f][5]=0);var o=Un(n[i],r);o&&(e[i][5]=0,e[o][4]=0);var a=On(n[i],r);a&&(e[i][2]=0,e[a][3]=0);var s=Zn(n[i],r);s&&(e[i][3]=0,e[s][2]=0);var u=Hn(n[i],r);u&&(e[i][0]=0,e[u][1]=0);var l=Xn(n[i],r);l&&(e[i][1]=0,e[l][0]=0)}this.faces=e}build_center(){const n=this.boundary;this.center=n[0].map((e,r)=>e+n[1][r])}build_boundary(){const n=this.voxels;for(var e=n[0],r=n[0],i=1;i<n.length;i++)e=e.map((f,o)=>Math.min(f,n[i][o])),r=r.map((f,o)=>Math.max(f,n[i][o]));this.boundary=[e,r]}}class Gn{constructor(n,e,r){this.gl=n,this.program=e,this.canvas=r,this.attribute_matrix_4_mat_float=fe((i,f)=>{var o=n.getUniformLocation(this.program,i);n.uniformMatrix4fv(o,!1,f)}),this.uniform_float=fe((i,f)=>{var o=n.getUniformLocation(this.program,i);n.uniform1f(o,f)}),this.uniform_4_float=fe((i,f)=>{var o=n.getUniformLocation(this.program,i);n.uniform4f(o,f[0],f[1],f[2],f[3])}),this.uniform_3_float=fe((i,f)=>{var o=n.getUniformLocation(this.program,i);n.uniform3f(o,f[0],f[1],f[2])}),this.attribute_matrix_3_float=fe((i,f,o)=>{var a=n.getAttribLocation(this.program,i);o!=null&&n.deleteBuffer(o);var s=n.createBuffer();return n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,new Float32Array(f),n.STATIC_DRAW),n.vertexAttribPointer(a,3,n.FLOAT,!1,0,0),n.enableVertexAttribArray(a),s}),this.attribute_matrix_4_float=fe((i,f,o)=>{var a=n.getAttribLocation(this.program,i);o!=null&&n.deleteBuffer(o);var s=n.createBuffer();return n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,new Float32Array(f),n.STATIC_DRAW),n.vertexAttribPointer(a,4,n.FLOAT,!1,0,0),n.enableVertexAttribArray(a),s})}set face(n){this.faces=n}buffer(n){const e=this.gl,r=this.canvas,i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i);const f=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,f),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,f);const o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0),n(),e.deleteTexture(o),e.deleteRenderbuffer(f),e.deleteFramebuffer(i),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),o}getPixel(n,e){const r=this.gl,i=new Uint8Array(4);return r.readPixels(n,e,1,1,r.RGBA,r.UNSIGNED_BYTE,i),i}drawSolid(n){const e=this.gl;if(!n){if(this.faces==null)throw"No faces defined";n=this.faces}var r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),e.STATIC_DRAW),e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),e.drawElements(e.TRIANGLES,n.length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.deleteBuffer(r)}drawLines(n){const e=this.gl;if(!n){if(this.faces==null)throw"No faces defined";n=this.faces}var r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),e.STATIC_DRAW),e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),e.drawElements(e.LINES,n.length,e.UNSIGNED_SHORT,0),e.deleteBuffer(r)}}function fe(t){var n={};return new Proxy({},{set:function(e,r,i){return n[r]=t(r,i,n[r]),!0}})}function Wn(t,n,e){const r=t.getContext("webgl2",{antialias:!0}),i=r.createProgram(),f=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(f,e),r.compileShader(f),r.attachShader(i,f);const o=r.createShader(r.VERTEX_SHADER);return r.shaderSource(o,n),r.compileShader(o),r.attachShader(i,o),r.linkProgram(i),r.useProgram(i),[r,new Gn(r,i,t)]}var Ge=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)});function Jn(){var t=new Ge(16);return Ge!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function zn(t,n){if(t===n){var e=n[1],r=n[2],i=n[3],f=n[6],o=n[7],a=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=e,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=f,t[11]=n[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t}function Vn(t,n){var e=n[0],r=n[1],i=n[2],f=n[3],o=n[4],a=n[5],s=n[6],u=n[7],l=n[8],d=n[9],c=n[10],h=n[11],v=n[12],p=n[13],_=n[14],L=n[15],F=e*a-r*o,R=e*s-i*o,w=e*u-f*o,P=r*s-i*a,D=r*u-f*a,N=i*u-f*s,k=l*p-d*v,$=l*_-c*v,b=l*L-h*v,A=d*_-c*p,T=d*L-h*p,y=c*L-h*_,E=F*y-R*T+w*A+P*b-D*$+N*k;return E?(E=1/E,t[0]=(a*y-s*T+u*A)*E,t[1]=(i*T-r*y-f*A)*E,t[2]=(p*N-_*D+L*P)*E,t[3]=(c*D-d*N-h*P)*E,t[4]=(s*b-o*y-u*$)*E,t[5]=(e*y-i*b+f*$)*E,t[6]=(_*w-v*N-L*R)*E,t[7]=(l*N-c*w+h*R)*E,t[8]=(o*T-a*b+u*k)*E,t[9]=(r*b-e*T-f*k)*E,t[10]=(v*D-p*w+L*F)*E,t[11]=(d*w-l*D-h*F)*E,t[12]=(a*$-o*A-s*k)*E,t[13]=(e*A-r*$+i*k)*E,t[14]=(p*R-v*P-_*F)*E,t[15]=(l*P-d*R+c*F)*E,t):null}function Kn(t,n,e,r){function i(m,C,B,M){var z=Math.tan(m*.5*Math.PI/180);return[.5/z,0,0,0,0,.5*C/z,0,0,0,0,-(M+B)/(M-B),-1,0,0,-2*M*B/(M-B),0]}var f=i(40,t.width/t.height,1,1e3),o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const s=Jn();Vn(s,a),zn(s,s),e.viewport(0,0,t.width,t.height),n.attribute_matrix_4_mat_float.uNormalMatrix=s,a[14]=a[14]-6;var u=0,l=!1,d,c,h=0,v=0,p=null,_=!1;document.addEventListener("keydown",function(m){m.key=="Control"&&(_=!0)}),document.addEventListener("keyup",function(m){m.key=="Control"&&(_=!1)});var L=function(m){if(!!_)return m.button==2?p="pan":p="rotate",l=!0,d=m.pageX,c=m.pageY,m.preventDefault(),!1},F=function(m){l=!1};const R={x:0,y:0};var w=function(m){const C=t.__element.getBoundingClientRect();if(R.x=(m.clientX-C.left)*e.canvas.width/e.canvas.clientWidth,R.y=e.canvas.height-(m.clientY-C.top)*e.canvas.height/e.canvas.clientHeight-1,!l)return!1;h=(m.pageX-d)*2*Math.PI/t.width,v=(m.pageY-c)*2*Math.PI/t.height,p=="rotate"?(b+=h,A+=v):p=="pan"&&P(h,v),d=m.pageX,c=m.pageY,m.preventDefault()};function P(m,C){a[12]-=m*a[14]/2,a[13]+=C*a[14]/2}t.$on("mousedown",L),t.$on("mouseup",F),t.$on("mouseout",F),t.$on("mousemove",w);var D=function(m){m.preventDefault();var C=m.wheelDelta?m.wheelDelta/40:m.detail?-m.detail:0,B=1.3;return C&&N(C<0?1*B:1/B),m.preventDefault()&&!1};function N(m){a[14]*=m}t.$on("wheel",D);function k(m,C){var B=Math.cos(C),M=Math.sin(C),z=m[1],H=m[5],K=m[9];m[1]=m[1]*B-m[2]*M,m[5]=m[5]*B-m[6]*M,m[9]=m[9]*B-m[10]*M,m[2]=m[2]*B+z*M,m[6]=m[6]*B+H*M,m[10]=m[10]*B+K*M}function $(m,C){var B=Math.cos(C),M=Math.sin(C),z=m[0],H=m[4],K=m[8];m[0]=B*m[0]+M*m[2],m[4]=B*m[4]+M*m[6],m[8]=B*m[8]+M*m[10],m[2]=B*m[2]-M*z,m[6]=B*m[6]-M*H,m[10]=B*m[10]-M*K}var b=.8,A=.8;function T(){l||(h*=u,v*=u,b+=h,A+=v),o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,A=Math.max(-Math.PI/2,Math.min(Math.PI/2,A)),$(o,b),k(o,A),n.attribute_matrix_4_mat_float.projection_matrix=f,n.attribute_matrix_4_mat_float.view_matrix=a,n.attribute_matrix_4_mat_float.model_matrix=o}function y(){a[12]=0,a[13]=0}function E(){b=.8,A=.8}function I(m){a[14]=m}return{update:T,mouse:R,zoom:N,resetPan:y,resetRotation:E,setZoom:I}}function jn(t){var n=0;function e(r){r*=.001;const i=r-n;n=r;const f=1/i;t(f.toFixed(1)),requestAnimationFrame(e)}e()}function oe(t,n,e){var r=[];const i=se({name:e});for(const f of t){const o=g("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(i.name==f.name?" button-selected":""),elements:[typeof i<"u"?i:void 0,typeof name<"u"?name:void 0,typeof f<"u"?f:void 0,typeof name<"u"?name:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>f.name,elements:[typeof f<"u"?f:void 0,typeof name<"u"?name:void 0]});o.$on("click",()=>{i.name=f.name,n(f.name)}),r.push(o)}return r}function Y(t,n,e=!0){const r=se({value:e});var i=g("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(r.value?" button-selected":""),elements:[typeof r<"u"?r:void 0,typeof value<"u"?value:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]});return i.$on("click",()=>{r.value=!r.value,n(r.value)}),i}function U(t,n){var e=g("button",{class:"button"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]});return e.$on("click",()=>{n()}),e}function Qn({callback:t,start:n,color:e}){t||(t=u=>{});const r=se({absolute_value:0,relative_value:0});var i=V(),f=g("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--accent-color:${e()};`,elements:[typeof e<"u"?e:void 0]}},g("div",{class:"trackbar-background"}),g("div",{class:"trackbar-foreground"}),g("div",{class:"trackbar-thumb",ref:i,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${r.absolute_value}px`,elements:[typeof r<"u"?r:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));f.$onUpdate(()=>{var u=f.__element.getBoundingClientRect();r.relative_value=n(),r.absolute_value=u.width*n()/255});var o=!1,a;function s(u){var l=u-a,d=f.__element.getBoundingClientRect();l<0&&(l=0),l>d.width&&(l=d.width),r.absolute_value=l,r.relative_value=r.absolute_value/d.width*255,t(r.relative_value)}return document.addEventListener("mousemove",u=>{o&&s(u.clientX)}),i.$on("mousedown",u=>{u.stopPropagation(),o=!0,a=u.clientX-r.absolute_value}),f.$on("mousedown",u=>{var l=f.__element.getBoundingClientRect();a=l.left,s(u.clientX),o=!0}),document.addEventListener("mouseup",u=>{o=!1}),f}function Be({callback:t,start:n,colorFrom:e,colorTo:r}){t||(t=l=>{});const i=se({absolute_value:0,relative_value:0});var f=V(),o=g("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--color-from:${e()};--color-to:${r()};`,elements:[typeof e<"u"?e:void 0,typeof r<"u"?r:void 0]}},g("div",{class:"trackbar-data"}),g("div",{class:"trackbar-thumb",ref:f,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${i.absolute_value}px`,elements:[typeof i<"u"?i:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));o.$onUpdate(()=>{var l=o.__element.getBoundingClientRect();i.relative_value=n(),i.absolute_value=l.width*n()/255});var a=!1,s;function u(l){var d=l-s,c=o.__element.getBoundingClientRect();d<0&&(d=0),d>c.width&&(d=c.width),i.absolute_value=d,i.relative_value=i.absolute_value/c.width*255,t(i.relative_value)}return document.addEventListener("mousemove",l=>{a&&u(l.clientX)}),f.$on("mousedown",l=>{l.stopPropagation(),a=!0,s=l.clientX-i.absolute_value}),o.$on("mousedown",l=>{var d=o.__element.getBoundingClientRect();s=d.left,u(l.clientX),a=!0}),document.addEventListener("mouseup",l=>{a=!1}),o}function qn({callback:t,start:n}){const e=se({absolute_value:0,relative_value:0,min_color:"0,0,0",max_color:"255,255,255",min_limit_percent:0,max_limit_percent:100});var r=0,i=0,f=0,o=0,a=255;t||(t=h=>{});var s=V(),u=g("div",null,g("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--color-from:${e.min_color};--color-to:${e.max_color};--min-limit:${e.min_limit_percent}%;--max-limit:${e.max_limit_percent}%`,elements:[typeof e<"u"?e:void 0,typeof min_color<"u"?min_color:void 0,typeof e<"u"?e:void 0,typeof max_color<"u"?max_color:void 0,typeof e<"u"?e:void 0,typeof min_limit_percent<"u"?min_limit_percent:void 0,typeof e<"u"?e:void 0,typeof max_limit_percent<"u"?max_limit_percent:void 0]}},g("div",{class:"trackbar-bright-data"}),g("div",{class:"trackbar-thumb",ref:s,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${e.absolute_value}px`,elements:[typeof e<"u"?e:void 0,typeof absolute_value<"u"?absolute_value:void 0]}})));u.$onUpdate(()=>{var h=u.__element.getBoundingClientRect(),v=n();r=v[0],i=v[1],f=v[2];var p=Math.min(r,i,f),_=Math.max(r,i,f),L=(r+i+f)/3;e.min_color=[r-p,i-p,f-p].join(","),e.max_color=[r+(255-_),i+(255-_),f+(255-_)].join(","),e.relative_value=L,e.absolute_value=h.width*L/255;var F=L-p,R=255-(_-L);o=h.width*F/255,a=h.width*R/255,e.min_limit_percent=F/255*100,e.max_limit_percent=R/255*100});var l=!1,d;function c(h){var v=e.relative_value,p=r-v,_=i-v,L=f-v,F=h-d,R=u.__element.getBoundingClientRect();F<o&&(F=o),F>a&&(F=a),e.absolute_value=F,e.relative_value=e.absolute_value/R.width*255,r=e.relative_value+p,i=e.relative_value+_,f=e.relative_value+L,t([r,i,f])}return document.addEventListener("mousemove",h=>{l&&c(h.clientX)}),s.$on("mousedown",h=>{h.stopPropagation(),l=!0,d=h.clientX-e.absolute_value}),u.$on("mousedown",h=>{var v=u.__element.getBoundingClientRect();d=v.left,c(h.clientX),l=!0}),document.addEventListener("mouseup",h=>{l=!1}),u}function nn(t,n){var e=JSON.stringify(n),r=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(r),f=document.createElement("a");f.download=t,f.href=i,f.textContent="Download",f.click(),f.remove()}function et(t,n){var e=new Blob([n],{type:"plain/text"}),r=URL.createObjectURL(e),i=document.createElement("a");i.download=t,i.href=r,i.textContent="Download",i.click(),i.remove()}async function tn(t,n){var e=document.createElement("input");e.type="file",e.accept="."+t,e.onchange=r=>{var i=r.target.files[0],f=new FileReader;f.onload=function(o){var a=o.target.result;n(JSON.parse(a))},f.readAsText(i)},e.click(),e.remove()}function We(t,n){var e=document.createElement("a");e.download=t,e.href=n,e.click(),e.remove()}function nt({set:t,get:n}){const e=V();var r=0,i=0,f=0,o=255,a=255,s=255,u=255,l=255;const d=V();var c=[];function h(){tn("col",y=>{d.$html("");for(var E=0;E<y.length;E++)p(y[E][0],y[E][1],y[E][2],y[E][3])})}function v(){nn("color_list.col",c)}function p(y,E,I,m){c.push([y,E,I,m]);var C=g("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${y},${E},${I},${m/255})`,elements:[typeof y<"u"?y:void 0,typeof E<"u"?E:void 0,typeof I<"u"?I:void 0,typeof m<"u"?m:void 0]}}),B=!1;C.$on("mousedown",M=>(B=!0,M.button==1&&M.preventDefault(),!1)),C.$on("contextmenu",M=>(M.preventDefault(),!1)),document.addEventListener("mouseup",M=>{setTimeout(()=>{B=!1},100)}),C.$on("mouseup",M=>{!B||(M.button==0?(r=y,i=E,f=I,o=m,P(),w&&w.$update()):M.button==2?(a=y,s=E,u=I,l=m,P("background"),w&&w.$update()):C.$remove())}),C.$parent(d)}function _(y,E,I){return[y,E,I].map(m=>parseInt(m).toString(16).padStart(2,"0")).join("")}function L(y){var E=parseInt(y.substring(0,2),16),I=parseInt(y.substring(2,4),16),m=parseInt(y.substring(4,6),16);return[E,I,m]}function F(y){return y.length==6&&!isNaN(parseInt(y,16))}function R(y){var E=y.target.value;if(E.startsWith("#")&&(E=E.substring(1),e.value=E),!!F(E)){var I=L(E);r=I[0],i=I[1],f=I[2],P(),w&&w.$update()}}var w=g("div",{style:"width:100%"},g("div",{style:"width:100px;margin:10px;position:relative"},g("div",{class:"hash-tag"},"#"),g("input",{type:"text",class:"input hex-input",maxLength:"6","on:input":R,ref:e})),g("div",{style:"display:flex;flex-direction:row"},g("div",{style:"width:100%;padding:10px"},g(Be,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`0,${i},${f}`,elements:[typeof i<"u"?i:void 0,typeof f<"u"?f:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`255,${i},${f}`,elements:[typeof i<"u"?i:void 0,typeof f<"u"?f:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:y=>N(y),elements:[typeof x<"u"?x:void 0,typeof N<"u"?N:void 0,typeof x<"u"?x:void 0]}}),g(Be,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},0,${f}`,elements:[typeof r<"u"?r:void 0,typeof f<"u"?f:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},255,${f}`,elements:[typeof r<"u"?r:void 0,typeof f<"u"?f:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:y=>k(y),elements:[typeof x<"u"?x:void 0,typeof k<"u"?k:void 0,typeof x<"u"?x:void 0]}}),g(Be,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>f,elements:[typeof f<"u"?f:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},${i},0`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},${i},255`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:y=>$(y),elements:[typeof x<"u"?x:void 0,typeof $<"u"?$:void 0,typeof x<"u"?x:void 0]}}),g(qn,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>[r,i,f],elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof f<"u"?f:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:y=>A(y),elements:[typeof x<"u"?x:void 0,typeof A<"u"?A:void 0,typeof x<"u"?x:void 0]}}))),g("div",{class:"row"},g("div",{class:"color-area"},g("div",{class:"color-container"},g("div",{class:"background color-item"},g("div",{class:"backdrop"}),g("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${a},${s},${u},${l/255})`,elements:[typeof a<"u"?a:void 0,typeof s<"u"?s:void 0,typeof u<"u"?u:void 0,typeof l<"u"?l:void 0]}})),g("div",{class:"foreground color-item"},g("div",{class:"backdrop"}),g("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${r},${i},${f},${o/255})`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof f<"u"?f:void 0,typeof o<"u"?o:void 0]}}))),g("div",{class:"hover-icon-container",style:"margin-left:5px","on:click":T},g("i",{class:"fa-solid fa-arrows-rotate hover-icon"}))),g("div",{class:"alpha-area",style:"margin-top:-10px"},g(Qn,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>o,elements:[typeof o<"u"?o:void 0]},color:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},${i},${f};`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof f<"u"?f:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:y=>b(y),elements:[typeof x<"u"?x:void 0,typeof b<"u"?b:void 0,typeof x<"u"?x:void 0]}}))),g("div",{class:"color-history-container"},g("div",{style:"display:inline-block",ref:d}),g("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${r},${i},${f},${o/255})`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof f<"u"?f:void 0,typeof o<"u"?o:void 0]},"on:click":()=>p(r,i,f,o)},g("i",{class:"fa fa-plus"})),g("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${a},${s},${u},${l/255})`,elements:[typeof a<"u"?a:void 0,typeof s<"u"?s:void 0,typeof u<"u"?u:void 0,typeof l<"u"?l:void 0]},"on:click":()=>p(a,s,u,l)},g("i",{class:"fa fa-plus"}))),g("button",{class:"button","on:click":()=>v()},"Save colors"),g("button",{class:"button","on:click":()=>h()},"Load colors"));function P(y="foreground"){n(y,{r,g:i,b:f,a:o},{r:a,g:s,b:u,a:l}),e.value=_(r,i,f)}t(D());function D(){return(y,E)=>{y!=null&&(r=y.r,i=y.g,f=y.b,o=y.a),E!=null&&(a=E.r,s=E.g,u=E.b,l=E.a),w&&w.$update()}}function N(y){r=y,w&&w.$update(),P()}function k(y){i=y,w&&w.$update(),P()}function $(y){f=y,w&&w.$update(),P()}function b(y){o=y,w&&w.$update(),P()}function A(y){r=y[0],i=y[1],f=y[2],w&&w.$update(),P()}function T(){var y=a;a=r,r=y,y=s,s=i,i=y,y=u,u=f,f=y,y=l,l=o,o=y,w&&w.$update(),P()}return P(),w.$onMounted(()=>{w.$update()}),w}const be=[2,2,1,1,0,0],tt=[1,0,1,0,1,0];function Je(t){for(var n=t[0][0],e=t[0][0],r=t[0][1],i=t[0][1],f=1;f<t.length;f++){var o=t[f];o[0]<n&&(n=o[0]),o[0]>e&&(e=o[0]),o[1]<r&&(r=o[1]),o[1]>i&&(i=o[1])}return[n,r,e,i]}function rt(t){for(var n=t.voxels,e=t.faces,r=t.color,i={},f=0;f<e.length;f++)for(var o=0,a=0;a<e[f].length;a++){if(e[f][a]==0){o+=1;continue}var s=`${n[f][be[o]]},${o}`;i[s]==null&&(i[s]={direction:o,relevant:be[o],position:n[f][be[o]]+tt[o],data:[],colors:[]}),i[s].data.push(n[f].filter((j,ee)=>ee!=be[o])),i[s].colors.push(r[f][o]),o+=1}for(var f in i)i[f].geometry=En(i[f].data);var u=[],l=[],d=[],c=[],h=[],v=[],p=0,_=0,L=0,F=0,R=0,w=Object.values(i).map(j=>Je(j.data)),P=w.reduce((j,ee)=>j+ee[2]-ee[0]+1,0),D=w.reduce((j,ee)=>Math.max(j,ee[3]-ee[1]+1),0),N=Math.ceil(Math.sqrt(P*D)),k=0;for(var f in i){var $=i[f],b=!1;($.direction==4||$.direction==5)&&(b=!0);var[A,T,y,E]=Je($.data);if(b){var I=E,m=y;_-=T}else{var I=y,m=E;_-=A}_>N&&(_=0,L+=k,k=0),m>k&&(k=m);for(var re in $.data){var C=$.colors[re],B=$.data[re];b?v.push({color:C,position:[B[1]+_,L+B[0]]}):v.push({color:C,position:[B[0]+_,L+B[1]]})}for(var re in $.geometry){for(var M=$.geometry[re],a=0;a<M.positions.length;a+=2){var z=[M.positions[a],M.positions[a+1]];z.splice($.relevant,0,$.position),d.push(z),b?u.push([M.positions[a+1]+_,L-1+M.positions[a]+1]):u.push([M.positions[a]+_,L-1+M.positions[a+1]+1])}for(var a=0;a<M.indices.length;a+=3){h.push($.direction+1);var H=[M.indices[a]+p,M.indices[a+1]+p,M.indices[a+2]+p];if($.direction==1){var K=H[0];H[0]=H[1],H[1]=K}if($.direction==2){var K=H[0];H[0]=H[2],H[2]=K}if($.direction==5){var K=H[1];H[1]=H[2],H[2]=K}l.push(H.map(an=>an+1)),c.push(H)}p+=M.positions.length/2}_+=I+1,_>R&&(R=_),L>F&&(F=L)}F+=D,u=u.map(j=>[j[0]/R,j[1]/F]);for(var f in v)v[f].position=[v[f].position[0],F-1-v[f].position[1]];var[on,re]=Rn(c,d);return{vert:on,index:re,normal:h,uv_position:u,uv_index:l,uv_color:v,width:R,height:F}}var me=1e3;function rn(t){const n=V(),e=g("div",{class:"modal-background","v-show":"visible"},g("div",{class:"modal-prompt"},g("span",{class:"close-button",ref:n,id:"close"},g("i",{class:"fa-solid fa-xmark"})),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]}));e.$style("z-index",{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>me++,elements:[typeof me<"u"?me:void 0]});function r(){me--,e.$remove()}return n.$on("click",r),e.$parent(document.body),{close:r}}var it=`
vn -0.000000 0.000000 1.000000
vn 0.000000 0.000000 -1.000000
vn 0.000000 1.000000 0.000000
vn 0.000000 -1.000000 0.000000
vn 1.000000 0.000000 0.000000
vn -1.000000 -0.000000 -0.000000
`;function ft({vert:t,index:n,normal:e,uv_position:r,uv_index:i,uv_color:f,width:o,height:a}){for(var s="",u=0;u<t.length;u++)s+=`v ${t[u][0]} ${t[u][1]} ${t[u][2]}
`;s+=`
`;for(var u=0;u<r.length;u++)s+=`vt ${r[u][0]} ${r[u][1]}
`;s+=`
`,s+=it,s+=`
`;for(var u=0;u<n.length;u++)s+=`f ${n[u][0]}/${i[u][0]}/${e[u]} ${n[u][1]}/${i[u][1]}/${e[u]} ${n[u][2]}/${i[u][2]}/${e[u]}
`;return s}function ot({uv_color:t,width:n,height:e},r=32){var i=document.createElement("canvas");i.width=n*r,i.height=e*r;var f=i.getContext("2d");for(var o of t){var[a,s]=o.position,[u,l,d]=o.color;f.fillStyle=`rgb(${u*255},${l*255},${d*255})`,f.fillRect(a*r,s*r,r,r)}var c=i.toDataURL("image/png");return i.remove(),c}function at({uv_color:t,width:n,height:e}){var r=document.createElement("canvas");r.width=n,r.height=e;for(var i=r.getContext("2d"),f=i.createImageData(n,e),o=0;o<f.width;o++)for(var a=0;a<f.height;a++){var s=(o+a*f.width)*4;f.data[s]=255,f.data[s+1]=1,f.data[s+2]=1,f.data[s+3]=1}for(var u of t){var[o,a]=u.position,[l,d,c]=u.color,s=(o+a*n)*4;f.data[s+0]=l*255,f.data[s+1]=d*255,f.data[s+2]=c*255,f.data[s+3]=255}i.putImageData(f,0,0);var h=r.toDataURL("image/png");return r.remove(),h}var ue=null,ye=null,xe=null,ge=null,$e=null,we=null,ke=null,Ee=null,X=Z;const Ie=[{name:"Pen"},{name:"Line"},{name:"Plane"},{name:"Horizontal line"},{name:"Vertical line"}],Ne=[{name:"Sculpt"},{name:"Paint"}];var W="Pen",ne="Sculpt",le=!0,Re=!0,Z=[1,0,0],Q=[1,1,1];function Ce(t,n,e){Z=[n.r/255,n.g/255,n.b/255,n.a/255],Q=[e.r/255,e.g/255,e.b/255,e.a/255],t=="foreground"?X=Z:X=Q}var Fe=null,Ae=null;function ze(t,n){var e=null;t!=null&&(e={r:t[0]*255,g:t[1]*255,b:t[2]*255,a:255});var r=null;n!=null&&(r={r:n[0]*255,g:n[1]*255,b:n[2]*255,a:255}),Fe(e,r)}const J=se({radius:1,feather:0}),G=V(),st=V();var de=!0;const ut=g("div",{class:"main"},g("div",{class:"info"},g("p",null,g("h3",null,"Mode"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>oe(Ne,t=>{ne=t,X=Z},"Sculpt"),elements:[typeof oe<"u"?oe:void 0,typeof Ne<"u"?Ne:void 0,typeof x<"u"?x:void 0,typeof ne<"u"?ne:void 0,typeof x<"u"?x:void 0,typeof X<"u"?X:void 0,typeof Z<"u"?Z:void 0]}),g("p",null,g("h3",null,"Color"),g(nt,{get:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:(t,n,e)=>Ce(t,n,e),elements:[typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0,typeof Ce<"u"?Ce:void 0,typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0]},set:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:t=>Fe=t,elements:[typeof fn<"u"?fn:void 0,typeof Fe<"u"?Fe:void 0,typeof fn<"u"?fn:void 0]}}),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Fill all",()=>Ae()),elements:[typeof U<"u"?U:void 0,typeof Ae<"u"?Ae:void 0]})),g("canvas",{ref:G}),g("div",{class:"info"},g("p",null,"FPS: ",g("span",{ref:st})),g("p",null,g("h3",null,"Tool"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>oe(Ie,t=>W=t,"Pen"),elements:[typeof oe<"u"?oe:void 0,typeof Ie<"u"?Ie:void 0,typeof x<"u"?x:void 0,typeof W<"u"?W:void 0,typeof x<"u"?x:void 0]}),g("p",null,g("h3",null,"Tool options"),g("label",null,"Radius"),g("div",{style:"width:300px"},g("input",{type:"number",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>J.radius,elements:[typeof J<"u"?J:void 0,typeof radius<"u"?radius:void 0]},t=>J.radius=t],class:"input"})),g("label",null,"Feather"),g("div",{style:"width:300px"},g("input",{type:"number",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>J.feather,elements:[typeof J<"u"?J:void 0,typeof feather<"u"?feather:void 0]},t=>J.feather=t],min:"0",max:"1",step:"0.1",class:"input"})),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>Y("Contiguous",t=>le=t),elements:[typeof Y<"u"?Y:void 0,typeof x<"u"?x:void 0,typeof le<"u"?le:void 0,typeof x<"u"?x:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>Y("Circle",t=>de=t),elements:[typeof Y<"u"?Y:void 0,typeof x<"u"?x:void 0,typeof de<"u"?de:void 0,typeof x<"u"?x:void 0]}),g("p",null,g("h3",null,"View"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>Y("Wireframe",t=>Re=t),elements:[typeof Y<"u"?Y:void 0,typeof x<"u"?x:void 0,typeof Re<"u"?Re:void 0,typeof x<"u"?x:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Reset pan",()=>$e()),elements:[typeof U<"u"?U:void 0,typeof $e<"u"?$e:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Reset rotation",()=>we()),elements:[typeof U<"u"?U:void 0,typeof we<"u"?we:void 0]}),g("p",null,g("h3",null,"Actions"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Subdivide",()=>ue()),elements:[typeof U<"u"?U:void 0,typeof ue<"u"?ue:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Undo",()=>ke()),elements:[typeof U<"u"?U:void 0,typeof ke<"u"?ke:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Redo",()=>Ee()),elements:[typeof U<"u"?U:void 0,typeof Ee<"u"?Ee:void 0]}),g("p",null,g("h3",null,"Persistence"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Save project",()=>ye()),elements:[typeof U<"u"?U:void 0,typeof ye<"u"?ye:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Load project",()=>xe()),elements:[typeof U<"u"?U:void 0,typeof xe<"u"?xe:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Export obj",()=>ge()),elements:[typeof U<"u"?U:void 0,typeof ge<"u"?ge:void 0]})));G.width=800;G.height=800;ut.$parent(document.body);var S=new Yn;S.init();ge=()=>{var t=localStorage.getItem("save_obj_preferences"),n=!0,e=!0,r="object",i=1;t!=null&&(t=JSON.parse(t),n=t.texture,e=t.geometry,r=t.filename,i=t.square_size);var f=V(),o=g("div",{class:"prompt col"},g("div",{class:"row margin"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>Y("Geometry",s=>e=s,e),elements:[typeof Y<"u"?Y:void 0,typeof x<"u"?x:void 0,typeof e<"u"?e:void 0,typeof x<"u"?x:void 0,typeof e<"u"?e:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>Y("Texture",s=>n=s,n),elements:[typeof Y<"u"?Y:void 0,typeof x<"u"?x:void 0,typeof n<"u"?n:void 0,typeof x<"u"?x:void 0,typeof n<"u"?n:void 0]}),g("div",{class:"row margin"},g("div",null,g("label",null,"File name"),g("input",{type:"text",class:"input",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]},s=>r=s]})),g("div",null,g("label",null,"Texture voxel size"),g("input",{type:"number",class:"input",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]},s=>i=s]}))),g("button",{class:"footer-button button",ref:f},"Export")),{close:a}=rn(o);f.$on("click",()=>{var s=rt(S);if(n)if(i<=1){var u=at(s);We(r+".png",u)}else{var u=ot(s,i);We(r+".png",u)}if(e){var l=ft(s);et(r+".obj",l)}var d={filename:r,geometry:e,texture:n,square_size:i};localStorage.setItem("save_obj_preferences",JSON.stringify(d)),a()})};function De(t){const n=G.__element.getBoundingClientRect();var e=(t.clientX-n.left)*G.width/G.clientWidth,r=G.height-(t.clientY-n.top)*G.height/G.clientHeight-1;return[e,r]}function Ve(t,n,e,r,i){var f,o,a,s;t==e?f=1:f=1/Math.abs(e-t),n==r?o=1:o=1/Math.abs(r-n);for(var u=Math.min(f,o)*i,l=0,d=[],c=a,h=s;l<=1;)c=t*(1-l)+e*l,h=n*(1-l)+r*l,d.push([c,h]),l+=u;return d}async function lt(){var t=await fetch("./shader.vert").then(k=>k.text()),n=await fetch("./shader.frag").then(k=>k.text()),[e,r]=Wn(G.__element,t,n);r.antialias=!1,r.uniform_4_float.color_overlay=[0,0,0,1],ye=()=>{var k=localStorage.getItem("save_obj_preferences"),$="";k!=null&&(k=JSON.parse(k),$=k.filename);const b=V();var A=g("div",{class:"prompt-small col"},g("div",{class:"row margin"},g("div",null,g("label",null,"File name"),g("input",{type:"text",class:"input",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>$,elements:[typeof $<"u"?$:void 0]},y=>$=y]}))),g("button",{class:"footer-button button",ref:b},"Export")),{close:T}=rn(A);b.$on("click",()=>{k.filename=$,localStorage.setItem("save_obj_preferences",JSON.stringify(k)),nn($+".vox",{voxels:S.voxels,color:S.color}),T()})},xe=async()=>{tn("vox",({voxels:k,color:$})=>{S.voxels=k,S.color=$,S.init();var[b,E]=S.boundary,A=b[0]-E[0],T=b[1]-E[1],y=b[2]-E[2],E=Math.abs(Math.max(A,T,y));D(-6),w(),P(),R(Math.max(E,1)),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes,c()})},Ae=()=>{for(var k=0;k<S.color.length;k++)for(var $=0;$<S.color[k].length;$++)for(var b=0;b<3;b++)S.color[k][$][b]=S.color[k][$][b]*(1-Z[3])+Z[b]*Z[3];c()};var i=null,f=[],o=0,a=0,s=!1,u=!1,l=-1,d=[];c();function c(k=!1){d.length>30&&(d=d.slice(1),l--),d=d.slice(0,l+1),d.push(JSON.parse(JSON.stringify([S.voxels,S.color,S.faces,k]))),l=d.length-1}ke=h,Ee=v;function h(){if(l>0){const k=d[l][3];l--;const[$,b,A]=JSON.parse(JSON.stringify(d[l]));k&&R(.5),S.voxels=$,S.color=b,S.faces=A,S.init(),S.build(),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes}}function v(){if(l+1<d.length){l++;const[k,$,b,A]=d[l];A&&R(2),S.voxels=k,S.color=$,S.faces=b,S.build(),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes}}document.addEventListener("keydown",function(k){k.key=="Control"&&(u=!0),k.key=="z"&&k.ctrlKey&&h(),k.key=="y"&&k.ctrlKey&&v(),k.key=="x"&&k.ctrlKey&&ue()}),document.addEventListener("keyup",function(k){k.key=="Control"&&(u=!1)});var p=!1;G.$on("mousedown",k=>{if(p=u,!u){if(k.offsetX,k.offsetY,k.button==1)k.preventDefault();else if(k.button==0||k.button==2&&W=="Pen"){const[$,b]=De(k);o=$,a=b,s=!0,f=[[$,b]]}if(W=="Line"){const[$,b]=De(k);o=$,a=b,s=!0,f=[[$,b]]}k.button==0?X=Z:k.button==2&&(X=Q)}}),G.$on("mousemove",k=>{if(!s)return;const[$,b]=De(k);W=="Line"?f=[[o,a],...Ve($,b,o,a,5),[$,b]]:(f.push(...Ve($,b,o,a,5)),o=$,a=b)}),G.$on("contextmenu",k=>(k.preventDefault(),!1));var _=[];G.$on("mouseup",k=>{if(!(u||p)&&(_=[],f=[],s=!1,!!i)){if(W=="Pen"||W=="Line")if(ne=="Sculpt"){if(k.button==0){var $=[];for(var b of i)$.push(...b.voxel.map(y=>y.map((E,I)=>E+b.direction[I])));$=[...new Set($.map(JSON.stringify))].map(JSON.parse),S.add(...$),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes}else if(k.button==2){var $=[];for(var b of i)$.push(...b.voxel);S.remove(...$),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes}}else{let y=function(E,I,m,C){var B=parseFloat(J.feather);if(B>0)var M=E/B;else var M=1;var z=I*(1-m[3]*M)+m[C]*m[3]*M;return z};if(k.button==0){X=Z;for(var b of i)for(var A=0;A<b.color.length;A++)for(var T=0;T<3;T++)b.color[A][T]=y(b.distance,b.color[A][T],Z,T)}else if(k.button==2){X=Q;for(var b of i)for(var A=0;A<b.color.length;A++)for(var T=0;T<3;T++)b.color[A][T]=y(b.distance,b.color[A][T],Q,T)}k.button==1&&(Z=[...i[0].mouse_color,1],X=Z,ze(Z))}else if(ne=="Sculpt")k.button==0?(S.add(...i.voxel.map(y=>y.map((E,I)=>E+i.direction[I]))),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes):k.button==2&&(S.remove(...i.voxel),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes);else if(k.button==0){X=Z;for(var A=0;A<i.color.length;A++)for(var T=0;T<3;T++)i.color[A][T]=i.color[A][T]*(1-Z[3])+Z[T]*Z[3]}else if(k.button==2){X=Q;for(var A=0;A<i.color.length;A++)for(var T=0;T<3;T++)i.color[A][T]=i.color[A][T]*(1-Q[3])+Q[T]*Q[3]}k.button==1&&(Z=[...i.mouse_color,1],X=Z,ze(Z)),c()}});const{update:L,mouse:F,zoom:R,resetPan:w,resetRotation:P,setZoom:D}=Kn(G,r,e);$e=w,we=P,ue=()=>{S.subdivide(),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes,R(2),c(!0)};function N(){e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.enable(e.CULL_FACE),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}jn(k=>{L(),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes;var $=null;r.buffer(()=>{e.clearColor(0,0,0,0),r.uniform_float.disable_lighting=1,N(),r.attribute_matrix_4_float.color=S.pick_map,r.drawSolid(S.geometry_indexes),W=="Pen"?s?(_.push(...f.map(b=>r.getPixel(b[0],b[1]))),f=[]):_=[r.getPixel(F.x,F.y)]:W=="Line"?s?_=f.map(b=>r.getPixel(b[0],b[1])):_=[r.getPixel(F.x,F.y)]:$=r.getPixel(F.x,F.y)}),r.uniform_float.disable_lighting=0,e.clearColor(.5,.5,.5,.9),e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(1,1),N(),i=null,W=="Pen"||W=="Line"?ne=="Sculpt"?r.attribute_matrix_4_float.color=S.get_highlight(_,b=>i=b,null,J.radius,de,parseFloat(J.feather)):r.attribute_matrix_4_float.color=S.get_highlight(_,b=>i=b,X,J.radius,de,parseFloat(J.feather)):ne=="Sculpt"?r.attribute_matrix_4_float.color=S.highlight_plane($,b=>i=b,W,le):r.attribute_matrix_4_float.color=S.highlight_plane($,b=>i=b,W,le,X),r.drawSolid(S.geometry_indexes),e.disable(e.POLYGON_OFFSET_FILL),Re&&(r.uniform_float.enable_color_overlay=1,r.drawLines(S.geometry_edge_index),r.uniform_float.enable_color_overlay=0)})}lt();
