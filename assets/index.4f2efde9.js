(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const f of i)if(f.type==="childList")for(const o of f.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const f={};return i.integrity&&(f.integrity=i.integrity),i.referrerpolicy&&(f.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?f.credentials="include":i.crossorigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(i){if(i.ep)return;i.ep=!0;const f=e(i);fetch(i.href,f)}})();function oe(t){const n=new Set;function e(o){n.add(o)}function r(o){n.delete(o)}const i={get(o,a){return a==="__subscribe"?e:a==="__unsubscribe"?r:typeof o[a]=="object"&&o[a]!==null&&!(o[a]instanceof HTMLElement)?new Proxy(o[a],i):o[a]},set(o,a,s){o[a]=s;for(const u of n)u.__update();return!0}};return new Proxy(t,i)}function Ve(t){return Ke(new on(t))}function Ke(t){function n(r,i){return typeof r[i]!="object"||r[i]!==null?r[i]:new Proxy(r[i],{set:(o,a,s)=>(e.__handleEffect(e.__isReactive(s),()=>{o[a]=e.__handleFunction(s)}),!0),get:(o,a)=>n(o,a)})}const e=new Proxy(t,{get:(r,i)=>{if(i in r)return r[i];if(i in r.__element)return n(r.__element,i)},set:(r,i,f)=>(i in r?r[i]=f:i=="style"?r.$set_style(f):i in r.__element&&r.$property(i,f),!0)});return e}class on{constructor(n){if(typeof n=="string")this.__element=document.createElement(n);else if(n instanceof HTMLElement)this.__element=n;else throw new Error("Invalid element name");this.__events=[],this.__children=[],this.__states=new Set,this.__unmounted_events=[],this.__mounted_events=[],this.__parent=null}__update(){for(const n of this.__events)n()}$click(){return this.__element.click(),this}$find(n){var e=[];this.__element.matches(n)&&e.push(Ke(this));for(const r of this.__children)e=e.concat(r.$find(n));return e}$update(){for(const n of this.__events)n();for(const n of this.__children)n.$update()}__parseInput(n){if(n&&n.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"){for(const e of n.elements)e&&e.__subscribe&&(this.__states.add(e),e.__subscribe(this));return n.expression}return n}__observeParent(){setTimeout(()=>{for(const e of this.__mounted_events)e()},0),new MutationObserver(e=>{for(const r of e){if(r.type==="childList"&&r.removedNodes.length){for(const i of r.removedNodes)if(i===this.__element){this.__unsubscribe();for(const f of this.__unmounted_events)f()}}if(r.type==="childList"&&r.addedNodes.length){for(const i of r.addedNodes)if(i===this.__element){this.__subscribe();for(const f of this.__mounted_events)f()}}}}).observe(this.__element.parentElement,{childList:!0})}__subscribe(){if(this.__states)for(const n of this.__states)n.__subscribe(this)}__unsubscribe(){for(const n of this.__children)n.__unsubscribe();if(this.__states)for(const n of this.__states)n.__unsubscribe(this)}__handleFunction(n){return typeof n=="function"?n():n}__handleEffect(n,e){n?(e(),this.__events.push(e)):e()}__isReactive(...n){for(const e of n)if(typeof e=="function")return!0;return!1}$if(n){return n=this.__parseInput(n),this.__handleEffect(this.__isReactive(n),()=>{const e=this.__handleFunction(n);this.$style("display",e?"":"none")}),this}$class(n,e=!0){n=this.__parseInput(n),e=this.__parseInput(e);var r=null;return this.__handleEffect(this.__isReactive(n,e),()=>{const i=this.__handleFunction(n);if(i)if(typeof i=="object")for(const f in i)i[f]?this.__element.classList.add(f):this.__element.classList.remove(f);else this.__handleFunction(e)?(this.__isReactive(n)&&(r&&this.__element.classList.remove(...r.split(" ").filter(f=>f.length>0)),r=i),this.__element.classList.add(...i.split(" ").filter(f=>f.length>0))):(this.__element.classList.remove(...i.split(" ").filter(f=>f.length>0)),r=null)}),this}get parentElement(){return this.__parent}$parent(n){return this.__parent=n,n.__element!==void 0?(n.__element.appendChild(this.__element),n.__children.push(this)):n.appendChild(this.__element),this.__observeParent(),this}$parentBefore(n){return this.__parent=n,n.__element!==void 0?n.__element.firstChild?n.__element.insertBefore(this.__element,n.__element.firstChild):n.__element.appendChild(this.__element):n.firstChild?n.insertBefore(this.__element,n.firstChild):n.appendChild(this.__element),this.__observeParent(),this}$on(n,e){return this.__element.addEventListener(n,e),this}__clean_input(n){return n&&n.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?n.expression:n}$onUpdate(n){return this.__events.push(n),this}$onMounted(n){this.__mounted_events.push(n)}$onUnmounted(n){this.__unmounted_events.push(n)}$property(n,e){return n=this.__parseInput(n),e=this.__parseInput(e),this.__handleEffect(this.__isReactive(n,e),()=>{this.__element[this.__handleFunction(n)]=this.__handleFunction(e)}),this}$style(n,e=null){return e?(this.__style(n,e),this):(n=this.__parseInput(n),this.__handleEffect(this.__isReactive(n),()=>{var r=this.__handleFunction(n);if(typeof r=="object")for(const i in r)this.__element.style[i]=r[i];else{const i=r.split(";").filter(f=>f.length>0);this.__element.style={};for(const f of i){const[o,a]=f.split(":");this.__element.style.setProperty(o,this.__handleFunction(a))}}}),this)}__style(n,e){return n=this.__parseInput(n),e=this.__parseInput(e),this.__handleEffect(this.__isReactive(n,e),()=>{this.__element.style[this.__handleFunction(n)]=this.__handleFunction(e)}),this}$get_computed_style(n){return window.getComputedStyle(this.__element).getPropertyValue(n)}$html(n){return n=this.__parseInput(n),this.__handleEffect(this.__isReactive(n),()=>{this.__element.innerHTML=this.__handleFunction(n)}),this}$child(n){n=this.__parseInput(n);var e;this.__isReactive(n)?e=Ve("span").$parent(this):e=this;var r=null;return this.__handleEffect(this.__isReactive(n),()=>{var i=this.__handleFunction(n);r&&r();const f=a=>a==null?()=>{}:a.__element!==void 0?(a.$parent(e),()=>a.$remove()):(a instanceof HTMLElement||(a=document.createTextNode(a)),e.__element.appendChild(a),()=>a.remove());if(Array.isArray(i)){var o=[];for(const a of i)o.push(f(a));r=()=>{for(const a of o)a()}}else r=f(i)}),this}$remove(){return this.__parent=null,this.__element.remove(),this}$model([n,e]){return this.$property("value",n),this.$on("input",r=>e(r.target.value)),this}}function an(t){return t&&t.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?t.expression:t}const $=(t,n,...e)=>{var r,i=!1;if(typeof t=="function"){var f={};if(n)for(const[s,u]of Object.entries(n))f[s]=an(u);if(r=t(f,...e),r===void 0)return e;i=!0}else r=Ve(t);const o={ref:s=>{s.__ref_object=r},style:s=>{r.$style(s)},class:s=>{r.$class(s)},parent:s=>{r.$parent(s)},if:s=>{r.$if(s)},model:([s,u])=>{r.$model([s,u])}},a={on:(s,u)=>{r.$on(s,u)}};if(n)for(const[s,u]of Object.entries(n)){const l=s.split(":");l.length==2?a[l[0]]&&a[l[0]](l[1],u):o[s]?o[s](u):i||r.$property(s,u)}if(e&&!i)for(const s of e)r.$child(s);return r};function V(t=null){var n=t;return new Proxy({},{get:(r,i)=>{if(n!=null)return n[i]},set:(r,i,f)=>(i==="__ref_object"&&(n=f),f!=null&&(n[i]=f),!0)})}var Ze={exports:{}};Ze.exports=Le;Ze.exports.default=Le;function Le(t,n,e){e=e||2;var r=n&&n.length,i=r?n[0]*e:t.length,f=je(t,0,i,e,!0),o=[];if(!f||f.next===f.prev)return o;var a,s,u,l,d,c,h;if(r&&(f=cn(t,n,f,e)),t.length>80*e){a=u=t[0],s=l=t[1];for(var v=e;v<i;v+=e)d=t[v],c=t[v+1],d<a&&(a=d),c<s&&(s=c),d>u&&(u=d),c>l&&(l=c);h=Math.max(u-a,l-s),h=h!==0?32767/h:0}return de(f,o,e,a,s,h,0),o}function je(t,n,e,r,i){var f,o;if(i===Oe(t,n,e,r)>0)for(f=n;f<e;f+=r)o=He(f,t[f],t[f+1],o);else for(f=e-r;f>=n;f-=r)o=He(f,t[f],t[f+1],o);return o&&Te(o,o.next)&&(ve(o),o=o.next),o}function ne(t,n){if(!t)return t;n||(n=t);var e=t,r;do if(r=!1,!e.steiner&&(Te(e,e.next)||O(e.prev,e,e.next)===0)){if(ve(e),e=n=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==n);return n}function de(t,n,e,r,i,f,o){if(!!t){!o&&f&&mn(t,r,i,f);for(var a=t,s,u;t.prev!==t.next;){if(s=t.prev,u=t.next,f?un(t,r,i,f):sn(t)){n.push(s.i/e|0),n.push(t.i/e|0),n.push(u.i/e|0),ve(t),t=u.next,a=u.next;continue}if(t=u,t===a){o?o===1?(t=ln(ne(t),n,e),de(t,n,e,r,i,f,2)):o===2&&dn(t,n,e,r,i,f):de(ne(t),n,e,r,i,f,1);break}}}}function sn(t){var n=t.prev,e=t,r=t.next;if(O(n,e,r)>=0)return!1;for(var i=n.x,f=e.x,o=r.x,a=n.y,s=e.y,u=r.y,l=i<f?i<o?i:o:f<o?f:o,d=a<s?a<u?a:u:s<u?s:u,c=i>f?i>o?i:o:f>o?f:o,h=a>s?a>u?a:u:s>u?s:u,v=r.next;v!==n;){if(v.x>=l&&v.x<=c&&v.y>=d&&v.y<=h&&fe(i,a,f,s,o,u,v.x,v.y)&&O(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function un(t,n,e,r){var i=t.prev,f=t,o=t.next;if(O(i,f,o)>=0)return!1;for(var a=i.x,s=f.x,u=o.x,l=i.y,d=f.y,c=o.y,h=a<s?a<u?a:u:s<u?s:u,v=l<d?l<c?l:c:d<c?d:c,p=a>s?a>u?a:u:s>u?s:u,_=l>d?l>c?l:c:d>c?d:c,T=De(h,v,n,e,r),F=De(p,_,n,e,r),R=t.prevZ,w=t.nextZ;R&&R.z>=T&&w&&w.z<=F;){if(R.x>=h&&R.x<=p&&R.y>=v&&R.y<=_&&R!==i&&R!==o&&fe(a,l,s,d,u,c,R.x,R.y)&&O(R.prev,R,R.next)>=0||(R=R.prevZ,w.x>=h&&w.x<=p&&w.y>=v&&w.y<=_&&w!==i&&w!==o&&fe(a,l,s,d,u,c,w.x,w.y)&&O(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;R&&R.z>=T;){if(R.x>=h&&R.x<=p&&R.y>=v&&R.y<=_&&R!==i&&R!==o&&fe(a,l,s,d,u,c,R.x,R.y)&&O(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;w&&w.z<=F;){if(w.x>=h&&w.x<=p&&w.y>=v&&w.y<=_&&w!==i&&w!==o&&fe(a,l,s,d,u,c,w.x,w.y)&&O(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function ln(t,n,e){var r=t;do{var i=r.prev,f=r.next.next;!Te(i,f)&&Qe(i,r,r.next,f)&&ce(i,f)&&ce(f,i)&&(n.push(i.i/e|0),n.push(r.i/e|0),n.push(f.i/e|0),ve(r),ve(r.next),r=t=f),r=r.next}while(r!==t);return ne(r)}function dn(t,n,e,r,i,f){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&xn(o,a)){var s=qe(o,a);o=ne(o,o.next),s=ne(s,s.next),de(o,n,e,r,i,f,0),de(s,n,e,r,i,f,0);return}a=a.next}o=o.next}while(o!==t)}function cn(t,n,e,r){var i=[],f,o,a,s,u;for(f=0,o=n.length;f<o;f++)a=n[f]*r,s=f<o-1?n[f+1]*r:t.length,u=je(t,a,s,r,!1),u===u.next&&(u.steiner=!0),i.push(yn(u));for(i.sort(vn),f=0;f<i.length;f++)e=hn(i[f],e);return e}function vn(t,n){return t.x-n.x}function hn(t,n){var e=pn(t,n);if(!e)return n;var r=qe(e,t);return ne(r,r.next),ne(e,e.next)}function pn(t,n){var e=n,r=t.x,i=t.y,f=-1/0,o;do{if(i<=e.y&&i>=e.next.y&&e.next.y!==e.y){var a=e.x+(i-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=r&&a>f&&(f=a,o=e.x<e.next.x?e:e.next,a===r))return o}e=e.next}while(e!==n);if(!o)return null;var s=o,u=o.x,l=o.y,d=1/0,c;e=o;do r>=e.x&&e.x>=u&&r!==e.x&&fe(i<l?r:f,i,u,l,i<l?f:r,i,e.x,e.y)&&(c=Math.abs(i-e.y)/(r-e.x),ce(e,t)&&(c<d||c===d&&(e.x>o.x||e.x===o.x&&_n(o,e)))&&(o=e,d=c)),e=e.next;while(e!==s);return o}function _n(t,n){return O(t.prev,t,n.prev)<0&&O(n.next,t,t.next)<0}function mn(t,n,e,r){var i=t;do i.z===0&&(i.z=De(i.x,i.y,n,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,bn(i)}function bn(t){var n,e,r,i,f,o,a,s,u=1;do{for(e=t,t=null,f=null,o=0;e;){for(o++,r=e,a=0,n=0;n<u&&(a++,r=r.nextZ,!!r);n++);for(s=u;a>0||s>0&&r;)a!==0&&(s===0||!r||e.z<=r.z)?(i=e,e=e.nextZ,a--):(i=r,r=r.nextZ,s--),f?f.nextZ=i:t=i,i.prevZ=f,f=i;e=r}f.nextZ=null,u*=2}while(o>1);return t}function De(t,n,e,r,i){return t=(t-e)*i|0,n=(n-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,t|n<<1}function yn(t){var n=t,e=t;do(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),n=n.next;while(n!==t);return e}function fe(t,n,e,r,i,f,o,a){return(i-o)*(n-a)>=(t-o)*(f-a)&&(t-o)*(r-a)>=(e-o)*(n-a)&&(e-o)*(f-a)>=(i-o)*(r-a)}function xn(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!gn(t,n)&&(ce(t,n)&&ce(n,t)&&$n(t,n)&&(O(t.prev,t,n.prev)||O(t,n.prev,n))||Te(t,n)&&O(t.prev,t,t.next)>0&&O(n.prev,n,n.next)>0)}function O(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function Te(t,n){return t.x===n.x&&t.y===n.y}function Qe(t,n,e,r){var i=pe(O(t,n,e)),f=pe(O(t,n,r)),o=pe(O(e,r,t)),a=pe(O(e,r,n));return!!(i!==f&&o!==a||i===0&&he(t,e,n)||f===0&&he(t,r,n)||o===0&&he(e,t,r)||a===0&&he(e,n,r))}function he(t,n,e){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function pe(t){return t>0?1:t<0?-1:0}function gn(t,n){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&Qe(e,e.next,t,n))return!0;e=e.next}while(e!==t);return!1}function ce(t,n){return O(t.prev,t,t.next)<0?O(t,n,t.next)>=0&&O(t,t.prev,n)>=0:O(t,n,t.prev)<0||O(t,t.next,n)<0}function $n(t,n){var e=t,r=!1,i=(t.x+n.x)/2,f=(t.y+n.y)/2;do e.y>f!=e.next.y>f&&e.next.y!==e.y&&i<(e.next.x-e.x)*(f-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==t);return r}function qe(t,n){var e=new Ue(t.i,t.x,t.y),r=new Ue(n.i,n.x,n.y),i=t.next,f=n.prev;return t.next=n,n.prev=t,e.next=i,i.prev=e,r.next=e,e.prev=r,f.next=r,r.prev=f,r}function He(t,n,e,r){var i=new Ue(t,n,e);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ve(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ue(t,n,e){this.i=t,this.x=n,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Le.deviation=function(t,n,e,r){var i=n&&n.length,f=i?n[0]*e:t.length,o=Math.abs(Oe(t,0,f,e));if(i)for(var a=0,s=n.length;a<s;a++){var u=n[a]*e,l=a<s-1?n[a+1]*e:t.length;o-=Math.abs(Oe(t,u,l,e))}var d=0;for(a=0;a<r.length;a+=3){var c=r[a]*e,h=r[a+1]*e,v=r[a+2]*e;d+=Math.abs((t[c]-t[v])*(t[h+1]-t[c+1])-(t[c]-t[h])*(t[v+1]-t[c+1]))}return o===0&&d===0?0:Math.abs((d-o)/o)};function Oe(t,n,e,r){for(var i=0,f=n,o=e-r;f<e;f+=r)i+=(t[o]-t[f])*(t[f+1]+t[o+1]),o=f;return i}Le.flatten=function(t){for(var n=t[0][0].length,e={vertices:[],holes:[],dimensions:n},r=0,i=0;i<t.length;i++){for(var f=0;f<t[i].length;f++)for(var o=0;o<n;o++)e.vertices.push(t[i][f][o]);i>0&&(r+=t[i-1].length,e.holes.push(r))}return e};function wn(t){const[n]=Ae(t),e=En(t,n),[r]=Ae(e),i=Rn(e,r,n),f=Fn(i,e,n),[o,a]=An(f,e);return Ln(f,e,o,a)}function kn(t,n){for(var e={},r=[],i=1,f=0;f<n.length;f++){var o=n[f].join(",");e[o]==null&&(e[o]=i,r.push(n[f]),i++)}for(var a of t)for(var s in a)a[s]=e[n[a[s]].join(",")];return[r,t]}function Q(t){return t.join(",")}function Ae(t){for(var n={},e=0;e<t.length;e++){var r=Q(t[e]);n[r]=e}function i(...f){var o=Q(f);return n[o]}return[i]}function En(t,n){for(var e=Array(t.length).fill(0).map(()=>Array(4).fill(1)),r=t[0][0],i=t[0][1],f=0;f<t.length;f++){t[f][0]<r&&(r=t[f][0]),t[f][1]<i&&(i=t[f][1]);var o=n(t[f][0]+1,t[f][1]),a=n(t[f][0],t[f][1]+1),s=n(t[f][0]-1,t[f][1]),u=n(t[f][0],t[f][1]-1);o!=null&&(e[f][1]=0,e[f][2]=0,e[o][0]=0,e[o][3]=0),a!=null&&(e[a][0]=0,e[a][1]=0,e[f][2]=0,e[f][3]=0),s!=null&&(e[s][1]=0,e[s][2]=0,e[f][0]=0,e[f][3]=0),u!=null&&(e[f][0]=0,e[f][1]=0,e[u][2]=0,e[u][3]=0)}var l={};for(var d in t)for(var c=t[d][0],h=t[d][1],f=0;f<4;f++){var v=c,p=h;f==1&&(v+=1),f==2&&(v+=1,p+=1),f==3&&(p+=1);var _=v+","+p;l[_]==null?l[_]={number:1,index:d,face_index:f}:l[_].number+=1}for(const[w,I]of Object.entries(l))I.number==3&&(e[I.index][I.face_index]=1);var T=[];for(var d in e){var c=t[d][0],h=t[d][1];for(var F in e[d])e[d][F]==1&&(F==0&&T.push([c,h]),F==1&&T.push([c+1,h]),F==2&&T.push([c+1,h+1]),F==3&&T.push([c,h+1]))}function R(w){for(var I=new Set,D=0;D<w.length;D++){var N=w[D].join(",");I.add(N)}return Array.from(I)}return R(T).map(w=>w.split(",").map(I=>parseInt(I)))}function Rn(t,n,e){var r=t[0][0],i=t[0][1],f=t[0][0],o=t[0][1];for(var a in t)t[a][0]<r&&(r=t[a][0]),t[a][1]<i&&(i=t[a][1]),t[a][0]>f&&(f=t[a][0]),t[a][1]>o&&(o=t[a][1]);function s(c,h,v){var p=c,_=void 0;if(h=="x")if(v=="forward")do{p=[p[0]+1,p[1]];var _=n(p)}while(_==null&&p[0]<f);else do{p=[p[0]-1,p[1]];var _=n(p)}while(_==null&&p[0]>r);else if(v=="forward")do{p=[p[0],p[1]+1];var _=n(p)}while(_==null&&p[1]<o);else do{p=[p[0],p[1]-1];var _=n(p)}while(_==null&&p[1]>i);return _}var u=new Set;function l(c,h,v){var p=c,_=s(t[c],v,h);if(_!=null){if(p>_)var T=[_,p];else var T=[p,_];var F=t[T[0]],R=t[T[1]];d(F,R,v)&&u.add(Q(T))}}function d(c,h,v){if(v=="x"){var p=c[1],_,T;if(c[0]>h[0]?(_=h[0],T=c[0]):(_=c[0],T=h[0]),e([_,p-1])==null){for(var F=_;F<T;F++)if(e([F,p-1])!=null||e([F,p])==null)return!1}else for(var F=_;F<T;F++)if(e([F,p-1])==null||e([F,p])!=null)return!1}else{var F=c[0],R,w;if(c[1]>h[1]?(R=h[1],w=c[1]):(R=c[1],w=h[1]),e([F-1,R])==null){for(var p=R;p<w;p++)if(e([F-1,p])!=null||e([F,p])==null)return!1}else for(var p=R;p<w;p++)if(e([F-1,p])==null||e([F,p])!=null)return!1}return!0}for(var a in t)l(a,"forward","x"),l(a,"forward","y"),l(a,"backward","x"),l(a,"backward","y");return Array.from(u).map(c=>c.split(",").map(h=>parseInt(h)))}function Fn(t,n,e){for(var r=new Array(n.length).fill(0).map(E=>[]),i=0;i<t.length;i++)r[t[i][0]].push(t[i][1]),r[t[i][1]].push(t[i][0]);function f(E,y){if(E[0]>y[0])var A=y,L=E;else var A=E,L=y;if(A[0]==L[0]||A[1]==L[1])return!1;if(L[1]>A[1])var g=A[0],k=L[0]-1,B=A[1],m=L[1]-1;else var g=A[0],k=L[0]-1,B=L[1],m=A[1]-1;for(var E=g;E<=k;E++){for(var M=!0,y=B;y<=m;y++)if(e([E,y])==null){M=!1;break}if(M)return!0}for(var y=B;y<=m;y++){for(var M=!0,E=g;E<=k;E++)if(e([E,y])==null){M=!1;break}if(M)return!0}return!1}var o=new Array(r.length).fill(0).map(E=>[]);for(var a in r){var s=r[a];if(s.length<=2){o[a]=[s];continue}for(var u=[],i=0;i<s.length;i++)for(var l=s[i],d=n[l],c=i+1;c<s.length;c++){var h=s[c];if(!(l==null||h==null)){var v=n[h];if(f(d,v)){var p=[l,h];u.push(p)}}}o[a]=u}function _(E,y){return o[E].findIndex(A=>A.includes(y))}var T=[],F=new Set,R=new Set;for(var a in o)for(var w in o[a]){let y=function(A){for(const k in o[A])if(!!N.has(`${A},${k}`)&&!R.has(`${A},${k}`)&&!D.has(`${A},${k}`)){N=new Set,D.add(`${A},${k}`),R.add(`${A},${k}`);var L=o[A][k];N.add(`${L[0]},${_(L[0],A)}`),N.add(`${L[1]},${_(L[1],A)}`),I.push(A);for(var g of L)y(g)}};var b=y;a=Number(a);var I=[],D=new Set;F.add(a),D.add(a);var N=new Set;N.add(`${a},${w}`),y(a),I.length!=0&&T.push(I)}return T}function An(t,n){function e(c,h){for(var v=!1,p=h[0],_=h[1],T=c.map(function(E){return E[0]}),F=0,R=T.length-1;F<T.length;R=F++){var w=T[F],I=c[F][1],D=T[R],N=c[R][1],b=I>_!=N>_&&p<(D-w)*(_-I)/(N-I)+w;if(b&&(v=!v),I===_&&w===p||N===_&&D===p){v=!0;break}}return v}for(var r=Array.from(t).fill(0).map(c=>[]),i=0;i<t.length;i++)for(var f=t[i].map(c=>n[c]),o=0;o<t.length;o++)i!=o&&t[o].every(c=>e(f,n[c]))&&r[i].push(o);for(var a=new Array(t.length).fill(!1),s=new Array(t.length).fill(0).map(c=>[]),i=0;i<r.length;i++)for(var o=0;o<r[i].length;o++)s[r[i][o]].push(i);for(var i=0;i<s.length;i++)for(var o=0;o<s[i].length;o++)r[s[i][o]]=r[s[i][o]].filter(v=>!r[i].includes(v));var u=new Array(t.length).fill(0).map((c,h)=>h);u.sort((c,h)=>r[c].includes(h)?-1:1);var l=new Set;for(const c of u)l.has(c)||d(c);function d(c,h=0){if(!l.has(c)){l.add(c);for(const v of r[c])d(v,h+1);h%2==1&&(r[c]=[],a[c]=!0)}}return[r,a]}function Ln(t,n,e,r){var i=[];for(var f in t)if(!r[f]){var o=0,a=[];for(var s of t[f])a.push(...n[s]),o+=1;var u=[];for(var s of e[f]){var l=[];u.push(o);for(var d of t[s])l.push(...n[d]),o+=1;a.push(...l)}var c=Ze.exports(a,u);i.push({positions:a,indices:c})}return i}function Tn(t){return[(t>>0&255)/255,(t>>8&255)/255,(t>>16&255)/255,1]}function Xe(t){return t[0]+(t[1]<<8)+(t[2]<<16)-1}const Sn=[[0,0,1,0,0,1,0,0,1,0,0,1],[0,0,-1,0,0,-1,0,0,-1,0,0,-1],[0,1,0,0,1,0,0,1,0,0,1,0],[0,-1,0,0,-1,0,0,-1,0,0,-1,0],[1,0,0,1,0,0,1,0,0,1,0,0],[-1,0,0,-1,0,0,-1,0,0,-1,0,0]],Pn=[[-1,-1,1,1,-1,1,1,1,1,-1,1,1],[-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1],[-1,1,-1,-1,1,1,1,1,1,1,1,-1],[-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1],[1,-1,-1,1,1,-1,1,1,1,1,-1,1],[-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]],Mn=[[0,1,2,0,2,3],[4,5,6,4,6,7],[8,9,10,8,10,11],[12,13,14,12,14,15],[16,17,18,16,18,19],[20,21,22,20,22,23]],In=[[0,1,1,2,2,3,3,0],[4,5,5,6,6,7,7,4],[8,9,9,10,10,11,11,8],[12,13,13,14,14,15,15,12],[16,17,17,18,18,19,19,16],[20,21,21,22,22,23,23,20]],te=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],Bn=[1,1,1];function Nn(t,n){var e=Q([t[0]+1,t[1],t[2]]);return n(e)}function Cn(t,n){var e=Q([t[0]-1,t[1],t[2]]);return n(e)}function Dn(t,n){var e=Q([t[0],t[1]+1,t[2]]);return n(e)}function Un(t,n){var e=Q([t[0],t[1]-1,t[2]]);return n(e)}function On(t,n){var e=Q([t[0],t[1],t[2]+1]);return n(e)}function Zn(t,n){var e=Q([t[0],t[1],t[2]-1]);return n(e)}const Se=[[0,1,0,1,0,1],[0,1,0,1,1,0],[0,1,1,0,0,1],[0,1,1,0,1,0],[1,0,0,1,0,1],[1,0,0,1,1,0],[1,0,1,0,0,1],[1,0,1,0,1,0]];var Pe=[2,2,1,1,0,0];class Hn{constructor(){this.voxels=[[0,0,0]],this.color=[],this.init_colors(this.voxels)}init_colors(n){for(var e=[],r=0;r<n.length;r++){var i=[];e.push(i);for(var f=0;f<6;f++)i.push([...Bn])}this.color.push(...e)}build_geometry(){for(var n=[],e=[],r=[],i=[],f=[],o=[],a=0,s=1,u=0;u<this.voxels.length;u++){for(var l=0,d=0,c=s-1,h=[],v=0;v<6;v++){if(this.faces[u][v]==0){d+=4;continue}r.push(...Pn[v].map((T,F)=>T+this.voxels[u][F%3]*2-this.center[F%3])),f.push(...Sn[v]),o.push(...In[v].map(T=>T+a-d)),i.push(...Mn[v].map(T=>T+a-d)),l+=4;for(var p=Tn(s),_=0;_<4;_++)h.push(...p);s++}a+=l,e.push({start:c,end:s-1}),n.push(...h)}this.id=s,this.distance=a,this.geometry_vertexes=r,this.geometry_indexes=i,this.geometry_normals=f,this.geometry_edge_index=o,this.pick_map=n,this.pick_meta=e}init(){this.build_boundary(),this.build_center(),this.build_faces(),this.build_geometry()}build(){this.build_boundary(),this.build_center(),this.build_geometry()}add(...n){this.voxels.push(...n),this.init_colors(n),this.init()}subdivide(){var n=[],e=[],r=[];for(const s in this.voxels){const u=this.voxels[s],l=this.faces[s],d=[u[0]*2,u[1]*2,u[2]*2];for(var i=0;i<8;i++){var f=[];r.push(f);for(var o=0;o<6;o++)f.push([...this.color[s][o]])}n.push([d[0],d[1],d[2]],[d[0]+1,d[1],d[2]],[d[0],d[1]+1,d[2]],[d[0]+1,d[1]+1,d[2]],[d[0],d[1],d[2]+1],[d[0]+1,d[1],d[2]+1],[d[0],d[1]+1,d[2]+1],[d[0]+1,d[1]+1,d[2]+1]);for(var o in Se){var a=Array(6).fill(0);for(var i in Se[o])Se[o][i]==1&&l[i]==1&&(a[i]=1);e.push(a)}}this.voxels=n,this.faces=e,this.color=r,this.build_boundary(),this.build_center(),this.build_geometry()}remove(...n){for(const r of n){if(this.voxels.length==1){n.splice(n.indexOf(r),1);continue}for(var e=0;e<this.voxels.length;e++)if(this.voxels[e][0]==r[0]&&this.voxels[e][1]==r[1]&&this.voxels[e][2]==r[2]){this.voxels.splice(e,1),this.faces.splice(e,1),this.color.splice(e,1);break}}this.init()}get_plane_color(n,e,r=null){var i=[];for(const l in this.pick_meta){const d=this.faces[l];for(var f=0,o=0;o<d.length;o++){if(d[o]==0){f+=1;continue}if(n.includes(l)){if(r!=null)var a=this.color[l][o];else var a=this.color[l][o];if(f==e){if(r!=null)var s=this.color[l][o].map((c,h)=>c*(1-r[3])+r[h]*r[3]);else var s=this.color[l][o].map(h=>Math.abs(1-h*.5));for(var u=0;u<4;u++)i.push(...s,1)}else for(var u=0;u<4;u++)i.push(...a,1)}else for(var u=0;u<4;u++)i.push(...this.color[l][o],1);f+=1}}return i}get_plane(n,e){var r=[];for(const o in this.voxels){const a=this.voxels[o];var i=!0;for(const s in e)if(e[s]!=0&&n[s]!=a[s]){i=!1;break}if(i){var f=this.voxels[o].map((s,u)=>s+e[u]);this.voxels.some(s=>s[0]==f[0]&&s[1]==f[1]&&s[2]==f[2])||r.push(o)}}return r}get_contiguous(n,e,r){var i=[];const f=this.voxels,o=new Set;function a(s){for(const c of n){const h=f[c];var u=!0;for(const v in r)if(r[v]!=0){if(s[v]!=h[v]){u=!1;break}}else if(Math.abs(s[v]-h[v])>1){u=!1;break}if(u){var l=f[c].map((v,p)=>v+r[p]),d=`${l[0]},${l[1]},${l[2]}`;o.has(d)||(o.add(d),i.push(c),a(f[c]))}}}return a(e),i}get_vertical_line(n,e,r){var i=[];for(const s in this.voxels){const u=this.voxels[s];var f=!0,o=-1;for(const l in e)if(e[l]!=0&&(o=l,n[l]!=u[l])){f=!1;break}if(o==0){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==2){f=!1;break}}else if(o==2){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==0){f=!1;break}}else if(o==1){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==0){f=!1;break}}else f=!1;if(f){var a=this.voxels[s].map((l,d)=>l+e[d]);this.voxels.some(l=>l[0]==a[0]&&l[1]==a[1]&&l[2]==a[2])||i.push(s)}}return i}get_horizontal_line(n,e,r){var i=[];for(const s in this.voxels){const u=this.voxels[s];var f=!0,o=-1;for(const l in e)if(e[l]!=0){if(o=l,n[l]!=u[l]){f=!1;break}}else if(n[l]!=u[l]&&l==1){f=!1;break}if(o==1){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==2){f=!1;break}}if(f){var a=this.voxels[s].map((l,d)=>l+e[d]);this.voxels.some(l=>l[0]==a[0]&&l[1]==a[1]&&l[2]==a[2])||i.push(s)}}return i}highlight_plane(n,e,r,i,f=null){var o=Xe(n),c=[],a=0;for(const v in this.pick_meta){const p=this.faces[v],_=this.pick_meta[v];if(o>=_.start&&o<_.end)for(var s=0,u=0;u<p.length;u++){if(p[u]==0){s+=1;continue}if(o==a){var l;switch(r){case"Plane":l=this.get_plane(this.voxels[v],te[s]);break;case"Horizontal line":l=this.get_horizontal_line(this.voxels[v],te[s]);break;case"Vertical line":l=this.get_vertical_line(this.voxels[v],te[s]);break}i&&(l=this.get_contiguous(l,this.voxels[v],te[s]));var d=[];for(const T of l)d.push(this.color[T][s]);return e({voxel:l.map(T=>this.voxels[T]),direction:te[s],color:d,mouse_color:this.color[v][u],index:v}),this.get_plane_color(l,s,f)}s+=1,a+=1}else for(var u=0;u<p.length;u++)p[u]!=0&&(a+=1)}var c=[];for(const v in this.pick_meta){const p=this.faces[v];for(var u=0;u<p.length;u++)if(p[u]!=0)for(var h=0;h<4;h++)c.push(...this.color[v][u],1)}return c}printPointsWithinCircle(n,e){if(n<1)return[[[e[0],e[1]],1]];const r={x:e[0],y:e[1]};var i=[];for(let f=r.x-n;f<=r.x+n;f++)for(let o=r.y-n;o<=r.y+n;o++){const a=Math.sqrt((f-r.x)**2+(o-r.y)**2);a<=n&&i.push([[f,o],1-a/n])}return i}printPointsWithinSquare(n,e){if(n<1)return[[e[0],e[1]]];n=Math.round(n/2);const r={x:e[0],y:e[1]};var i=[];for(let f=r.x-n;f<=r.x+n;f++)for(let o=r.y-n;o<=r.y+n;o++)i.push([f,o]);return i}get_highlight(n,e,r=null,i,f,o){const[a]=Ae(this.voxels),s={};var u=new Set(n.map(L=>Xe(L))),l=Array.from(u),d=[],c=0,h=[],v=new Set;for(const L in this.pick_meta){const g=this.faces[L],k=this.pick_meta[L];if(l.some(B=>B>=k.start&&B<k.end))for(var p=0,_=0;_<g.length;_++){if(g[_]==0){p+=1;continue}if(u.has(c)){var T=[...this.voxels[L]];if(T.splice(Pe[p],1),f)var F=this.printPointsWithinCircle(i-1,T);else var F=this.printPointsWithinSquare(i,T);for(const B of F){var[R,w]=B,I=[...R];I.splice(Pe[p],0,this.voxels[L][Pe[p]]);var D=a(I),N=`${D},${_}`;if(v.has(N)){s[N].distance=Math.max(s[N].distance,w);continue}if(D!=null){v.add(N);var b={voxel:[this.voxels[D]],direction:te[p],color:[this.color[D][_]],distance:w,mouse_color:this.color[D][_],index:L};s[N]=b,h.push(b)}}}p+=1,c+=1}else for(var _=0;_<g.length;_++)g[_]!=0&&(c+=1)}for(const L in this.faces)for(var E=this.faces[L],_=0;_<E.length;_++)if(E[_]!=0){for(var y=0;y<4;y++)if(v.has(`${L},${_}`)){const k=s[`${L},${_}`];if(r)var A=this.color[L][_].map((B,m)=>{var M=o;if(M>0)var C=k.distance/M;else var C=1;var P=B*(1-r[3]*C)+r[m]*r[3]*C;return P});else var A=this.color[L][_].map(m=>Math.abs(1-m*.5));d.push(...A,1)}else d.push(...this.color[L][_],1);c+=1}return e(h),d}build_faces(){const n=this.voxels,e=new Array(n.length).fill(0).map(d=>[1,1,1,1,1,1]),[r]=Ae(this.voxels);for(var i=0;i<n.length;i++){var f=Nn(n[i],r);f&&(e[i][4]=0,e[f][5]=0);var o=Cn(n[i],r);o&&(e[i][5]=0,e[o][4]=0);var a=Dn(n[i],r);a&&(e[i][2]=0,e[a][3]=0);var s=Un(n[i],r);s&&(e[i][3]=0,e[s][2]=0);var u=On(n[i],r);u&&(e[i][0]=0,e[u][1]=0);var l=Zn(n[i],r);l&&(e[i][1]=0,e[l][0]=0)}this.faces=e}build_center(){const n=this.boundary;this.center=n[0].map((e,r)=>e+n[1][r])}build_boundary(){const n=this.voxels;for(var e=n[0],r=n[0],i=1;i<n.length;i++)e=e.map((f,o)=>Math.min(f,n[i][o])),r=r.map((f,o)=>Math.max(f,n[i][o]));this.boundary=[e,r]}}class Xn{constructor(n,e,r){this.gl=n,this.program=e,this.canvas=r,this.attribute_matrix_4_mat_float=re((i,f)=>{var o=n.getUniformLocation(this.program,i);n.uniformMatrix4fv(o,!1,f)}),this.uniform_float=re((i,f)=>{var o=n.getUniformLocation(this.program,i);n.uniform1f(o,f)}),this.uniform_4_float=re((i,f)=>{var o=n.getUniformLocation(this.program,i);n.uniform4f(o,f[0],f[1],f[2],f[3])}),this.uniform_3_float=re((i,f)=>{var o=n.getUniformLocation(this.program,i);n.uniform3f(o,f[0],f[1],f[2])}),this.attribute_matrix_3_float=re((i,f)=>{var o=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,o),n.bufferData(n.ARRAY_BUFFER,new Float32Array(f),n.STATIC_DRAW);var a=n.getAttribLocation(this.program,i);n.vertexAttribPointer(a,3,n.FLOAT,!1,0,0),n.enableVertexAttribArray(a)}),this.attribute_matrix_4_float=re((i,f)=>{var o=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,o),n.bufferData(n.ARRAY_BUFFER,new Float32Array(f),n.STATIC_DRAW);var a=n.getAttribLocation(this.program,i);n.vertexAttribPointer(a,4,n.FLOAT,!1,0,0),n.enableVertexAttribArray(a)})}set face(n){this.faces=n}buffer(n){const e=this.gl,r=this.canvas,i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i);var f=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,f),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,f);const o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0),n(),e.bindFramebuffer(e.FRAMEBUFFER,null),o}getPixel(n,e){const r=this.gl,i=new Uint8Array(4);return r.readPixels(n,e,1,1,r.RGBA,r.UNSIGNED_BYTE,i),i}drawSolid(n){const e=this.gl;if(!n){if(this.faces==null)throw"No faces defined";n=this.faces}var r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),e.STATIC_DRAW),e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),e.drawElements(e.TRIANGLES,n.length,e.UNSIGNED_SHORT,0)}drawLines(n){const e=this.gl;if(!n){if(this.faces==null)throw"No faces defined";n=this.faces}var r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),e.STATIC_DRAW),e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),e.drawElements(e.LINES,n.length,e.UNSIGNED_SHORT,0)}}function re(t){return new Proxy({},{set:function(n,e,r){return t(e,r),!0}})}function Gn(t,n,e){const r=t.getContext("webgl2",{antialias:!0}),i=r.createProgram(),f=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(f,e),r.compileShader(f),r.attachShader(i,f);const o=r.createShader(r.VERTEX_SHADER);return r.shaderSource(o,n),r.compileShader(o),r.attachShader(i,o),r.linkProgram(i),r.useProgram(i),[r,new Xn(r,i,t)]}var Ge=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)});function Yn(){var t=new Ge(16);return Ge!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Wn(t,n){if(t===n){var e=n[1],r=n[2],i=n[3],f=n[6],o=n[7],a=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=e,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=f,t[11]=n[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t}function Jn(t,n){var e=n[0],r=n[1],i=n[2],f=n[3],o=n[4],a=n[5],s=n[6],u=n[7],l=n[8],d=n[9],c=n[10],h=n[11],v=n[12],p=n[13],_=n[14],T=n[15],F=e*a-r*o,R=e*s-i*o,w=e*u-f*o,I=r*s-i*a,D=r*u-f*a,N=i*u-f*s,b=l*p-d*v,E=l*_-c*v,y=l*T-h*v,A=d*_-c*p,L=d*T-h*p,g=c*T-h*_,k=F*g-R*L+w*A+I*y-D*E+N*b;return k?(k=1/k,t[0]=(a*g-s*L+u*A)*k,t[1]=(i*L-r*g-f*A)*k,t[2]=(p*N-_*D+T*I)*k,t[3]=(c*D-d*N-h*I)*k,t[4]=(s*y-o*g-u*E)*k,t[5]=(e*g-i*y+f*E)*k,t[6]=(_*w-v*N-T*R)*k,t[7]=(l*N-c*w+h*R)*k,t[8]=(o*L-a*y+u*b)*k,t[9]=(r*y-e*L-f*b)*k,t[10]=(v*D-p*w+T*F)*k,t[11]=(d*w-l*D-h*F)*k,t[12]=(a*E-o*A-s*b)*k,t[13]=(e*A-r*E+i*b)*k,t[14]=(p*R-v*I-_*F)*k,t[15]=(l*I-d*R+c*F)*k,t):null}function zn(t,n,e,r){function i(m,M,C,P){var Y=Math.tan(m*.5*Math.PI/180);return[.5/Y,0,0,0,0,.5*M/Y,0,0,0,0,-(P+C)/(P-C),-1,0,0,-2*P*C/(P-C),0]}var f=i(40,t.width/t.height,1,1e3),o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const s=Yn();Jn(s,a),Wn(s,s),e.viewport(0,0,t.width,t.height),n.attribute_matrix_4_mat_float.uNormalMatrix=s,a[14]=a[14]-6;var u=0,l=!1,d,c,h=0,v=0,p=null,_=!1;document.addEventListener("keydown",function(m){m.key=="Control"&&(_=!0)}),document.addEventListener("keyup",function(m){m.key=="Control"&&(_=!1)});var T=function(m){if(!!_)return m.button==2?p="pan":p="rotate",l=!0,d=m.pageX,c=m.pageY,m.preventDefault(),!1},F=function(m){l=!1};const R={x:0,y:0};var w=function(m){const M=t.__element.getBoundingClientRect();if(R.x=(m.clientX-M.left)*e.canvas.width/e.canvas.clientWidth,R.y=e.canvas.height-(m.clientY-M.top)*e.canvas.height/e.canvas.clientHeight-1,!l)return!1;h=(m.pageX-d)*2*Math.PI/t.width,v=(m.pageY-c)*2*Math.PI/t.height,p=="rotate"?(y+=h,A+=v):p=="pan"&&I(h,v),d=m.pageX,c=m.pageY,m.preventDefault()};function I(m,M){a[12]-=m*a[14]/2,a[13]+=M*a[14]/2}t.$on("mousedown",T),t.$on("mouseup",F),t.$on("mouseout",F),t.$on("mousemove",w);var D=function(m){m.preventDefault();var M=m.wheelDelta?m.wheelDelta/40:m.detail?-m.detail:0,C=1.3;return M&&N(M<0?1*C:1/C),m.preventDefault()&&!1};function N(m){a[14]*=m}t.$on("wheel",D);function b(m,M){var C=Math.cos(M),P=Math.sin(M),Y=m[1],ae=m[5],z=m[9];m[1]=m[1]*C-m[2]*P,m[5]=m[5]*C-m[6]*P,m[9]=m[9]*C-m[10]*P,m[2]=m[2]*C+Y*P,m[6]=m[6]*C+ae*P,m[10]=m[10]*C+z*P}function E(m,M){var C=Math.cos(M),P=Math.sin(M),Y=m[0],ae=m[4],z=m[8];m[0]=C*m[0]+P*m[2],m[4]=C*m[4]+P*m[6],m[8]=C*m[8]+P*m[10],m[2]=C*m[2]-P*Y,m[6]=C*m[6]-P*ae,m[10]=C*m[10]-P*z}var y=.8,A=.8;function L(){l||(h*=u,v*=u,y+=h,A+=v),o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,A=Math.max(-Math.PI/2,Math.min(Math.PI/2,A)),E(o,y),b(o,A),n.attribute_matrix_4_mat_float.projection_matrix=f,n.attribute_matrix_4_mat_float.view_matrix=a,n.attribute_matrix_4_mat_float.model_matrix=o}function g(){a[12]=0,a[13]=0}function k(){y=.8,A=.8}function B(m){a[14]=m}return{update:L,mouse:R,zoom:N,resetPan:g,resetRotation:k,setZoom:B}}function Vn(t){var n=0;function e(r){r*=.001;const i=r-n;n=r;const f=1/i;t(f.toFixed(1)),requestAnimationFrame(e)}e()}function ie(t,n,e){var r=[];const i=oe({name:e});for(const f of t){const o=$("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(i.name==f.name?" button-selected":""),elements:[typeof i<"u"?i:void 0,typeof name<"u"?name:void 0,typeof f<"u"?f:void 0,typeof name<"u"?name:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>f.name,elements:[typeof f<"u"?f:void 0,typeof name<"u"?name:void 0]});o.$on("click",()=>{i.name=f.name,n(f.name)}),r.push(o)}return r}function X(t,n,e=!0){const r=oe({value:e});var i=$("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(r.value?" button-selected":""),elements:[typeof r<"u"?r:void 0,typeof value<"u"?value:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]});return i.$on("click",()=>{r.value=!r.value,n(r.value)}),i}function U(t,n){var e=$("button",{class:"button"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]});return e.$on("click",()=>{n()}),e}function Kn({callback:t,start:n,color:e}){t||(t=u=>{});const r=oe({absolute_value:0,relative_value:0});var i=V(),f=$("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--accent-color:${e()};`,elements:[typeof e<"u"?e:void 0]}},$("div",{class:"trackbar-background"}),$("div",{class:"trackbar-foreground"}),$("div",{class:"trackbar-thumb",ref:i,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${r.absolute_value}px`,elements:[typeof r<"u"?r:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));f.$onUpdate(()=>{var u=f.__element.getBoundingClientRect();r.relative_value=n(),r.absolute_value=u.width*n()/255});var o=!1,a;function s(u){var l=u-a,d=f.__element.getBoundingClientRect();l<0&&(l=0),l>d.width&&(l=d.width),r.absolute_value=l,r.relative_value=r.absolute_value/d.width*255,t(r.relative_value)}return document.addEventListener("mousemove",u=>{o&&s(u.clientX)}),i.$on("mousedown",u=>{u.stopPropagation(),o=!0,a=u.clientX-r.absolute_value}),f.$on("mousedown",u=>{var l=f.__element.getBoundingClientRect();a=l.left,s(u.clientX),o=!0}),document.addEventListener("mouseup",u=>{o=!1}),f}function Me({callback:t,start:n,colorFrom:e,colorTo:r}){t||(t=l=>{});const i=oe({absolute_value:0,relative_value:0});var f=V(),o=$("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--color-from:${e()};--color-to:${r()};`,elements:[typeof e<"u"?e:void 0,typeof r<"u"?r:void 0]}},$("div",{class:"trackbar-data"}),$("div",{class:"trackbar-thumb",ref:f,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${i.absolute_value}px`,elements:[typeof i<"u"?i:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));o.$onUpdate(()=>{var l=o.__element.getBoundingClientRect();i.relative_value=n(),i.absolute_value=l.width*n()/255});var a=!1,s;function u(l){var d=l-s,c=o.__element.getBoundingClientRect();d<0&&(d=0),d>c.width&&(d=c.width),i.absolute_value=d,i.relative_value=i.absolute_value/c.width*255,t(i.relative_value)}return document.addEventListener("mousemove",l=>{a&&u(l.clientX)}),f.$on("mousedown",l=>{l.stopPropagation(),a=!0,s=l.clientX-i.absolute_value}),o.$on("mousedown",l=>{var d=o.__element.getBoundingClientRect();s=d.left,u(l.clientX),a=!0}),document.addEventListener("mouseup",l=>{a=!1}),o}function jn({callback:t,start:n}){const e=oe({absolute_value:0,relative_value:0,min_color:"0,0,0",max_color:"255,255,255",min_limit_percent:0,max_limit_percent:100});var r=0,i=0,f=0,o=0,a=255;t||(t=h=>{});var s=V(),u=$("div",null,$("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--color-from:${e.min_color};--color-to:${e.max_color};--min-limit:${e.min_limit_percent}%;--max-limit:${e.max_limit_percent}%`,elements:[typeof e<"u"?e:void 0,typeof min_color<"u"?min_color:void 0,typeof e<"u"?e:void 0,typeof max_color<"u"?max_color:void 0,typeof e<"u"?e:void 0,typeof min_limit_percent<"u"?min_limit_percent:void 0,typeof e<"u"?e:void 0,typeof max_limit_percent<"u"?max_limit_percent:void 0]}},$("div",{class:"trackbar-bright-data"}),$("div",{class:"trackbar-thumb",ref:s,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${e.absolute_value}px`,elements:[typeof e<"u"?e:void 0,typeof absolute_value<"u"?absolute_value:void 0]}})));u.$onUpdate(()=>{var h=u.__element.getBoundingClientRect(),v=n();r=v[0],i=v[1],f=v[2];var p=Math.min(r,i,f),_=Math.max(r,i,f),T=(r+i+f)/3;e.min_color=[r-p,i-p,f-p].join(","),e.max_color=[r+(255-_),i+(255-_),f+(255-_)].join(","),e.relative_value=T,e.absolute_value=h.width*T/255;var F=T-p,R=255-(_-T);o=h.width*F/255,a=h.width*R/255,e.min_limit_percent=F/255*100,e.max_limit_percent=R/255*100});var l=!1,d;function c(h){var v=e.relative_value,p=r-v,_=i-v,T=f-v,F=h-d,R=u.__element.getBoundingClientRect();F<o&&(F=o),F>a&&(F=a),e.absolute_value=F,e.relative_value=e.absolute_value/R.width*255,r=e.relative_value+p,i=e.relative_value+_,f=e.relative_value+T,t([r,i,f])}return document.addEventListener("mousemove",h=>{l&&c(h.clientX)}),s.$on("mousedown",h=>{h.stopPropagation(),l=!0,d=h.clientX-e.absolute_value}),u.$on("mousedown",h=>{var v=u.__element.getBoundingClientRect();d=v.left,c(h.clientX),l=!0}),document.addEventListener("mouseup",h=>{l=!1}),u}function en(t,n){var e=JSON.stringify(n),r=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(r),f=document.createElement("a");f.download=t,f.href=i,f.textContent="Download",f.click(),f.remove()}function Qn(t,n){var e=new Blob([n],{type:"plain/text"}),r=URL.createObjectURL(e),i=document.createElement("a");i.download=t,i.href=r,i.textContent="Download",i.click(),i.remove()}async function nn(t,n){var e=document.createElement("input");e.type="file",e.accept="."+t,e.onchange=r=>{var i=r.target.files[0],f=new FileReader;f.onload=function(o){var a=o.target.result;n(JSON.parse(a))},f.readAsText(i)},e.click(),e.remove()}function Ye(t,n){var e=document.createElement("a");e.download=t,e.href=n,e.click(),e.remove()}function qn({set:t,get:n}){const e=V();var r=0,i=0,f=0,o=255,a=255,s=255,u=255,l=255;const d=V();var c=[];function h(){nn("col",g=>{d.$html("");for(var k=0;k<g.length;k++)p(g[k][0],g[k][1],g[k][2],g[k][3])})}function v(){en("color_list.col",c)}function p(g,k,B,m){c.push([g,k,B,m]);var M=$("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${g},${k},${B},${m/255})`,elements:[typeof g<"u"?g:void 0,typeof k<"u"?k:void 0,typeof B<"u"?B:void 0,typeof m<"u"?m:void 0]}}),C=!1;M.$on("mousedown",P=>(C=!0,P.button==1&&P.preventDefault(),!1)),M.$on("contextmenu",P=>(P.preventDefault(),!1)),document.addEventListener("mouseup",P=>{setTimeout(()=>{C=!1},100)}),M.$on("mouseup",P=>{!C||(P.button==0?(r=g,i=k,f=B,o=m,I(),w&&w.$update()):P.button==2?(a=g,s=k,u=B,l=m,I("background"),w&&w.$update()):M.$remove())}),M.$parent(d)}function _(g,k,B){return[g,k,B].map(m=>parseInt(m).toString(16).padStart(2,"0")).join("")}function T(g){var k=parseInt(g.substring(0,2),16),B=parseInt(g.substring(2,4),16),m=parseInt(g.substring(4,6),16);return[k,B,m]}function F(g){return g.length==6&&!isNaN(parseInt(g,16))}function R(g){var k=g.target.value;if(k.startsWith("#")&&(k=k.substring(1),e.value=k),!!F(k)){var B=T(k);r=B[0],i=B[1],f=B[2],I(),w&&w.$update()}}var w=$("div",{style:"width:100%"},$("div",{style:"width:100px;margin:10px;position:relative"},$("div",{class:"hash-tag"},"#"),$("input",{type:"text",class:"input hex-input",maxLength:"6","on:input":R,ref:e})),$("div",{style:"display:flex;flex-direction:row"},$("div",{style:"width:100%;padding:10px"},$(Me,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`0,${i},${f}`,elements:[typeof i<"u"?i:void 0,typeof f<"u"?f:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`255,${i},${f}`,elements:[typeof i<"u"?i:void 0,typeof f<"u"?f:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:g=>N(g),elements:[typeof x<"u"?x:void 0,typeof N<"u"?N:void 0,typeof x<"u"?x:void 0]}}),$(Me,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},0,${f}`,elements:[typeof r<"u"?r:void 0,typeof f<"u"?f:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},255,${f}`,elements:[typeof r<"u"?r:void 0,typeof f<"u"?f:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:g=>b(g),elements:[typeof x<"u"?x:void 0,typeof b<"u"?b:void 0,typeof x<"u"?x:void 0]}}),$(Me,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>f,elements:[typeof f<"u"?f:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},${i},0`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},${i},255`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:g=>E(g),elements:[typeof x<"u"?x:void 0,typeof E<"u"?E:void 0,typeof x<"u"?x:void 0]}}),$(jn,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>[r,i,f],elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof f<"u"?f:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:g=>A(g),elements:[typeof x<"u"?x:void 0,typeof A<"u"?A:void 0,typeof x<"u"?x:void 0]}}))),$("div",{class:"row"},$("div",{class:"color-area"},$("div",{class:"color-container"},$("div",{class:"background color-item"},$("div",{class:"backdrop"}),$("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${a},${s},${u},${l/255})`,elements:[typeof a<"u"?a:void 0,typeof s<"u"?s:void 0,typeof u<"u"?u:void 0,typeof l<"u"?l:void 0]}})),$("div",{class:"foreground color-item"},$("div",{class:"backdrop"}),$("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${r},${i},${f},${o/255})`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof f<"u"?f:void 0,typeof o<"u"?o:void 0]}}))),$("div",{class:"hover-icon-container",style:"margin-left:5px","on:click":L},$("i",{class:"fa-solid fa-arrows-rotate hover-icon"}))),$("div",{class:"alpha-area",style:"margin-top:-10px"},$(Kn,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>o,elements:[typeof o<"u"?o:void 0]},color:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${r},${i},${f};`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof f<"u"?f:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:g=>y(g),elements:[typeof x<"u"?x:void 0,typeof y<"u"?y:void 0,typeof x<"u"?x:void 0]}}))),$("div",{class:"color-history-container"},$("div",{style:"display:inline-block",ref:d}),$("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${r},${i},${f},${o/255})`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof f<"u"?f:void 0,typeof o<"u"?o:void 0]},"on:click":()=>p(r,i,f,o)},$("i",{class:"fa fa-plus"})),$("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${a},${s},${u},${l/255})`,elements:[typeof a<"u"?a:void 0,typeof s<"u"?s:void 0,typeof u<"u"?u:void 0,typeof l<"u"?l:void 0]},"on:click":()=>p(a,s,u,l)},$("i",{class:"fa fa-plus"}))),$("button",{class:"button","on:click":()=>v()},"Save colors"),$("button",{class:"button","on:click":()=>h()},"Load colors"));function I(g="foreground"){n(g,{r,g:i,b:f,a:o},{r:a,g:s,b:u,a:l}),e.value=_(r,i,f)}t(D());function D(){return(g,k)=>{g!=null&&(r=g.r,i=g.g,f=g.b,o=g.a),k!=null&&(a=k.r,s=k.g,u=k.b,l=k.a),w&&w.$update()}}function N(g){r=g,w&&w.$update(),I()}function b(g){i=g,w&&w.$update(),I()}function E(g){f=g,w&&w.$update(),I()}function y(g){o=g,w&&w.$update(),I()}function A(g){r=g[0],i=g[1],f=g[2],w&&w.$update(),I()}function L(){var g=a;a=r,r=g,g=s,s=i,i=g,g=u,u=f,f=g,g=l,l=o,o=g,w&&w.$update(),I()}return I(),w.$onMounted(()=>{w.$update()}),w}const _e=[2,2,1,1,0,0],et=[1,0,1,0,1,0];function We(t){for(var n=t[0][0],e=t[0][0],r=t[0][1],i=t[0][1],f=1;f<t.length;f++){var o=t[f];o[0]<n&&(n=o[0]),o[0]>e&&(e=o[0]),o[1]<r&&(r=o[1]),o[1]>i&&(i=o[1])}return[n,r,e,i]}function nt(t){for(var n=t.voxels,e=t.faces,r=t.color,i={},f=0;f<e.length;f++)for(var o=0,a=0;a<e[f].length;a++){if(e[f][a]==0){o+=1;continue}var s=`${n[f][_e[o]]},${o}`;i[s]==null&&(i[s]={direction:o,relevant:_e[o],position:n[f][_e[o]]+et[o],data:[],colors:[]}),i[s].data.push(n[f].filter((K,q)=>q!=_e[o])),i[s].colors.push(r[f][o]),o+=1}for(var f in i)i[f].geometry=wn(i[f].data);var u=[],l=[],d=[],c=[],h=[],v=[],p=0,_=0,T=0,F=0,R=0,w=Object.values(i).map(K=>We(K.data)),I=w.reduce((K,q)=>K+q[2]-q[0]+1,0),D=w.reduce((K,q)=>Math.max(K,q[3]-q[1]+1),0),N=Math.ceil(Math.sqrt(I*D));for(var f in i){var b=i[f],E=!1;(b.direction==4||b.direction==5)&&(E=!0);var[y,A,L,g]=We(b.data);if(E){var k=g;_-=A}else{var k=L;_-=y}_>N&&(_=0,T+=D);for(var z in b.data){var B=b.colors[z],m=b.data[z];E?v.push({color:B,position:[m[1]+_,T+m[0]]}):v.push({color:B,position:[m[0]+_,T+m[1]]})}for(var z in b.geometry){for(var M=b.geometry[z],a=0;a<M.positions.length;a+=2){var C=[M.positions[a],M.positions[a+1]];C.splice(b.relevant,0,b.position),d.push(C),E?u.push([M.positions[a+1]+_,T-1+M.positions[a]+1]):u.push([M.positions[a]+_,T-1+M.positions[a+1]+1])}for(var a=0;a<M.indices.length;a+=3){h.push(b.direction+1);var P=[M.indices[a]+p,M.indices[a+1]+p,M.indices[a+2]+p];if(b.direction==1){var Y=P[0];P[0]=P[1],P[1]=Y}if(b.direction==2){var Y=P[0];P[0]=P[2],P[2]=Y}if(b.direction==5){var Y=P[1];P[1]=P[2],P[2]=Y}l.push(P.map(rn=>rn+1)),c.push(P)}p+=M.positions.length/2}_+=k+1,_>R&&(R=_),T>F&&(F=T)}F+=D,u=u.map(K=>[K[0]/R,K[1]/F]);for(var f in v)v[f].position=[v[f].position[0],F-1-v[f].position[1]];var[ae,z]=kn(c,d);return{vert:ae,index:z,normal:h,uv_position:u,uv_index:l,uv_color:v,width:R,height:F}}var me=1e3;function tn(t){const n=V(),e=$("div",{class:"modal-background","v-show":"visible"},$("div",{class:"modal-prompt"},$("span",{class:"close-button",ref:n,id:"close"},$("i",{class:"fa-solid fa-xmark"})),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]}));e.$style("z-index",{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>me++,elements:[typeof me<"u"?me:void 0]});function r(){me--,e.$remove()}return n.$on("click",r),e.$parent(document.body),{close:r}}var tt=`
vn -0.000000 0.000000 1.000000
vn 0.000000 0.000000 -1.000000
vn 0.000000 1.000000 0.000000
vn 0.000000 -1.000000 0.000000
vn 1.000000 0.000000 0.000000
vn -1.000000 -0.000000 -0.000000
`;function rt({vert:t,index:n,normal:e,uv_position:r,uv_index:i,uv_color:f,width:o,height:a}){for(var s="",u=0;u<t.length;u++)s+=`v ${t[u][0]} ${t[u][1]} ${t[u][2]}
`;s+=`
`;for(var u=0;u<r.length;u++)s+=`vt ${r[u][0]} ${r[u][1]}
`;s+=`
`,s+=tt,s+=`
`;for(var u=0;u<n.length;u++)s+=`f ${n[u][0]}/${i[u][0]}/${e[u]} ${n[u][1]}/${i[u][1]}/${e[u]} ${n[u][2]}/${i[u][2]}/${e[u]}
`;return s}function it({uv_color:t,width:n,height:e},r=32){var i=document.createElement("canvas");i.width=n*r,i.height=e*r;var f=i.getContext("2d");for(var o of t){var[a,s]=o.position,[u,l,d]=o.color;f.fillStyle=`rgb(${u*255},${l*255},${d*255})`,f.fillRect(a*r,s*r,r,r)}var c=i.toDataURL("image/png");return i.remove(),c}function ft({uv_color:t,width:n,height:e}){var r=document.createElement("canvas");r.width=n,r.height=e;for(var i=r.getContext("2d"),f=i.createImageData(n,e),o=0;o<f.width;o++)for(var a=0;a<f.height;a++){var s=(o+a*f.width)*4;f.data[s]=255,f.data[s+1]=1,f.data[s+2]=1,f.data[s+3]=1}for(var u of t){var[o,a]=u.position,[l,d,c]=u.color,s=(o+a*n)*4;f.data[s+0]=l*255,f.data[s+1]=d*255,f.data[s+2]=c*255,f.data[s+3]=255}i.putImageData(f,0,0);var h=r.toDataURL("image/png");return r.remove(),h}var se=null,be=null,ye=null,xe=null,ge=null,$e=null,we=null,ke=null,H=Z;const Ie=[{name:"Pen"},{name:"Line"},{name:"Plane"},{name:"Horizontal line"},{name:"Vertical line"}],Be=[{name:"Sculpt"},{name:"Paint"}];var W="Pen",ee="Sculpt",ue=!0,Ee=!0,Z=[1,0,0],j=[1,1,1];function Ne(t,n,e){Z=[n.r/255,n.g/255,n.b/255,n.a/255],j=[e.r/255,e.g/255,e.b/255,e.a/255],t=="foreground"?H=Z:H=j}var Re=null,Fe=null;function Je(t,n){var e=null;t!=null&&(e={r:t[0]*255,g:t[1]*255,b:t[2]*255,a:255});var r=null;n!=null&&(r={r:n[0]*255,g:n[1]*255,b:n[2]*255,a:255}),Re(e,r)}const J=oe({radius:1,feather:0}),G=V(),ot=V();var le=!0;const at=$("div",{class:"main"},$("div",{class:"info"},$("p",null,$("h3",null,"Mode"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>ie(Be,t=>{ee=t,H=Z},"Sculpt"),elements:[typeof ie<"u"?ie:void 0,typeof Be<"u"?Be:void 0,typeof x<"u"?x:void 0,typeof ee<"u"?ee:void 0,typeof x<"u"?x:void 0,typeof H<"u"?H:void 0,typeof Z<"u"?Z:void 0]}),$("p",null,$("h3",null,"Color"),$(qn,{get:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:(t,n,e)=>Ne(t,n,e),elements:[typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0,typeof Ne<"u"?Ne:void 0,typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0]},set:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:t=>Re=t,elements:[typeof fn<"u"?fn:void 0,typeof Re<"u"?Re:void 0,typeof fn<"u"?fn:void 0]}}),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Fill all",()=>Fe()),elements:[typeof U<"u"?U:void 0,typeof Fe<"u"?Fe:void 0]})),$("canvas",{ref:G}),$("div",{class:"info"},$("p",null,"FPS: ",$("span",{ref:ot})),$("p",null,$("h3",null,"Tool"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>ie(Ie,t=>W=t,"Pen"),elements:[typeof ie<"u"?ie:void 0,typeof Ie<"u"?Ie:void 0,typeof x<"u"?x:void 0,typeof W<"u"?W:void 0,typeof x<"u"?x:void 0]}),$("p",null,$("h3",null,"Tool options"),$("label",null,"Radius"),$("div",{style:"width:300px"},$("input",{type:"number",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>J.radius,elements:[typeof J<"u"?J:void 0,typeof radius<"u"?radius:void 0]},t=>J.radius=t],class:"input"})),$("label",null,"Feather"),$("div",{style:"width:300px"},$("input",{type:"number",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>J.feather,elements:[typeof J<"u"?J:void 0,typeof feather<"u"?feather:void 0]},t=>J.feather=t],min:"0",max:"1",step:"0.1",class:"input"})),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>X("Contiguous",t=>ue=t),elements:[typeof X<"u"?X:void 0,typeof x<"u"?x:void 0,typeof ue<"u"?ue:void 0,typeof x<"u"?x:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>X("Circle",t=>le=t),elements:[typeof X<"u"?X:void 0,typeof x<"u"?x:void 0,typeof le<"u"?le:void 0,typeof x<"u"?x:void 0]}),$("p",null,$("h3",null,"View"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>X("Wireframe",t=>Ee=t),elements:[typeof X<"u"?X:void 0,typeof x<"u"?x:void 0,typeof Ee<"u"?Ee:void 0,typeof x<"u"?x:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Reset pan",()=>ge()),elements:[typeof U<"u"?U:void 0,typeof ge<"u"?ge:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Reset rotation",()=>$e()),elements:[typeof U<"u"?U:void 0,typeof $e<"u"?$e:void 0]}),$("p",null,$("h3",null,"Actions"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Subdivide",()=>se()),elements:[typeof U<"u"?U:void 0,typeof se<"u"?se:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Undo",()=>we()),elements:[typeof U<"u"?U:void 0,typeof we<"u"?we:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Redo",()=>ke()),elements:[typeof U<"u"?U:void 0,typeof ke<"u"?ke:void 0]}),$("p",null,$("h3",null,"Persistence"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Save project",()=>be()),elements:[typeof U<"u"?U:void 0,typeof be<"u"?be:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Load project",()=>ye()),elements:[typeof U<"u"?U:void 0,typeof ye<"u"?ye:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>U("Export obj",()=>xe()),elements:[typeof U<"u"?U:void 0,typeof xe<"u"?xe:void 0]})));G.width=800;G.height=800;at.$parent(document.body);var S=new Hn;S.init();xe=()=>{var t=localStorage.getItem("save_obj_preferences"),n=!0,e=!0,r="object",i=1;t!=null&&(t=JSON.parse(t),n=t.texture,e=t.geometry,r=t.filename,i=t.square_size);var f=V(),o=$("div",{class:"prompt col"},$("div",{class:"row margin"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>X("Geometry",s=>e=s,e),elements:[typeof X<"u"?X:void 0,typeof x<"u"?x:void 0,typeof e<"u"?e:void 0,typeof x<"u"?x:void 0,typeof e<"u"?e:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>X("Texture",s=>n=s,n),elements:[typeof X<"u"?X:void 0,typeof x<"u"?x:void 0,typeof n<"u"?n:void 0,typeof x<"u"?x:void 0,typeof n<"u"?n:void 0]}),$("div",{class:"row margin"},$("div",null,$("label",null,"File name"),$("input",{type:"text",class:"input",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]},s=>r=s]})),$("div",null,$("label",null,"Texture voxel size"),$("input",{type:"number",class:"input",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]},s=>i=s]}))),$("button",{class:"footer-button button",ref:f},"Export")),{close:a}=tn(o);f.$on("click",()=>{var s=nt(S);if(n)if(i<=1){var u=ft(s);Ye(r+".png",u)}else{var u=it(s,i);Ye(r+".png",u)}if(e){var l=rt(s);Qn(r+".obj",l)}var d={filename:r,geometry:e,texture:n,square_size:i};localStorage.setItem("save_obj_preferences",JSON.stringify(d)),a()})};function Ce(t){const n=G.__element.getBoundingClientRect();var e=(t.clientX-n.left)*G.width/G.clientWidth,r=G.height-(t.clientY-n.top)*G.height/G.clientHeight-1;return[e,r]}function ze(t,n,e,r,i){var f,o,a,s;t==e?f=1:f=1/Math.abs(e-t),n==r?o=1:o=1/Math.abs(r-n);for(var u=Math.min(f,o)*i,l=0,d=[],c=a,h=s;l<=1;)c=t*(1-l)+e*l,h=n*(1-l)+r*l,d.push([c,h]),l+=u;return d}async function st(){var t=await fetch("./shader.vert").then(b=>b.text()),n=await fetch("./shader.frag").then(b=>b.text()),[e,r]=Gn(G.__element,t,n);r.antialias=!1,r.uniform_4_float.color_overlay=[0,0,0,1],be=()=>{var b=localStorage.getItem("save_obj_preferences"),E="";b!=null&&(b=JSON.parse(b),E=b.filename);const y=V();var A=$("div",{class:"prompt-small col"},$("div",{class:"row margin"},$("div",null,$("label",null,"File name"),$("input",{type:"text",class:"input",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>E,elements:[typeof E<"u"?E:void 0]},g=>E=g]}))),$("button",{class:"footer-button button",ref:y},"Export")),{close:L}=tn(A);y.$on("click",()=>{b.filename=E,localStorage.setItem("save_obj_preferences",JSON.stringify(b)),en(E+".vox",{voxels:S.voxels,color:S.color}),L()})},ye=async()=>{nn("vox",({voxels:b,color:E})=>{S.voxels=b,S.color=E,S.init();var[y,k]=S.boundary,A=y[0]-k[0],L=y[1]-k[1],g=y[2]-k[2],k=Math.abs(Math.max(A,L,g));D(-6),w(),I(),R(Math.max(k,1)),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes,c()})},Fe=()=>{for(var b=0;b<S.color.length;b++)for(var E=0;E<S.color[b].length;E++)for(var y=0;y<3;y++)S.color[b][E][y]=S.color[b][E][y]*(1-Z[3])+Z[y]*Z[3];c()};var i=null,f=[],o=0,a=0,s=!1,u=!1,l=-1,d=[];c();function c(b=!1){d.length>30&&(d=d.slice(1),l--),d=d.slice(0,l+1),d.push(JSON.parse(JSON.stringify([S.voxels,S.color,S.faces,b]))),l=d.length-1}we=h,ke=v;function h(){if(l>0){const b=d[l][3];l--;const[E,y,A]=JSON.parse(JSON.stringify(d[l]));b&&R(.5),S.voxels=E,S.color=y,S.faces=A,S.init(),S.build(),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes}}function v(){if(l+1<d.length){l++;const[b,E,y,A]=d[l];A&&R(2),S.voxels=b,S.color=E,S.faces=y,S.build(),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes}}document.addEventListener("keydown",function(b){b.key=="Control"&&(u=!0),b.key=="z"&&b.ctrlKey&&h(),b.key=="y"&&b.ctrlKey&&v(),b.key=="x"&&b.ctrlKey&&se()}),document.addEventListener("keyup",function(b){b.key=="Control"&&(u=!1)});var p=!1;G.$on("mousedown",b=>{if(p=u,!u){if(b.offsetX,b.offsetY,b.button==1)b.preventDefault();else if(b.button==0||b.button==2&&W=="Pen"){const[E,y]=Ce(b);o=E,a=y,s=!0,f=[[E,y]]}if(W=="Line"){const[E,y]=Ce(b);o=E,a=y,s=!0}b.button==0?H=Z:b.button==2&&(H=j)}}),G.$on("mousemove",b=>{if(!s)return;const[E,y]=Ce(b);W=="Line"?f=[[o,a],...ze(E,y,o,a,5),[E,y]]:(f.push(...ze(E,y,o,a,5)),o=E,a=y)}),G.$on("contextmenu",b=>(b.preventDefault(),!1));var _=[];G.$on("mouseup",b=>{if(!(u||p)&&(_=[],f=[],s=!1,!!i)){if(W=="Pen"||W=="Line")if(ee=="Sculpt"){if(b.button==0){var E=[];for(var y of i)E.push(...y.voxel.map(g=>g.map((k,B)=>k+y.direction[B])));E=[...new Set(E.map(JSON.stringify))].map(JSON.parse),S.add(...E),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes}else if(b.button==2){var E=[];for(var y of i)E.push(...y.voxel);S.remove(...E),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes}}else{let g=function(k,B,m,M){var C=parseFloat(J.feather);if(C>0)var P=k/C;else var P=1;var Y=B*(1-m[3]*P)+m[M]*m[3]*P;return Y};if(b.button==0){H=Z;for(var y of i)for(var A=0;A<y.color.length;A++)for(var L=0;L<3;L++)y.color[A][L]=g(y.distance,y.color[A][L],Z,L)}else if(b.button==2){H=j;for(var y of i)for(var A=0;A<y.color.length;A++)for(var L=0;L<3;L++)y.color[A][L]=g(y.distance,y.color[A][L],j,L)}b.button==1&&(Z=[...i[0].mouse_color,1],H=Z,Je(Z))}else if(ee=="Sculpt")b.button==0?(S.add(...i.voxel.map(g=>g.map((k,B)=>k+i.direction[B]))),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes):b.button==2&&(S.remove(...i.voxel),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes);else if(b.button==0){H=Z;for(var A=0;A<i.color.length;A++)for(var L=0;L<3;L++)i.color[A][L]=i.color[A][L]*(1-Z[3])+Z[L]*Z[3]}else if(b.button==2){H=j;for(var A=0;A<i.color.length;A++)for(var L=0;L<3;L++)i.color[A][L]=i.color[A][L]*(1-j[3])+j[L]*j[3]}b.button==1&&(Z=[...i.mouse_color,1],H=Z,Je(Z)),c()}});const{update:T,mouse:F,zoom:R,resetPan:w,resetRotation:I,setZoom:D}=zn(G,r,e);ge=w,$e=I,se=()=>{S.subdivide(),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes,R(2),c(!0)};function N(){e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.enable(e.CULL_FACE),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}Vn(b=>{T(),r.attribute_matrix_3_float.normal=S.geometry_normals,r.attribute_matrix_3_float.position=S.geometry_vertexes;var E=null;r.buffer(()=>{e.clearColor(0,0,0,0),r.uniform_float.disable_lighting=1,N(),r.attribute_matrix_4_float.color=S.pick_map,r.drawSolid(S.geometry_indexes),W=="Pen"?s?(_.push(...f.map(y=>r.getPixel(y[0],y[1]))),f=[]):_=[r.getPixel(F.x,F.y)]:W=="Line"?s?_=f.map(y=>r.getPixel(y[0],y[1])):_=[r.getPixel(F.x,F.y)]:E=r.getPixel(F.x,F.y)}),r.uniform_float.disable_lighting=0,e.clearColor(.5,.5,.5,.9),e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(1,1),N(),i=null,W=="Pen"||W=="Line"?ee=="Sculpt"?r.attribute_matrix_4_float.color=S.get_highlight(_,y=>i=y,null,J.radius,le,parseFloat(J.feather)):r.attribute_matrix_4_float.color=S.get_highlight(_,y=>i=y,H,J.radius,le,parseFloat(J.feather)):ee=="Sculpt"?r.attribute_matrix_4_float.color=S.highlight_plane(E,y=>i=y,W,ue):r.attribute_matrix_4_float.color=S.highlight_plane(E,y=>i=y,W,ue,H),r.drawSolid(S.geometry_indexes),e.disable(e.POLYGON_OFFSET_FILL),Ee&&(r.uniform_float.enable_color_overlay=1,r.drawLines(S.geometry_edge_index),r.uniform_float.enable_color_overlay=0)})}st();
