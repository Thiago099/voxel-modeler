(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const f of i)if(f.type==="childList")for(const o of f.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const f={};return i.integrity&&(f.integrity=i.integrity),i.referrerpolicy&&(f.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?f.credentials="include":i.crossorigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(i){if(i.ep)return;i.ep=!0;const f=e(i);fetch(i.href,f)}})();function we(t){const n=new Set;function e(o){n.add(o)}function r(o){n.delete(o)}const i={get(o,a){return a==="__subscribe"?e:a==="__unsubscribe"?r:typeof o[a]=="object"&&o[a]!==null&&!(o[a]instanceof HTMLElement)?new Proxy(o[a],i):o[a]},set(o,a,s){o[a]=s;for(const u of n)u.__update();return!0}};return new Proxy(t,i)}function Je(t){return ze(new tn(t))}function ze(t){function n(r,i){return typeof r[i]!="object"||r[i]!==null?r[i]:new Proxy(r[i],{set:(o,a,s)=>(e.__handleEffect(e.__isReactive(s),()=>{o[a]=e.__handleFunction(s)}),!0),get:(o,a)=>n(o,a)})}const e=new Proxy(t,{get:(r,i)=>{if(i in r)return r[i];if(i in r.__element)return n(r.__element,i)},set:(r,i,f)=>(i in r?r[i]=f:i=="style"?r.$set_style(f):i in r.__element&&r.$property(i,f),!0)});return e}class tn{constructor(n){if(typeof n=="string")this.__element=document.createElement(n);else if(n instanceof HTMLElement)this.__element=n;else throw new Error("Invalid element name");this.__events=[],this.__children=[],this.__states=new Set,this.__unmounted_events=[],this.__mounted_events=[],this.__parent=null}__update(){for(const n of this.__events)n()}$click(){return this.__element.click(),this}$find(n){var e=[];this.__element.matches(n)&&e.push(ze(this));for(const r of this.__children)e=e.concat(r.$find(n));return e}$update(){for(const n of this.__events)n();for(const n of this.__children)n.$update()}__parseInput(n){if(n&&n.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"){for(const e of n.elements)e&&e.__subscribe&&(this.__states.add(e),e.__subscribe(this));return n.expression}return n}__observeParent(){setTimeout(()=>{for(const e of this.__mounted_events)e()},0),new MutationObserver(e=>{for(const r of e){if(r.type==="childList"&&r.removedNodes.length){for(const i of r.removedNodes)if(i===this.__element){this.__unsubscribe();for(const f of this.__unmounted_events)f()}}if(r.type==="childList"&&r.addedNodes.length){for(const i of r.addedNodes)if(i===this.__element){this.__subscribe();for(const f of this.__mounted_events)f()}}}}).observe(this.__element.parentElement,{childList:!0})}__subscribe(){if(this.__states)for(const n of this.__states)n.__subscribe(this)}__unsubscribe(){for(const n of this.__children)n.__unsubscribe();if(this.__states)for(const n of this.__states)n.__unsubscribe(this)}__handleFunction(n){return typeof n=="function"?n():n}__handleEffect(n,e){n?(e(),this.__events.push(e)):e()}__isReactive(...n){for(const e of n)if(typeof e=="function")return!0;return!1}$if(n){return n=this.__parseInput(n),this.__handleEffect(this.__isReactive(n),()=>{const e=this.__handleFunction(n);this.$style("display",e?"":"none")}),this}$class(n,e=!0){n=this.__parseInput(n),e=this.__parseInput(e);var r=null;return this.__handleEffect(this.__isReactive(n,e),()=>{const i=this.__handleFunction(n);if(i)if(typeof i=="object")for(const f in i)i[f]?this.__element.classList.add(f):this.__element.classList.remove(f);else this.__handleFunction(e)?(this.__isReactive(n)&&(r&&this.__element.classList.remove(...r.split(" ").filter(f=>f.length>0)),r=i),this.__element.classList.add(...i.split(" ").filter(f=>f.length>0))):(this.__element.classList.remove(...i.split(" ").filter(f=>f.length>0)),r=null)}),this}get parentElement(){return this.__parent}$parent(n){return this.__parent=n,n.__element!==void 0?(n.__element.appendChild(this.__element),n.__children.push(this)):n.appendChild(this.__element),this.__observeParent(),this}$parentBefore(n){return this.__parent=n,n.__element!==void 0?n.__element.firstChild?n.__element.insertBefore(this.__element,n.__element.firstChild):n.__element.appendChild(this.__element):n.firstChild?n.insertBefore(this.__element,n.firstChild):n.appendChild(this.__element),this.__observeParent(),this}$on(n,e){return this.__element.addEventListener(n,e),this}__clean_input(n){return n&&n.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?n.expression:n}$onUpdate(n){return this.__events.push(n),this}$onMounted(n){this.__mounted_events.push(n)}$onUnmounted(n){this.__unmounted_events.push(n)}$property(n,e){return n=this.__parseInput(n),e=this.__parseInput(e),this.__handleEffect(this.__isReactive(n,e),()=>{this.__element[this.__handleFunction(n)]=this.__handleFunction(e)}),this}$style(n,e=null){return e?(this.__style(n,e),this):(n=this.__parseInput(n),this.__handleEffect(this.__isReactive(n),()=>{var r=this.__handleFunction(n);if(typeof r=="object")for(const i in r)this.__element.style[i]=r[i];else{const i=r.split(";").filter(f=>f.length>0);this.__element.style={};for(const f of i){const[o,a]=f.split(":");this.__element.style.setProperty(o,this.__handleFunction(a))}}}),this)}__style(n,e){return n=this.__parseInput(n),e=this.__parseInput(e),this.__handleEffect(this.__isReactive(n,e),()=>{this.__element.style[this.__handleFunction(n)]=this.__handleFunction(e)}),this}$get_computed_style(n){return window.getComputedStyle(this.__element).getPropertyValue(n)}$html(n){return n=this.__parseInput(n),this.__handleEffect(this.__isReactive(n),()=>{this.__element.innerHTML=this.__handleFunction(n)}),this}$child(n){n=this.__parseInput(n);var e;this.__isReactive(n)?e=Je("span").$parent(this):e=this;var r=null;return this.__handleEffect(this.__isReactive(n),()=>{var i=this.__handleFunction(n);r&&r();const f=a=>a==null?()=>{}:a.__element!==void 0?(a.$parent(e),()=>a.$remove()):(a instanceof HTMLElement||(a=document.createTextNode(a)),e.__element.appendChild(a),()=>a.remove());if(Array.isArray(i)){var o=[];for(const a of i)o.push(f(a));r=()=>{for(const a of o)a()}}else r=f(i)}),this}$remove(){return this.__parent=null,this.__element.remove(),this}$model([n,e]){return this.$property("value",n),this.$on("input",r=>e(r.target.value)),this}}function rn(t){return t&&t.key=="e0b8fc2b-fc7e-4786-bc05-b85187a8d065"?t.expression:t}const g=(t,n,...e)=>{var r,i=!1;if(typeof t=="function"){var f={};if(n)for(const[s,u]of Object.entries(n))f[s]=rn(u);if(r=t(f,...e),r===void 0)return e;i=!0}else r=Je(t);const o={ref:s=>{s.__ref_object=r},style:s=>{r.$style(s)},class:s=>{r.$class(s)},parent:s=>{r.$parent(s)},if:s=>{r.$if(s)},model:([s,u])=>{r.$model([s,u])}},a={on:(s,u)=>{r.$on(s,u)}};if(n)for(const[s,u]of Object.entries(n)){const l=s.split(":");l.length==2?a[l[0]]&&a[l[0]](l[1],u):o[s]?o[s](u):i||r.$property(s,u)}if(e&&!i)for(const s of e)r.$child(s);return r};function K(t=null){var n=t;return new Proxy({},{get:(r,i)=>{if(n!=null)return n[i]},set:(r,i,f)=>(i==="__ref_object"&&(n=f),f!=null&&(n[i]=f),!0)})}var De={exports:{}};De.exports=Ee;De.exports.default=Ee;function Ee(t,n,e){e=e||2;var r=n&&n.length,i=r?n[0]*e:t.length,f=Ve(t,0,i,e,!0),o=[];if(!f||f.next===f.prev)return o;var a,s,u,l,d,v,_;if(r&&(f=ln(t,n,f,e)),t.length>80*e){a=u=t[0],s=l=t[1];for(var h=e;h<i;h+=e)d=t[h],v=t[h+1],d<a&&(a=d),v<s&&(s=v),d>u&&(u=d),v>l&&(l=v);_=Math.max(u-a,l-s),_=_!==0?32767/_:0}return se(f,o,e,a,s,_,0),o}function Ve(t,n,e,r,i){var f,o;if(i===Ne(t,n,e,r)>0)for(f=n;f<e;f+=r)o=Ce(f,t[f],t[f+1],o);else for(f=e-r;f>=n;f-=r)o=Ce(f,t[f],t[f+1],o);return o&&Re(o,o.next)&&(le(o),o=o.next),o}function ee(t,n){if(!t)return t;n||(n=t);var e=t,r;do if(r=!1,!e.steiner&&(Re(e,e.next)||U(e.prev,e,e.next)===0)){if(le(e),e=n=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==n);return n}function se(t,n,e,r,i,f,o){if(!!t){!o&&f&&pn(t,r,i,f);for(var a=t,s,u;t.prev!==t.next;){if(s=t.prev,u=t.next,f?an(t,r,i,f):on(t)){n.push(s.i/e|0),n.push(t.i/e|0),n.push(u.i/e|0),le(t),t=u.next,a=u.next;continue}if(t=u,t===a){o?o===1?(t=sn(ee(t),n,e),se(t,n,e,r,i,f,2)):o===2&&un(t,n,e,r,i,f):se(ee(t),n,e,r,i,f,1);break}}}}function on(t){var n=t.prev,e=t,r=t.next;if(U(n,e,r)>=0)return!1;for(var i=n.x,f=e.x,o=r.x,a=n.y,s=e.y,u=r.y,l=i<f?i<o?i:o:f<o?f:o,d=a<s?a<u?a:u:s<u?s:u,v=i>f?i>o?i:o:f>o?f:o,_=a>s?a>u?a:u:s>u?s:u,h=r.next;h!==n;){if(h.x>=l&&h.x<=v&&h.y>=d&&h.y<=_&&ie(i,a,f,s,o,u,h.x,h.y)&&U(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function an(t,n,e,r){var i=t.prev,f=t,o=t.next;if(U(i,f,o)>=0)return!1;for(var a=i.x,s=f.x,u=o.x,l=i.y,d=f.y,v=o.y,_=a<s?a<u?a:u:s<u?s:u,h=l<d?l<v?l:v:d<v?d:v,p=a>s?a>u?a:u:s>u?s:u,b=l>d?l>v?l:v:d>v?d:v,F=Me(_,h,n,e,r),E=Me(p,b,n,e,r),k=t.prevZ,R=t.nextZ;k&&k.z>=F&&R&&R.z<=E;){if(k.x>=_&&k.x<=p&&k.y>=h&&k.y<=b&&k!==i&&k!==o&&ie(a,l,s,d,u,v,k.x,k.y)&&U(k.prev,k,k.next)>=0||(k=k.prevZ,R.x>=_&&R.x<=p&&R.y>=h&&R.y<=b&&R!==i&&R!==o&&ie(a,l,s,d,u,v,R.x,R.y)&&U(R.prev,R,R.next)>=0))return!1;R=R.nextZ}for(;k&&k.z>=F;){if(k.x>=_&&k.x<=p&&k.y>=h&&k.y<=b&&k!==i&&k!==o&&ie(a,l,s,d,u,v,k.x,k.y)&&U(k.prev,k,k.next)>=0)return!1;k=k.prevZ}for(;R&&R.z<=E;){if(R.x>=_&&R.x<=p&&R.y>=h&&R.y<=b&&R!==i&&R!==o&&ie(a,l,s,d,u,v,R.x,R.y)&&U(R.prev,R,R.next)>=0)return!1;R=R.nextZ}return!0}function sn(t,n,e){var r=t;do{var i=r.prev,f=r.next.next;!Re(i,f)&&We(i,r,r.next,f)&&ue(i,f)&&ue(f,i)&&(n.push(i.i/e|0),n.push(r.i/e|0),n.push(f.i/e|0),le(r),le(r.next),r=t=f),r=r.next}while(r!==t);return ee(r)}function un(t,n,e,r,i,f){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&mn(o,a)){var s=je(o,a);o=ee(o,o.next),s=ee(s,s.next),se(o,n,e,r,i,f,0),se(s,n,e,r,i,f,0);return}a=a.next}o=o.next}while(o!==t)}function ln(t,n,e,r){var i=[],f,o,a,s,u;for(f=0,o=n.length;f<o;f++)a=n[f]*r,s=f<o-1?n[f+1]*r:t.length,u=Ve(t,a,s,r,!1),u===u.next&&(u.steiner=!0),i.push(bn(u));for(i.sort(dn),f=0;f<i.length;f++)e=cn(i[f],e);return e}function dn(t,n){return t.x-n.x}function cn(t,n){var e=vn(t,n);if(!e)return n;var r=je(e,t);return ee(r,r.next),ee(e,e.next)}function vn(t,n){var e=n,r=t.x,i=t.y,f=-1/0,o;do{if(i<=e.y&&i>=e.next.y&&e.next.y!==e.y){var a=e.x+(i-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=r&&a>f&&(f=a,o=e.x<e.next.x?e:e.next,a===r))return o}e=e.next}while(e!==n);if(!o)return null;var s=o,u=o.x,l=o.y,d=1/0,v;e=o;do r>=e.x&&e.x>=u&&r!==e.x&&ie(i<l?r:f,i,u,l,i<l?f:r,i,e.x,e.y)&&(v=Math.abs(i-e.y)/(r-e.x),ue(e,t)&&(v<d||v===d&&(e.x>o.x||e.x===o.x&&hn(o,e)))&&(o=e,d=v)),e=e.next;while(e!==s);return o}function hn(t,n){return U(t.prev,t,n.prev)<0&&U(n.next,t,t.next)<0}function pn(t,n,e,r){var i=t;do i.z===0&&(i.z=Me(i.x,i.y,n,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,_n(i)}function _n(t){var n,e,r,i,f,o,a,s,u=1;do{for(e=t,t=null,f=null,o=0;e;){for(o++,r=e,a=0,n=0;n<u&&(a++,r=r.nextZ,!!r);n++);for(s=u;a>0||s>0&&r;)a!==0&&(s===0||!r||e.z<=r.z)?(i=e,e=e.nextZ,a--):(i=r,r=r.nextZ,s--),f?f.nextZ=i:t=i,i.prevZ=f,f=i;e=r}f.nextZ=null,u*=2}while(o>1);return t}function Me(t,n,e,r,i){return t=(t-e)*i|0,n=(n-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,t|n<<1}function bn(t){var n=t,e=t;do(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),n=n.next;while(n!==t);return e}function ie(t,n,e,r,i,f,o,a){return(i-o)*(n-a)>=(t-o)*(f-a)&&(t-o)*(r-a)>=(e-o)*(n-a)&&(e-o)*(f-a)>=(i-o)*(r-a)}function mn(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!yn(t,n)&&(ue(t,n)&&ue(n,t)&&xn(t,n)&&(U(t.prev,t,n.prev)||U(t,n.prev,n))||Re(t,n)&&U(t.prev,t,t.next)>0&&U(n.prev,n,n.next)>0)}function U(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function Re(t,n){return t.x===n.x&&t.y===n.y}function We(t,n,e,r){var i=ce(U(t,n,e)),f=ce(U(t,n,r)),o=ce(U(e,r,t)),a=ce(U(e,r,n));return!!(i!==f&&o!==a||i===0&&de(t,e,n)||f===0&&de(t,r,n)||o===0&&de(e,t,r)||a===0&&de(e,n,r))}function de(t,n,e){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function ce(t){return t>0?1:t<0?-1:0}function yn(t,n){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&We(e,e.next,t,n))return!0;e=e.next}while(e!==t);return!1}function ue(t,n){return U(t.prev,t,t.next)<0?U(t,n,t.next)>=0&&U(t,t.prev,n)>=0:U(t,n,t.prev)<0||U(t,t.next,n)<0}function xn(t,n){var e=t,r=!1,i=(t.x+n.x)/2,f=(t.y+n.y)/2;do e.y>f!=e.next.y>f&&e.next.y!==e.y&&i<(e.next.x-e.x)*(f-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==t);return r}function je(t,n){var e=new Ie(t.i,t.x,t.y),r=new Ie(n.i,n.x,n.y),i=t.next,f=n.prev;return t.next=n,n.prev=t,e.next=i,i.prev=e,r.next=e,e.prev=r,f.next=r,r.prev=f,r}function Ce(t,n,e,r){var i=new Ie(t,n,e);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function le(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ie(t,n,e){this.i=t,this.x=n,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Ee.deviation=function(t,n,e,r){var i=n&&n.length,f=i?n[0]*e:t.length,o=Math.abs(Ne(t,0,f,e));if(i)for(var a=0,s=n.length;a<s;a++){var u=n[a]*e,l=a<s-1?n[a+1]*e:t.length;o-=Math.abs(Ne(t,u,l,e))}var d=0;for(a=0;a<r.length;a+=3){var v=r[a]*e,_=r[a+1]*e,h=r[a+2]*e;d+=Math.abs((t[v]-t[h])*(t[_+1]-t[v+1])-(t[v]-t[_])*(t[h+1]-t[v+1]))}return o===0&&d===0?0:Math.abs((d-o)/o)};function Ne(t,n,e,r){for(var i=0,f=n,o=e-r;f<e;f+=r)i+=(t[o]-t[f])*(t[f+1]+t[o+1]),o=f;return i}Ee.flatten=function(t){for(var n=t[0][0].length,e={vertices:[],holes:[],dimensions:n},r=0,i=0;i<t.length;i++){for(var f=0;f<t[i].length;f++)for(var o=0;o<n;o++)e.vertices.push(t[i][f][o]);i>0&&(r+=t[i-1].length,e.holes.push(r))}return e};function gn(t){const[n]=Be(t),e=kn(t,n),[r]=Be(e),i=wn(e,r,n),f=En(i,e,n),[o,a]=Rn(f,e);return Fn(f,e,o,a)}function $n(t,n){for(var e={},r=[],i=1,f=0;f<n.length;f++){var o=n[f].join(",");e[o]==null&&(e[o]=i,r.push(n[f]),i++)}for(var a of t)for(var s in a)a[s]=e[n[a[s]].join(",")];return[r,t]}function j(t){return t.join(",")}function Be(t){for(var n={},e=0;e<t.length;e++){var r=j(t[e]);n[r]=e}function i(...f){var o=j(f);return n[o]}return[i]}function kn(t,n){for(var e=Array(t.length).fill(0).map(()=>Array(4).fill(1)),r=t[0][0],i=t[0][1],f=0;f<t.length;f++){t[f][0]<r&&(r=t[f][0]),t[f][1]<i&&(i=t[f][1]);var o=n(t[f][0]+1,t[f][1]),a=n(t[f][0],t[f][1]+1),s=n(t[f][0]-1,t[f][1]),u=n(t[f][0],t[f][1]-1);o!=null&&(e[f][1]=0,e[f][2]=0,e[o][0]=0,e[o][3]=0),a!=null&&(e[a][0]=0,e[a][1]=0,e[f][2]=0,e[f][3]=0),s!=null&&(e[s][1]=0,e[s][2]=0,e[f][0]=0,e[f][3]=0),u!=null&&(e[f][0]=0,e[f][1]=0,e[u][2]=0,e[u][3]=0)}var l={};for(var d in t)for(var v=t[d][0],_=t[d][1],f=0;f<4;f++){var h=v,p=_;f==1&&(h+=1),f==2&&(h+=1,p+=1),f==3&&(p+=1);var b=h+","+p;l[b]==null?l[b]={number:1,index:d,face_index:f}:l[b].number+=1}for(const[R,S]of Object.entries(l))S.number==3&&(e[S.index][S.face_index]=1);var F=[];for(var d in e){var v=t[d][0],_=t[d][1];for(var E in e[d])e[d][E]==1&&(E==0&&F.push([v,_]),E==1&&F.push([v+1,_]),E==2&&F.push([v+1,_+1]),E==3&&F.push([v,_+1]))}function k(R){for(var S=new Set,I=0;I<R.length;I++){var N=R[I].join(",");S.add(N)}return Array.from(S)}return k(F).map(R=>R.split(",").map(S=>parseInt(S)))}function wn(t,n,e){var r=t[0][0],i=t[0][1],f=t[0][0],o=t[0][1];for(var a in t)t[a][0]<r&&(r=t[a][0]),t[a][1]<i&&(i=t[a][1]),t[a][0]>f&&(f=t[a][0]),t[a][1]>o&&(o=t[a][1]);function s(v,_,h){var p=v,b=void 0;if(_=="x")if(h=="forward")do{p=[p[0]+1,p[1]];var b=n(p)}while(b==null&&p[0]<f);else do{p=[p[0]-1,p[1]];var b=n(p)}while(b==null&&p[0]>r);else if(h=="forward")do{p=[p[0],p[1]+1];var b=n(p)}while(b==null&&p[1]<o);else do{p=[p[0],p[1]-1];var b=n(p)}while(b==null&&p[1]>i);return b}var u=new Set;function l(v,_,h){var p=v,b=s(t[v],h,_);if(b!=null){if(p>b)var F=[b,p];else var F=[p,b];var E=t[F[0]],k=t[F[1]];d(E,k,h)&&u.add(j(F))}}function d(v,_,h){if(h=="x"){var p=v[1],b,F;if(v[0]>_[0]?(b=_[0],F=v[0]):(b=v[0],F=_[0]),e([b,p-1])==null){for(var E=b;E<F;E++)if(e([E,p-1])!=null||e([E,p])==null)return!1}else for(var E=b;E<F;E++)if(e([E,p-1])==null||e([E,p])!=null)return!1}else{var E=v[0],k,R;if(v[1]>_[1]?(k=_[1],R=v[1]):(k=v[1],R=_[1]),e([E-1,k])==null){for(var p=k;p<R;p++)if(e([E-1,p])!=null||e([E,p])==null)return!1}else for(var p=k;p<R;p++)if(e([E-1,p])==null||e([E,p])!=null)return!1}return!0}for(var a in t)l(a,"forward","x"),l(a,"forward","y"),l(a,"backward","x"),l(a,"backward","y");return Array.from(u).map(v=>v.split(",").map(_=>parseInt(_)))}function En(t,n,e){for(var r=new Array(n.length).fill(0).map(m=>[]),i=0;i<t.length;i++)r[t[i][0]].push(t[i][1]),r[t[i][1]].push(t[i][0]);function f(m,y){if(m[0]>y[0])var w=y,A=m;else var w=m,A=y;if(w[0]==A[0]||w[1]==A[1])return!1;if(A[1]>w[1])var B=w[0],L=A[0]-1,G=w[1],$=A[1]-1;else var B=w[0],L=A[0]-1,G=A[1],$=w[1]-1;for(var m=B;m<=L;m++){for(var P=!0,y=G;y<=$;y++)if(e([m,y])==null){P=!1;break}if(P)return!0}for(var y=G;y<=$;y++){for(var P=!0,m=B;m<=L;m++)if(e([m,y])==null){P=!1;break}if(P)return!0}return!1}var o=new Array(r.length).fill(0).map(m=>[]);for(var a in r){var s=r[a];if(s.length<=2){o[a]=[s];continue}for(var u=[],i=0;i<s.length;i++)for(var l=s[i],d=n[l],v=i+1;v<s.length;v++){var _=s[v];if(!(l==null||_==null)){var h=n[_];if(f(d,h)){var p=[l,_];u.push(p)}}}o[a]=u}function b(m,y){return o[m].findIndex(w=>w.includes(y))}var F=[],E=new Set,k=new Set;for(var a in o)for(var R in o[a]){let y=function(w){for(const L in o[w])if(!!N.has(`${w},${L}`)&&!k.has(`${w},${L}`)&&!I.has(`${w},${L}`)){N=new Set,I.add(`${w},${L}`),k.add(`${w},${L}`);var A=o[w][L];N.add(`${A[0]},${b(A[0],w)}`),N.add(`${A[1]},${b(A[1],w)}`),S.push(w);for(var B of A)y(B)}};var c=y;a=Number(a);var S=[],I=new Set;E.add(a),I.add(a);var N=new Set;N.add(`${a},${R}`),y(a),S.length!=0&&F.push(S)}return F}function Rn(t,n){function e(v,_){for(var h=!1,p=_[0],b=_[1],F=v.map(function(m){return m[0]}),E=0,k=F.length-1;E<F.length;k=E++){var R=F[E],S=v[E][1],I=F[k],N=v[k][1],c=S>b!=N>b&&p<(I-R)*(b-S)/(N-S)+R;if(c&&(h=!h),S===b&&R===p||N===b&&I===p){h=!0;break}}return h}for(var r=Array.from(t).fill(0).map(v=>[]),i=0;i<t.length;i++)for(var f=t[i].map(v=>n[v]),o=0;o<t.length;o++)i!=o&&t[o].every(v=>e(f,n[v]))&&r[i].push(o);for(var a=new Array(t.length).fill(!1),s=new Array(t.length).fill(0).map(v=>[]),i=0;i<r.length;i++)for(var o=0;o<r[i].length;o++)s[r[i][o]].push(i);for(var i=0;i<s.length;i++)for(var o=0;o<s[i].length;o++)r[s[i][o]]=r[s[i][o]].filter(h=>!r[i].includes(h));var u=new Array(t.length).fill(0).map((v,_)=>_);u.sort((v,_)=>r[v].includes(_)?-1:1);var l=new Set;for(const v of u)l.has(v)||d(v);function d(v,_=0){if(!l.has(v)){l.add(v);for(const h of r[v])d(h,_+1);_%2==1&&(r[v]=[],a[v]=!0)}}return[r,a]}function Fn(t,n,e,r){var i=[];for(var f in t)if(!r[f]){var o=0,a=[];for(var s of t[f])a.push(...n[s]),o+=1;var u=[];for(var s of e[f]){var l=[];u.push(o);for(var d of t[s])l.push(...n[d]),o+=1;a.push(...l)}var v=De.exports(a,u);i.push({positions:a,indices:v})}return i}function An(t){return[(t>>0&255)/255,(t>>8&255)/255,(t>>16&255)/255,1]}function Ue(t){return t[0]+(t[1]<<8)+(t[2]<<16)-1}const Ln=[[0,0,1,0,0,1,0,0,1,0,0,1],[0,0,-1,0,0,-1,0,0,-1,0,0,-1],[0,1,0,0,1,0,0,1,0,0,1,0],[0,-1,0,0,-1,0,0,-1,0,0,-1,0],[1,0,0,1,0,0,1,0,0,1,0,0],[-1,0,0,-1,0,0,-1,0,0,-1,0,0]],Tn=[[-1,-1,1,1,-1,1,1,1,1,-1,1,1],[-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1],[-1,1,-1,-1,1,1,1,1,1,1,1,-1],[-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1],[1,-1,-1,1,1,-1,1,1,1,1,-1,1],[-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]],Sn=[[0,1,2,0,2,3],[4,5,6,4,6,7],[8,9,10,8,10,11],[12,13,14,12,14,15],[16,17,18,16,18,19],[20,21,22,20,22,23]],Pn=[[0,1,1,2,2,3,3,0],[4,5,5,6,6,7,7,4],[8,9,9,10,10,11,11,8],[12,13,13,14,14,15,15,12],[16,17,17,18,18,19,19,16],[20,21,21,22,22,23,23,20]],ne=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],Mn=[1,1,1];function In(t,n){var e=j([t[0]+1,t[1],t[2]]);return n(e)}function Nn(t,n){var e=j([t[0]-1,t[1],t[2]]);return n(e)}function Bn(t,n){var e=j([t[0],t[1]+1,t[2]]);return n(e)}function Dn(t,n){var e=j([t[0],t[1]-1,t[2]]);return n(e)}function Cn(t,n){var e=j([t[0],t[1],t[2]+1]);return n(e)}function Un(t,n){var e=j([t[0],t[1],t[2]-1]);return n(e)}const Fe=[[0,1,0,1,0,1],[0,1,0,1,1,0],[0,1,1,0,0,1],[0,1,1,0,1,0],[1,0,0,1,0,1],[1,0,0,1,1,0],[1,0,1,0,0,1],[1,0,1,0,1,0]];class On{constructor(){this.voxels=[[0,0,0]],this.color=[],this.init_colors(this.voxels)}init_colors(n){for(var e=[],r=0;r<n.length;r++){var i=[];e.push(i);for(var f=0;f<6;f++)i.push([...Mn])}this.color.push(...e)}build_geometry(){for(var n=[],e=[],r=[],i=[],f=[],o=[],a=0,s=1,u=0;u<this.voxels.length;u++){for(var l=0,d=0,v=s-1,_=[],h=0;h<6;h++){if(this.faces[u][h]==0){d+=4;continue}r.push(...Tn[h].map((F,E)=>F+this.voxels[u][E%3]*2-this.center[E%3])),f.push(...Ln[h]),o.push(...Pn[h].map(F=>F+a-d)),i.push(...Sn[h].map(F=>F+a-d)),l+=4;for(var p=An(s),b=0;b<4;b++)_.push(...p);s++}a+=l,e.push({start:v,end:s-1}),n.push(..._)}this.id=s,this.distance=a,this.geometry_vertexes=r,this.geometry_indexes=i,this.geometry_normals=f,this.geometry_edge_index=o,this.pick_map=n,this.pick_meta=e}init(){this.build_boundary(),this.build_center(),this.build_faces(),this.build_geometry()}build(){this.build_boundary(),this.build_center(),this.build_geometry()}add(...n){this.voxels.push(...n),this.init_colors(n),this.init()}subdivide(){var n=[],e=[],r=[];for(const s in this.voxels){const u=this.voxels[s],l=this.faces[s],d=[u[0]*2,u[1]*2,u[2]*2];for(var i=0;i<8;i++){var f=[];r.push(f);for(var o=0;o<6;o++)f.push([...this.color[s][o]])}n.push([d[0],d[1],d[2]],[d[0]+1,d[1],d[2]],[d[0],d[1]+1,d[2]],[d[0]+1,d[1]+1,d[2]],[d[0],d[1],d[2]+1],[d[0]+1,d[1],d[2]+1],[d[0],d[1]+1,d[2]+1],[d[0]+1,d[1]+1,d[2]+1]);for(var o in Fe){var a=Array(6).fill(0);for(var i in Fe[o])Fe[o][i]==1&&l[i]==1&&(a[i]=1);e.push(a)}}this.voxels=n,this.faces=e,this.color=r,this.build_boundary(),this.build_center(),this.build_geometry()}remove(...n){for(const r of n){if(this.voxels.length==1){n.splice(n.indexOf(r),1);continue}for(var e=0;e<this.voxels.length;e++)if(this.voxels[e][0]==r[0]&&this.voxels[e][1]==r[1]&&this.voxels[e][2]==r[2]){this.voxels.splice(e,1),this.faces.splice(e,1),this.color.splice(e,1);break}}this.init()}get_plane_color(n,e,r=null){var i=[];for(const l in this.pick_meta){const d=this.faces[l];for(var f=0,o=0;o<d.length;o++){if(d[o]==0){f+=1;continue}if(n.includes(l)){if(r!=null)var a=this.color[l][o];else var a=this.color[l][o];if(f==e){if(r!=null)var s=this.color[l][o].map((v,_)=>v*(1-r[3])+r[_]*r[3]);else var s=this.color[l][o].map(_=>Math.abs(1-_*.5));for(var u=0;u<4;u++)i.push(...s,1)}else for(var u=0;u<4;u++)i.push(...a,1)}else for(var u=0;u<4;u++)i.push(...this.color[l][o],1);f+=1}}return i}get_plane(n,e){var r=[];for(const o in this.voxels){const a=this.voxels[o];var i=!0;for(const s in e)if(e[s]!=0&&n[s]!=a[s]){i=!1;break}if(i){var f=this.voxels[o].map((s,u)=>s+e[u]);this.voxels.some(s=>s[0]==f[0]&&s[1]==f[1]&&s[2]==f[2])||r.push(o)}}return r}get_contiguous(n,e,r){var i=[];const f=this.voxels,o=new Set;function a(s){for(const v of n){const _=f[v];var u=!0;for(const h in r)if(r[h]!=0){if(s[h]!=_[h]){u=!1;break}}else if(Math.abs(s[h]-_[h])>1){u=!1;break}if(u){var l=f[v].map((h,p)=>h+r[p]),d=`${l[0]},${l[1]},${l[2]}`;o.has(d)||(o.add(d),i.push(v),a(f[v]))}}}return a(e),i}get_vertical_line(n,e,r){var i=[];for(const s in this.voxels){const u=this.voxels[s];var f=!0,o=-1;for(const l in e)if(e[l]!=0&&(o=l,n[l]!=u[l])){f=!1;break}if(o==0){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==2){f=!1;break}}else if(o==2){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==0){f=!1;break}}else if(o==1){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==0){f=!1;break}}else f=!1;if(f){var a=this.voxels[s].map((l,d)=>l+e[d]);this.voxels.some(l=>l[0]==a[0]&&l[1]==a[1]&&l[2]==a[2])||i.push(s)}}return i}get_horizontal_line(n,e,r){var i=[];for(const s in this.voxels){const u=this.voxels[s];var f=!0,o=-1;for(const l in e)if(e[l]!=0){if(o=l,n[l]!=u[l]){f=!1;break}}else if(n[l]!=u[l]&&l==1){f=!1;break}if(o==1){for(const l in e)if(e[l]==0&&n[l]!=u[l]&&l==2){f=!1;break}}if(f){var a=this.voxels[s].map((l,d)=>l+e[d]);this.voxels.some(l=>l[0]==a[0]&&l[1]==a[1]&&l[2]==a[2])||i.push(s)}}return i}highlight_plane(n,e,r,i,f=null){var o=Ue(n),v=[],a=0;for(const h in this.pick_meta){const p=this.faces[h],b=this.pick_meta[h];if(o>=b.start&&o<b.end)for(var s=0,u=0;u<p.length;u++){if(p[u]==0){s+=1;continue}if(o==a){var l;switch(r){case"Plane":l=this.get_plane(this.voxels[h],ne[s]);break;case"Horizontal line":l=this.get_horizontal_line(this.voxels[h],ne[s]);break;case"Vertical line":l=this.get_vertical_line(this.voxels[h],ne[s]);break}i&&(l=this.get_contiguous(l,this.voxels[h],ne[s]));var d=[];for(const F of l)d.push(this.color[F][s]);return e({voxel:l.map(F=>this.voxels[F]),direction:ne[s],color:d,mouse_color:this.color[h][u],index:h}),this.get_plane_color(l,s,f)}s+=1,a+=1}else for(var u=0;u<p.length;u++)p[u]!=0&&(a+=1)}var v=[];for(const h in this.pick_meta){const p=this.faces[h];for(var u=0;u<p.length;u++)if(p[u]!=0)for(var _=0;_<4;_++)v.push(...this.color[h][u],1)}return v}get_highlight(n,e,r=null){var i=new Set(n.map(h=>Ue(h))),f=Array.from(i),o=[],a=[],s=0;for(const h in this.pick_meta){const p=this.faces[h],b=this.pick_meta[h];if(f.some(F=>F>=b.start&&F<b.end))for(var u=0,l=0;l<p.length;l++){if(p[l]==0){u+=1;continue}if(r!=null)var d=this.color[h][l];else var d=this.color[h][l];if(i.has(s)){if(r!=null)var v=this.color[h][l].map((F,E)=>F*(1-r[3])+r[E]*r[3]);else var v=this.color[h][l].map(E=>Math.abs(1-E*.5));a.push({voxel:[this.voxels[h]],direction:ne[u],color:[this.color[h][l]],mouse_color:this.color[h][l],index:h});for(var _=0;_<4;_++)o.push(...v,1)}else for(var _=0;_<4;_++)o.push(...d,1);u+=1,s+=1}else for(var l=0;l<p.length;l++)if(p[l]!=0){for(var _=0;_<4;_++)o.push(...this.color[h][l],1);s+=1}}return e(a),o}build_faces(){const n=this.voxels,e=new Array(n.length).fill(0).map(d=>[1,1,1,1,1,1]),[r]=Be(this.voxels);for(var i=0;i<n.length;i++){var f=In(n[i],r);f&&(e[i][4]=0,e[f][5]=0);var o=Nn(n[i],r);o&&(e[i][5]=0,e[o][4]=0);var a=Bn(n[i],r);a&&(e[i][2]=0,e[a][3]=0);var s=Dn(n[i],r);s&&(e[i][3]=0,e[s][2]=0);var u=Cn(n[i],r);u&&(e[i][0]=0,e[u][1]=0);var l=Un(n[i],r);l&&(e[i][1]=0,e[l][0]=0)}this.faces=e}build_center(){const n=this.boundary;this.center=n[0].map((e,r)=>e+n[1][r])}build_boundary(){const n=this.voxels;for(var e=n[0],r=n[0],i=1;i<n.length;i++)e=e.map((f,o)=>Math.min(f,n[i][o])),r=r.map((f,o)=>Math.max(f,n[i][o]));this.boundary=[e,r]}}class Zn{constructor(n,e,r){this.gl=n,this.program=e,this.canvas=r,this.attribute_matrix_4_mat_float=te((i,f)=>{var o=n.getUniformLocation(this.program,i);n.uniformMatrix4fv(o,!1,f)}),this.uniform_float=te((i,f)=>{var o=n.getUniformLocation(this.program,i);n.uniform1f(o,f)}),this.uniform_4_float=te((i,f)=>{var o=n.getUniformLocation(this.program,i);n.uniform4f(o,f[0],f[1],f[2],f[3])}),this.uniform_3_float=te((i,f)=>{var o=n.getUniformLocation(this.program,i);n.uniform3f(o,f[0],f[1],f[2])}),this.attribute_matrix_3_float=te((i,f)=>{var o=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,o),n.bufferData(n.ARRAY_BUFFER,new Float32Array(f),n.STATIC_DRAW);var a=n.getAttribLocation(this.program,i);n.vertexAttribPointer(a,3,n.FLOAT,!1,0,0),n.enableVertexAttribArray(a)}),this.attribute_matrix_4_float=te((i,f)=>{var o=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,o),n.bufferData(n.ARRAY_BUFFER,new Float32Array(f),n.STATIC_DRAW);var a=n.getAttribLocation(this.program,i);n.vertexAttribPointer(a,4,n.FLOAT,!1,0,0),n.enableVertexAttribArray(a)})}set face(n){this.faces=n}buffer(n){const e=this.gl,r=this.canvas,i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i);var f=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,f),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,f);const o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0),n(),e.bindFramebuffer(e.FRAMEBUFFER,null),o}getPixel(n,e){const r=this.gl,i=new Uint8Array(4);return r.readPixels(n,e,1,1,r.RGBA,r.UNSIGNED_BYTE,i),i}drawSolid(n){const e=this.gl;if(!n){if(this.faces==null)throw"No faces defined";n=this.faces}var r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),e.STATIC_DRAW),e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),e.drawElements(e.TRIANGLES,n.length,e.UNSIGNED_SHORT,0)}drawLines(n){const e=this.gl;if(!n){if(this.faces==null)throw"No faces defined";n=this.faces}var r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),e.STATIC_DRAW),e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),e.drawElements(e.LINES,n.length,e.UNSIGNED_SHORT,0)}}function te(t){return new Proxy({},{set:function(n,e,r){return t(e,r),!0}})}function Hn(t,n,e){const r=t.getContext("webgl2",{antialias:!0}),i=r.createProgram(),f=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(f,e),r.compileShader(f),r.attachShader(i,f);const o=r.createShader(r.VERTEX_SHADER);return r.shaderSource(o,n),r.compileShader(o),r.attachShader(i,o),r.linkProgram(i),r.useProgram(i),[r,new Zn(r,i,t)]}var Oe=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)});function Xn(){var t=new Oe(16);return Oe!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Gn(t,n){if(t===n){var e=n[1],r=n[2],i=n[3],f=n[6],o=n[7],a=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=e,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=f,t[11]=n[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t}function Yn(t,n){var e=n[0],r=n[1],i=n[2],f=n[3],o=n[4],a=n[5],s=n[6],u=n[7],l=n[8],d=n[9],v=n[10],_=n[11],h=n[12],p=n[13],b=n[14],F=n[15],E=e*a-r*o,k=e*s-i*o,R=e*u-f*o,S=r*s-i*a,I=r*u-f*a,N=i*u-f*s,c=l*p-d*h,m=l*b-v*h,y=l*F-_*h,w=d*b-v*p,A=d*F-_*p,B=v*F-_*b,L=E*B-k*A+R*w+S*y-I*m+N*c;return L?(L=1/L,t[0]=(a*B-s*A+u*w)*L,t[1]=(i*A-r*B-f*w)*L,t[2]=(p*N-b*I+F*S)*L,t[3]=(v*I-d*N-_*S)*L,t[4]=(s*y-o*B-u*m)*L,t[5]=(e*B-i*y+f*m)*L,t[6]=(b*R-h*N-F*k)*L,t[7]=(l*N-v*R+_*k)*L,t[8]=(o*A-a*y+u*c)*L,t[9]=(r*y-e*A-f*c)*L,t[10]=(h*I-p*R+F*E)*L,t[11]=(d*R-l*I-_*E)*L,t[12]=(a*m-o*w-s*c)*L,t[13]=(e*w-r*m+i*c)*L,t[14]=(p*k-h*S-b*E)*L,t[15]=(l*S-d*k+v*E)*L,t):null}function Jn(t,n,e,r){function i($,P,D,M){var Y=Math.tan($*.5*Math.PI/180);return[.5/Y,0,0,0,0,.5*P/Y,0,0,0,0,-(M+D)/(M-D),-1,0,0,-2*M*D/(M-D),0]}var f=i(40,t.width/t.height,1,1e3),o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const s=Xn();Yn(s,a),Gn(s,s),e.viewport(0,0,t.width,t.height),n.attribute_matrix_4_mat_float.uNormalMatrix=s,a[14]=a[14]-6;var u=0,l=!1,d,v,_=0,h=0,p=null,b=!1;document.addEventListener("keydown",function($){$.key=="Control"&&(b=!0)}),document.addEventListener("keyup",function($){$.key=="Control"&&(b=!1)});var F=function($){if(!!b)return $.button==2?p="pan":p="rotate",l=!0,d=$.pageX,v=$.pageY,$.preventDefault(),!1},E=function($){l=!1};const k={x:0,y:0};var R=function($){const P=t.__element.getBoundingClientRect();if(k.x=($.clientX-P.left)*e.canvas.width/e.canvas.clientWidth,k.y=e.canvas.height-($.clientY-P.top)*e.canvas.height/e.canvas.clientHeight-1,!l)return!1;_=($.pageX-d)*2*Math.PI/t.width,h=($.pageY-v)*2*Math.PI/t.height,p=="rotate"?(y+=_,w+=h):p=="pan"&&S(_,h),d=$.pageX,v=$.pageY,$.preventDefault()};function S($,P){a[12]-=$*a[14]/2,a[13]+=P*a[14]/2}t.$on("mousedown",F),t.$on("mouseup",E),t.$on("mouseout",E),t.$on("mousemove",R);var I=function($){$.preventDefault();var P=$.wheelDelta?$.wheelDelta/40:$.detail?-$.detail:0,D=1.3;return P&&N(P<0?1*D:1/D),$.preventDefault()&&!1};function N($){a[14]*=$}t.$on("wheel",I);function c($,P){var D=Math.cos(P),M=Math.sin(P),Y=$[1],fe=$[5],V=$[9];$[1]=$[1]*D-$[2]*M,$[5]=$[5]*D-$[6]*M,$[9]=$[9]*D-$[10]*M,$[2]=$[2]*D+Y*M,$[6]=$[6]*D+fe*M,$[10]=$[10]*D+V*M}function m($,P){var D=Math.cos(P),M=Math.sin(P),Y=$[0],fe=$[4],V=$[8];$[0]=D*$[0]+M*$[2],$[4]=D*$[4]+M*$[6],$[8]=D*$[8]+M*$[10],$[2]=D*$[2]-M*Y,$[6]=D*$[6]-M*fe,$[10]=D*$[10]-M*V}var y=.8,w=.8;function A(){l||(_*=u,h*=u,y+=_,w+=h),o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,w=Math.max(-Math.PI/2,Math.min(Math.PI/2,w)),m(o,y),c(o,w),n.attribute_matrix_4_mat_float.projection_matrix=f,n.attribute_matrix_4_mat_float.view_matrix=a,n.attribute_matrix_4_mat_float.model_matrix=o}function B(){a[12]=0,a[13]=0}function L(){y=.8,w=.8}function G($){a[14]=$}return{update:A,mouse:k,zoom:N,resetPan:B,resetRotation:L,setZoom:G}}function zn(t){var n=0;function e(r){r*=.001;const i=r-n;n=r;const f=1/i;t(f.toFixed(1)),requestAnimationFrame(e)}e()}function re(t,n,e){var r=[];const i=we({name:e});for(const f of t){const o=g("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(i.name==f.name?" button-selected":""),elements:[typeof i<"u"?i:void 0,typeof name<"u"?name:void 0,typeof f<"u"?f:void 0,typeof name<"u"?name:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>f.name,elements:[typeof f<"u"?f:void 0,typeof name<"u"?name:void 0]});o.$on("click",()=>{i.name=f.name,n(f.name)}),r.push(o)}return r}function J(t,n,e=!0){const r=we({value:e});var i=g("button",{class:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>"button"+(r.value?" button-selected":""),elements:[typeof r<"u"?r:void 0,typeof value<"u"?value:void 0]}},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]});return i.$on("click",()=>{r.value=!r.value,n(r.value)}),i}function C(t,n){var e=g("button",{class:"button"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]});return e.$on("click",()=>{n()}),e}function Ze({callback:t,start:n,color:e}){t||(t=u=>{});const r=we({absolute_value:0,relative_value:0});var i=K(),f=g("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--accent-color:${e()};`,elements:[typeof e<"u"?e:void 0]}},g("div",{class:"trackbar-background"}),g("div",{class:"trackbar-foreground"}),g("div",{class:"trackbar-thumb",ref:i,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${r.absolute_value}px`,elements:[typeof r<"u"?r:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));f.$onUpdate(()=>{var u=f.__element.getBoundingClientRect();r.relative_value=n(),r.absolute_value=u.width*n()/255});var o=!1,a;function s(u){var l=u-a,d=f.__element.getBoundingClientRect();l<0&&(l=0),l>d.width&&(l=d.width),r.absolute_value=l,r.relative_value=r.absolute_value/d.width*255,t(r.relative_value)}return document.addEventListener("mousemove",u=>{o&&s(u.clientX)}),i.$on("mousedown",u=>{u.stopPropagation(),o=!0,a=u.clientX-r.absolute_value}),f.$on("mousedown",u=>{var l=f.__element.getBoundingClientRect();a=l.left,s(u.clientX),o=!0}),document.addEventListener("mouseup",u=>{o=!1}),f}function Ae({callback:t,start:n,colorFrom:e,colorTo:r}){t||(t=l=>{});const i=we({absolute_value:0,relative_value:0});var f=K(),o=g("div",{class:"trackbar-container",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`--color-from:${e()};--color-to:${r()};`,elements:[typeof e<"u"?e:void 0,typeof r<"u"?r:void 0]}},g("div",{class:"trackbar-data"}),g("div",{class:"trackbar-thumb",ref:f,style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`left:${i.absolute_value}px`,elements:[typeof i<"u"?i:void 0,typeof absolute_value<"u"?absolute_value:void 0]}}));o.$onUpdate(()=>{var l=o.__element.getBoundingClientRect();i.relative_value=n(),i.absolute_value=l.width*n()/255});var a=!1,s;function u(l){var d=l-s,v=o.__element.getBoundingClientRect();d<0&&(d=0),d>v.width&&(d=v.width),i.absolute_value=d,i.relative_value=i.absolute_value/v.width*255,t(i.relative_value)}return document.addEventListener("mousemove",l=>{a&&u(l.clientX)}),f.$on("mousedown",l=>{l.stopPropagation(),a=!0,s=l.clientX-i.absolute_value}),o.$on("mousedown",l=>{var d=o.__element.getBoundingClientRect();s=d.left,u(l.clientX),a=!0}),document.addEventListener("mouseup",l=>{a=!1}),o}function Ke(t,n){var e=JSON.stringify(n),r=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(r),f=document.createElement("a");f.download=t,f.href=i,f.textContent="Download",f.click(),f.remove()}function Vn(t,n){var e=new Blob([n],{type:"plain/text"}),r=URL.createObjectURL(e),i=document.createElement("a");i.download=t,i.href=r,i.textContent="Download",i.click(),i.remove()}async function Qe(t,n){var e=document.createElement("input");e.type="file",e.accept="."+t,e.onchange=r=>{var i=r.target.files[0],f=new FileReader;f.onload=function(o){var a=o.target.result;n(JSON.parse(a))},f.readAsText(i)},e.click(),e.remove()}function He(t,n){var e=document.createElement("a");e.download=t,e.href=n,e.click(),e.remove()}function Wn({set:t,get:n}){var e=0,r=0,i=0,f=255,o=255,a=255,s=255,u=255;const l=K();var d=[];function v(){Qe("col",c=>{l.$html("");for(var m=0;m<c.length;m++)h(c[m][0],c[m][1],c[m][2],c[m][3])})}function _(){Ke("color_list.col",d)}function h(c,m,y,w){d.push([c,m,y,w]);var A=g("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${c},${m},${y},${w/255})`,elements:[typeof c<"u"?c:void 0,typeof m<"u"?m:void 0,typeof y<"u"?y:void 0,typeof w<"u"?w:void 0]}}),B=!1;A.$on("mousedown",L=>(B=!0,L.button==1&&L.preventDefault(),!1)),A.$on("contextmenu",L=>(L.preventDefault(),!1)),document.addEventListener("mouseup",L=>{setTimeout(()=>{B=!1},100)}),A.$on("mouseup",L=>{!B||(L.button==0?(e=c,r=m,i=y,f=w,b(),p&&p.$update()):L.button==2?(o=c,a=m,s=y,u=w,b("background"),p&&p.$update()):A.$remove())}),A.$parent(l)}var p=g("div",null,g("div",{style:"display:flex;flex-direction:row"},g("div",{style:"width:100%;padding:10px"},g(Ae,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>e,elements:[typeof e<"u"?e:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`0,${r},${i}`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`255,${r},${i}`,elements:[typeof r<"u"?r:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:c=>E(c),elements:[typeof x<"u"?x:void 0,typeof E<"u"?E:void 0,typeof x<"u"?x:void 0]}}),g(Ae,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${e},0,${i}`,elements:[typeof e<"u"?e:void 0,typeof i<"u"?i:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${e},255,${i}`,elements:[typeof e<"u"?e:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:c=>k(c),elements:[typeof x<"u"?x:void 0,typeof k<"u"?k:void 0,typeof x<"u"?x:void 0]}}),g(Ae,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]},colorFrom:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${e},${r},0`,elements:[typeof e<"u"?e:void 0,typeof r<"u"?r:void 0]},colorTo:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${e},${r},255`,elements:[typeof e<"u"?e:void 0,typeof r<"u"?r:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:c=>R(c),elements:[typeof x<"u"?x:void 0,typeof R<"u"?R:void 0,typeof x<"u"?x:void 0]}}))),g("div",{class:"row"},g("div",{class:"color-area"},g("div",{class:"color-container"},g("div",{class:"background color-item"},g("div",{class:"backdrop"}),g("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${o},${a},${s},${u/255})`,elements:[typeof o<"u"?o:void 0,typeof a<"u"?a:void 0,typeof s<"u"?s:void 0,typeof u<"u"?u:void 0]}})),g("div",{class:"foreground color-item"},g("div",{class:"backdrop"}),g("div",{class:"color",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${e},${r},${i},${f/255})`,elements:[typeof e<"u"?e:void 0,typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof f<"u"?f:void 0]}}))),g("div",{class:"hover-icon-container",style:"margin-left:5px","on:click":N},g("i",{class:"fa-solid fa-arrows-rotate hover-icon"}))),g("div",{class:"alpha-area",style:"margin-top:-10px"},g(Ze,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>f,elements:[typeof f<"u"?f:void 0]},color:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${e},${r},${i};`,elements:[typeof e<"u"?e:void 0,typeof r<"u"?r:void 0,typeof i<"u"?i:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:c=>S(c),elements:[typeof x<"u"?x:void 0,typeof S<"u"?S:void 0,typeof x<"u"?x:void 0]}}),g(Ze,{start:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>u,elements:[typeof u<"u"?u:void 0]},color:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`${o},${a},${s};`,elements:[typeof o<"u"?o:void 0,typeof a<"u"?a:void 0,typeof s<"u"?s:void 0]},callback:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:c=>I(c),elements:[typeof x<"u"?x:void 0,typeof I<"u"?I:void 0,typeof x<"u"?x:void 0]}}))),g("div",{class:"color-history-container"},g("div",{style:"display:inline-block",ref:l}),g("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgba(${e},${r},${i},${f/255})`,elements:[typeof e<"u"?e:void 0,typeof r<"u"?r:void 0,typeof i<"u"?i:void 0,typeof f<"u"?f:void 0]},"on:click":()=>h(e,r,i,f)},g("i",{class:"fa fa-plus"})),g("div",{class:"color-history-item",style:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>`background-color:rgb(${o},${a},${s},${u/255})`,elements:[typeof o<"u"?o:void 0,typeof a<"u"?a:void 0,typeof s<"u"?s:void 0,typeof u<"u"?u:void 0]},"on:click":()=>h(o,a,s,u)},g("i",{class:"fa fa-plus"}))),g("button",{class:"button","on:click":()=>_()},"Save colors"),g("button",{class:"button","on:click":()=>v()},"Load colors"));function b(c="foreground"){n(c,{r:e,g:r,b:i,a:f},{r:o,g:a,b:s,a:u})}t(F());function F(){return(c,m)=>{c!=null&&(e=c.r,r=c.g,i=c.b,f=c.a),m!=null&&(o=m.r,a=m.g,s=m.b,u=m.a),p&&p.$update()}}function E(c){e=c,p&&p.$update(),b()}function k(c){r=c,p&&p.$update(),b()}function R(c){i=c,p&&p.$update(),b()}function S(c){f=c,p&&p.$update(),b()}function I(c){u=c,p&&p.$update(),b("background")}function N(){var c=o;o=e,e=c,c=a,a=r,r=c,c=s,s=i,i=c,c=u,u=f,f=c,p&&p.$update(),b()}return b(),p.$onMounted(()=>{p.$update()}),p}const ve=[2,2,1,1,0,0],jn=[1,0,1,0,1,0];function Xe(t){for(var n=t[0][0],e=t[0][0],r=t[0][1],i=t[0][1],f=1;f<t.length;f++){var o=t[f];o[0]<n&&(n=o[0]),o[0]>e&&(e=o[0]),o[1]<r&&(r=o[1]),o[1]>i&&(i=o[1])}return[n,r,e,i]}function Kn(t){for(var n=t.voxels,e=t.faces,r=t.color,i={},f=0;f<e.length;f++)for(var o=0,a=0;a<e[f].length;a++){if(e[f][a]==0){o+=1;continue}var s=`${n[f][ve[o]]},${o}`;i[s]==null&&(i[s]={direction:o,relevant:ve[o],position:n[f][ve[o]]+jn[o],data:[],colors:[]}),i[s].data.push(n[f].filter((W,Q)=>Q!=ve[o])),i[s].colors.push(r[f][o]),o+=1}for(var f in i)i[f].geometry=gn(i[f].data);var u=[],l=[],d=[],v=[],_=[],h=[],p=0,b=0,F=0,E=0,k=0,R=Object.values(i).map(W=>Xe(W.data)),S=R.reduce((W,Q)=>W+Q[2]-Q[0]+1,0),I=R.reduce((W,Q)=>Math.max(W,Q[3]-Q[1]+1),0),N=Math.ceil(Math.sqrt(S*I));for(var f in i){var c=i[f],m=!1;(c.direction==4||c.direction==5)&&(m=!0);var[y,w,A,B]=Xe(c.data);if(m){var L=B;b-=w}else{var L=A;b-=y}b>N&&(b=0,F+=I);for(var V in c.data){var G=c.colors[V],$=c.data[V];m?h.push({color:G,position:[$[1]+b,F+$[0]]}):h.push({color:G,position:[$[0]+b,F+$[1]]})}for(var V in c.geometry){for(var P=c.geometry[V],a=0;a<P.positions.length;a+=2){var D=[P.positions[a],P.positions[a+1]];D.splice(c.relevant,0,c.position),d.push(D),m?u.push([P.positions[a+1]+b,F-1+P.positions[a]+1]):u.push([P.positions[a]+b,F-1+P.positions[a+1]+1])}for(var a=0;a<P.indices.length;a+=3){_.push(c.direction+1);var M=[P.indices[a]+p,P.indices[a+1]+p,P.indices[a+2]+p];if(c.direction==1){var Y=M[0];M[0]=M[1],M[1]=Y}if(c.direction==2){var Y=M[0];M[0]=M[2],M[2]=Y}if(c.direction==5){var Y=M[1];M[1]=M[2],M[2]=Y}l.push(M.map(nn=>nn+1)),v.push(M)}p+=P.positions.length/2}b+=L+1,b>k&&(k=b),F>E&&(E=F)}E+=I,u=u.map(W=>[W[0]/k,W[1]/E]);for(var f in h)h[f].position=[h[f].position[0],E-1-h[f].position[1]];var[fe,V]=$n(v,d);return{vert:fe,index:V,normal:_,uv_position:u,uv_index:l,uv_color:h,width:k,height:E}}var he=1e3;function qe(t){const n=K(),e=g("div",{class:"modal-background","v-show":"visible"},g("div",{class:"modal-prompt"},g("span",{class:"close-button",ref:n,id:"close"},g("i",{class:"fa-solid fa-xmark"})),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>t,elements:[typeof t<"u"?t:void 0]}));e.$style("z-index",{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>he++,elements:[typeof he<"u"?he:void 0]});function r(){he--,e.$remove()}return n.$on("click",r),e.$parent(document.body),{close:r}}var Qn=`
vn -0.000000 0.000000 1.000000
vn 0.000000 0.000000 -1.000000
vn 0.000000 1.000000 0.000000
vn 0.000000 -1.000000 0.000000
vn 1.000000 0.000000 0.000000
vn -1.000000 -0.000000 -0.000000
`;function qn({vert:t,index:n,normal:e,uv_position:r,uv_index:i,uv_color:f,width:o,height:a}){for(var s="",u=0;u<t.length;u++)s+=`v ${t[u][0]} ${t[u][1]} ${t[u][2]}
`;s+=`
`;for(var u=0;u<r.length;u++)s+=`vt ${r[u][0]} ${r[u][1]}
`;s+=`
`,s+=Qn,s+=`
`;for(var u=0;u<n.length;u++)s+=`f ${n[u][0]}/${i[u][0]}/${e[u]} ${n[u][1]}/${i[u][1]}/${e[u]} ${n[u][2]}/${i[u][2]}/${e[u]}
`;return s}function et({uv_color:t,width:n,height:e},r=32){var i=document.createElement("canvas");i.width=n*r,i.height=e*r;var f=i.getContext("2d");for(var o of t){var[a,s]=o.position,[u,l,d]=o.color;f.fillStyle=`rgb(${u*255},${l*255},${d*255})`,f.fillRect(a*r,s*r,r,r)}var v=i.toDataURL("image/png");return i.remove(),v}function nt({uv_color:t,width:n,height:e}){var r=document.createElement("canvas");r.width=n,r.height=e;for(var i=r.getContext("2d"),f=i.createImageData(n,e),o=0;o<f.width;o++)for(var a=0;a<f.height;a++){var s=(o+a*f.width)*4;f.data[s]=255,f.data[s+1]=1,f.data[s+2]=1,f.data[s+3]=1}for(var u of t){var[o,a]=u.position,[l,d,v]=u.color,s=(o+a*n)*4;f.data[s+0]=l*255,f.data[s+1]=d*255,f.data[s+2]=v*255,f.data[s+3]=255}i.putImageData(f,0,0);var _=r.toDataURL("image/png");return r.remove(),_}var oe=null,pe=null,_e=null,be=null,me=null,ye=null,xe=null,ge=null,Z=O;const Le=[{name:"Pen"},{name:"Line"},{name:"Plane"},{name:"Horizontal line"},{name:"Vertical line"}],Te=[{name:"Sculpt"},{name:"Paint"}];var X="Pen",q="Sculpt",ae=!0,$e=!0,O=[1,0,0],z=[1,1,1];function Se(t,n,e){O=[n.r/255,n.g/255,n.b/255,n.a/255],z=[e.r/255,e.g/255,e.b/255,e.a/255],t=="foreground"?Z=O:Z=z}var ke=null;function Ge(t,n){var e=null;t!=null&&(e={r:t[0]*255,g:t[1]*255,b:t[2]*255,a:255});var r=null;n!=null&&(r={r:n[0]*255,g:n[1]*255,b:n[2]*255,a:255}),ke(e,r)}const H=K(),en=K(),tt=g("div",{class:"main"},g("div",{class:"info"},g("p",null,g("h3",null,"Mode"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>re(Te,t=>{q=t,Z=O},"Sculpt"),elements:[typeof re<"u"?re:void 0,typeof Te<"u"?Te:void 0,typeof x<"u"?x:void 0,typeof q<"u"?q:void 0,typeof x<"u"?x:void 0,typeof Z<"u"?Z:void 0,typeof O<"u"?O:void 0]}),g("p",null,g("h3",null,"Color"),g(Wn,{get:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:(t,n,e)=>Se(t,n,e),elements:[typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0,typeof Se<"u"?Se:void 0,typeof changed<"u"?changed:void 0,typeof fg<"u"?fg:void 0,typeof bg<"u"?bg:void 0]},set:{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:t=>ke=t,elements:[typeof fn<"u"?fn:void 0,typeof ke<"u"?ke:void 0,typeof fn<"u"?fn:void 0]}}))),g("canvas",{ref:H}),g("div",{class:"info"},g("p",null,"FPS: ",g("span",{ref:en})),g("p",null,g("h3",null,"Tool"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>re(Le,t=>X=t,"Pen"),elements:[typeof re<"u"?re:void 0,typeof Le<"u"?Le:void 0,typeof x<"u"?x:void 0,typeof X<"u"?X:void 0,typeof x<"u"?x:void 0]}),g("p",null,g("h3",null,"Tool options"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>J("Contiguous",t=>ae=t),elements:[typeof J<"u"?J:void 0,typeof x<"u"?x:void 0,typeof ae<"u"?ae:void 0,typeof x<"u"?x:void 0]}),g("p",null,g("h3",null,"View"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>J("Wireframe",t=>$e=t),elements:[typeof J<"u"?J:void 0,typeof x<"u"?x:void 0,typeof $e<"u"?$e:void 0,typeof x<"u"?x:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>C("Reset pan",()=>me()),elements:[typeof C<"u"?C:void 0,typeof me<"u"?me:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>C("Reset rotation",()=>ye()),elements:[typeof C<"u"?C:void 0,typeof ye<"u"?ye:void 0]}),g("p",null,g("h3",null,"Actions"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>C("Subdivide",()=>oe()),elements:[typeof C<"u"?C:void 0,typeof oe<"u"?oe:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>C("Undo",()=>xe()),elements:[typeof C<"u"?C:void 0,typeof xe<"u"?xe:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>C("Redo",()=>ge()),elements:[typeof C<"u"?C:void 0,typeof ge<"u"?ge:void 0]}),g("p",null,g("h3",null,"Persistence"),{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>C("Save project",()=>pe()),elements:[typeof C<"u"?C:void 0,typeof pe<"u"?pe:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>C("Load project",()=>_e()),elements:[typeof C<"u"?C:void 0,typeof _e<"u"?_e:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>C("Export obj",()=>be()),elements:[typeof C<"u"?C:void 0,typeof be<"u"?be:void 0]})));H.width=800;H.height=800;tt.$parent(document.body);var T=new On;T.init();be=()=>{var t=localStorage.getItem("save_obj_preferences"),n=!0,e=!0,r="object",i=1;t!=null&&(console.log(t),t=JSON.parse(t),n=t.texture,e=t.geometry,r=t.filename,i=t.square_size);var f=K(),o=g("div",{class:"prompt col"},g("div",{class:"row margin"},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>J("Geometry",s=>e=s,e),elements:[typeof J<"u"?J:void 0,typeof x<"u"?x:void 0,typeof e<"u"?e:void 0,typeof x<"u"?x:void 0,typeof e<"u"?e:void 0]},{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>J("Texture",s=>n=s,n),elements:[typeof J<"u"?J:void 0,typeof x<"u"?x:void 0,typeof n<"u"?n:void 0,typeof x<"u"?x:void 0,typeof n<"u"?n:void 0]}),g("div",{class:"row margin"},g("div",null,g("label",null,"File name"),g("input",{type:"text",class:"input",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>r,elements:[typeof r<"u"?r:void 0]},s=>r=s]})),g("div",null,g("label",null,"Texture voxel size"),g("input",{type:"number",class:"input",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>i,elements:[typeof i<"u"?i:void 0]},s=>i=s]}))),g("button",{class:"footer-button button",ref:f},"Export")),{close:a}=qe(o);f.$on("click",()=>{var s=Kn(T);if(n)if(i<=1){var u=nt(s);He(r+".png",u)}else{var u=et(s,i);He(r+".png",u)}if(e){var l=qn(s);Vn(r+".obj",l)}var d={filename:r,geometry:e,texture:n,square_size:i};localStorage.setItem("save_obj_preferences",JSON.stringify(d)),a()})};function Pe(t){const n=H.__element.getBoundingClientRect();var e=(t.clientX-n.left)*H.width/H.clientWidth,r=H.height-(t.clientY-n.top)*H.height/H.clientHeight-1;return[e,r]}function Ye(t,n,e,r,i){var f,o,a,s;t==e?f=1:f=1/Math.abs(e-t),n==r?o=1:o=1/Math.abs(r-n);for(var u=Math.min(f,o)*i,l=0,d=[],v=a,_=s;l<=1;)v=t*(1-l)+e*l,_=n*(1-l)+r*l,d.push([v,_]),l+=u;return d}async function rt(){var t=await fetch("./shader.vert").then(c=>c.text()),n=await fetch("./shader.frag").then(c=>c.text()),[e,r]=Hn(H.__element,t,n);r.antialias=!1,r.uniform_4_float.color_overlay=[0,0,0,1],pe=()=>{var c=localStorage.getItem("save_obj_preferences"),m="";c!=null&&(c=JSON.parse(c),m=c.filename);const y=K();var w=g("div",{class:"prompt-small col"},g("div",{class:"row margin"},g("div",null,g("label",null,"File name"),g("input",{type:"text",class:"input",model:[{key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>m,elements:[typeof m<"u"?m:void 0]},B=>m=B]}))),g("button",{class:"footer-button button",ref:y},"Export")),{close:A}=qe(w);y.$on("click",()=>{c.filename=m,localStorage.setItem("save_obj_preferences",JSON.stringify(c)),Ke(m+".vox",{voxels:T.voxels,color:T.color}),A()})},_e=async()=>{Qe("vox",({voxels:c,color:m})=>{T.voxels=c,T.color=m,T.init();var[y,L]=T.boundary,w=y[0]-L[0],A=y[1]-L[1],B=y[2]-L[2],L=Math.abs(Math.max(w,A,B));I(-6),R(),S(),k(Math.max(L,1)),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes,v()})};var i=null,f=[],o=0,a=0,s=!1,u=!1,l=-1,d=[];v();function v(c=!1){d.length>30&&(d=d.slice(1),l--),d=d.slice(0,l+1),d.push(JSON.parse(JSON.stringify([T.voxels,T.color,T.faces,c]))),l=d.length-1}xe=_,ge=h;function _(){if(l>0){const c=d[l][3];l--;const[m,y,w]=JSON.parse(JSON.stringify(d[l]));c&&k(.5),T.voxels=m,T.color=y,T.faces=w,T.init(),T.build(),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes}}function h(){if(l+1<d.length){l++;const[c,m,y,w]=d[l];w&&k(2),T.voxels=c,T.color=m,T.faces=y,T.build(),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes}}document.addEventListener("keydown",function(c){c.key=="Control"&&(u=!0),c.key=="z"&&c.ctrlKey&&_(),c.key=="y"&&c.ctrlKey&&h(),c.key=="x"&&c.ctrlKey&&oe()}),document.addEventListener("keyup",function(c){c.key=="Control"&&(u=!1)});var p=!1;H.$on("mousedown",c=>{if(p=u,!u){if(c.offsetX,c.offsetY,c.button==1)c.preventDefault();else if(c.button==0||c.button==2&&X=="Pen"){const[m,y]=Pe(c);o=m,a=y,s=!0,f=[[m,y]]}if(X=="Line"){const[m,y]=Pe(c);o=m,a=y,s=!0}c.button==0?Z=O:c.button==2&&(Z=z)}}),H.$on("mousemove",c=>{if(!s)return;const[m,y]=Pe(c);X=="Line"?f=[[o,a],...Ye(m,y,o,a,5),[m,y]]:(f.push(...Ye(m,y,o,a,5)),o=m,a=y)}),H.$on("contextmenu",c=>(c.preventDefault(),!1));var b=[];H.$on("mouseup",c=>{if(!(u||p)&&(b=[],f=[],s=!1,!!i)){if(X=="Pen"||X=="Line")if(q=="Sculpt"){if(c.button==0){var m=[];for(var y of i)m.push(...y.voxel.map(B=>B.map((L,G)=>L+y.direction[G])));m=[...new Set(m.map(JSON.stringify))].map(JSON.parse),T.add(...m),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes}else if(c.button==2){var m=[];for(var y of i)m.push(...y.voxel);T.remove(...m),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes}}else{if(c.button==0){Z=O;for(var y of i)for(var w=0;w<y.color.length;w++)for(var A=0;A<3;A++)y.color[w][A]=y.color[w][A]*(1-O[3])+O[A]*O[3]}else if(c.button==2){Z=z;for(var y of i)for(var w=0;w<y.color.length;w++)for(var A=0;A<3;A++)y.color[w][A]=y.color[w][A]*(1-z[3])+z[A]*z[3]}c.button==1&&(O=[...i[0].mouse_color,1],Z=O,Ge(O))}else if(q=="Sculpt")c.button==0?(T.add(...i.voxel.map(B=>B.map((L,G)=>L+i.direction[G]))),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes):c.button==2&&(T.remove(...i.voxel),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes);else{if(c.button==0){Z=O;for(var w=0;w<i.color.length;w++)for(var A=0;A<3;A++)i.color[w][A]=i.color[w][A]*(1-O[3])+O[A]*O[3]}else if(c.button==2){Z=z;for(var w=0;w<i.color.length;w++)for(var A=0;A<3;A++)i.color[w][A]=i.color[w][A]*(1-z[3])+z[A]*z[3]}c.button==1&&(O=[...i.mouse_color,1],Z=O,Ge(O))}v()}});const{update:F,mouse:E,zoom:k,resetPan:R,resetRotation:S,setZoom:I}=Jn(H,r,e);me=R,ye=S,oe=()=>{T.subdivide(),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes,k(2),v(!0)};function N(){e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.enable(e.CULL_FACE),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}zn(c=>{en.$html({key:"e0b8fc2b-fc7e-4786-bc05-b85187a8d065",expression:()=>c,elements:[typeof c<"u"?c:void 0]}),F(),r.attribute_matrix_3_float.normal=T.geometry_normals,r.attribute_matrix_3_float.position=T.geometry_vertexes;var m=null;r.buffer(()=>{e.clearColor(0,0,0,0),r.uniform_float.disable_lighting=1,N(),r.attribute_matrix_4_float.color=T.pick_map,r.drawSolid(T.geometry_indexes),X=="Pen"?s?(b.push(...f.map(y=>r.getPixel(y[0],y[1]))),f=[]):b=[r.getPixel(E.x,E.y)]:X=="Line"?s?b=f.map(y=>r.getPixel(y[0],y[1])):b=[r.getPixel(E.x,E.y)]:m=r.getPixel(E.x,E.y)}),r.uniform_float.disable_lighting=0,e.clearColor(.5,.5,.5,.9),e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(1,1),N(),i=null,X=="Pen"||X=="Line"?q=="Sculpt"?r.attribute_matrix_4_float.color=T.get_highlight(b,y=>i=y):r.attribute_matrix_4_float.color=T.get_highlight(b,y=>i=y,Z):q=="Sculpt"?r.attribute_matrix_4_float.color=T.highlight_plane(m,y=>i=y,X,ae):r.attribute_matrix_4_float.color=T.highlight_plane(m,y=>i=y,X,ae,Z),r.drawSolid(T.geometry_indexes),e.disable(e.POLYGON_OFFSET_FILL),$e&&(r.uniform_float.enable_color_overlay=1,r.drawLines(T.geometry_edge_index),r.uniform_float.enable_color_overlay=0)})}rt();
